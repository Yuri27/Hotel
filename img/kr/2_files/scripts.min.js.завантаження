function toggleClass(id,class1,class2){$("#"+id).toggleClass(class1),$("#"+id).toggleClass(class2)}function toggleVisibility(divId){$("#"+divId).toggle()}function merge(obj1,obj2){var result={};for(var i in obj1)i in obj2&&"object"==typeof obj1[i]&&null!==i?result[i]=merge(obj1[i],obj2[i]):result[i]=obj1[i];for(i in obj2)i in result||(result[i]=obj2[i]);return result}function handleDetailContent(content){content.find(".more-content-holder").length>0&&(content.find(".media .hotel-item .col-12 .ng-scope").each(function(){var currentContentHeight=$(this).find(".more-content-holder").height(),lineHeight=$(this).find(".more-content-holder").css("line-height");if("undefined"!=typeof lineHeight){var maxLineHeight=10*lineHeight.replace("px","");currentContentHeight>maxLineHeight?$(this).addClass("only-show-partial"):$(this).find(".toggle-content-less").addClass("hide-toggle-link")}}),content.find(".col-8").each(function(){var currentContentHeight=$(this).find(".more-content-holder").height(),lineHeight=$(this).find(".more-content-holder").css("line-height");if("undefined"!=typeof lineHeight){var maxLineHeight=10*lineHeight.replace("px","");currentContentHeight>maxLineHeight?$(this).find(".more-content-container").addClass("only-show-partial"):$(this).find(".toggle-content-less").addClass("hide-toggle-link")}}))}function handleMoreContent(content){var currentContentHeight=content.find(".more-content-holder").height(),maxLineHeight=10*content.find(".more-content-holder").css("line-height").replace("px","");currentContentHeight>maxLineHeight?content.find(".more-content-container").addClass("only-show-partial"):0==$(".featured-accordion").length&&content.find(".toggle-content-less").addClass("hide-toggle-link")}Function.prototype.bind||(Function.prototype.bind=function(oThis){"use strict";if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var aArgs=Array.prototype.slice.call(arguments,1),fToBind=this,FNOP=function(){},fBound=function(){return fToBind.apply(this instanceof FNOP&&oThis?this:oThis,aArgs.concat(Array.prototype.slice.call(arguments)))};return FNOP.prototype=this.prototype,fBound.prototype=new FNOP,fBound}),$(document).ready(function(){if($(document).on("input",".signin-now #account, .signin-now .sign-in-password",function(){$(this).removeClass("field-error")}),(window.navigator.userAgent.indexOf("MSIE ")>-1||window.navigator.userAgent.indexOf("Trident/")>-1)&&($(".select-styled select").change(function(event){$(this).blur()}),$(".lt-ie10 .select-styled option").each(function(){$(this).prepend("&nbsp;&nbsp;&nbsp;")})),$(".meetings").length>0&&$(".featured-2 .detail.general-content .col60 div.buttons-wrap-bottom").length>0&&$(".featured-2 .detail.general-content").each(function(idx){if($(this).find("div.moreless").length>0){var buttonsDiv=$(".col60 div.buttons-wrap-bottom",$(this));buttonsDiv.children("div.buttons-wrap-bottom .download:first").before('<br class="buttonsSeparator"/>'),$(this).append('<div class="col40 layer-two"></div><div class="col60 layer-two"></div>'),$(this).children("div.col60.layer-two").append(buttonsDiv)}else $("div.buttons-wrap-bottom",$(this)).css("display","inline-block")}),function(){var adThisSocialScripts=$(".addthis_social_script");adThisSocialScripts.length>0&&$(adThisSocialScripts[0]).append('<script type="text/javascript" src="'+adThisSocialScripts.attr("nosrc")+'"></script>')}(),function(){var socialLinkTemplates=$('script[type="template"].social_linking_page_template');if(socialLinkTemplates.length>0){var useTemplate=function(template,data){function replaceWithData(data_bit){var html_snippet,prop,regex;for(prop in data_bit)regex=new RegExp("{{"+prop+"}}","ig"),html_snippet=(html_snippet||template).replace(regex,data_bit[prop]);return html_snippet}var html="";return html+=replaceWithData(data)},getMetaContent=function(prop){for(var metas=document.getElementsByTagName("meta"),i=0;i<metas.length;i++)if(metas[i].getAttribute("property")==prop)return metas[i].getAttribute("content");return""},ogImage="";ogImage=getMetaContent("og:image"),socialLinkTemplates.each(function(){var template=useTemplate(this.innerHTML,{title:encodeURIComponent(document.title),link:encodeURIComponent(window.location.href),media:encodeURIComponent(ogImage)});$(this).after(template)})}}(),$(".general-content iframe[src*='www.youtube.com']").length>0){var $allVideos=$(".general-content").find("iframe[src*='www.youtube.com']");$allVideos.each(function(){var $el=$(this);$el.wrap('<div class="videoWrapper">'),$(this).css({position:"absolute",top:"0",left:"0",width:"100%",height:"100%"}),$(this).parent().css({position:"relative","padding-bottom":"56.25%","padding-top":"25px",height:"0","margin-bottom":"15px"})})}}),$(".meetings").length>0&&$(".featured-2 .detail.general-content .col60 div.buttons-wrap-bottom").length>0&&$(window).resize(function(){var width=Math.max(document.documentElement.clientWidth,window.innerWidth||0);width<=800?$(".featured-2 .detail.general-content").each(function(idx){if($(this).find("div.moreless").length>0){var buttonsDiv=$("div.col60.layer-two div.buttons-wrap-bottom",$(this)),targetDiv=$("div.col60 div.moreless",$(this));targetDiv.before(buttonsDiv)}else $("div.buttons.wrap-bottom",$(this)).css("display","")}):$(".featured-2 .detail.general-content").each(function(idx){if($(this).find("div.moreless").length>0){var buttonsDiv=$("div.col60 div.buttons-wrap-bottom",$(this)),targetDiv=$("div.col60.layer-two",$(this));targetDiv.append(buttonsDiv)}else $("div.buttons.wrap-bottom",$(this)).css("display","inline-block")})}),angular.module("radBlu",["ngCookies","ngResource","ngSanitize","ngRoute","ngTouch","ngAnimate","multi-select","ui.bootstrap.accordion","ui.bootstrap.modal","ui.bootstrap.tpls","ui.router","ui.date","filters","xml","slick","cgBusy","radBlu.search","radBlu.services","radBlu.weather","radBlu.offers","radBlu.floorplans","radBlu.floorplanfane","radBlu.exploreHotels","ng.shims.placeholder"]).config(["$sceDelegateProvider","$stateProvider","$urlRouterProvider","$locationProvider",function($sceDelegateProvider,$stateProvider,$urlRouterProvider,$locationProvider){"use strict";$sceDelegateProvider.resourceUrlWhitelist(["self","https://www.youtube.com/**","https://player.vimeo.com/**","https://media.videopolis.com/**","https://www.google.com/maps/**","https://camera.deckchair.com/**"]),$stateProvider.state("map-results",{url:"/map-results",views:{maps:{templateProvider:["$q","$http",function($q,$http){var loading=$q.defer(),mapResultsURL="";return null!==document.getElementById("mapResultsURL")&&null!==document.getElementById("mapResultsURL").getAttribute("data-URL")&&(mapResultsURL=document.getElementById("mapResultsURL").getAttribute("data-URL")),$http.get(mapResultsURL).success(function(html){$("#content .content-container:not([ui-view])").empty(),loading.resolve(html)}),loading.promise}]}}})}]).run(["$rootScope","$window","$log","xmlFilter","cookieUtilities","micecrowd","lazyLoading","navPositions","socialMediaFeeds","picturePolyfill","accordion",function($rootScope,$window,$log,xmlFilter,cookieUtilities,micecrowd,lazyLoading,navPositions,socialMediaFeeds,picturePolyfill,accordion){"use strict";function getWindowWidth(){$rootScope.windowWidth=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth}function screenOrientation(){var orientation=$(window).width()>$(window).height()?"landscape":"portrait";"landscape"===orientation?$("#wrap").addClass("landscape").removeClass("portrait"):$("#wrap").addClass("portrait").removeClass("landscape"),$window.setTimeout(function(){$rootScope.$broadcast("cr-uiEvent-orientation",orientation)},30)}function viewportCheck(){var windowWidth=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,windowHeight=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;windowWidth<801?($("#wrap").removeClass("tablet desktop").addClass("mobile"),$rootScope.viewport="mobile"):windowWidth>=801&&windowWidth<=1280?($("#wrap").removeClass("mobile desktop").addClass("tablet"),$rootScope.viewport="tablet"):($("#wrap").removeClass("mobile tablet").addClass("desktop"),$rootScope.viewport="desktop"),windowHeight>=801&&windowHeight<=1280&&windowWidth>=600&&windowWidth<=800?$("#wrap").addClass("tabletportrait"):$("#wrap").removeClass("tabletportrait")}function contentPosition(){setTimeout(function(){var navHeight=$("#header").outerHeight();if($(".secondary-nav-wrap").length>0){var marqueeHeight=0,marqueeHeader="";$("#marqueeHeader").length>0&&(marqueeHeader="#marqueeHeader "),$(marqueeHeader+".marquee-slide").not(".floorplan-slide").length>0&&(marqueeHeight=$(".marquee-slide").not(".floorplan-slide").height()),$(marqueeHeader+".hero-banner").length>0&&(marqueeHeight=$(".hero-banner").height()),$(marqueeHeader+".hero-banner--half").length>0&&(marqueeHeight=$(".hero-banner--half").height()),0===marqueeHeight&&(navHeight+=50)}$("#content").css("margin-top",navHeight+"px")},40)}function getHashParams(){for(var e,obj={},a=/\+/g,r=/([^&\/;=]+)=?([^&;]*)/g,d=function(s){return decodeURIComponent(s.replace(a," "))},q=window.location.hash.substring(1);e=r.exec(q);)obj[d(e[1])]=d(e[2]);return obj}$rootScope.viewport="",$rootScope.windowWidth="",$rootScope.weather=null,$rootScope.showDrawer=function(section){$rootScope.$broadcast("cr-uiEvent-showDrawer",{section:section})},$rootScope.isLayout=function(layoutType){return $("#wrap."+layoutType).length>0},$rootScope.isMobileLayout=function(){return $rootScope.isLayout("mobile")},$rootScope.isDesktopLayout=function(){return $rootScope.isLayout("desktop")},$rootScope.isTabletLayout=function(){var isLayoutTablet=$rootScope.isLayout("tablet")||$("#wrap").hasClass("tabletportrait");return isLayoutTablet},$rootScope.isDisplayRTL=function(){return $('html[dir="rtl"]').length>0},$(window).bind("click",function(e){$rootScope.$broadcast("cr-uiEvent-click",e)}),$(window).bind("resize",function(){screenOrientation(),viewportCheck(),contentPosition(),getWindowWidth()}).trigger("resize"),$(document).on("ready",function(){contentPosition()}),setTimeout(function(){var mainContainer=$("#wrap"),mainContent=$("#content"),mainFooter=$("#footer");$(mainContainer).waitForImages({finished:function(){mainContainer.fadeIn("slow"),$(mainContent).waitForImages({finished:function(){mainContent.fadeIn("slow"),$(mainFooter).waitForImages({finished:function(){mainFooter.fadeIn("slow")},each:function(loaded,count,success){},waitForAll:!0})},each:function(loaded,count,success){},waitForAll:!0})}}),$(".loading").removeClass("loading")},50),"undefined"==typeof console&&(this.console={log:function(){}}),getWindowWidth(),$(document).on("click",".toggle-content",function(){$(this).closest(".more-content-container").toggleClass("only-show-partial");var columnTwo=$(this).parents(".col60").siblings(".col60.layer-two");null!=columnTwo&&columnTwo.length>0&&$(columnTwo).toggleClass("remove-margin-top")});var locale=$("html").attr("lang");window.createCookie("locale",locale,7300);var openGenericPopup=function(content){if($(".js-msgContainer").length>0){$(".js-msgContainer").html(content);var inst=$.remodal.lookup[$("[data-remodal-id=genericMessage]").data("remodal")];inst.open()}},getAuthKey=function(callback){$.ajax({url:"/cs/Satellite",dataType:"json",type:"get",data:"pagename=generic/services/NewsletterManager&action=getSession",tryCount:0,retryLimit:1,success:function(response){"null"==response._authkey_?(this.tryCount++,this.tryCount<=this.retryLimit?$.ajax(this):openGenericPopup("Session failure.")):callback(response)},error:function(error){openGenericPopup(error)}})},setupNewsletterSignupForm=function(res){$(".js-rb_signupForm").append('<input type="hidden" name="_authkey_" value="'+res._authkey_+'">');var selectizeDropdownInstace,newslettterWidth=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,$selectizeDropdown=$(".js-selectize");$(window).bind("resize",function(){newslettterWidth=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,newslettterWidth>767?($selectizeDropdown.addClass("rb_selectizeTextField js-selectize"),$selectizeDropdown.parent().addClass("rb_form-inputWrapperFlexible"),$selectizeDropdown.removeClass("rb_form-select rb_form-select--bottomBorder rb_form-select--themeWhite rb_form-selectBgBlue"),void 0===selectizeDropdownInstace&&($selectizeDropdown.selectize({onChange:function(value){if($(".rb_selectizeTextField .selectize-dropdown").length>0){var customDropdownPosition=($("div[data-value="+value+"]").outerWidth(),$("div[data-value="+value+"]").offset().left),windowHalfWidth=($(window).width(),$(window).width()/2);customDropdownPosition<windowHalfWidth?($(".rb_selectizeTextField .selectize-dropdown").removeClass("left-aligned"),$(".rb_selectizeTextField .selectize-dropdown").removeClass("right-aligned"),$(".rb_selectizeTextField .selectize-dropdown").addClass("left-aligned")):($(".rb_selectizeTextField .selectize-dropdown").removeClass("left-aligned"),$(".rb_selectizeTextField .selectize-dropdown").removeClass("right-aligned"),$(".rb_selectizeTextField .selectize-dropdown").addClass("right-aligned"))}}}),selectizeDropdownInstace=$selectizeDropdown[0].selectize)):($selectizeDropdown.removeClass("rb_selectizeTextField js-selectize"),$selectizeDropdown.parent().removeClass("rb_form-inputWrapperFlexible"),$selectizeDropdown.addClass("rb_form-select rb_form-select--bottomBorder rb_form-select--themeWhite rb_form-selectBgBlue"),void 0!==selectizeDropdownInstace&&(selectizeDropdownInstace.destroy(),selectizeDropdownInstace=void 0,$selectizeDropdown.find("option:first").attr("selected","selected")))}).trigger("resize"),$(".js-rb_signupForm [type='email']").addClass("rb_form-textFieldHasContent"),$(".js-rb_signupForm [type='email']").val(res.emailid),jQuery.validator.setDefaults({ignore:[]}),$(".js-rb_signupForm").validate({errorClass:"rb_signupForm-error",rules:{firstname:"required",lastname:"required",gender:"required",country:"required",email:{required:!0}},submitHandler:function(form){var actionUrl=$(form).attr("action"),data=$(form).serialize();$.ajax({url:actionUrl,dataType:"json",contentType:"application/x-www-form-urlencoded",data:data,type:"post",beforeSend:function(){$("[name=subscribe]").prop("disabled",!0),$("[name=subscribe]").toggleClass("rb_button--themeBlue rb_button--themeGrey")},success:function(response){if(30==response.status||13==response.status)$(".js-rb_newsletterSignupError .rb_typeBody").html(response.message),"undefined"!=typeof response.title&&$(".js-rb_newsletterSignupError .rb_typeHeadline").html(response.title),$(".js-rb_newsletterSignupContainer").slideUp(),$(".js-rb_newsletterSignupError").show();else if(0!==response.status){$(".js-msgContainer").attr("data-parentmodal","signup"),$(".js-msgContainer").text(response.message);var inst=$.remodal.lookup[$("[data-remodal-id=genericMessage]").data("remodal")];inst.open()}else $(".js-rb_newsletterSignupResponse .rb_typeBody").html(response.message),$(".js-rb_newsletterSignupContainer").slideUp(),$(".js-rb_newsletterSignupResponse").show()},error:function(error){},complete:function(){$("[name=subscribe]").prop("disabled",!1),$("[name=subscribe]").toggleClass("rb_button--themeBlue rb_button--themeGrey")}})}})};$("body").on("click",".js-rb_newsletterSignupBackButton",function(e){$(".js-rb_newsletterSignupError").hide(),$(".js-rb_newsletterSignupContainer").slideDown()});var openNewsletterPopup=function(res){res.emailid=$("[name='newsletterForm'] [type='email']").val(),void 0!=querystringObj.newsletterunsubscribe&&querystringObj.newsletterunsubscribe.length>0&&0===$("[name='newsletterForm'] [type='email']").val().length&&(res.emailid=querystringObj.newsletterunsubscribe),void 0!=querystringObj.newslettersubscribe&&querystringObj.newslettersubscribe.length>0&&0===$("[name='newsletterForm'] [type='email']").val().length&&(res.emailid=querystringObj.newslettersubscribe);var data=$("[name='newsletterForm']").serialize(),url=$("[name='newsletterForm']").attr("data-formaction");data+="&_authkey_="+res._authkey_,$.ajax({url:url,dataType:"html",type:"get",data:data,success:function(response){if($("[data-remodal-id=signup]").length>0){$("[data-remodal-id=signup]").html(response);var inst=$.remodal.lookup[$("[data-remodal-id=signup]").data("remodal")];inst.open(),setupNewsletterSignupForm(res)}else openGenericPopup("Signup popup is not configured on page")},error:function(error){openGenericPopup(error)},complete:function(){}})};$rootScope.newsletterSignup=function(form){getAuthKey(openNewsletterPopup)};var performAction=function(res){var action=querystringObj.hasOwnProperty("newsletterdbloptin")?"dbloptin":"unsubscribe",popupid=querystringObj.hasOwnProperty("newsletterdbloptin")?"dbloptin":"unsubscribe",lanugage=void 0!=$("html").attr("lang")?$("html").attr("lang"):"en",data="pagename=generic/services/NewsletterManager&locale="+lanugage+"&action="+action;data+=querystringObj.hasOwnProperty("newsletterdbloptin")?"&tokenid="+querystringObj.newsletterdbloptin:"&email="+querystringObj.newsletterunsubscribe,data+="&_authkey_="+res._authkey_,$.ajax({url:"/cs/Satellite",dataType:"json",type:"post",data:data,success:function(response){if(0==response.status){action.indexOf("unsubscribe")>-1&&($("#unsubscribe_email").html(querystringObj.newsletterunsubscribe),$(".rb_newsletterPostcard-unsubscribe .rb_link").click(function(){getAuthKey(openNewsletterPopup)}));var inst=$.remodal.lookup[$("[data-remodal-id="+popupid+"]").data("remodal")];inst.open()}else openGenericPopup(response.message)},error:function(error){openGenericPopup(error)}})},querystringObj=getHashParams($window.location.search);(querystringObj.hasOwnProperty("newsletterdbloptin")&&$("[data-remodal-id=dbloptin]").length>0||querystringObj.hasOwnProperty("newsletterunsubscribe")&&$("[data-remodal-id=unsubscribe]").length>0)&&getAuthKey(performAction),querystringObj.hasOwnProperty("newslettersubscribe")&&getAuthKey(openNewsletterPopup);var updateSessionKey=function(res){$("[name=_authkey_]").val(res._authkey_)};$("[name=profile]").length>0&&$window.setInterval(function(){getAuthKey(updateSessionKey)},6e5);var doLogin=function(res){var form=$("[name=login]");$(form).find("[name=_authkey_]").val(res._authkey_);var url=$(form).attr("data-formaction"),data=$(form).serialize();$.ajax({url:url,dataType:"json",type:"post",data:data,beforeSend:function(){$("[name=subscribe]").prop("disabled",!0).toggleClass("rb_button--themeBlue rb_button--themeGrey")},success:function(response){0==response.status?window.location.reload(!0):openGenericPopup(response.message)},error:function(error){openGenericPopup(error)},complete:function(){$("[name=subscribe]").prop("disabled",!1).toggleClass("rb_button--themeBlue rb_button--themeGrey")}})};$rootScope.profileLogin=function(form){getAuthKey(doLogin)},micecrowd.init(),lazyLoading.init(),navPositions.init(),socialMediaFeeds.init(),picturePolyfill.init(),accordion.init()}]),angular.module("radBlu.floorplans",[]),angular.module("radBlu.floorplanfane",[]),$(document).on("opened",'[data-remodal-id="signup"]',function(){function resizeForText(text){var $this=$(this);text.trim()||$this.removeClass("rb_form-textFieldHasContent");var $span=$this.parent().find("span");$span.text(text.replace(/ /g,"|"));var $inputSize=$span.width(),$inputDefaultSize=$this.attr("data-default-size");$inputSize>$inputDefaultSize?$this.parent().css("width",$inputSize):$this.parent().removeAttr("style")}$(".rb_form-resizingInput").find("input").each(function(i,e){$(e).attr("data-default-size",$(e).width())});var $inputs=$(".js-resizingInput");$inputs.find("input").keypress(function(e){if(e.which&&e.charCode){var c=String.fromCharCode(e.keyCode|e.charCode),$this=$(this);resizeForText.call($this,$this.val()+c),$this.val().trim().length>=0&&!$this.hasClass("rb_form-textFieldHasContent")&&$this.addClass("rb_form-textFieldHasContent")}}),$inputs.find("input").keyup(function(e){if(8===e.keyCode||46===e.keyCode){var $this=$(this);resizeForText.call($this,$this.val())}else{if($("#wrap").hasClass("desktop"))return;var c=String.fromCharCode(e.keyCode|e.charCode),$this=$(this);resizeForText.call($this,$this.val()+c),$this.val().trim().length>=0&&!$this.hasClass("rb_form-textFieldHasContent")&&$this.addClass("rb_form-textFieldHasContent")}}),$inputs.find("input").each(function(){var $this=$(this);resizeForText.call($this,$this.val()),$this.attr("data-default-size",2)})}),$(function(){navigator.userAgent.toLowerCase().match(/iphone|ipod|ipad/)&&$("a").bind("click",function(evt){var href=$(this).attr("href");if(void 0!==href&&!href.match(/^#/)&&""!=href.trim()){var ret={};return $.when($(window).trigger("ays-beforeunload",ret)).done(function(){if(ret.message){var msg=ret.message+"\n\nPress OK to leave the page or Cancel to return.",msg=ret.message;confirm(msg)&&(window.location.href=href)}else window.location.href=href}),!1}})}),$(document).on("closing",'[data-remodal-id="genericMessage"]',function(e){var msgContainer=$(e.currentTarget).children(".js-msgContainer");if(void 0!=msgContainer.attr("data-parentmodal")&&msgContainer.attr("data-parentmodal").length>0){var parentpopup=msgContainer.attr("data-parentmodal");msgContainer.removeAttr("data-parentmodal");var inst=$.remodal.lookup[$("[data-remodal-id="+parentpopup+"]").data("remodal")];inst.open()}}),$(document).ready(function(){function swtichNativeDatePicker(){var $dobDatePickerInstance;if(navigator.userAgent.toLowerCase().match(/iphone|ipod|ipad/)){void 0!==$dobDatePickerInstance&&$dobDatePickerInstance.datepicker("destroy"),$(".js-rb_form-dob").attr("type","date").addClass("rb_form-dobNative");var maxDate=new Date;maxDate.setDate(maxDate.getDate()-1),maxDate=maxDate.getFullYear()+"-"+(maxDate.getMonth()+1)+"-"+maxDate.getDate(),$(".js-rb_form-dob").attr("max",maxDate);var minDate=new Date;minDate.setDate(minDate.getDate()-1),minDate.setFullYear(minDate.getFullYear()-99),minDate=minDate.getFullYear()+"-"+(minDate.getMonth()+1)+"-"+minDate.getDate(),$(".js-rb_form-dob").attr("min",minDate),$(".rb_form-dobNative").on("change",function(e){$(".js-rb_form-dob-formatted").val($(this).val())})}else $(".js-rb_form-dob").length>0&&($(".js-rb_form-dob").attr("type","text").removeClass("rb_form-dobNative"),$dobDatePickerInstance=$(".js-rb_form-dob").datepicker({changeMonth:!0,changeYear:!0,yearRange:"-99:c",maxDate:"-1d",dateFormat:"mm-dd-yy",altField:".js-rb_form-dob-formatted",altFormat:"yy-mm-dd",onSelect:function(){$(this).attr("readonly","readonly"),dirtyOn()}}),$(".js-rb_form-dob").val().length>0&&$dobDatePickerInstance.datepicker("setDate",new Date($(".js-rb_form-dob").val())))}function dirtyOn(){$(window).bind("beforeunload ays-beforeunload",function(evt,ret){return ret&&(ret.message=dirtyWarning),dirtyWarning}),isDirty=!0}function dirtyOff(){window.onbeforeunload=null,isDirty=!1}swtichNativeDatePicker(),jQuery.validator.addMethod("rb_emailValidation",function(value,element){return this.optional(element)||/^[\w\-]([\.\w])+[\w\W]+@([\w\-]+\.)+[a-zA-Z]{2,4}$/.test(value)},"Please enter a valid email address.");var parentElement=$(".rb_newsletterProfilePage");$(".js-rb_profileForm").validate({errorClass:"rb_profileForm-error",rules:{firstname:"required",lastname:"required",date_of_birth:{required:!1,date:!0},email:{required:!0,rb_emailValidation:!0}},submitHandler:function(form){var actionUrl=$(form).attr("action"),data=$(form).serialize();$.ajax({url:actionUrl,dataType:"json",contentType:"application/x-www-form-urlencoded",data:data,type:"post",beforeSend:function(){$(form).find("button").prop("disabled",!0)},success:function(response){$(".js-msgContainer").text(response.message);var inst=$.remodal.lookup[$("[data-remodal-id=genericMessage]").data("remodal")];if(inst.open(),0==response.status){var email=$('.js-rb_profileForm input[name="email"]').val();"undefined"!=typeof email&&($('#unsubscribeTab input[name="email"]').val(email),$('#unsubscribeTab form[name="unsubscribe"]').attr("action","#/newsletterunsubscribe="+email))}},error:function(){console.log("error")},complete:function(){$(form).find("button").prop("disabled",!1)}})}}),$(".js-rb_changePasswordForm").validate({errorClass:"rb_profileForm-error",rules:{password:"required",confirmpassword:{required:!0,equalTo:".js-rb_form-password"}},submitHandler:function(form){var actionUrl=$(form).attr("action"),data=$(form).serialize();$.ajax({url:actionUrl,dataType:"json",contentType:"application/x-www-form-urlencoded",data:data,type:"post",beforeSend:function(){$(form).find("button").prop("disabled",!0)},success:function(response){$(".js-msgContainer").text(response.message);var inst=$.remodal.lookup[$("[data-remodal-id=genericMessage]").data("remodal")];inst.open(),$('.js-rb_changePasswordForm input[type="password"]').val("")},error:function(){console.log("error")},complete:function(){$(form).find("button").prop("disabled",!1)}})}}),$(".js-list-item").each(function(){$(this).click(function(){$(this).hasClass("rb_list-itemActive")||($(".js-list-item").removeClass("rb_list-itemActive"),$(".js-loginPageTitle").html($(this).attr("data-title")),$(this).addClass("rb_list-itemActive"))})});var isDirty=!1,dirtyWarning="Changes you made may not be saved.",scrollMargin=40;$(".js-tab-menuItem").each(function(){$(this).click(function(e){"#resetPassword"==$(this).attr("data-target-id").replace("Tab","")?(e.preventDefault(),$(".js-tab-item").hide(),$($(this).attr("data-target-id")).show(),window.location=$(this).attr("data-target-id").replace("Tab","")):"#welcomeTab"==$(this).attr("data-target-id")?(e.preventDefault(),$(".js-tab-item").hide(),$($(this).attr("data-target-id")).show(),window.location.hash=""):($(".js-tab-item").hide(),$($(this).attr("data-target-id")).show()),$("#wrap").hasClass("desktop")||$("html, body").animate({scrollTop:$($(this).attr("data-target-id")).offset().top-($("#header").outerHeight()+$(".next-mobile").outerHeight()+scrollMargin)},500)})}),"#/resetPassword"==window.location.hash&&($("#welcomeTab").hide(),$("#resetPasswordTab").show()),parentElement.find(".js-saveProfileBtn").click(function(){dirtyOff()}),parentElement.find("[name=resetprofile]").click(function(){dirtyOff(),location.reload()}),jQuery("#searchForm").submit(function(){dirtyOff()}),parentElement.find("[name=firstname], [name=lastname], [name=gender], [name=addr1], [name=city], [name=postcode], [name=country], [name=language]").change(function(){dirtyOn()}),jQuery("body").on("change","#yourProfileTab [name=email]",function(){dirtyOn()}),$("#viewLanguage").change(function(){document.languageForm.action=$("#viewLanguage").val(),document.languageForm.submit()});var msgText=$.trim($(".js-msgContainer").text());if(msgText.length>0){var inst=$.remodal.lookup[$("[data-remodal-id=genericMessage]").data("remodal")];inst.open()}$(".js-icon-help").tooltip({tooltipClass:"ui-bookingForm"}),$(".js-icon-help").click(function(){$(this).tooltip("open")})});var getUrlParam=function(param){var lResults=new RegExp("[?&]"+param+"=([^&#]*)").exec(window.location.href);return null===lResults?null:decodeURI(lResults[1])||0};angular.module("filters",[]).filter("orderHotelsBy",[function(){"use strict";var showCountryHeader=function(items){var previousHeader="";angular.forEach(items,function(item){item.showHeader=!1,item.country!==previousHeader&&(item.showHeader=!0,previousHeader=item.country)})},showRateHeader=function(items){var previousHeader="";angular.forEach(items,function(item){item.showHeader=!1,item.rateHeader!==previousHeader&&(item.showHeader=!0,previousHeader=item.rateHeader)})};return function(items,sortType){return"destination"===sortType?(items=_.sortBy(items,function(item){return item.country+item.name}),showCountryHeader(items),items):"rate"===sortType?(items=_.sortBy(items,function(item){return+item.basePrice}),showRateHeader(items),items):"destination-rate"===sortType?(items=_.sortBy(items,function(item){return+item.basePrice}),items=_.sortBy(items,function(item){return item.country}),showCountryHeader(items),items):items}}]).filter("enabledBrandCodes",function(){return function(input){for(var i=0,len=input.length,result=[];i<len;i++)"undefined"!=typeof input[i].enabled&&input[i].enabled&&result.push(input[i].code);return result}}).filter("getById",function(){return function(input,id){for(var i=0,len=input.length;i<len;i++)if(+input[i].id===+id)return input[i];return null}}).filter("limitToEllipsis",function(){return function(input,maxLength){var result=input.substring(0,maxLength);return input.length>result.length&&(result+="..."),result}}).filter("trustAsResourceUrl",["$sce",function($sce){return function(val){return $sce.trustAsResourceUrl(val)}}]).filter("unique",function(){return function(items,filterOn){if(filterOn===!1)return items;if((filterOn||angular.isUndefined(filterOn))&&angular.isArray(items)){var newItems=[],extractValueToCompare=function(item){return angular.isObject(item)&&angular.isString(filterOn)?item[filterOn]:item};angular.forEach(items,function(item){for(var isDuplicate=!1,i=0;i<newItems.length;i++)if(angular.equals(extractValueToCompare(newItems[i]),extractValueToCompare(item))){isDuplicate=!0;break}isDuplicate||newItems.push(item)}),items=newItems}return items}}).filter("orderOffersBy",function(){return function(pOffers,pSortType){var lIncludedOffers=[],lExcludedOffers=[];return"lowest"!==pSortType&&"highest"!==pSortType||(angular.forEach(pOffers,function(offer,key){"RadBluWEOffer"==offer.offersubType&&"Yes"==offer.isBrandOffer?lExcludedOffers.push(offer):lIncludedOffers.push(offer)}),lExcludedOffers=_.sortBy(lExcludedOffers,function(offer){return offer.hotelFixture.mapMarker})),"lowest"===pSortType?(lIncludedOffers=_.sortBy(lIncludedOffers,function(offer){return+offer.sortingPrice}),lExcludedOffers.concat(lIncludedOffers)):"highest"===pSortType?(lIncludedOffers=_.sortBy(lIncludedOffers,function(offer){return-offer.sortingPrice}),lExcludedOffers.concat(lIncludedOffers)):pOffers}}).filter("removeSpecialCharacters",function(){return function(text){var textArea=document.createElement("textarea");textArea.innerHTML=text;var str=textArea.value.replace(/[`~!@#$%^&*()_|+\-=?;:'",.<>\{\}\[\]\\\/]/gi,"").replace(/ /g,"");return str}}).filter("replacePipeCharacter",function(){return function(text){var str=text.replace(/[|]/gi,"-");return str}}).filter("html",["$sce",function($sce){return function(text){return $sce.trustAsHtml(text)}}]),angular.module("radBlu.services",[]),angular.module("radBlu.services").service("userService",["$http","$log","$q","$timeout","$location",function($http,$log,$q,$timeout,$location){"use strict";var User=function(){return this.firstName="",this.lastName="",this.loggedIn=!1,this.accountNumber="",this.points=0,this.loginResponse="",this.doclocation="",this.certs=[{id:"0",name:"N/A"}],this.geolocation={lat:28,lng:2.3470599},this.reservations=[],this.$get=function(){return this},this};return User.prototype.fullName=function(){return this.firstName+" "+this.lastName},User.prototype.signin=function(){this.loggedIn=!0},User.prototype.checkIfLoggedIn=function(){"www.radisson.com"!=window.location.hostname&&this.checkIfLoggedInCall().success(_.bind(this.checkIfLoggedInSuccess,this)).error(_.bind(this.checkIfLoggedInError,this))},User.prototype.checkIfLoggedInCall=function(){var lLanguage=$('input[name="language"]').val();void 0!==lLanguage&&""!==lLanguage||(lLanguage=$("html").attr("lang"));var URL="https://"+window.location.hostname+"/myaccount/secure/fetchProfileWelcomeMessage.do";return"www.radisson.com"===window.location.hostname&&(URL="https://www.radissonblu.com/myaccount/secure/fetchProfileWelcomeMessage.do"),$http({url:URL,method:"jsonp",params:{callback:"JSON_CALLBACK",language:lLanguage}})},User.prototype.checkIfLoggedInSuccess=function(data){data.firstName&&(this.loggedIn=!0,this.firstName=data.firstName,this.lastName=data.lastName,this.points=data.accountBalance,this.accountNumber=data.accountNumber,data.reservationInformation&&this.reservations.push(data.reservationInformation)),
$log.log(data,status)},User.prototype.checkIfLoggedInError=function(data){this.loggedIn=!1,$log.log(data,status)},User.prototype.login=function(){var submitForm=!1;Modernizr.input.required&&("undefined"!=typeof this.account&&""!==this.account||$(".signin-now #account").addClass("ng-dirty"),"undefined"!=typeof this.password&&""!==this.password||$(".signin-now .sign-in-password").addClass("ng-dirty"),"undefined"==typeof this.account&&"undefined"==typeof this.password||""===this.account&&""===this.password||(submitForm=!0)),(Modernizr.input.required||submitForm)&&this.logInCall().success(_.bind(this.logInCallSuccess,this)).error(_.bind(this.logInCallError,this))},User.prototype.logInCall=function(){return $http({method:"POST",url:"/wcs/secure/loginService.do",data:$.param({userId:this.account,password:this.password,rememberMe:this.rememberMe}),headers:{"Content-Type":"application/x-www-form-urlencoded"}})},User.prototype.logInCallSuccess=function(data){if("success"===data.status)this.checkIfLoggedIn(),$timeout(function(){angular.element(".click-event-placeholder").triggerHandler("click")},0);else if(data.error.formErrors){var errorMsg="";angular.forEach(data.error.formErrors,function(formError){errorMsg+=formError.errorMessage+" "}),this.loginResponse=errorMsg}else this.loginResponse=data.error.errorMessage;$log.log(status.status),this.isAuth=!0,$log.log(data,status)},User.prototype.logInCallError=function(data){this.isAuth=!1,$log.log(data,status)},User.prototype.logOut=function(){return this.logOutCall().success(_.bind(this.logOutSuccess,this)).error(_.bind(this.logOutError,this))},User.prototype.logOutCall=function(data){return $http({url:"/secure/logout.do",method:"post"})},User.prototype.logOutSuccess=function(data){this.loggedIn=!1,this.firstName="",this.lastName="",this.points="",this.accountNumber="",this.rememberMe||(this.account="",this.password=""),this.reservations=[]},User.prototype.logOutError=function(data,status){console.log("error")},User.prototype.getDoclocation=function(){this.doclocation=$location.$$absUrl},User.prototype.getGeolocation=function(){var success,error,_this=this,deferred=$q.defer(),opts={maximumAge:1e3};return success=function(geo){_this.geolocation={lat:geo.coords.latitude,lng:geo.coords.longitude},deferred.resolve(geo)},error=function(){deferred.reject("Could not obtain position")},navigator.geolocation.getCurrentPosition(success,error,opts),deferred.promise},new User}]),angular.module("radBlu").service("OffersAndPromotionsService",["$http","$q",function($http,$q){"use strict";var OffersAndPromotionsService=function(){};return OffersAndPromotionsService.prototype.getSidebarDestinationData=function(locationId){var deferred=$q.defer(),getDestinationDataURL=$("#offerMapContentURL").attr("data-URL"),paramString="&packedargs=location="+locationId,url=getDestinationDataURL+paramString;return $http.get(url).success(function(response){deferred.resolve(OffersAndPromotionsService.prototype.createPromotionPackages(response.offerResults))}).error(function(response){deferred.reject(null)}),deferred.promise},OffersAndPromotionsService.prototype.getSidebarInterestData=function(interests){var deferred=$q.defer(),getInterestDataURL=$("#offerMapContentURL").attr("data-URL"),interestsString=interests.join(","),paramString="&packedargs=interests="+interestsString,url=getInterestDataURL+paramString;return $http.get(url).success(function(response){deferred.resolve(OffersAndPromotionsService.prototype.createPromotionPackages(response.offerResults))}).error(function(response){deferred.reject(null)}),deferred.promise},OffersAndPromotionsService.prototype.getCombinedSearchResultsData=function(searchCriteria,hasDateCriteria){var deferred=$q.defer(),getCombinedSearchDataURL=$("#offerMapContentURL").attr("data-URL");hasDateCriteria&&(getCombinedSearchDataURL=$("#refinedOfferMapContentURL").attr("data-URL"));var hasCriteria=!1,paramString="&packedargs=";null!==searchCriteria.interests&&searchCriteria.interests.length>0&&(paramString+="interests="+searchCriteria.interests.join(","),hasCriteria=!0),null!==searchCriteria.location&&searchCriteria.location>0&&(hasCriteria&&(paramString+="&"),paramString+="location="+searchCriteria.location,hasCriteria=!0),hasDateCriteria&&(hasCriteria&&(paramString+="&"),paramString+="checkInDate="+searchCriteria.dateSpan.checkInDate,paramString+="&checkOutDate="+searchCriteria.dateSpan.checkOutDate,hasCriteria=!0);var url=getCombinedSearchDataURL+paramString;return hasCriteria?($http.get(url).success(function(response){deferred.resolve(OffersAndPromotionsService.prototype.createPromotionPackages(response.offerResults))}).error(function(response){deferred.reject(null)}),deferred.promise):null},OffersAndPromotionsService.prototype.convertSecPricing=function(price,secPrice){return price!==secPrice?"("+secPrice+")":""},OffersAndPromotionsService.prototype.createPromotionPackages=function(offerResults){var result=[],uniqueHotels={},hotelOffers={},nonHotelOffers={};return _.each(offerResults,function(offersPackage,index){offersPackage.hotels&&offersPackage.hotels.length>0?_.each(offersPackage.hotels,function(hotel,index){if(offersPackage.hotelsBookingFixture[hotel.hotelCode]){var keyCode=hotel.hotelCode+"_"+offersPackage.offerId;uniqueHotels[hotel.hotelCode]||(hotel.mapMarker=String.fromCharCode("A".charCodeAt(0)+_.size(uniqueHotels)),hotel.latLng=[offersPackage.hotelsBookingFixture[hotel.hotelCode].lat,offersPackage.hotelsBookingFixture[hotel.hotelCode].lng],uniqueHotels[hotel.hotelCode]=hotel),hotelOffers[keyCode]||(hotelOffers[keyCode]=_.omit(offersPackage,"hotels"),hotelOffers[keyCode].hotelFixture=hotel),offersPackage.hotelFixture=hotel,offersPackage.mapMarker=offersPackage.hotelFixture.mapMarker,result.push(_.omit(offersPackage,"hotels"))}}):nonHotelOffers[offersPackage.offerId]=offersPackage}),_.each(nonHotelOffers,function(offer,index){result.push(offer)}),{hotels:hotelOffers,uniqueHotels:uniqueHotels,promotionPackages:result}},OffersAndPromotionsService.prototype.loadPromosData=function(){var deferred=$q.defer(),getFeaturedOffersURL=$("#getFeaturedOffersURL").attr("data-URL");return $http.get(getFeaturedOffersURL).success(function(response){deferred.resolve(response)}).error(function(response){deferred.reject(null)}),deferred.promise},new OffersAndPromotionsService}]),angular.module("radBlu.services").service("locationsService",["$http","$q",function($http,$q){"use strict";var locations={url:"/lcrExpSearch?callback=JSON_CALLBACK"};return locations.fetch=function(destination){var loading=$q.defer();return $http({url:locations.url,method:"jsonp",params:{city:destination,suggest:"true",singleSearch:"true",jsonp:"true"}}).success(function(data,status){_.each(data,function(item,index){item.isCategoryLabel||(item.display=decodeURIComponent(item.display))}),loading.resolve(data)}).error(function(data,status){loading.resolve([])}),loading.promise},locations}]);var mapWeatherURL="#";null!==document.getElementById("mapWeatherURL")&&null!==document.getElementById("mapWeatherURL").getAttribute("data-URL")&&(mapWeatherURL=document.getElementById("mapWeatherURL").getAttribute("data-URL")),angular.module("radBlu.services").service("carlsonService",["$http","$log",function($http,$log){var Carlson,defaultServices,environments;return defaultServices={bootstrap:{url:"https://www.radissonblu.com/gmaps/bootstrap.do"},markers:{url:"https://www.radissonblu.com/gmaps/markers.do",method:"get",params:{zoom:9,bounds:"48.494798,1.438983,49.215833,3.26546",center:"48.856614,2.352222",variants:["RAD_B"],callback:"JSON_CALLBACK"}},weather:{url:mapWeatherURL,method:"jsonp",params:{client:"EB39EA2D",pageType:"WEATHER",format:"json",callback:"JSON_CALLBACK"}},suggestLocations:{url:"/lcrExpSearch",method:"jsonp",params:{maxResults:"10",suggest:"true",singleSearch:"true",jsonp:"true",callback:"JSON_CALLBACK"}},mapSearch:{url:"/gmaps/gmapsearch.do",method:"post",params:{searchTerm:"Chicago",googleResults:",41.8781136,-87.62979819999998,Chicago, IL, USA",requestVersion:"2"}},googleGecoderSearch:{url:"/reservation/googleGeocoderSuggestionsSearch.do",method:"post",params:{requestVersion:"2"}}},environments={local:{bootstrap:{url:"/gmaps/bootstrap.do",cache:!0,method:"get",params:{callback:"JSON_CALLBACK"}},markers:{url:"/gmaps/markers.do",cache:!0},weather:{url:mapWeatherURL,cache:!0,method:"get",dataType:"jsonp"},suggestLocations:{url:"/lcrExpSearch",cache:!0},mapSearch:{url:"/gmaps/gmapsearch.do",cache:!0,method:"post"}},dev:{bootstrap:{url:"/gmaps/bootstrap.do",cache:!0,method:"get",params:{callback:"JSON_CALLBACK"}},markers:{url:"/gmaps/markers.do",cache:!0},weather:{url:mapWeatherURL,cache:!0,method:"get",dataType:"jsonp"},suggestLocations:{url:"/lcrExpSearch",cache:!0},mapSearch:{url:"/gmaps/gmapsearch.do",cache:!0,method:"post"}},stage:{bootstrap:{url:"/gmaps/bootstrap.do",cache:!0,method:"get",params:{callback:"JSON_CALLBACK"}},markers:{url:"/gmaps/markers.do",cache:!0},weather:{url:mapWeatherURL,cache:!0,method:"get",dataType:"jsonp"},suggestLocations:{url:"/lcrExpSearch",cache:!0},mapSearch:{url:"/gmaps/gmapsearch.do",cache:!0,method:"post"}},prod:{bootstrap:{url:"https://www.radissonblu.com/gmaps/bootstrap.do",cache:!0,method:"get",params:{callback:"JSON_CALLBACK"}},markers:{url:"https://www.radissonblu.com/gmaps/markers.do",cache:!0},weather:{url:mapWeatherURL,cache:!0,method:"get",dataType:"jsonp"},suggestLocations:{url:"/lcrExpSearch",cache:!0},mapSearch:{url:"/gmaps/gmapsearch.do",cache:!0,method:"post"}}},Carlson=function(){this.environment="local",window.location.href.indexOf("devradblu1")>-1?(this.environment="dev",$log.log("development")):window.location.href.indexOf("owcs-edit")>-1?(this.environment="stage",$log.log("stage")):window.location.href.indexOf("www.radissonblu.com")>-1||window.location.href.indexOf("www.radisson.com")>-1?(this.environment="prod",$log.log("prod")):$log.log("local"),this.brands=[{name:"Radisson Blu",code:"RAD_B",enabled:!0},{name:"Radisson",code:"RAD_G",enabled:!1},{name:"Radisson Blu Edwardian",code:"RAD_E",enabled:!1},{name:"Radisson Red",code:"RAD_R",enabled:!1},{name:"Country Inns & Suites",code:"CHI",enabled:!1},{name:"Park Inn",code:"PII",enabled:!1},{name:"Park Plaza",code:"PKP",enabled:!1},{name:"Art'otels",code:"PKP_A",enabled:!1}],this.updateServices()},Carlson.prototype.updateServices=function(){var envCopy=angular.copy(environments[this.environment]),defaultCopy=angular.copy(defaultServices);this.services=merge(envCopy,defaultCopy)},Carlson.prototype.fetch=function(service,options){var serv=angular.copy(this.services[service]);return serv.params=serv.params||{},options.params=options.params||{},angular.extend(serv.params,options.params),$http(serv)},Carlson.prototype.weatherByCity=function(metroCode){return this.fetch("weather",{params:{metroCode:metroCode}})},Carlson.prototype.weatherByHotelCode=function(hotelCode){return this.fetch("weather",{params:{hotelCode:hotelCode}})},Carlson.prototype.suggestLocations=function(q){return this.fetch("suggestLocations",{params:{city:q||""}})},Carlson.prototype.searchLatLng=function(){return this.fetch("searchLatLng",{params:{address:"Chicago",sensor:"false"}})},Carlson.prototype.locationSearch=function(){return this.fetch("searchLatLng")},Carlson.prototype.googleGecoderSearch=function(searchTerm,googleResults){return this.fetch("googleGecoderSearch",{params:{searchTerm:searchTerm,googleResults:googleResults}})},new Carlson}]),angular.module("radBlu").service("reservationModel",["$location",function($location){"use strict";window.reservationModel=this,this.locations={suggestedList:[]},this.selectionMade=!1,this.destination={displayVal:"",searchedVal:"",hotelCode:"",hotelName:"",zoomLevel:2,cityId:"",geoCoordinates:{lat:"",lng:""},address:"78 Bis Avenue Marceau (8� Arr), FR-75008 Paris"},this.rate={rateType:"",rateVal:"",rmcCode:""},this.rooms={numOfRooms:1,roomsArray:[{adults:1,children:0},{adults:1,children:0},{adults:1,children:0},{adults:1,children:0},{adults:1,children:0},{adults:1,children:0},{adults:1,children:0},{adults:1,children:0},{adults:1,children:0}]},this.dates={checkInReservation:null,checkOutReservation:null,checkInDay:null,checkInMonth:null,checkInDate:null,checkOutDay:null,checkOutMonth:null,checkOutDate:null,dateString:function(date){var month=date.getMonth()+1,day=date.getDate(),year=date.getFullYear();return month<10&&(month="0"+month),day<10&&(day=""+day),year+month+day},checkInDateString:function(){return this.dateString(this.checkInDate)},checkOutDateString:function(){return this.dateString(this.checkOutDate)}},this.setDefaultDates=function(){var today=new Date,tomorrow=new Date(today.getTime()+864e5),twoDays=new Date(today.getTime()+1728e5),checkInMonth=tomorrow.getMonth()+1,checkOutMonth=twoDays.getMonth()+1,todayArray=today.toString().split(" "),tomorrowArray=tomorrow.toString().split(" ");twoDays.toString().split(" ");checkInMonth=(checkInMonth<10?"0":"")+checkInMonth,checkOutMonth=(checkOutMonth<10?"0":"")+checkOutMonth,this.dates.checkInDay=todayArray[2],this.dates.checkInMonthShow=todayArray[1],this.dates.checkOutDay=tomorrowArray[2],this.dates.checkOutMonthShow=tomorrowArray[1],this.dates.checkInYear=todayArray[3],this.dates.checkOutYear=tomorrowArray[3],this.dates.checkInDate=today.setHours(0,0,0,0),this.dates.checkOutDate=tomorrow.setHours(0,0,0,0),this.dates.checkInDateFormated||(this.dates.checkInDateFormated=today.getMonth()+1+"/"+today.getDate()+"/"+today.getFullYear()),this.dates.checkOutDateFormated||(this.dates.checkOutDateFormated=tomorrow.getMonth()+1+"/"+tomorrow.getDate()+"/"+tomorrow.getFullYear()),this.dates.checkInDateFormatted||(this.dates.checkInDateFormatted=new Date(today)),this.dates.checkOutDateFormatted||(this.dates.checkOutDateFormatted=new Date(tomorrow)),this.dates.checkInDateNoMinFormated||(this.dates.checkInDateNoMinFormated=today.getMonth()+1+"/"+today.getDate()+"/"+today.getFullYear()),this.dates.checkOutDateNoMinFormated||(this.dates.checkOutDateNoMinFormated=tomorrow.getMonth()+1+"/"+tomorrow.getDate()+"/"+tomorrow.getFullYear()),this.dates.checkInReservation=" ",this.dates.checkOutReservation=" ",this.dates.checkInMonth=" ",this.dates.checkOutMonth=" "},this.buildRooms=function(){for(var roomsUrl="",i=0;i<this.rooms.numOfRooms;i+=1)roomsUrl+="&rateSearchForm.o["+i+"].a="+this.rooms.roomsArray[i].adults,roomsUrl+="&rateSearchForm.o["+i+"].c="+this.rooms.roomsArray[i].children;return roomsUrl},this.selectValues={1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",9:"9"},this.selectRange="1",this.buildRates=function(rateType,rateVal){if(""!==rateType){var rate="&rateSearchForm."+rateType+"="+rateVal;return rate}return""},this.hotelBookingFunnelUrl=function(hotelUrl,hotelId,promoCode){var currentURLPieces=(hotelUrl.indexOf(".")>0?hotelUrl.split(".")[1]:hotelUrl,document.URL.split("/")),url=(currentURLPieces[currentURLPieces.length-1],hotelUrl);return url+="?numberRooms="+this.rooms.numOfRooms,url+="&hotelCode="+hotelId,url+="&rmcCode="+this.rate.rmcCode,url+="&promotionalCode="+promoCode,url+="&startDate="+this.dates.checkInDateFormated,url+="&endDate="+this.dates.checkOutDateFormated,url+=this.buildRates(this.rate.rateType,this.rate.rateVal),url+=this.buildRooms()},this.setSearchLocation=function(locationId,locationName){if($('.destination input[type="hidden"]').val(""),this.destination.displayVal=locationName.replace(/\+/g," "),this.destination.searchedVal=locationName.replace(/\+/g," "),/^[a-zA-Z]*$/.test(locationId))$('input[name="citySearchForm.country"]').val(locationId),$('.destination input[name="cityId"]').val("0");else if(locationId.indexOf(" ")>=0){var countryState=locationId.split(" ");$('input[name="citySearchForm.country"]').val(countryState[0]),$('input[name="citySearchForm.countryAndState"]').val(locationId),$('input[name="citySearchForm.state"]').val(countryState[1])}else $('input[name="citySearchForm.cityId"]').val(locationId)}}]),angular.module("radBlu").service("citySearch",[function(){"use strict";window.citySearch=this,this.locations={suggestedList:[]},this.destination={displayVal:"",hotelCode:"",hotelName:"",geoCoordinates:{lat:"",lng:""},address:""},this.setSearchLocation=function(locationId,locationName){if($('.destination input[type="hidden"]').val(""),this.destination.displayVal=locationName.replace(/\+/g," "),/^[a-zA-Z]*$/.test(locationId))$('input[name="citySearchFormSearch.country"]').val(locationId),$('.destination input[name="cityId"]').val("0");else if(locationId.indexOf(" ")>=0){var countryState=locationId.split(" ");$('input[name="citySearchFormSearch.country"]').val(countryState[0]),$('input[name="citySearchFormSearch.countryAndState"]').val(locationId),$('input[name="citySearchFormSearch.state"]').val(countryState[1])}else $('input[name="citySearchFormSearch.cityId"]').val(locationId)}}]),angular.module("radBlu.services").factory("messageBus",[function(){"use strict";var topics={},subUid=-1,API={subscribe:function(topic,func){topics[topic]||(topics[topic]=[]);var token=(++subUid).toString();return topics[topic].push({token:token,func:func}),token},publish:function(topic,args){return!!topics[topic]&&(setTimeout(function(){for(var subscribers=topics[topic],len=subscribers?subscribers.length:0;len--;)subscribers[len].func(topic,args)},0),!0)},unsubscribe:function(token){for(var m in topics)if(topics[m])for(var i=0,j=topics[m].length;i<j;i++)if(topics[m][i].token===token)return topics[m].splice(i,1),token;return!1}};return API}]),angular.module("radBlu").service("GeolocationService",["$q",function($q){"use strict";var GeolocationService=function(){};return GeolocationService.prototype.getByLatLng=function(latLng){var gettingResults=$q.defer();return loadGoogleMapsApi(function(){var geocoder=new google.maps.Geocoder;geocoder.geocode({latLng:latLng},function(results,status){status===google.maps.GeocoderStatus.OK?results.length&&gettingResults.resolve(results[0]):gettingResults.reject()})}),gettingResults.promise},GeolocationService.prototype.getByAddress=function(address){var gettingResults=$q.defer();return loadGoogleMapsApi(function(){var geocoder=new google.maps.Geocoder;geocoder.geocode({address:address},function(results,status){status===google.maps.GeocoderStatus.OK?results.length&&gettingResults.resolve(results[0]):gettingResults.reject()})}),gettingResults.promise},GeolocationService.prototype.getByMapAddress=function(address,isCountrySearch){var gettingResults=$q.defer();return loadGoogleMapsApi(function(){var geocoder=new google.maps.Geocoder;geocoder.geocode({address:address},function(results,status){if(status===google.maps.GeocoderStatus.OK){if(1==results.length)gettingResults.resolve(results[0]);else if(results.length>1)if(isCountrySearch){for(var j=0;j<results.length;j++)if("country"==results[j].address_components[0].types[0])return gettingResults.resolve(results[j]),gettingResults.promise}else gettingResults.resolve(results[0])}else gettingResults.reject()})}),gettingResults.promise},GeolocationService.prototype.getMetroCode=function(address){var _this=this;return this.get(address).then(function(result){return _this.parseMetroCode(result)})},GeolocationService.prototype.parseMetroCode=function(location){var city=this.getAddressValue(location,"locality"),state=this.getAddressValue(location,"administrative_area_level_1","short_name"),country=this.getAddressValue(location,"country","short_name");return"US"===country||"USA"===country||"CA"===country||"MX"===country?encodeURI(city+":"+state+":"+country):encodeURI(city+"::"+country)},GeolocationService.prototype.getAddressValue=function(location,type,field){field=field||"long_name";var component=_.find(location.address_components,function(component){return _.intersection([type],component.types).length});return component?component[field]:""},new GeolocationService}]),angular.module("radBlu.services").factory("mapLocUpdateService",[function(){"use strict";var location=[],zoom=0,locationAndZoom=[],updateLocation=function(loc){location=new google.maps.LatLng(loc.lat,loc.lng)},getLocation=function(){return location},updateZoom=function(pZoom){zoom=0,isNaN(pZoom)||(zoom=pZoom)},getZoom=function(){return zoom},updateLocationAndZoom=function(pLocation,pZoom){locationAndZoom=[],updateLocation(pLocation),updateZoom(pZoom),locationAndZoom.push(location),locationAndZoom.push(zoom)},getLocationAndZoom=function(){return locationAndZoom};return{updateLocation:updateLocation,getLocation:getLocation,updateZoom:updateZoom,getZoom:getZoom,updateLocationAndZoom:updateLocationAndZoom,getLocationAndZoom:getLocationAndZoom}}]),angular.module("radBlu").service("mapUtilityService",["brandColorValues","$q","sharedSearchMap",function(brandColorValues,$q,sharedSearchMap){"use strict";this.map=null,this.$mapElement=null;var _this=this,deferred=$q.defer();_this.getService=function(){return deferred.promise},loadGoogleMapsApi(function(){_this.mapOptions={maxZoom:14,minZoom:2,zoom:2,disableDefaultUI:!0,overviewMapControl:!0,overviewMapControlOptions:{opened:!1},zoomControl:!0,zoomControlOptions:{position:google.maps.ControlPosition.LEFT_CENTER,style:google.maps.ZoomControlStyle.SMALL},center:{lat:10,lng:2},scaleControlOptions:{position:google.maps.ControlPosition.BOTTOM_RIGHT}},_this.localMarkers=[],_this.regionalMarkers=[],_this.worldMarkers=[],_this.interestMarkers=[],_this.currentLocalMarkerSymbol="A",_this.currentInterestMarkerSymbol="A";var defaultCityZoom=12;_this.initializeValues=function(mapElement){_this.$mapElement=$(mapElement),_this.resizeMapViewPort()},_this.createMap=function(mapElement,options){return _this.$mapElement=$(mapElement),_this.resizeMapViewPort(),_this.map=new google.maps.Map(mapElement,_this.mapOptions),google.maps.event.trigger(_this.map,"resize"),$(window).on("resize",_.bind(_this.resizeMapViewPort,_this)),_this.map},_this.clearLocalMarkers=function(){_.each(_this.localMarkers,function(marker){marker.setMap(null)}),_this.localMarkers=[],_this.currentLocalMarkerSymbol="A"},_this.resizeMapViewPort=_.debounce(function(){var windowHeight=Math.floor($(window).height()),topBarHeight=Math.floor($(".top-bar").height());_this.$mapElement.height(windowHeight-topBarHeight)},200),_this.createMatchedInterests=function(pMarker,pInterestString){var lMatchingInterests=[],interestSelectionArray=pInterestString.split(",");return _.each(pMarker.interests,function(hotelInterest){var hotelInterestKey=hotelInterest.internalKey;interestSelectionArray.indexOf(hotelInterestKey)>-1&&lMatchingInterests.push(hotelInterest)}),lMatchingInterests},_this.matchesAllInterests=function(pMarker,pInterestString){var interestSelectionArray=pInterestString.split(","),hotelInterestString="",matchesAll=!0;return _.each(pMarker.interests,function(hotelInterest){var hotelInterestKey=hotelInterest.internalKey;hotelInterestString+=","+hotelInterestKey}),_.each(interestSelectionArray,function(selectedInterest){if(hotelInterestString.indexOf(selectedInterest)===-1)return matchesAll=!1,!1}),matchesAll},_this.filterExistingInterestMarkers=function(pInterestString){var __this=_this;if(""!==pInterestString){var modifiedInterestMarkers=[],interestFound=!1,interestSelectionArray=pInterestString.split(",");__this.currentInterestMarkerSymbol="A",_.each(interestSelectionArray,function(selectedInterest){_.each(__this.interestMarkers,function(interestMarker){_.each(interestMarker.interests,function(hotelInterest){var hotelInterestKey=hotelInterest.internalKey;interestFound=selectedInterest===hotelInterestKey}),1==interestFound&&modifiedInterestMarkers.push(interestMarker)})}),__this.interestMarkers=modifiedInterestMarkers}return __this.interestMarkers},_this.createLocalMarkers=function(propertyMarkers,markerClickCallback){var __this=_this;_.each(propertyMarkers,function(localMarker){localMarker.lat&&localMarker.lng&&"RAD_B"==localMarker.variant?__this.localMarkers.push(__this.createMarker(localMarker,markerClickCallback,!0)):console.error("failed to create world marker for",localMarker,"no lat lng data found")})},_this.createOfferMarkers=function(offerFixtures,markerClickCallback){var __this=_this;return __this.currentInterestMarkerSymbol="A",_.each(offerFixtures,function(offerMarker){if(offerMarker.latLng){var lMarker=__this.createInterestMarker(offerMarker,markerClickCallback,!1,!0);__this.interestMarkers.push(lMarker)}else console.error("failed to create offer marker for",offerMarker,"no lat lng data found")}),__this.interestMarkers},_this.createInterestMarkers=function(interestFixtures,markerClickCallback,isLocalMarkerSet,interestString,isOffer){var __this=_this;return __this.currentInterestMarkerSymbol="A",_.each(interestFixtures,function(interestMarker){if(interestMarker){var markerStartingPoint=null,latLng=null;isLocalMarkerSet?(markerStartingPoint=interestMarker.hotelFixture,interestMarker.bookingFixture&&(markerStartingPoint.bookingFixture=interestMarker.bookingFixture,latLng=[interestMarker.bookingFixture.lat,interestMarker.bookingFixture.lng])):(latLng=[interestMarker.lat,interestMarker.lng],markerStartingPoint=interestMarker),interestMarker.latLng=latLng;var hotelLatLng=interestMarker.latLng;if(markerStartingPoint.latLng=latLng,hotelLatLng)if(""===interestString){var lMarker=__this.createInterestMarker(markerStartingPoint,markerClickCallback,!1,isOffer);lMarker.matchedInterests={},__this.interestMarkers.push(lMarker)}else{var matchesInterests=__this.matchesAllInterests(markerStartingPoint,interestString);if(matchesInterests){var lMarker=__this.createInterestMarker(markerStartingPoint,markerClickCallback,!1,isOffer);__this.interestMarkers.push(lMarker)}}else console.error("failed to create interest marker for",interestMarker,"no lat lng data found")}}),__this.interestMarkers},_this.createInterestMarker=function(fixture,markerClickCallback,hideMarker,isOffer){var mapMarker=_this.getMapMarker(fixture,!0),mapValue=hideMarker?null:_this.map,googleMapMarker=new google.maps.Marker({position:new google.maps.LatLng(fixture.latLng[0],fixture.latLng[1]),icon:_this.createMarkerIcon(fixture,mapMarker),map:mapValue,active:!1,scaledSize:new google.maps.Size(100,100),mapMarker:mapMarker});return isOffer?(googleMapMarker.offerFixture={},angular.extend(googleMapMarker.offerFixture,fixture)):(googleMapMarker.hotelFixture={},googleMapMarker.bookingFixture={},angular.extend(googleMapMarker.hotelFixture,fixture),fixture.bookingFixture&&angular.extend(googleMapMarker.bookingFixture,fixture.bookingFixture)),google.maps.event.addListener(googleMapMarker,"click",_this.markerClick),google.maps.event.addListener(googleMapMarker,"click",function(){_.isFunction(markerClickCallback)&&markerClickCallback()}),googleMapMarker},_this.createBootstrapMarkers=function(bootstrapResponse,markerClickCallback){var __this=_this;__this.hideMarkers(__this.worldMarkers),__this.hideMarkers(__this.regionalMarkers),_.each(bootstrapResponse.worldMarkers,function(worldMarker){var worldMarkerHasProperty=Number(worldMarker.RAD_B),hideMarker=!1,excludedMarker=sharedSearchMap.excludedMarkers()[worldMarker.id];"undefined"!=typeof excludedMarker&&excludedMarker.lat==worldMarker.lat&&excludedMarker.lng==worldMarker.lng&&(hideMarker=!0),!hideMarker&&worldMarker.lat&&worldMarker.lng?worldMarkerHasProperty>0&&__this.worldMarkers.push(__this.createMarker(worldMarker,markerClickCallback,!1)):console.error("failed to create world marker for",worldMarker,"no lat lng data found")}),_.each(bootstrapResponse.regionalMarkers,function(regionalMarker){var regionalMarkerHasProperty=Number(regionalMarker.RAD_B),hideMarker=!1,excludedMarker=sharedSearchMap.excludedMarkers()[regionalMarker.id];"undefined"!=typeof excludedMarker&&excludedMarker.lat==regionalMarker.lat&&excludedMarker.lng==regionalMarker.lng&&(hideMarker=!0),!hideMarker&&regionalMarker.lat&&regionalMarker.lng?regionalMarkerHasProperty>0&&__this.regionalMarkers.push(__this.createMarker(regionalMarker,markerClickCallback,!0)):console.error("failed to create region marker for",regionalMarker,"no lat lng data found")})},_this.createMarker=function(marker,markerClickCallback,hideMarker){var mapMarker=_this.getMapMarker(marker,!1),mapValue=hideMarker?null:_this.map,googleMapMarker=angular.extend(new google.maps.Marker({position:new google.maps.LatLng(marker.lat,marker.lng),icon:_this.createMarkerIcon(marker,mapMarker),map:mapValue,active:!1,scaledSize:new google.maps.Size(100,100),mapMarker:mapMarker}),marker);return google.maps.event.addListener(googleMapMarker,"click",_this.markerClick),google.maps.event.addListener(googleMapMarker,"click",function(){_.isFunction(markerClickCallback)&&markerClickCallback()}),googleMapMarker},_this.getMapMarker=function(marker,isInterestMarker){return marker.RAD_B?marker.RAD_B:isInterestMarker?_this.createAlphaInterestMarkerSymbol(marker):_this.createAlphaLocalMarkerSymbol(marker)},_this.createAlphaInterestMarkerSymbol=function(marker){var symbol=_this.currentInterestMarkerSymbol;return _this.incrementInterestMarkerSymbol(),marker.markerSymbol=symbol,symbol},_this.createAlphaLocalMarkerSymbol=function(marker){var symbol=_this.currentLocalMarkerSymbol;return _this.incrementLocalMarkerSymbol(),marker.markerSymbol=symbol,symbol},_this.incrementLocalMarkerSymbol=function(){function nextChar(c){return String.fromCharCode(c.charCodeAt(0)+1)}var nextSymbol;return nextSymbol=nextChar(_this.currentLocalMarkerSymbol),_this.currentLocalMarkerSymbol=nextSymbol,_this.currentLocalMarkerSymbol},_this.incrementInterestMarkerSymbol=function(){function nextChar(c){return String.fromCharCode(c.charCodeAt(0)+1)}var nextSymbol;return nextSymbol=nextChar(_this.currentInterestMarkerSymbol),_this.currentInterestMarkerSymbol=nextSymbol,_this.currentInterestMarkerSymbol},_this.createMarkerIcon=function(marker,mapMarker){var wh=[21,34];return{url:_this.getMarkerIconUrl(marker,mapMarker),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(wh[0]/2,wh[1]),size:new google.maps.Size(wh[0],wh[1]),scaledSize:new google.maps.Size(wh[0],wh[1])}},_this.getMarkerIconUrl=function(marker,mapMarker){return"//chart.googleapis.com/chart?chst=d_map_pin_letter&chld="+mapMarker+"|"+brandColorValues[_this.getBrandType(marker)]+"|FFFFFF"},_this.getBrandType=function(marker){var result=marker.variant||"RAD_B";return null===marker?result:(Number(marker.RAD_B)>0?result="RAD_B":Number(marker.RAD_G)>0?result="RAD_G":Number(marker.RAD_E)>0?result="RAD_E":Number(marker.RAD_R)>0?result="RAD_R":Number(marker.CHI)>0?result="CHI":Number(marker.PII)>0?result="PII":Number(marker.PKP)>0?result="PKP":Number(marker.PKP_A)>0&&(result="PKP_A"),result)},_this.markerClick=function(event){var lCityId=this.id,lZoomLevel=defaultCityZoom,lLat=event.latLng.lat(),lLng=event.latLng.lng();"undefined"==typeof lCityId||isNaN(lCityId)||"undefined"==typeof sharedSearchMap.markerClickOverride()[lCityId]||(""!==sharedSearchMap.markerClickOverride()[lCityId].zoom&&(lZoomLevel=parseInt(sharedSearchMap.markerClickOverride()[lCityId].zoom)),""!==sharedSearchMap.markerClickOverride()[lCityId].lat&&""!==sharedSearchMap.markerClickOverride()[lCityId].lng&&(lLat=sharedSearchMap.markerClickOverride()[lCityId].lat,lLng=sharedSearchMap.markerClickOverride()[lCityId].lng)),_this.map.setCenter({lat:lLat,lng:lLng}),_this.map.getZoom()<lZoomLevel&&_this.map.setZoom(lZoomLevel)},_this.handleZoomChanged=function(){var farWorldZoom=4,closeWorldZoom=9;_this.hideAllMarkers(),_this.map.zoom<farWorldZoom?(_this.markerType="world",_this.showMarkers(_this.worldMarkers,_this.map)):_this.map.zoom<closeWorldZoom?(_this.markerType="regional",_this.clearLocalMarkers(),_this.showMarkers(_this.regionalMarkers,_this.map)):(_this.markerType="local",_this.showMarkers(_this.localMarkers,_this.map))},_this.hideAllMarkers=function(){_this.hideMarkers(_this.worldMarkers),_this.hideMarkers(_this.regionalMarkers),_this.hideMarkers(_this.interestMarkers)},_this.resetInterestMarkers=function(){_this.interestMarkers=[],_this.currentInterestMarkerSymbol="A"},_this.hideMarkers=function(markers){_.each(markers,function(marker){marker.setMap(null)})},_this.showMarkers=function(markers,pMap){
var __this=_this;_.each(markers,function(marker){marker.setMap(__this.map)})},_this.showInterestMarkers=function(){var __this=_this;_.each(_this.interestMarkers,function(marker){marker.hotelFixture&&(marker.setVisible(!0),marker.setMap(__this.map))})},_this.showRegionalMarkers=function(){var __this=_this;_.each(_this.regionalMarkers,function(marker){marker.setVisible(!0),marker.setMap(__this.map)}),_.each(_this.worldMarkers,function(marker){marker.setVisible(!0),marker.setMap(__this.map)})},_this.getHotelCodes=function(){var lHotelCodes=[],lHotelCodeList="";return _.each(_this.localMarkers,function(pMarker){lHotelCodes.push(pMarker.id)}),lHotelCodeList=lHotelCodes.join(",")},_this.getHotelMapResultsSuccess=function(pHotelContent){var __this=_this,lMarkers=__this.localMarkers,lMarkersWithData=[];if(__this.clearLocalMarkers(),pHotelContent){var lHotelFixtures=pHotelContent.hotelFixtures;lHotelFixtures&&_.each(lMarkers,function(pMarker){var lHotelCode=pMarker.id,lHotelFixture=lHotelFixtures[lHotelCode];lHotelFixture?(pMarker.icon=__this.createMarkerIcon(pMarker,__this.currentLocalMarkerSymbol),pMarker.mapMarker=__this.currentLocalMarkerSymbol,pMarker.markerSymbol=__this.currentLocalMarkerSymbol,__this.incrementLocalMarkerSymbol(),pMarker.hotelFixture={},angular.extend(pMarker.hotelFixture,lHotelFixture),lMarkersWithData.push(pMarker),pMarker.setMap(__this.map)):pMarker.setMap(null)});var lBookingFixtures=pHotelContent.hotelsBookingFixture;lBookingFixtures&&_.each(lMarkers,function(pMarker){var lHotelCode=pMarker.id,lBookingFixture=lBookingFixtures[lHotelCode];lBookingFixture&&(pMarker.bookingFixture={},angular.extend(pMarker.bookingFixture,lBookingFixture))})}return __this.localMarkers=lMarkers,lMarkersWithData},_this.toggleMapBounds=function(){var latSouth=Math.floor(_this.map.getBounds().getSouthWest().lat()),latNorth=Math.floor(_this.map.getBounds().getNorthEast().lat());latSouth<=-85?_this.checkBounds():latNorth>=85&&_this.checkBounds()};var boundsTriggered=!1,isExploreHotels=$("#map.explore-hotels-view.explore-hotels-map-view").length>0;_this.checkBounds=function(){!boundsTriggered&&isExploreHotels&&(google.maps.event.addListener(_this.map,"bounds_changed",function(){_this.toggleMapBounds()}),boundsTriggered=!0);var latNorth=_this.map.getBounds().getNorthEast().lat(),latSouth=_this.map.getBounds().getSouthWest().lat();if(_this.map.getZoom()<11)for(var newLat;!(latNorth<85&&latSouth>-85||latNorth>85&&latSouth<-85);){if(latNorth<85&&latSouth>-85)return;if(latNorth>85&&latSouth<-85)return;if(latNorth>85&&(newLat=_this.map.getCenter().lat()-(latNorth-85)),latSouth<-85&&(newLat=_this.map.getCenter().lat()-(latSouth+85)),newLat){var newCenter=new google.maps.LatLng(newLat,_this.map.getCenter().lng());_this.map.setCenter(newCenter)}latNorth=_this.map.getBounds().getNorthEast().lat(),latSouth=_this.map.getBounds().getSouthWest().lat()}},deferred.resolve(_this)})}]),angular.module("radBlu.services").factory("sharedModel",["$location",function($location){"use strict";function isEmpty(obj){for(var key in obj)if(obj.hasOwnProperty(key))return!1;return!0}var dateStart="",dateEnd="",dateObject={},bookAHotelGeoLocation=!1,isBookAHotelPage=function(){var lLocation=$location.absUrl().toString();return lLocation.indexOf("book-a-hotel")>-1&&($(".book-a-hotel-wrapper").length>0||lLocation.indexOf("map-results")>-1)&&(lLocation.indexOf("map-results")>-1&&setBookAHotelGeoLocation("true"),!0)},setBookAHotelGeoLocation=function(isGeo){bookAHotelGeoLocation=isGeo},isBookAHotelGeoLocation=function(){return bookAHotelGeoLocation},sendDate=function(date,date2){dateStart=date,dateEnd=date2,dateObject.startingDate=date,dateObject.endingDate=date2},getDate=function(){if(!isEmpty(dateObject))return dateObject};return{sendDate:sendDate,getDate:getDate,setBookAHotelGeoLocation:setBookAHotelGeoLocation,isBookAHotelGeoLocation:isBookAHotelGeoLocation,isBookAHotelPage:isBookAHotelPage}}]),angular.module("radBlu.services").factory("sharedSearchMap",[function(){"use strict";function isEmpty(obj){for(var key in obj)if(obj.hasOwnProperty(key))return!1;return!0}var zoomLevel=function(){var level={Afghanistan:5,Albania:7,Algeria:4,Andorra:10,Angola:5,"Antigua and Barbuda":11,Argentina:4,Armenia:7,Aruba:11,Australia:4,Austria:6,Azerbaijan:7,"Bahamas, The":11,Bahrain:9,Bangladesh:6,Barbados:10,Belarus:5,Belgium:7,Belize:7,Benin:6,Bhutan:7,Bolivia:5,"Bosnia and Herzegovina":7,Botswana:5,Brazil:4,Brunei:8,Bulgaria:6,"Burkina Faso":6,Burundi:7,Cambodia:6,Cameroon:5,Canada:3,"Cape Verde":8,"Central African Republic":5,Chad:5,Chile:4,China:4,Colombia:5,Comoros:9,"Congo, Democratic Republic of the":5,"Congo, Republic of the":5,"Costa Rica":7,"Cote D'ivoire":6,Croatia:6,Cuba:5,Curacao:8,Cyprus:7,"Czech Rep.":6,Denmark:5,Djibouti:7,Dominica:8,"Dominican Republic":6,"East Timor":7,Ecuador:6,Egypt:5,"El Salvador":7,"Equatorial Guinea":8,Eritrea:5,Estonia:6,Ethiopia:5,"Fiji Islands":8,Finland:4,France:5,Gabon:6,"Gambia, The":7,Georgia:7,Germany:5,Ghana:6,Greece:6,Grenada:10,Guatemala:6,Guinea:6,"Guinea-Bissau":8,Guyana:6,Haiti:7,Honduras:6,"Hong Kong":10,Hungary:6,Iceland:6,India:5,Indonesia:5,Iran:5,Iraq:5,Ireland:6,Israel:6,Italy:5,Jamaica:8,Japan:5,Jordan:6,Kazakhstan:4,Kenya:5,Kiribati:10,Kosovo:7,Kuwait:8,Kyrgyzstan:6,Laos:5,Latvia:6,Lebanon:7,Lesotho:7,Liberia:6,Libya:5,Liechtenstein:9,Lithuania:6,Luxembourg:8,Macau:12,Macedonia:7,Madagascar:5,Malawi:5,Malaysia:5,Maldives:5,Mali:5,Malta:9,"Marshall Islands":5,Mauritania:5,Mauritius:6,Mexico:4,Micronesia:10,Moldova:6,Monaco:13,Mongolia:4,Montenegro:7,Morocco:5,Mozambique:5,Myanmar:5,Namibia:5,Nauru:10,Nepal:6,Netherlands:6,"Netherlands Antilles":5,"New Zealand":4,Nicaragua:6,Niger:5,Nigeria:5,"North Korea":6,Norway:4,Oman:5,Pakistan:5,Palau:7,"Palestinian Territories":7,Panama:6,"Papua New Guinea":5,Paraguay:5,Peru:4,Philippines:5,Poland:5,Portugal:6,Qatar:7,Romania:6,Russia:2,Rwanda:8,"Saint Kitts and Nevis":8,"Saint Lucia":10,"Saint Vincent and the Grenadines":10,Samoa:7,"San Marino":11,"Sao Tome and Principe":9,"Saudi Arabia":4,Senegal:6,Serbia:6,Seychelles:9,"Sierra Leone":7,Singapore:9,"Sint Maarten":10,Slovakia:7,Slovenia:7,"Solomon Islands":5,Somalia:5,"South Africa":4,"South Korea":5,"South Sudan":5,Spain:5,"Sri Lanka":6,Sudan:4,Suriname:6,"Swaziland ":8,Sweden:5,Switzerland:7,Syria:7,Taiwan:6,Tajikistan:6,Tanzania:5,Thailand:5,Togo:6,Tonga:9,"Trinidad And Tobago":8,Tunisia:5,Turkey:5,Turkmenistan:5,Tuvalu:5,Uganda:6,Ukraine:5,"United Arab Emirates":6,"United Kingdom":5,"United States":4,Uruguay:6,Uzbekistan:5,Vanuatu:5,"Vatican+City":12,Venezuela:5,Vietnam:5,Yemen:5,Zambia:5,Zimbabwe:5,"Minnesota (US)":7,"Pennsylvania (US)":7,"Illinois (US)":7,"Crete (Greece)":9,"Kreta (Greece)":9,"Creta (Greece)":9};return level},markerClickOverride=function(){var overrides={2117:{zoom:"10",lat:"",lng:""}};return overrides},excludedMarkers=function(){var overrides={1913:{lat:"39.683723",lng:"-75.749657"}};return overrides},latLngOverride=function(){var overrides={23634:{lat:"35.308200",lng:"25.06039"}};return overrides},locationObject={},searchBarDestinationName={},showLocation=function(countryInfo){locationObject.destName=countryInfo},getLocation=function(){if(!isEmpty(locationObject))return locationObject},setSearchBar=function(name){searchBarDestinationName=name},setSearchBarGo=function(){if(!isEmpty(searchBarDestinationName))return searchBarDestinationName};return{showLocation:showLocation,getLocation:getLocation,setSearchBar:setSearchBar,setSearchBarGo:setSearchBarGo,zoomLevel:zoomLevel,markerClickOverride:markerClickOverride,excludedMarkers:excludedMarkers,latLngOverride:latLngOverride}}]);var serv=angular.module("radBlu.services");serv.factory("tagging",["$window","radblu_tags",function($window,radblu_tags){function s_doPlugins(s){s.campaign||(s.campaign=s.getQueryParam("csref"),s.campaign=s.getValOnce(s.campaign,"csref",0),s.campaign&&(s.eVar22=s.campaign,s.eVar23=s.campaign)),s.eVar21||(s.eVar21=s.getQueryParam("bcid"),s.eVar21=s.getValOnce(s.eVar21,"bcid",0)),s.eVar39||(s.eVar39=s.getQueryParam("icid"),s.eVar39=s.getValOnce(s.eVar39,"icamp",0))}function s_gi(un,pg,ss){var a,i,j,x,s,c='s.version=\'H.24.1\';s.an=s_an;s.logDebug=function(m){var s=this,tcf=new Function(\'var e;try{console.log("\'+s.rep(s.rep(m,"\\n","\\\\n"),"\\"","\\\\\\"")+\'");}catch(e){}\');tcf()};s.cls=function(x,c){var i,y=\'\';if(!c)c=this.an;for(i=0;i<x.length;i++){n=x.substring(i,i+1);if(c.indexOf(n)>=0)y+=n}return y};s.fl=function(x,l){retur'+"n x?(''+x).substring(0,l):x};s.co=function(o){if(!o)return o;var n=new Object,x;for(x in o)if(x.indexOf('select')<0&&x.indexOf('filter')<0)n[x]=o[x];return n};s.num=function(x){x=''+x;for(var p=0;p<x.length;p++)if(('0123456789').indexOf(x.substring(p,p+1))<0)return 0;return 1};s.rep=s_rep;s.sp=s_sp;s.jn=s_jn;s.ape=function(x){var s=this,h='0123456789ABCDEF',i,c=s.charSet,n,l,e,y='';c=c?c.toUpperCase():'';if(x){x=''+x;if(s.em==3)x=encodeURIComponent(x);else if(c=='AUTO'&&('').charCodeAt){for(i=0;i<x.length;i++){c=x.substring(i,i+1);n=x.charCodeAt(i);if(n>127){l=0;e='';while(n||l<4){e=h.substring(n%16,n%16+1)+e;n=(n-n%16)/16;l++}y+='%u'+e}else if(c=='+')y+='%2B';else y+=escape(c)}x=y}else x=escape(''+x);x=s.rep(x,'+','%2B');if(c&&c!='AUTO'&&s.em==1&&x.indexOf('%u')<0&&x.indexOf('%U')<0){i=x.indexOf('%');while(i>=0){i++;if(h.substring(8).indexOf(x.substring(i,i+1).toUpperCase())>=0)return x.substring(0,i)+'u00'+x.substring(i);i=x.indexOf('%',i)}}}return x};s.epa=function(x){var s=this;if(x){x=s.rep(''+x,'+',' ');return s.em==3?decodeURIComponent(x):unescape(x)}return x};s.pt=function(x,d,f,a){var s=this,t=x,z=0,y,r;while(t){y=t.indexOf(d);y=y<0?t.length:y;t=t.substring(0,y);r=s[f](t,a);if(r)return r;z+=y+d.length;t=x.substring(z,x.length);t=z<x.length?t:''}return ''};s.isf=function(t,a){var c=a.indexOf(':');if(c>=0)a=a.substring(0,c);c=a.indexOf('=');if(c>=0)a=a.substring(0,c);if(t.substring(0,2)=='s_')t=t.substring(2);return (t!=''&&t==a)};s.fsf=function(t,a){var s=this;if(s.pt(a,',','isf',t))s.fsg+=(s.fsg!=''?',':'')+t;return 0};s.fs=function(x,f){var s=this;s.fsg='';s.pt(x,',','fsf',f);return s.fsg};s.si=function(){var s=this,i,k,v,c=s_gi+'var s=s_gi(\"'+s.oun+'\");s.sa(\"'+s.un+'\");';for(i=0;i<s.va_g.length;i++){k=s.va_g[i];v=s[k];if(v!=undefined){if(typeof(v)!='number')c+='s.'+k+'=\"'+s_fe(v)+'\";';else c+='s.'+k+'='+v+';'}}c+=\"s.lnk=s.eo=s.linkName=s.linkType=s.wd.s_objectID=s.ppu=s.pe=s.pev1=s.pev2=s.pev3='';\";return c};s.c_d='';s.c_gdf=function(t,a){var s=this;if(!s.num(t))return 1;return 0};s.c_gd=function(){var s=this,d=s.wd.location.hostname,n=s.fpCookieDomainPeriods,p;if(!n)n=s.cookieDomainPeriods;if(d&&!s.c_d){n=n?parseInt(n):2;n=n>2?n:2;p=d.lastIndexOf('.');if(p>=0){while(p>=0&&n>1){p=d.lastIndexOf('.',p-1);n--}s.c_d=p>0&&s.pt(d,'.','c_gdf',0)?d.substring(p):d}}return s.c_d};s.c_r=function(k){var s=this;k=s.ape(k);var c=' '+s.d.cookie,i=c.indexOf(' '+k+'='),e=i<0?i:c.indexOf(';',i),v=i<0?'':s.epa(c.substring(i+2+k.length,e<0?c.length:e));return v!='[[B]]'?v:''};s.c_w=function(k,v,e){var s=this,d=s.c_gd(),l=s.cookieLifetime,t;v=''+v;l=l?(''+l).toUpperCase():'';if(e&&l!='SESSION'&&l!='NONE'){t=(v!=''?parseInt(l?l:0):-60);if(t){e=new Date;e.setTime(e.getTime()+(t*1000))}}if(k&&l!='NONE'){s.d.cookie=k+'='+s.ape(v!=''?v:'[[B]]')+'; path=/;'+(e&&l!='SESSION'?' expires='+e.toGMTString()+';':'')+(d?' domain='+d+';':'');return s.c_r(k)==v}return 0};s.eh=function(o,e,r,f){var s=this,b='s_'+e+'_'+s._in,n=-1,l,i,x;if(!s.ehl)s.ehl=new Array;l=s.ehl;for(i=0;i<l.length&&n<0;i++){if(l[i].o==o&&l[i].e==e)n=i}if(n<0){n=i;l[n]=new Object}x=l[n];x.o=o;x.e=e;f=r?x.b:f;if(r||f){x.b=r?0:o[e];x.o[e]=f}if(x.b){x.o[b]=x.b;return b}return 0};s.cet=function(f,a,t,o,b){var s=this,r,tcf;if(s.apv>=5&&(!s.isopera||s.apv>=7)){tcf=new Function('s','f','a','t','var e,r;try{r=s[f](a)}catch(e){r=s[t](e)}return r');r=tcf(s,f,a,t)}else{if(s.ismac&&s.u.indexOf('MSIE 4')>=0)r=s[b](a);else{s.eh(s.wd,'onerror',0,o);r=s[f](a);s.eh(s.wd,'onerror',1)}}return r};s.gtfset=function(e){var s=this;return s.tfs};s.gtfsoe=new Function('e','var s=s_c_il['+s._in+'],c;s.eh(window,\"onerror\",1);s.etfs=1;c=s.t();if(c)s.d.write(c);s.etfs=0;return true');s.gtfsfb=function(a){return window};s.gtfsf=function(w){var s=this,p=w.parent,l=w.location;s.tfs=w;if(p&&p.location!=l&&p.location.host==l.host){s.tfs=p;return s.gtfsf(s.tfs)}return s.tfs};s.gtfs=function(){var s=this;if(!s.tfs){s.tfs=s.wd;if(!s.etfs)s.tfs=s.cet('gtfsf',s.tfs,'gtfset',s.gtfsoe,'gtfsfb')}return s.tfs};s.mrq=function(u){var s=this,l=s.rl[u],n,r;s.rl[u]=0;if(l)for(n=0;n<l.length;n++){r=l[n];s.mr(0,0,r.r,r.t,r.u)}};s.flushBufferedRequests=function(){};s.mr=function(sess,q,rs,ta,u){var s=this,dc=s.dc,t1=s.trackingServer,t2=s.trackingServerSecure,tb=s.trackingServerBase,p='.sc',ns=s.visitorNamespace,un=s.cls(u?u:(ns?ns:s.fun)),r=new Object,l,imn='s_i_'+(un),im,b,e;if(!rs){if(t1){if(t2&&s.ssl)t1=t2}else{if(!tb)tb='2o7.net';if(dc)dc=(''+dc).toLowerCase();else dc='d1';if(tb=='2o7.net'){if(dc=='d1')dc='112';else if(dc=='d2')dc='122';p=''}t1=un+'.'+dc+'.'+p+tb}rs='http'+(s.ssl?'s':'')+'://'+t1+'/b/ss/'+s.un+'/'+(s.mobile?'5.1':'1')+'/'+s.version+(s.tcn?'T':'')+'/'+sess+'?AQB=1&ndh=1'+(q?q:'')+'&AQE=1';if(s.isie&&!s.ismac)rs=s.fl(rs,2047)}if(s.d.images&&s.apv>=3&&(!s.isopera||s.apv>=7)&&(s.ns6<0||s.apv>=6.1)){if(!s.rc)s.rc=new Object;if(!s.rc[un]){s.rc[un]=1;if(!s.rl)s.rl=new Object;s.rl[un]=new Array;setTimeout('if(window.s_c_il)window.s_c_il['+s._in+'].mrq(\"'+un+'\")',750)}else{l=s.rl[un];if(l){r.t=ta;r.u=un;r.r=rs;l[l.length]=r;return ''}imn+='_'+s.rc[un];s.rc[un]++}im=s.wd[imn];if(!im)im=s.wd[imn]=new Image;im.s_l=0;im.onload=new Function('e','this.s_l=1;var wd=window,s;if(wd.s_c_il){s=wd.s_c_il['+s._in+'];s.mrq(\"'+un+'\");s.nrs--;if(!s.nrs)s.m_m(\"rr\")}');if(!s.nrs){s.nrs=1;s.m_m('rs')}else s.nrs++;if(s.debugTracking){var d='AppMeasurement Debug: '+rs,dl=s.sp(rs,'&'),dln;for(dln=0;dln<dl.length;dln++)d+=\"\\n\\t\"+s.epa(dl[dln]);s.logDebug(d)}im.src=rs;if((!ta||ta=='_self'||ta=='_top'||(s.wd.name&&ta==s.wd.name))&&rs.indexOf('&pe=')>=0){b=e=new Date;while(!im.s_l&&e.getTime()-b.getTime()<500)e=new Date}return ''}return '<im'+'g sr'+'c=\"'+rs+'\" width=1 height=1 border=0 alt=\"\">'};s.gg=function(v){var s=this;if(!s.wd['s_'+v])s.wd['s_'+v]='';return s.wd['s_'+v]};s.glf=function(t,a){if(t.substring(0,2)=='s_')t=t.substring(2);var s=this,v=s.gg(t);if(v)s[t]=v};s.gl=function(v){var s=this;if(s.pg)s.pt(v,',','glf',0)};s.rf=function(x){var s=this,y,i,j,h,p,l=0,q,a,b='',c='',t;if(x&&x.length>255){y=''+x;i=y.indexOf('?');if(i>0){q=y.substring(i+1);y=y.substring(0,i);h=y.toLowerCase();j=0;if(h.substring(0,7)=='http://')j+=7;else if(h.substring(0,8)=='https://')j+=8;i=h.indexOf(\"/\",j);if(i>0){h=h.substring(j,i);p=y.substring(i);y=y.substring(0,i);if(h.indexOf('google')>=0)l=',q,ie,start,search_key,word,kw,cd,';else if(h.indexOf('yahoo.co')>=0)l=',p,ei,';if(l&&q){a=s.sp(q,'&');if(a&&a.length>1){for(j=0;j<a.length;j++){t=a[j];i=t.indexOf('=');if(i>0&&l.indexOf(','+t.substring(0,i)+',')>=0)b+=(b?'&':'')+t;else c+=(c?'&':'')+t}if(b&&c)q=b+'&'+c;else c=''}i=253-(q.length-c.length)-y.length;x=y+(i>0?p.substring(0,i):'')+'?'+q}}}}return x};s.s2q=function(k,v,vf,vfp,f){var s=this,qs='',sk,sv,sp,ss,nke,nk,nf,nfl=0,nfn,nfm;if(k==\"contextData\")k=\"c\";if(v){for(sk in v) {if((!f||sk.substring(0,f.length)==f)&&v[sk]&&(!vf||vf.indexOf(','+(vfp?vfp+'.':'')+sk+',')>=0)){nfm=0;if(nfl)for(nfn=0;nfn<nfl.length;nfn++)if(sk.substring(0,nfl[nfn].length)==nfl[nfn])nfm=1;if(!nfm){if(qs=='')qs+='&'+k+'.';sv=v[sk];if(f)sk=sk.substring(f.length);if(sk.length>0){nke=sk.indexOf('.');if(nke>0){nk=sk.substring(0,nke);nf=(f?f:'')+nk+'.';if(!nfl)nfl=new Array;nfl[nfl.length]=nf;qs+=s.s2q(nk,v,vf,vfp,nf)}else{if(typeof(sv)=='boolean'){if(sv)sv='true';else sv='false'}if(sv){if(vfp=='retrieveLightData'&&f.indexOf('.contextData.')<0){sp=sk.substring(0,4);ss=sk.substring(4);if(sk=='transactionID')sk='xact';else if(sk=='channel')sk='ch';else if(sk=='campaign')sk='v0';else if(s.num(ss)){if(sp=='prop')sk='c'+ss;else if(sp=='eVar')sk='v'+ss;else if(sp=='list')sk='l'+ss;else if(sp=='hier'){sk='h'+ss;sv=sv.substring(0,255)}}}qs+='&'+s.ape(sk)+'='+s.ape(sv)}}}}}}if(qs!='')qs+='&.'+k}return qs};s.hav=function(){var s=this,qs='',l,fv='',fe='',mn,i,e;if(s.lightProfileID){l=s.va_m;fv=s.lightTrackVars;if(fv)fv=','+fv+','+s.vl_mr+','}else{l=s.va_t;if(s.pe||s.linkType){fv=s.linkTrackVars;fe=s.linkTrackEvents;if(s.pe){mn=s.pe.substring(0,1).toUpperCase()+s.pe.substring(1);if(s[mn]){fv=s[mn].trackVars;fe=s[mn].trackEvents}}}if(fv)fv=','+fv+','+s.vl_l+','+s.vl_l2;if(fe){fe=','+fe+',';if(fv)fv+=',events,'}if (s.events2)e=(e?',':'')+s.events2}for(i=0;i<l.length;i++){var k=l[i],v=s[k],b=k.substring(0,4),x=k.substring(4),n=parseInt(x),q=k;if(!v)if(k=='events'&&e){v=e;e=''}if(v&&(!fv||fv.indexOf(','+k+',')>=0)&&k!='linkName'&&k!='linkType'){if(k=='timestamp')q='ts';else if(k=='dynamicVariablePrefix')q='D';else if(k=='visitorID')q='vid';else if(k=='pageURL'){q='g';v=s.fl(v,255)}else if(k=='referrer'){q='r';v=s.fl(s.rf(v),255)}else if(k=='vmk'||k=='visitorMigrationKey')q='vmt';else if(k=='visitorMigrationServer'){q='vmf';if(s.ssl&&s.visitorMigrationServerSecure)v=''}else if(k=='visitorMigrationServerSecure'){q='vmf';if(!s.ssl&&s.visitorMigrationServer)v=''}else if(k=='charSet'){q='ce';if(v.toUpperCase()=='AUTO')v='ISO8859-1';else if(s.em==2||s.em==3)v='UTF-8'}else if(k=='visitorNamespace')q='ns';else if(k=='cookieDomainPeriods')q='cdp';else if(k=='cookieLifetime')q='cl';else if(k=='variableProvider')q='vvp';else if(k=='currencyCode')q='cc';else if(k=='channel')q='ch';else if(k=='transactionID')q='xact';else if(k=='campaign')q='v0';else if(k=='resolution')q='s';else if(k=='colorDepth')q='c';else if(k=='javascriptVersion')q='j';else if(k=='javaEnabled')q='v';else if(k=='cookiesEnabled')q='k';else if(k=='browserWidth')q='bw';else if(k=='browserHeight')q='bh';else if(k=='connectionType')q='ct';else if(k=='homepage')q='hp';else if(k=='plugins')q='p';else if(k=='events'){if(e)v+=(v?',':'')+e;if(fe)v=s.fs(v,fe)}else if(k=='events2')v='';else if(k=='contextData'){qs+=s.s2q('c',s[k],fv,k,0);v=''}else if(k=='lightProfileID')q='mtp';else if(k=='lightStoreForSeconds'){q='mtss';if(!s.lightProfileID)v=''}else if(k=='lightIncrementBy'){q='mti';if(!s.lightProfileID)v=''}else if(k=='retrieveLightProfiles')q='mtsr';else if(k=='deleteLightProfiles')q='mtsd';else if(k=='retrieveLightData'){if(s.retrieveLightProfiles)qs+=s.s2q('mts',s[k],fv,k,0);v=''}else if(s.num(x)){if(b=='prop')q='c'+n;else if(b=='eVar')q='v'+n;else if(b=='list')q='l'+n;else if(b=='hier'){q='h'+n;v=s.fl(v,255)}}if(v)qs+='&'+s.ape(q)+'='+(k.substring(0,3)!='pev'?s.ape(v):v)}}return qs};s.ltdf=function(t,h){t=t?t.toLowerCase():'';h=h?h.toLowerCase():'';var qi=h.indexOf('?');h=qi>=0?h.substring(0,qi):h;if(t&&h.substring(h.length-(t.length+1))=='.'+t)return 1;return 0};s.ltef=function(t,h){t=t?t.toLowerCase():'';h=h?h.toLowerCase():'';if(t&&h.indexOf(t)>=0)return 1;return 0};s.lt=function(h){var s=this,lft=s.linkDownloadFileTypes,lef=s.linkExternalFilters,lif=s.linkInternalFilters;lif=lif?lif:s.wd.location.hostname;h=h.toLowerCase();if(s.trackDownloadLinks&&lft&&s.pt(lft,',','ltdf',h))return 'd';if(s.trackExternalLinks&&h.substring(0,1)!='#'&&(lef||lif)&&(!lef||s.pt(lef,',','ltef',h))&&(!lif||!s.pt(lif,',','ltef',h)))return 'e';return ''};s.lc=new Function('e','var s=s_c_il['+s._in+'],b=s.eh(this,\"onclick\");s.lnk=s.co(this);s.t();s.lnk=0;if(b)return this[b](e);return true');s.bc=new Function('e','var s=s_c_il['+s._in+'],f,tcf;if(s.d&&s.d.all&&s.d.all.cppXYctnr)return;s.eo=e.srcElement?e.srcElement:e.target;tcf=new Function(\"s\",\"var e;try{if(s.eo&&(s.eo.tagName||s.eo.parentElement||s.eo.parentNode))s.t()}catch(e){}\");tcf(s);s.eo=0');s.oh=function(o){var s=this,l=s.wd.location,h=o.href?o.href:'',i,j,k,p;i=h.indexOf(':');j=h.indexOf('?');k=h.indexOf('/');if(h&&(i<0||(j>=0&&i>j)||(k>=0&&i>k))){p=o.protocol&&o.protocol.length>1?o.protocol:(l.protocol?l.protocol:'');i=l.pathname.lastIndexOf('/');h=(p?p+'//':'')+(o.host?o.host:(l.host?l.host:''))+(h.substring(0,1)!='/'?l.pathname.substring(0,i<0?0:i)+'/':'')+h}return h};s.ot=function(o){var t=o.tagName;if(o.tagUrn||(o.scopeName&&o.scopeName.toUpperCase()!='HTML'))return '';t=t&&t.toUpperCase?t.toUpperCase():'';if(t=='SHAPE')t='';if(t){if((t=='INPUT'||t=='BUTTON')&&o.type&&o.type.toUpperCase)t=o.type.toUpperCase();else if(!t&&o.href)t='A';}return t};s.oid=function(o){var s=this,t=s.ot(o),p,c,n='',x=0;if(t&&!o.s_oid){p=o.protocol;c=o.onclick;if(o.href&&(t=='A'||t=='AREA')&&(!c||!p||p.toLowerCase().indexOf('javascript')<0))n=s.oh(o);else if(c){n=s.rep(s.rep(s.rep(s.rep(''+c,\"\\r\",''),\"\\n\",''),\"\\t\",''),' ','');x=2}else if(t=='INPUT'||t=='SUBMIT'){if(o.value)n=o.value;else if(o.innerText)n=o.innerText;else if(o.textContent)n=o.textContent;x=3}else if(o.src&&t=='IMAGE')n=o.src;if(n){o.s_oid=s.fl(n,100);o.s_oidt=x}}return o.s_oid};s.rqf=function(t,un){var s=this,e=t.indexOf('='),u=e>=0?t.substring(0,e):'',q=e>=0?s.epa(t.substring(e+1)):'';if(u&&q&&(','+u+',').indexOf(','+un+',')>=0){if(u!=s.un&&s.un.indexOf(',')>=0)q='&u='+u+q+'&u=0';return q}return ''};s.rq=function(un){if(!un)un=this.un;var s=this,c=un.indexOf(','),v=s.c_r('s_sq'),q='';if(c<0)return s.pt(v,'&','rqf',un);return s.pt(un,',','rq',0)};s.sqp=function(t,a){var s=this,e=t.indexOf('='),q=e<0?'':s.epa(t.substring(e+1));s.sqq[q]='';if(e>=0)s.pt(t.substring(0,e),',','sqs',q);return 0};s.sqs=function(un,q){var s=this;s.squ[un]=q;return 0};s.sq=function(q){var s=this,k='s_sq',v=s.c_r(k),x,c=0;s.sqq=new Object;s.squ=new Object;s.sqq[q]='';s.pt(v,'&','sqp',0);s.pt(s.un,',','sqs',q);v='';for(x in s.squ)if(x&&(!Object||!Object.prototype||!Object.prototype[x]))s.sqq[s.squ[x]]+=(s.sqq[s.squ[x]]?',':'')+x;for(x in s.sqq)if(x&&(!Object||!Object.prototype||!Object.prototype[x])&&s.sqq[x]&&(x==q||c<2)){v+=(v?'&':'')+s.sqq[x]+'='+s.ape(x);c++}return s.c_w(k,v,0)};s.wdl=new Function('e','var s=s_c_il['+s._in+'],r=true,b=s.eh(s.wd,\"onload\"),i,o,oc;if(b)r=this[b](e);for(i=0;i<s.d.links.length;i++){o=s.d.links[i];oc=o.onclick?\"\"+o.onclick:\"\";if((oc.indexOf(\"s_gs(\")<0||oc.indexOf(\".s_oc(\")>=0)&&oc.indexOf(\".tl(\")<0)s.eh(o,\"onclick\",0,s.lc);}return r');s.wds=function(){var s=this;if(s.apv>3&&(!s.isie||!s.ismac||s.apv>=5)){if(s.b&&s.b.attachEvent)s.b.attachEvent('onclick',s.bc);else if(s.b&&s.b.addEventListener)s.b.addEventListener('click',s.bc,false);else s.eh(s.wd,'onload',0,s.wdl)}};s.vs=function(x){var s=this,v=s.visitorSampling,g=s.visitorSamplingGroup,k='s_vsn_'+s.un+(g?'_'+g:''),n=s.c_r(k),e=new Date,y=e.getYear();e.setYear(y+10+(y<1900?1900:0));if(v){v*=100;if(!n){if(!s.c_w(k,x,e))return 0;n=x}if(n%10000>v)return 0}return 1};s.dyasmf=function(t,m){if(t&&m&&m.indexOf(t)>=0)return 1;return 0};s.dyasf=function(t,m){var s=this,i=t?t.indexOf('='):-1,n,x;if(i>=0&&m){var n=t.substring(0,i),x=t.substring(i+1);if(s.pt(x,',','dyasmf',m))return n}return 0};s.uns=function(){var s=this,x=s.dynamicAccountSelection,l=s.dynamicAccountList,m=s.dynamicAccountMatch,n,i;s.un=s.un.toLowerCase();if(x&&l){if(!m)m=s.wd.location.host;if(!m.toLowerCase)m=''+m;l=l.toLowerCase();m=m.toLowerCase();n=s.pt(l,';','dyasf',m);if(n)s.un=n}i=s.un.indexOf(',');s.fun=i<0?s.un:s.un.substring(0,i)};s.sa=function(un){var s=this;s.un=un;if(!s.oun)s.oun=un;else if((','+s.oun+',').indexOf(','+un+',')<0)s.oun+=','+un;s.uns()};s.m_i=function(n,a){var s=this,m,f=n.substring(0,1),r,l,i;if(!s.m_l)s.m_l=new Object;if(!s.m_nl)s.m_nl=new Array;m=s.m_l[n];if(!a&&m&&m._e&&!m._i)s.m_a(n);if(!m){m=new Object,m._c='s_m';m._in=s.wd.s_c_in;m._il=s._il;m._il[m._in]=m;s.wd.s_c_in++;m.s=s;m._n=n;m._l=new Array('_c','_in','_il','_i','_e','_d','_dl','s','n','_r','_g','_g1','_t','_t1','_x','_x1','_rs','_rr','_l');s.m_l[n]=m;s.m_nl[s.m_nl.length]=n}else if(m._r&&!m._m){r=m._r;r._m=m;l=m._l;for(i=0;i<l.length;i++)if(m[l[i]])r[l[i]]=m[l[i]];r._il[r._in]=r;m=s.m_l[n]=r}if(f==f.toUpperCase())s[n]=m;return m};s.m_a=new Function('n','g','e','if(!g)g=\"m_\"+n;var s=s_c_il['+s._in+'],c=s[g+\"_c\"],m,x,f=0;if(!c)c=s.wd[\"s_\"+g+\"_c\"];if(c&&s_d)s[g]=new Function(\"s\",s_ft(s_d(c)));x=s[g];if(!x)x=s.wd[\\'s_\\'+g];if(!x)x=s.wd[g];m=s.m_i(n,1);if(x&&(!m._i||g!=\"m_\"+n)){m._i=f=1;if((\"\"+x).indexOf(\"function\")>=0)x(s);else s.m_m(\"x\",n,x,e)}m=s.m_i(n,1);if(m._dl)m._dl=m._d=0;s.dlt();return f');s.m_m=function(t,n,d,e){t='_'+t;var s=this,i,x,m,f='_'+t,r=0,u;if(s.m_l&&s.m_nl)for(i=0;i<s.m_nl.length;i++){x=s.m_nl[i];if(!n||x==n){m=s.m_i(x);u=m[t];if(u){if((''+u).indexOf('function')>=0){if(d&&e)u=m[t](d,e);else if(d)u=m[t](d);else u=m[t]()}}if(u)r=1;u=m[t+1];if(u&&!m[f]){if((''+u).indexOf('function')>=0){if(d&&e)u=m[t+1](d,e);else if(d)u=m[t+1](d);else u=m[t+1]()}}m[f]=1;if(u)r=1}}return r};s.m_ll=function(){var s=this,g=s.m_dl,i,o;if(g)for(i=0;i<g.length;i++){o=g[i];if(o)s.loadModule(o.n,o.u,o.d,o.l,o.e,1);g[i]=0}};s.loadModule=function(n,u,d,l,e,ln){var s=this,m=0,i,g,o=0,f1,f2,c=s.h?s.h:s.b,b,tcf;if(n){i=n.indexOf(':');if(i>=0){g=n.substring(i+1);n=n.substring(0,i)}else g=\"m_\"+n;m=s.m_i(n)}if((l||(n&&!s.m_a(n,g)))&&u&&s.d&&c&&s.d.createElement){if(d){m._d=1;m._dl=1}if(ln){if(s.ssl)u=s.rep(u,'http:','https:');i='s_s:'+s._in+':'+n+':'+g;b='var s=s_c_il['+s._in+'],o=s.d.getElementById(\"'+i+'\");if(s&&o){if(!o.l&&s.wd.'+g+'){o.l=1;if(o.i)clearTimeout(o.i);o.i=0;s.m_a(\"'+n+'\",\"'+g+'\"'+(e?',\"'+e+'\"':'')+')}';f2=b+'o.c++;if(!s.maxDelay)s.maxDelay=250;if(!o.l&&o.c<(s.maxDelay*2)/100)o.i=setTimeout(o.f2,100)}';f1=new Function('e',b+'}');tcf=new Function('s','c','i','u','f1','f2','var e,o=0;try{o=s.d.createElement(\"script\");if(o){o.type=\"text/javascript\";'+(n?'o.id=i;o.defer=true;o.onload=o.onreadystatechange=f1;o.f2=f2;o.l=0;':'')+'o.src=u;c.appendChild(o);'+(n?'o.c=0;o.i=setTimeout(f2,100)':'')+'}}catch(e){o=0}return o');o=tcf(s,c,i,u,f1,f2)}else{o=new Object;o.n=n+':'+g;o.u=u;o.d=d;o.l=l;o.e=e;g=s.m_dl;if(!g)g=s.m_dl=new Array;i=0;while(i<g.length&&g[i])i++;g[i]=o}}else if(n){m=s.m_i(n);m._e=1}return m};s.voa=function(vo,r){var s=this,l=s.va_g,i,k,v,x;for(i=0;i<l.length;i++){k=l[i];v=vo[k];if(v||vo['!'+k]){if(!r&&(k==\"contextData\"||k==\"retrieveLightData\")&&s[k])for(x in s[k])if(!v[x])v[x]=s[k][x];s[k]=v}}};s.vob=function(vo){var s=this,l=s.va_g,i,k;for(i=0;i<l.length;i++){k=l[i];vo[k]=s[k];if(!vo[k])vo['!'+k]=1}};s.dlt=new Function('var s=s_c_il['+s._in+'],d=new Date,i,vo,f=0;if(s.dll)for(i=0;i<s.dll.length;i++){vo=s.dll[i];if(vo){if(!s.m_m(\"d\")||d.getTime()-vo._t>=s.maxDelay){s.dll[i]=0;s.t(vo)}else f=1}}if(s.dli)clearTimeout(s.dli);s.dli=0;if(f){if(!s.dli)s.dli=setTimeout(s.dlt,s.maxDelay)}else s.dll=0');s.dl=function(vo){var s=this,d=new Date;if(!vo)vo=new Object;s.vob(vo);vo._t=d.getTime();if(!s.dll)s.dll=new Array;s.dll[s.dll.length]=vo;if(!s.maxDelay)s.maxDelay=250;s.dlt()};s.track=s.t=function(vo){var s=this,trk=1,tm=new Date,sed=Math&&Math.random?Math.floor(Math.random()*10000000000000):tm.getTime(),sess='s'+Math.floor(tm.getTime()/10800000)%10+sed,y=tm.getYear(),vt=tm.getDate()+'/'+tm.getMonth()+'/'+(y<1900?y+1900:y)+' '+tm.getHours()+':'+tm.getMinutes()+':'+tm.getSeconds()+' '+tm.getDay()+' '+tm.getTimezoneOffset(),tcf,tfs=s.gtfs(),ta=-1,q='',qs='',code='',vb=new Object;s.gl(s.vl_g);s.uns();s.m_ll();if(!s.td){var tl=tfs.location,a,o,i,x='',c='',v='',p='',bw='',bh='',j='1.0',k=s.c_w('s_cc','true',0)?'Y':'N',hp='',ct='',pn=0,ps;if(String&&String.prototype){j='1.1';if(j.match){j='1.2';if(tm.setUTCDate){j='1.3';if(s.isie&&s.ismac&&s.apv>=5)j='1.4';if(pn.toPrecision){j='1.5';a=new Array;if(a.forEach){j='1.6';i=0;o=new Object;tcf=new Function('o','var e,i=0;try{i=new Iterator(o)}catch(e){}return i');i=tcf(o);if(i&&i.next)j='1.7'}}}}}if(s.apv>=4)x=screen.width+'x'+screen.height;if(s.isns||s.isopera){if(s.apv>=3){v=s.n.javaEnabled()?'Y':'N';if(s.apv>=4){c=screen.pixelDepth;bw=s.wd.innerWidth;bh=s.wd.innerHeight}}s.pl=s.n.plugins}else if(s.isie){if(s.apv>=4){v=s.n.javaEnabled()?'Y':'N';c=screen.colorDepth;if(s.apv>=5){bw=s.d.documentElement.offsetWidth;bh=s.d.documentElement.offsetHeight;if(!s.ismac&&s.b){tcf=new Function('s','tl','var e,hp=0;try{s.b.addBehavior(\"#default#homePage\");hp=s.b.isHomePage(tl)?\"Y\":\"N\"}catch(e){}return hp');hp=tcf(s,tl);tcf=new Function('s','var e,ct=0;try{s.b.addBehavior(\"#default#clientCaps\");ct=s.b.connectionType}catch(e){}return ct');ct=tcf(s)}}}else r=''}if(s.pl)while(pn<s.pl.length&&pn<30){ps=s.fl(s.pl[pn].name,100)+';';if(p.indexOf(ps)<0)p+=ps;pn++}s.resolution=x;s.colorDepth=c;s.javascriptVersion=j;s.javaEnabled=v;s.cookiesEnabled=k;s.browserWidth=bw;s.browserHeight=bh;s.connectionType=ct;s.homepage=hp;s.plugins=p;s.td=1}if(vo){s.vob(vb);s.voa(vo)}if((vo&&vo._t)||!s.m_m('d')){if(s.usePlugins)s.doPlugins(s);var l=s.wd.location,r=tfs.document.referrer;if(!s.pageURL)s.pageURL=l.href?l.href:l;if(!s.referrer&&!s._1_referrer){s.referrer=r;s._1_referrer=1}s.m_m('g');if(s.lnk||s.eo){var o=s.eo?s.eo:s.lnk,p=s.pageName,w=1,t=s.ot(o),n=s.oid(o),x=o.s_oidt,h,l,i,oc;if(s.eo&&o==s.eo){while(o&&!n&&t!='BODY'){o=o.parentElement?o.parentElement:o.parentNode;if(o){t=s.ot(o);n=s.oid(o);x=o.s_oidt}}if(o){oc=o.onclick?''+o.onclick:'';if((oc.indexOf('s_gs(')>=0&&oc.indexOf('.s_oc(')<0)||oc.indexOf('.tl(')>=0)o=0}}if(o){if(n)ta=o.target;h=s.oh(o);i=h.indexOf('?');h=s.linkLeaveQueryString||i<0?h:h.substring(0,i);l=s.linkName;t=s.linkType?s.linkType.toLowerCase():s.lt(h);if(t&&(h||l)){s.pe='lnk_'+(t=='d'||t=='e'?t:'o');q+='&pe='+s.pe+(h?'&pev1='+s.ape(h):'')+(l?'&pev2='+s.ape(l):'');}else trk=0;if(s.trackInlineStats){if(!p){p=s.pageURL;w=0}t=s.ot(o);i=o.sourceIndex;if(s.gg('objectID')){n=s.gg('objectID');x=1;i=1}if(p&&n&&t)qs='&pid='+s.ape(s.fl(p,255))+(w?'&pidt='+w:'')+'&oid='+s.ape(s.fl(n,100))+(x?'&oidt='+x:'')+'&ot='+s.ape(t)+(i?'&oi='+i:'')}}else trk=0}if(trk||qs){s.sampled=s.vs(sed);if(trk){if(s.sampled)code=s.mr(sess,(vt?'&t='+s.ape(vt):'')+s.hav()+q+(qs?qs:s.rq()),0,ta);qs='';s.m_m('t');if(s.p_r)s.p_r();s.referrer=s.lightProfileID=s.retrieveLightProfiles=s.deleteLightProfiles=''}s.sq(qs)}}else s.dl(vo);if(vo)s.voa(vb,1);s.lnk=s.eo=s.linkName=s.linkType=s.wd.s_objectID=s.ppu=s.pe=s.pev1=s.pev2=s.pev3='';if(s.pg)s.wd.s_lnk=s.wd.s_eo=s.wd.s_linkName=s.wd.s_linkType='';return code};s.trackLink=s.tl=function(o,t,n,vo){var s=this;s.lnk=s.co(o);s.linkType=t;s.linkName=n;s.t(vo)};s.trackLight=function(p,ss,i,vo){var s=this;s.lightProfileID=p;s.lightStoreForSeconds=ss;s.lightIncrementBy=i;s.t(vo)};s.setTagContainer=function(n){var s=this,l=s.wd.s_c_il,i,t,x,y;s.tcn=n;if(l)for(i=0;i<l.length;i++){t=l[i];if(t&&t._c=='s_l'&&t.tagContainerName==n){s.voa(t);if(t.lmq)for(i=0;i<t.lmq.length;i++){x=t.lmq[i];y='m_'+x.n;if(!s[y]&&!s[y+'_c']){s[y]=t[y];s[y+'_c']=t[y+'_c']}s.loadModule(x.n,x.u,x.d)}if(t.ml)for(x in t.ml)if(s[x]){y=s[x];x=t.ml[x];for(i in x)if(!Object.prototype[i]){if(typeof(x[i])!='function'||(''+x[i]).indexOf('s_c_il')<0)y[i]=x[i]}}if(t.mmq)for(i=0;i<t.mmq.length;i++){x=t.mmq[i];if(s[x.m]){y=s[x.m];if(y[x.f]&&typeof(y[x.f])=='function'){if(x.a)y[x.f].apply(y,x.a);else y[x.f].apply(y)}}}if(t.tq)for(i=0;i<t.tq.length;i++)s.t(t.tq[i]);t.s=s;return}}};s.wd=window;s.ssl=(s.wd.location.protocol.toLowerCase().indexOf('https')>=0);s.d=document;s.b=s.d.body;if(s.d.getElementsByTagName){s.h=s.d.getElementsByTagName('HEAD');if(s.h)s.h=s.h[0]}s.n=navigator;s.u=s.n.userAgent;s.ns6=s.u.indexOf('Netscape6/');var apn=s.n.appName,v=s.n.appVersion,ie=v.indexOf('MSIE '),o=s.u.indexOf('Opera '),i;if(v.indexOf('Opera')>=0||o>0)apn='Opera';s.isie=(apn=='Microsoft Internet Explorer');s.isns=(apn=='Netscape');s.isopera=(apn=='Opera');s.ismac=(s.u.indexOf('Mac')>=0);if(o>0)s.apv=parseFloat(s.u.substring(o+6));else if(ie>0){s.apv=parseInt(i=v.substring(ie+5));if(s.apv>3)s.apv=parseFloat(i)}else if(s.ns6>0)s.apv=parseFloat(s.u.substring(s.ns6+10));else s.apv=parseFloat(v);s.em=0;if(s.em.toPrecision)s.em=3;else if(String.fromCharCode){i=escape(String.fromCharCode(256)).toUpperCase();s.em=(i=='%C4%80'?2:(i=='%U0100'?1:0))}if(s.oun)s.sa(s.oun);s.sa(un);s.vl_l='dynamicVariablePrefix,visitorID,vmk,visitorMigrationKey,visitorMigrationServer,visitorMigrationServerSecure,ppu,charSet,visitorNamespace,cookieDomainPeriods,cookieLifetime,pageName,pageURL,referrer,currencyCode';s.va_l=s.sp(s.vl_l,',');s.vl_mr=s.vl_m='charSet,visitorNamespace,cookieDomainPeriods,cookieLifetime,contextData,lightProfileID,lightStoreForSeconds,lightIncrementBy';s.vl_t=s.vl_l+',variableProvider,channel,server,pageType,transactionID,purchaseID,campaign,state,zip,events,events2,products,linkName,linkType,contextData,lightProfileID,lightStoreForSeconds,lightIncrementBy,retrieveLightProfiles,deleteLightProfiles,retrieveLightData';var n;for(n=1;n<=75;n++){s.vl_t+=',prop'+n+',eVar'+n;s.vl_m+=',prop'+n+',eVar'+n}for(n=1;n<=5;n++)s.vl_t+=',hier'+n;for(n=1;n<=3;n++)s.vl_t+=',list'+n;s.va_m=s.sp(s.vl_m,',');s.vl_l2=',tnt,pe,pev1,pev2,pev3,resolution,colorDepth,javascriptVersion,javaEnabled,cookiesEnabled,browserWidth,browserHeight,connectionType,homepage,plugins';s.vl_t+=s.vl_l2;s.va_t=s.sp(s.vl_t,',');s.vl_g=s.vl_t+',trackingServer,trackingServerSecure,trackingServerBase,fpCookieDomainPeriods,disableBufferedRequests,mobile,visitorSampling,visitorSamplingGroup,dynamicAccountSelection,dynamicAccountList,dynamicAccountMatch,trackDownloadLinks,trackExternalLinks,trackInlineStats,linkLeaveQueryString,linkDownloadFileTypes,linkExternalFilters,linkInternalFilters,linkTrackVars,linkTrackEvents,linkNames,lnk,eo,lightTrackVars,_1_referrer,un';s.va_g=s.sp(s.vl_g,',');s.pg=pg;s.gl(s.vl_g);s.contextData=new Object;s.retrieveLightData=new Object;if(!ss)s.wds();if(pg){s.wd.s_co=function(o){s_gi(\"_\",1,1).co(o)};s.wd.s_gs=function(un){s_gi(un,1,1).t()};s.wd.s_dc=function(un){s_gi(un,1).t()}}",w=window,l=w.s_c_il,n=navigator,u=n.userAgent,v=n.appVersion,e=v.indexOf("MSIE "),m=u.indexOf("Netscape6/");
if(un&&(un=un.toLowerCase(),l))for(j=0;j<2;j++)for(i=0;i<l.length;i++)if(s=l[i],x=s._c,(!x||"s_c"==x||j>0&&"s_l"==x)&&(s.oun==un||s.fs&&s.sa&&s.fs(s.oun,un))){if(s.sa&&s.sa(un),"s_c"==x)return s}else s=0;return w.s_an="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",w.s_sp=new Function("x","d","var a=new Array,i=0,j;if(x){if(x.split)a=x.split(d);else if(!d)for(i=0;i<x.length;i++)a[a.length]=x.substring(i,i+1);else while(i>=0){j=x.indexOf(d,i);a[a.length]=x.substring(i,j<0?x.length:j);i=j;if(i>=0)i+=d.length}}return a"),w.s_jn=new Function("a","d","var x='',i,j=a.length;if(a&&j>0){x=a[0];if(j>1){if(a.join)x=a.join(d);else for(i=1;i<j;i++)x+=d+a[i]}}return x"),w.s_rep=new Function("x","o","n","return s_jn(s_sp(x,o),n)"),w.s_d=new Function("x","var t='`^@$#',l=s_an,l2=new Object,x2,d,b=0,k,i=x.lastIndexOf('~~'),j,v,w;if(i>0){d=x.substring(0,i);x=x.substring(i+2);l=s_sp(l,'');for(i=0;i<62;i++)l2[l[i]]=i;t=s_sp(t,'');d=s_sp(d,'~');i=0;while(i<5){v=0;if(x.indexOf(t[i])>=0) {x2=s_sp(x,t[i]);for(j=1;j<x2.length;j++){k=x2[j].substring(0,1);w=t[i]+k;if(k!=' '){v=1;w=d[b+l2[k]]}x2[j]=w+x2[j].substring(1)}}if(v)x=s_jn(x2,'');else{w=t[i]+' ';if(x.indexOf(w)>=0)x=s_rep(x,w,t[i]);i++;b+=62}}}return x"),w.s_fe=new Function("c","return s_rep(s_rep(s_rep(c,'\\\\','\\\\\\\\'),'\"','\\\\\"'),\"\\n\",\"\\\\n\")"),w.s_fa=new Function("f","var s=f.indexOf('(')+1,e=f.indexOf(')'),a='',c;while(s>=0&&s<e){c=f.substring(s,s+1);if(c==',')a+='\",\"';else if((\"\\n\\r\\t \").indexOf(c)<0)a+=c;s++}return a?'\"'+a+'\"':a"),w.s_ft=new Function("c","c+='';var s,e,o,a,d,q,f,h,x;s=c.indexOf('=function(');while(s>=0){s++;d=1;q='';x=0;f=c.substring(s);a=s_fa(f);e=o=c.indexOf('{',s);e++;while(d>0){h=c.substring(e,e+1);if(q){if(h==q&&!x)q='';if(h=='\\\\')x=x?0:1;else x=0}else{if(h=='\"'||h==\"'\")q=h;if(h=='{')d++;if(h=='}')d--}if(d>0)e++}c=c.substring(0,s)+'new Function('+(a?a+',':'')+'\"'+s_fe(c.substring(o+1,e))+'\")'+c.substring(e+1);s=c.indexOf('=function(')}return c;"),c=s_d(c),e>0?(a=parseInt(i=v.substring(e+5)),a>3&&(a=parseFloat(i))):a=m>0?parseFloat(u.substring(m+10)):parseFloat(v),(a<5||v.indexOf("Opera")>=0||u.indexOf("Opera")>=0)&&(c=s_ft(c)),s||(s=new Object,w.s_c_in||(w.s_c_il=new Array,w.s_c_in=0),s._il=w.s_c_il,s._in=w.s_c_in,s._il[s._in]=s,w.s_c_in++),s._c="s_c",new Function("s","un","pg","ss",c)(s,un,pg,ss),s}function s_giqf(){var i,t,s,w=window,q=w.s_giq;if(q)for(i=0;i<q.length;i++)t=q[i],s=s_gi(t.oun),s.sa(t.un),s.setTagContainer(t.tagContainerName);w.s_giq=0}var s,bluTag=radblu_tags;bluTag.excludeFromTealium=function(key){return tealiumExcludeList=["accord_page_name","base_page_name","site","suites","section","contact_information","pac_code"],$.inArray(key,tealiumExcludeList)!=-1},bluTag.loadTealium=function(){if(window.utag_data={},angular.forEach(bluTag,function(value,key){angular.isFunction(value)||bluTag.excludeFromTealium(key)||(window.utag_data[key]=value)}),window.location.href.indexOf("csref")<0&&document.referrer){var a=document.createElement("a");a.href=document.referrer,utag_data.referrer_domain=a.hostname}window.utag_data.bvcode="RADSAS"},bluTag.fireTealium=function(){tealiumInclude=function(){var tEnv="dev";bluTag.environment&&(tEnv=bluTag.environment),function(a,b,c,d){a="//tags.tiqcdn.com/utag/carlson/rad-blu/"+tEnv+"/utag.js",b=document,c="script",d=b.createElement(c),d.src=a,d.type="text/java"+c,d.async=!0,a=b.getElementsByTagName(c)[0],a.parentNode.insertBefore(d,a)}()},tealiumInclude()},bluTag.reevaluateTealium=function(){function linkTealium(){window.utag?window.utag.view(window.utag_data):setTimeout(function(){linkTealium()},5e3)}linkTealium()},bluTag.getOmnitureSuites=function(){var temp=bluTag.suites;return bluTag.secondarySuites&&(temp+=","+bluTag.secondarySuites),temp},bluTag.tagAdobe=function(loadURLData,pEvents,pSuites){if(s?(bluTag.resetAdobe(),pEvents&&(s.events=pEvents)):bluTag.initAdobe(),loadURLData&&bluTag.parseQstring(),s.pageName=bluTag.page_name,bluTag.user_loggedIn?(s.prop12="registered",s.eVar3="registered"):(s.prop12="unregistered",s.eVar3="unregistered"),bluTag.pageType?s.pageType=bluTag.pageType:delete s.pageType,bluTag.extended_page_name&&(s.pageName+=">"+bluTag.extended_page_name),bluTag.originating_uri&&bluTag.propEvar("2",bluTag.originating_uri),bluTag.webextra_hotel_code&&(s.prop3=bluTag.webextra_hotel_code,s.eVar12=bluTag.webextra_hotel_code,bluTag.is_webextra_page&&(s.prop37=bluTag.webextra_hotel_code)),"RADBLU"===bluTag.site?bluTag.propEvar("1","Radisson Blu"):bluTag.propEvar("1",bluTag.site),bluTag.propEvar("11",bluTag.visitor_language),s.eVar40=bluTag.domain,bluTag.webextra_country_code&&bluTag.propEvar("18",bluTag.webextra_country_code),bluTag.webextra_city&&bluTag.propEvar("19",bluTag.webextra_city),bluTag.contact_information&&(bluTag.propEvar("16",bluTag.page_name),bluTag.addEvent("event26")),bluTag.products&&(s.products=bluTag.products,bluTag.localPrice&&(s.products+=";event37="+bluTag.localPrice,bluTag.addEvent("event37"))),bluTag.signup&&bluTag.propEvar("14",bluTag.signup,!1),bluTag.purchaseID?(s.purchaseID=bluTag.purchaseID,s.eVar37=bluTag.purchaseID):(bluTag.AID&&bluTag.propEvar("31",bluTag.AID,"aid"),bluTag.partnerID&&bluTag.propEvar("32",bluTag.partnerID,"id"),bluTag.shopID&&bluTag.propEvar("33",bluTag.shopID,"shopid"),bluTag.facilitator&&bluTag.propEvar("34",bluTag.facilitator,"facilitator"),bluTag.iata&&bluTag.propEvar("35",bluTag.iata,"iata")),bluTag.bannerid&&bluTag.propEvar("15",bluTag.bannerid,1),bluTag.currency&&(s.currencyCode=bluTag.currency,s.prop20=bluTag.currency,s.eVar38=bluTag.currency),bluTag.pac_code&&bluTag.propEvar("36",bluTag.pac_code),bluTag.brandCode&&("RAD"==bluTag.brandCode?bluTag.addEvent("event17"):"PII"==bluTag.brandCode?bluTag.addEvent("event18"):"HMW"==bluTag.brandCode?bluTag.addEvent("event20"):"REG"==bluTag.brandCode?bluTag.addEvent("event27"):"MIS"==bluTag.brandCode?bluTag.addEvent("event28"):"CHI"==bluTag.brandCode&&bluTag.addEvent("event29")),bluTag.icid&&(s.eVar39=s.getValOnce(bluTag.icid,"icamp",0)),bluTag.events&&(s.events=bluTag.events),bluTag.campaign&&(s.prop25=bluTag.campaign),bluTag.section&&(s.channel=bluTag.section),bluTag.subsection&&bluTag.propEvar("27",bluTag.subsection,0),bluTag.domain&&(s.server=bluTag.domain),bluTag.campaignValue&&(s.eVar30=bluTag.campaignValue),bluTag.referrer&&(s.referrer=bluTag.referrer),bluTag.bookingLeadTime&&bluTag.propEvar("4",bluTag.bookingLeadTime),bluTag.cancelBookingID&&bluTag.propEvar("13",bluTag.cancelBookingID),bluTag.bookingCreated&&bluTag.propEvar("5",bluTag.bookingCreated),bluTag.bookingArrival&&bluTag.propEvar("6",bluTag.bookingArrival),bluTag.bookingDeparture&&bluTag.propEvar("7",bluTag.bookingDeparture),bluTag.bookingRooms&&(bluTag.propEvar("8",bluTag.bookingRooms),s.prop28=bluTag.bookingRooms),bluTag.bookingAdults&&bluTag.propEvar("9",bluTag.bookingAdults),bluTag.bookingKids&&bluTag.propEvar("10",bluTag.bookingKids),bluTag.commentCount&&(s.prop21=bluTag.commentCount),bluTag.commentDest&&(s.prop22=bluTag.commentDest),bluTag.bookerCity&&(s.prop38=bluTag.bookerCity,s.eVar24=bluTag.bookerCity),bluTag.bookerCountry&&(s.prop39=bluTag.bookerCountry,s.eVar25=bluTag.bookerCountry),bluTag.social&&(s.eVar20=bluTag.social),window._cvp&&"undefined"!==window._cvp.startup){window._cvp.completed!==!0&&window._cvp.startup(void 0,null,{domain:"www.radissonblu.com",site:"radisson"});var conf=window._cvp_ext_config;window._cvp.cvpModified&&void 0!=conf.cvp.cvpEvar&&window._cvp.cvp&&(s[conf.cvp.cvpEvar]=window._cvp.cvp),window._cvp.cvpCombinedModified&&void 0!=conf.classification.cvpEvarCombined&&conf.classification.enable&&window._cvp.cvpCombined&&(s[conf.classification.cvpEvarCombined]=window._cvp.cvpCombined)}if(bluTag.webextra_hotel_code&&bluTag.is_webextra_page&&bluTag.visitor_language&&"undefined"!=typeof bluTag.c_classification){var webextra_page_type=bluTag.webextra_hotel_code+"_"+bluTag.visitor_language+"_",wxPage=new RegExp("^.*_ho_"+bluTag.webextra_hotel_code+"\\|(.*)?$","g"),match=wxPage.exec(bluTag.c_classification);webextra_page_type+=match?match[1]:"fp",s.eVar17=webextra_page_type,s.prop17=webextra_page_type}"prod"===bluTag.environment&&pSuites&&(s=s_gi(bluTag.getOmnitureSuites()+pSuites)),s.t()},bluTag.initAdobe=function(){var s_account="rezidortest",suite=bluTag.getOmnitureSuites();void 0!==suite&&""!==suite&&(s_account=suite),s=s_gi(s_account),window.s_gi=s_gi,window.s_account=s_account,s.charSet="UTF-8",s.currencyCode="EUR",s.trackDownloadLinks=!0,s.trackExternalLinks=!0,s.trackInlineStats=!0,s.linkDownloadFileTypes="exe,zip,wav,mp3,mov,mpg,avi,wmv,doc,pdf,xls",s.linkInternalFilters="javascript:,radissonblu.,rezidor",s.linkLeaveQueryString=!1,s.linkTrackVars="None",s.linkTrackEvents="None",s.visitorNamespace="rezidor",s.trackingServer="rezidor.112.2o7.net",s.usePlugins=!0,s.doPlugins=s_doPlugins,s.getQueryParam=new Function("p","d","u","var s=this,v='',i,t;d=d?d:'';u=u?u:(s.pageURL?s.pageURL:s.wd.location);if(u=='f')u=s.gtfs().location;while(p){i=p.indexOf(',');i=i<0?p.length:i;t=s.p_gpv(p.substring(0,i),u+'');if(t){t=t.indexOf('#')>-1?t.substring(0,t.indexOf('#')):t;}if(t)v+=v?d+t:t;p=p.substring(i==p.length?i:i+1)}return v"),s.p_gpv=new Function("k","u","var s=this,v='',i=u.indexOf('?'),q;if(k&&i>-1){q=u.substring(i+1);v=s.pt(q,'&','p_gvf',k)}return v"),s.p_gvf=new Function("t","k","if(t){var s=this,i=t.indexOf('='),p=i<0?t:t.substring(0,i),v=i<0?'True':t.substring(i+1);if(p.toLowerCase()==k.toLowerCase())return s.epa(v)}return ''"),s.getValOnce=new Function("v","c","e","var s=this,a=new Date,v=v?v:v='',c=c?c:c='s_gvo',e=e?e:0,k=s.c_r(c);if(v){a.setTime(a.getTime()+e*86400000);s.c_w(c,v,e?a:0);}return v==k?'':v"),s.split=new Function("l","d","var i,x=0,a=new Array;while(l){i=l.indexOf(d);i=i>-1?i:l.length;a[x++]=l.substring(0,i);l=l.substring(i+d.length);}return a")},bluTag.resetAdobe=function(){s.campaign="",s.eVar22="",s.eVar23="",s.eVar21="",s.page_name="",s.pageType="",s.prop2="",s.prop37="",s.prop3="",s.eVar12="",s.eVar3="",s.prop12="",bluTag.propEvar("5",""),bluTag.propEvar("6",""),bluTag.propEvar("7",""),bluTag.propEvar("8",""),bluTag.propEvar("9",""),bluTag.propEvar("10",""),bluTag.propEvar("11",""),bluTag.propEvar("13",""),bluTag.propEvar("31",""),bluTag.propEvar("32",""),bluTag.propEvar("33",""),bluTag.propEvar("34",""),bluTag.propEvar("35",""),bluTag.propEvar("16",""),bluTag.propEvar("18",""),bluTag.propEvar("19",""),bluTag.propEvar("36",""),bluTag.propEvar("15",""),bluTag.propEvar("24",""),bluTag.propEvar("25",""),s.eVar30="",s.eVar40="",s.events="",s.products="",s.purchaseID="",s.currencyCode="",bluTag.propEvar("20",""),s.eVar37="",bluTag.propEvar("38",""),bluTag.propEvar("39","")},bluTag.propEvar=function(field,value,eVarOnce){s["prop"+field]=value,eVarOnce?s["eVar"+field]=s.getValOnce(value,eVarOnce,0):s["eVar"+field]=value},bluTag.parseQstring=function(){var p=parseLocation($window.location.search);!bluTag.AID&&p.AID&&(bluTag.AID=p.AID),!bluTag.partnerID&&p.PID&&(bluTag.partnerID=p.PID),!bluTag.partnerID&&p.PartnerID&&(bluTag.partnerID=p.PartnerID),!bluTag.shopID&&p.SID&&(bluTag.shopID=p.SID),!bluTag.facilitator&&p.businesscode&&(bluTag.facilitator=p.businesscode),!bluTag.facilitator&&p.facilitator&&(bluTag.facilitator=p.facilitator),!bluTag.facilitator&&p.facilitatorId&&(bluTag.facilitator=p.facilitatorId),!bluTag.siteId&&p.siteId&&(bluTag.siteId=p.siteId),!bluTag.iata&&p.iata&&(bluTag.iata=p.iata),!bluTag.iata&&p.travAgnt&&(bluTag.iata=p.travAgnt),!bluTag.icid&&p.icid&&(bluTag.icid=p.icid),!bluTag.campaign&&p.csref&&(bluTag.campaign=p.csref),!bluTag.campaign&&p.s_cid&&(bluTag.campaign=p.s_cid),bluTag.domain||(bluTag.domain=location.hostname),!bluTag.referrer&&p.ref&&(bluTag.referrer=p.ref),!bluTag.gclid&&p.gclid&&(bluTag.gclid=p.gclid),!bluTag.bannerid&&p.bannerid&&(bluTag.bannerid=p.bannerid)},bluTag.fireTheTags=function(element,attrs){bluTag.parseQstring(),bluTag.loadTealium(),bluTag.tagAdobe(!0),"true"!==attrs.delaytealium&&bluTag.fireTealium(),element.on("fireTealium",function(){bluTag.fireTealium()}),element.on("cookiePolicyAccepted",function(){window.utag_data.c_policy_accepted="just-now",bluTag.reevaluateTealium()}),sCookie=function(name,value,exp){var d=new Date;d.setTime(d.getTime()+24*exp*60*60*1e3);var expires="expires="+d.toUTCString(),opts="";"www.radissonblu.com"==document.location.host&&(opts=";domain=radissonblu.com");var cString=name+"="+value+"; "+expires+";path=/"+opts;document.cookie=cString},gCookie=function(name){name+="=";for(var ca=document.cookie.split(";"),i=0;i<ca.length;i++){for(var c=ca[i];" "==c.charAt(0);)c=c.substring(1);if(0==c.indexOf(name))return c.substring(name.length,c.length)}return""},bluTag.facilitator&&(sCookie("facilitator-id",bluTag.facilitator,30),bluTag.siteId?sCookie("Merchantsite-id",bluTag.siteId,30):gCookie("Merchantsite-id")&&sCookie("Merchantsite-id","",-30))},bluTag.addEvent=function(event){s.events?s.events+=","+event:s.events=event};var parseLocation=function(location){var obj={};if("undefined"!=typeof location&&""!==location){var pairs=location.substring(1).split("&");if(void 0!==pairs&&pairs.length>0)for(var i=0;i<pairs.length;i++)if(""!==pairs[i]&&"undefined"!=typeof pairs[i]){var pair=pairs[i].split("=");obj[decodeURIComponent(pair[0])]=decodeURIComponent(pair[1])}}return obj};return s_giqf(),bluTag}]),serv.directive("tagHtml",["tagging",function(tagging){return{restrict:"A",link:function(scope,elem,attr){tagging[attr.tagHtml]=elem.html()}}}]),serv.directive("tagInput",["tagging",function(tagging){return{restrict:"A",link:function(scope,elem,attr){tagging[attr.tagInput]=elem.val()}}}]),serv.directive("fireTagging",["tagging","$http",function(tagging,$http){return{restrict:"E",link:function(scope,element,attrs){var URL="https://"+window.location.hostname+"/myaccount/secure/fetchProfileWelcomeMessage.do";"www.radisson.com"===window.location.hostname&&(URL="https://www.radissonblu.com/myaccount/secure/fetchProfileWelcomeMessage.do"),$http({url:URL,method:"jsonp",params:{callback:"JSON_CALLBACK"}}).success(function(data,status,headers,config){data.firstName?tagging.user_loggedIn=!0:tagging.user_loggedIn=!1,tagging.fireTheTags(element,attrs)}).error(function(data,status,headers,config){tagging.user_loggedIn=!1,tagging.fireTheTags(element,attrs)})}}}]),serv.directive("tagDeeplink",["tagging",function(tagging){return{restrict:"A",link:function(){},controller:["$scope",function($scope){$scope.fireDeepLinkingTag=function(tagObj){angular.forEach(tagObj,function(val,key){tagging[key]=val}),null!==tagging.accord_page_name&&""!==tagging.accord_page_name.trim()&&(tagging.page_name=tagging.base_page_name+">"+tagging.accord_page_name,tagging.accord_page_name=""),tagging.tagAdobe(!0)},$scope.fireCookieDeepLinkingTag=function(){var checkboxOptIn=$scope.extendedCookieAccepted,checkboxOptOut=$scope.extendedCookieDeclined;"undefined"!=typeof checkboxOptIn&&checkboxOptIn?(tagging.c_policy_accepted="true",$("#tnode").trigger("cookiePolicyAccepted")):"undefined"!=typeof checkboxOptOut&&checkboxOptOut&&(tagging.c_policy_accepted="false")}}]}}]),serv.controller("bluTagging",["$scope","tagging",function($scope,tagging){$scope.tagging=tagging,$scope.tagging.is_webextra_page="true"}]),angular.module("radBlu").value("brandColorValues",{RAD_B:"034ea0",RAD_G:"BBDD11",RAD_E:"ABC0E5",RAD_R:"EB2629",CHI:"ACB237",PII:"544395",PKP:"75CEE7",PKP_A:"DC3200",QCN:"988B58"}),angular.module("radBlu").directive("crCarousel",["$timeout","$rootScope",function($timeout,$rootScope){"use strict";return{restrict:"ECMA",scope:{items:"=crCarousel"},replace:!0,transclude:!0,template:'<div ng-swipe-right="previous()" ng-swipe-left="next()"><div ng-transclude></div></div>',link:function($scope,$el){function init(){$el.hide(),$scope.hideNavArrows=!1,$scope.sliderInitialized=!1,watchForNewItems()}function watchForNewItems(){"undefined"!=typeof $scope.items&&$scope.$watch("items",function(newValue,oldValue){newValue&&($el.hide(),$scope.timeout=$timeout($scope.initFilmRoll,50),$scope.sliderInitialized=!0,$el.find(".film_roll_wrapper").show())},!0)}$scope.initFilmRoll=function(){$el.find(".film_roll_wrapper, .film_roll_prev, .film_roll_next").remove(),$el.show(),$scope.filmroll=new FilmRoll({container:$el,configure_load:!0,animation:500,scroll:!1,vertical_center:!1,pager:!1}),$el.find(".film_roll_wrapper").show(),$scope.toggleNavArrows(),$el.find(".film_roll_next, .film_roll_prev").on("click",function(){}),$el.on("film_roll:resizing",function(){$scope.toggleNavArrows()})},$scope.toggleNavArrows=function(){var $windowWidth=$(window).width(),totalItemWidth=$windowWidth>1440?$windowWidth-1440:0;$el.find(".item").each(function(index,elem){var padding=$(elem).css("margin-right").replace("px",""),padVal=padding.length>0?+padding:0;totalItemWidth+=Math.ceil($(elem).width()+padVal)}),$windowWidth>totalItemWidth?($el.find(".film_roll_prev").css("display","none"),$el.find(".film_roll_next").css("display","none"),$scope.hideNavArrows=!0):($el.find(".film_roll_prev").css("display","block"),$el.find(".film_roll_next").css("display","block"),$scope.hideNavArrows=!1)},$scope.next=function(){$scope.filmroll.moveLeft(),$rootScope.isMobileLayout||($scope.filmroll.moveLeft(),$scope.filmroll.moveLeft())},$scope.previous=function(){$scope.filmroll.moveRight(),$rootScope.isMobileLayout||($scope.filmroll.moveRight(),$scope.filmroll.moveRight())},init()}}}]),angular.module("radBlu").directive("crDropdown",[function(){"use strict";var link=function($scope,$el,attr){$el.find("ul").find("li:nth-child(even)").addClass("even"),$scope.$watch("showopts",function(){var action=$scope.showopts===!0?"addClass":"removeClass";$el[action]("active"),$("body")[action]("no-scroll")}),$scope.$root.$on("cr-uiEvent-click",function(evt,jqe){$el.find(jqe.target).length<1&&($scope.showopts=!1,$("body").removeClass("no-scroll"))});var $dropdown=$el.find("ul"),dropdownHeight=$dropdown.height(),dropdownPosition=$dropdown.offset(),windowHeight=$(window).height(),viewableContent=windowHeight-dropdownPosition.top,defaultDropdownPositionTop=30;viewableContent<0&&(viewableContent=windowHeight-defaultDropdownPositionTop);var defaultDropdownPositionTop=30;if(viewableContent<0&&(viewableContent=windowHeight-defaultDropdownPositionTop),dropdownHeight>=viewableContent){var defLineHeight=11,lineHeight=Math.round(viewableContent/15/3)>defLineHeight?Math.round(viewableContent/15/3):defLineHeight,fontSize=lineHeight>defLineHeight?Math.round(.8*lineHeight):Math.round(.8*defLineHeight),newDropDownHeight=dropdownHeight-dropdownPosition;$dropdown.css({height:newDropDownHeight+"px",overflow:"auto"});var $dropdownLangOpt=$el.find("ul#langOptions li");$dropdownLangOpt.css({"font-size":fontSize+"px","line-height":lineHeight+"px"})}};return{restrict:"CA",scope:{showopts:"=showopts"},link:link}}]),angular.module("radBlu").directive("crRibbon",["$timeout",function($timeout){"use strict";var link=function($scope,$el){function getFixedItemsWidth(){return $el.siblings(".fixed").length?$el.siblings(".fixed").width():0}function adjustForFixedMenuItems(){$body.css({left:getFixedItemsWidth()+"px"}),$el.find(".prev").css({left:getFixedItemsWidth()+"px"})}var $body=$el.find(".ribbon-body"),$next=$el.find(".next"),$prev=$el.find(".prev"),$fixed=$el.find(".fixed");$scope.scrollDistance=function(){var availableWidth=$scope.frameWidth+getFixedItemsWidth();return availableWidth/4},$scope.getTotalWidth=function(){return $body.children().not(".fixed").width()},$scope.setScrollPosition=function(width,el){$el=el,$body=$el.find(".ribbon-body");var $html=$("html"),tran3d=$html.hasClass("csstransforms3d"),style=null,transition=null;return 0===width&&(width+=40),transition=[tran3d?"translate3d(":"translate(",width+"px, 0",tran3d?",0)":")"].join(""),$html.hasClass("csstransforms")&&(style={"-webkit-transform":transition,"-moz-transform":transition,"-o-transform":transition,"-ms-transform":transition,transform:transition}),$html.hasClass("csstransforms")||(style={"margin-left":width+"px"}),$body.css(style),width},$scope.toggleArrows=function(){var action=$scope.totalWidth<$scope.frameWidth?"hide":"show";$el.find(".next, .prev")[action]();var prevAct=("undefined"!=typeof $scope.curPos&&$scope.curPos)<1?"addClass":"removeClass";$prev[prevAct]("disabled");var nextAct="undefined"!=typeof $scope.curPos&&$scope.curPos>=$scope.maxScroll||"undefined"==typeof $scope.curPos?"addClass":"removeClass";$next[nextAct]("disabled");var nextVisibility="undefined"!=typeof $scope.curPos&&$scope.curPos>=$scope.maxScroll||"undefined"==typeof $scope.curPos?"hide":"show";$el.find(".next")[nextVisibility]();var prevVisibility="undefined"!=typeof $scope.curPos&&$scope.curPos>0?"show":"hide";$el.find(".prev")[prevVisibility](),$scope.totalWidth<$scope.frameWidth?$scope.curPos=0:$scope.curPos>$scope.maxScroll&&($scope.curPos=$scope.maxScroll)},$scope.go=function(direction){var newPos=null;"next"===direction?(newPos=$scope.curPos+$scope.scrollDistance(),$scope.curPos=newPos>$scope.maxScroll?$scope.maxScroll:newPos):"prev"===direction&&(newPos=$scope.curPos-$scope.scrollDistance(),$scope.curPos=newPos<1?0:newPos)},$scope.$watch(function(){return $el.closest("#secondaryNav").find("li.active").length},function(){if($el.closest("#secondaryNav").length&&$("#secondaryNav .ribbon-body ul li").hasClass("active")&&!$("#wrap").hasClass("mobile")){var activeTabElement=$(".secondary-nav .ribbon-body li.active"),offsetYActive=activeTabElement.offset().left+activeTabElement.width(),totalTabWidth=offsetYActive-getFixedItemsWidth();if($scope.totalWidth>=$scope.frameWidth-40){var newPos=null;newPos=$scope.curPos+totalTabWidth+17,$scope.curPos=newPos+getFixedItemsWidth()>$scope.frameWidth-40?$scope.maxScroll+60:0}adjustForFixedMenuItems(),$timeout(adjustForFixedMenuItems,4e3),$scope.setScrollPosition(-$scope.curPos,$el)}});var init=function(e){var actionWidth=$next.width()+$prev.width();$scope.frameWidth=$el.width(),$scope.totalWidth=$body.children().not(".fixed").width()+actionWidth+getFixedItemsWidth(),$scope.maxScroll=$scope.totalWidth-$scope.frameWidth,$fixed.length>0?$scope.fixedOffset=$fixed.first().width():$scope.fixedOffset=0,"undefined"==typeof e&&($scope.curPos=0,$scope.fixedOffset>0&&$body.css({"padding-left":$fixed.width()})),adjustForFixedMenuItems(),$timeout(adjustForFixedMenuItems,4e3),$scope.setScrollPosition(-$scope.curPos,$el)};$scope.updatePosition=function(){$scope.frameWidth=$el.width(),$scope.totalWidth=$body.children().not(".fixed").width()+getFixedItemsWidth(),$("#wrap").hasClass("mobile")?$scope.totalWidth+=.25*$scope.frameWidth:$scope.totalWidth==$scope.frameWidth&&0===$fixed.length?$scope.totalWidth=$scope.totalWidth:$scope.totalWidth+=60+$fixed.width(),$scope.maxScroll=$scope.totalWidth-$scope.frameWidth,$scope.setScrollPosition(-$scope.curPos,$el)},$(window).resize(init),$scope.$watch("curPos",$scope.updatePosition),$scope.$watch("curPos",$scope.toggleArrows),$scope.$watch("frameWidth",$scope.toggleArrows),init()};return{restrict:"ECMA",link:link,transclude:!0,scope:{},templateUrl:"/radblu_sc/views/ribbon.html"}}]),angular.module("radBlu").controller("headerCtrl",["$scope","userService","sharedModel",function($scope,userService,sharedModel){"use strict";$scope.showLangOptions=!1,$scope.drawerClass="",$scope.drawerSection="",$scope.user=$scope.$root.user=userService,$scope.sharedModel=sharedModel,$scope.activateAccount={firstName:"",lastName:"",carlsonNumber:"",email:"",password:"",confirmPassword:""},$scope.login=function(signin){var hasLogInValues=!(signin.account.$isEmpty(signin.account.$viewValue)||signin.password.$isEmpty(signin.password.$viewValue));$scope.user.login(),!$scope.user.loggedIn&&hasLogInValues&&(signin.account.$setValidity("required",!1),signin.password.$setValidity("required",!1))},$scope.pathTo=function(id){return id.length<1&&(id="default"),"/views/drawer/"+id+".html"},$scope.toggleErrorMessage=function(toggle){var errorMsg=jQuery("#header .headerErrorMessage");toggle=toggle||!1,toggle?(errorMsg.show(),angular.element("#header .drawer-body")[0].scrollTop=0):errorMsg.hide()},$scope.showDrawer=function(section){return $scope.isMobileLayout()&&$scope.user.loggedIn&&(section="user-profile"),$scope.drawerSection=section,$scope.drawerClass="active",!1},$scope.activateAccount=function(form){if(form.$valid&&Modernizr.input.required)document.createAccountForm.action="/profiles/secure/activateaccount.do",document.createAccountForm.method="post",document.createAccountForm.submit();else{if(Modernizr.input.required){var emailPattern=/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i,showError=!1;"undefined"!=typeof $scope.activateAccount.firstName&&""!==$scope.activateAccount.firstName||($(".activate-account #firstName").addClass("ng-dirty"),showError=!0),"undefined"!=typeof $scope.activateAccount.lastName&&""!==$scope.activateAccount.lastName||($(".activate-account #lastName").addClass("ng-dirty"),showError=!0),"undefined"!=typeof $scope.activateAccount.carlsonNumber&&""!==$scope.activateAccount.carlsonNumber||($(".activate-account #accountNumber").addClass("ng-dirty"),showError=!0),"undefined"!=typeof accountemail&&""!==accountemail||($(".online-info #emailAddress").addClass("ng-dirty"),showError=!0),"undefined"!=typeof $scope.activateAccount.password&&""!==$scope.activateAccount.password||($(".online-info .activate-online-password1").addClass("ng-dirty"),showError=!0),"undefined"!=typeof $scope.activateAccount.confirmPassword&&""!==$scope.activateAccount.confirmPassword||($(".online-info .activate-online-password2").addClass("ng-dirty"),showError=!0),"undefined"==typeof accountemail||""==accountemail||emailPattern.test(accountemail)||($(".online-info #emailAddress").addClass("ng-dirty"),showError=!0),$scope.toggleErrorMessage(showError)}form.$valid&&(document.createAccountForm.action="/profiles/secure/activateaccount.do",document.createAccountForm.method="post",document.createAccountForm.submit())}},$scope.isLoggedIn=function(){userService.checkIfLoggedIn()},$scope.hideDrawer=function(){return $scope.drawerClass="",$scope.drawerSection="",!1},$scope.$root.$on("cr-uiEvent-showDrawer",function(evt,options){$scope.showDrawer(options.section)}),$scope.$root.$on("cr-uiEvent-hideDrawer",function(){$scope.drawerClass="",$scope.drawerSection=""}),$scope.isLoggedIn(),$scope.logOut=function(){userService.logOut().success(function(){$scope.drawerClass="",$scope.drawerSection=""}).error(function(){console.log("error logging out")})}}]).directive("drawer",["$timeout",function($timeout){"use strict";var link=function($scope,$el){$scope.drawerSection=$scope.$parent.drawerSection,$scope.drawerClass=$scope.$parent.drawerClass,$scope.user=$scope.$parent.user,$scope.orientation="portrait",$scope.adjustDrawerHeight=function(height){var $html=$("html"),tran3d=$html.hasClass("csstransforms3d"),style=null,transition=null;return $html.hasClass("csstransforms")?style={"padding-top":height+"px"}:(transition=[tran3d?"translate3d(":"translate(","0,"+height+"px",tran3d?",0)":")"].join(""),style={"-webkit-transform":transition,"-moz-transform":transition,"-o-transform":transition,"-ms-transform":transition,transform:transition}),$el.css("height","auto"),height},$scope.getDrawerHeight=function(){var $drawerBody=$el.find(".drawer-body"),height=$drawerBody.height()||0,padding=$drawerBody.css("padding-top").replace(/[^-\d\.]/g,"")||0,totalHeight=Number(height)+2*Number(padding);totalHeight=height>0?totalHeight:0,""===$scope.$parent.drawerSection&&(totalHeight=0),$scope.adjustDrawerHeight(totalHeight)},$scope.watchDrawer=function(){$timeout($scope.getDrawerHeight,10)},$scope.$root.$on("cr-uiEvent-click",function(evt,jqe){var target=jqe.target,isTargetOrChild=$el.is(target)||$el.find(target).length>0,isTargetToggle=$(target).is(".drawer-toggle"),doesExist=$("body").find(target).length>0;isTargetOrChild||isTargetToggle||!doesExist||$timeout(function(){$scope.$root.$broadcast("cr-uiEvent-hideDrawer")})}),$scope.$root.$on("cr-uiEvent-orientation",function(e,orientation){$scope.orientation=orientation,$scope.watchDrawer()}),$(window).on("resize",$scope.watchDrawer),$scope.$watch("drawerSection",$scope.watchDrawer),$scope.$watch("drawerClass",$scope.watchDrawer)};return{restrict:"CA",link:link}}]),angular.module("radBlu").controller("contentCtrl",["$scope","$modal",function($scope,$modal){"use strict";$scope.featuredColumns=3,$scope.openModal=function(template){$modal.open({templateUrl:template,controller:"ModalInstanceCtrl"})},$scope.rates=window.LOWEST_RATE_FIXTURE||{},angular.forEach(window.LOWEST_RATE_ARR,function(val){angular.extend($scope.rates,val)}),$scope.featuredSlickCrBreakpoints=[{breakpoint:1200,settings:{slidesToShow:2}},{breakpoint:800,settings:{slidesToShow:1}}]}]),angular.module("radBlu").directive("crTripAdvisor",["$sce","$http",function($sce,$http){"use strict";return{replace:!1,template:"",link:function($scope,iElement,iAttrs){$scope.taUrl=$scope.taUrl,$scope.hotelcodeparam=iAttrs.hotelcodeparam,$scope.tripAvisorSummary="",$scope.$watch($scope.hotelcodeparam,function(newVal){newVal?$http.get($sce.trustAsResourceUrl($scope.taUrl+"&hotelCode="+newVal)).then(function(res){$scope.tripAvisorSummary=$sce.trustAsHtml(res.data)}):$scope.tripAvisorSummary=""})}}}]).directive("tripadvisorFilters",[function(){return{controller:["$scope",function($scope){$scope.updateLang=function(){$scope.lang=$scope.ta_language;var redirectUrl=$scope.path;"undefined"!=typeof $scope.sort&&(redirectUrl+="/"+$scope.sort),redirectUrl+="/"+$scope.lang,window.location.href=redirectUrl},$scope.updateSort=function(){$scope.sort=$scope.ta_sorting;var redirectUrl=$scope.path;redirectUrl+="/"+$scope.sort,"undefined"!=typeof $scope.lang&&(redirectUrl+="/"+$scope.lang),window.location.href=redirectUrl}}],link:function(scope,iElement,iAttrs,ctrl){scope.path=iAttrs.path,scope.lang=iAttrs.lang,scope.sort=iAttrs.sort,scope.ta_language=iAttrs.selectedlang,scope.ta_sorting=iAttrs.selectedsort}}}]).controller("TripadvisorReadmore",["$scope",function($scope){$scope.open=!1,$scope.readMore=function(){$scope.open=!$scope.open}}]),angular.module("radBlu").directive("crSelect",["$document",function($document){"use strict";return{restrict:"A",transclude:!0,replace:!0,scope:{sortValue:"=crSelect"},templateUrl:"/radblu_sc/views/partials/cr-select.html",link:function($scope,$el,$attrs){function handleDocumentClick(e){return!!isSelectClicked(e)||(console.log("select wasnt clicked"),void($scope.isOptionsDisplayed=!1))}function isSelectClicked(e){return $(e.target).closest("[cr-select]").length}function toggleClickListener(){$scope.isOptionsDisplayed?$document.on("click",handleDocumentClick):$document.off("click",handleDocumentClick)}function hideSortValueInList(newValue){var $option,$options=$el.find("[data-value]");return!!newValue&&void $options.removeClass("cr-select__option--selected").each(function(index,element){$option=$(element),$option.attr("data-value")===$scope.sortValue&&$option.addClass("cr-select__option--selected")})}function init(){$el.find("[data-value]").on("click",$scope.selectValue),$scope.$on("destroy",destroy),$scope.$watch("isOptionsDisplayed",toggleClickListener),$scope.$watch("sortValue",hideSortValueInList)}function destroy(){$el.find("[data-value]").off("click",$scope.selectValue),$document.off("click",handleDocumentClick)}$scope.isOptionsDisplayed=!1,$scope.toggleOptions=function(){$scope.isOptionsDisplayed=!$scope.isOptionsDisplayed},$scope.selectValue=function(event){$scope.sortValue=$(event.target).data("value"),$scope.isOptionsDisplayed=!1},init()}}}]),angular.module("radBlu").directive("crFeatured",["$timeout",function($timeout){"use strict";return{restrict:"A",link:function($scope,$el){$scope.intialize=function(){var visibleSlides,getSectionWidth,sections=$el.find(".box"),sectionFirst=sections.first(),panel=$el.find(".panel"),wrap=$("#wrap"),sectionWidth=$("#wrap").hasClass("mobile")?$(window).width()+4:sectionFirst.width(),showNext=!0,showPrev=!1;sections.last().addClass("last"),$scope.isDisplayRTL=$('html[dir="rtl"]').length>0,$scope.sectionsVisible=3,
$scope.position=0,getSectionWidth=function(){return sectionWidth=$("#wrap").hasClass("mobile")?$(window).width()+4:sectionFirst.width()},visibleSlides=function(){wrap.hasClass("tablet")&&sections.length>2?($scope.breakpoint="tablet",$scope.sectionsVisible=2):wrap.hasClass("desktop")&&sections.length>3?($scope.breakpoint="desktop",$scope.sectionsVisible=3):wrap.hasClass("mobile")&&($scope.breakpoint="mobile",$scope.sectionsVisible=1);for(var i=0;i<sections.length;i++)i===$scope.position?$(sections[i]).addClass("visible"):i<=$scope.position?$(sections[i]).removeClass("visible"):i>=$scope.position&&i<=$scope.position+($scope.sectionsVisible-1)?$(sections[i]).addClass("visible"):$(sections[i]).removeClass("visible")},$scope.scrollTo=function(pos,ease,cb){panel.velocity({left:pos+"px",easing:ease||"easeInQuint"},200,function(){cb&&cb(),visibleSlides()})},$scope.featuredNext=function(){var $panel=$(".panel"),numberOfItems=$(".box").length,panelWidth=$panel.width(),itemWidth=$(".box").width(),peakWidth=panelWidth-itemWidth*$scope.sectionsVisible,currentPosition=$panel.position(),currentLeft=currentPosition.left,cssvalue=currentLeft-itemWidth,hasMoreThanVisable=numberOfItems>$scope.sectionsVisible,isLastItemShowing=currentLeft<=-((numberOfItems-($scope.sectionsVisible+1))*itemWidth),lastItemScroll=-((numberOfItems-$scope.sectionsVisible)*itemWidth-peakWidth-3*numberOfItems);$scope.isDisplayRTL&&cssvalue<1&&(cssvalue=0,showNext=!1),isLastItemShowing&&(cssvalue=lastItemScroll,$scope.scrollTo(cssvalue,"easeOutQuint"),showNext=!1,showPrev=!0),!isLastItemShowing&&hasMoreThanVisable?($scope.scrollTo(cssvalue,"easeOutQuint"),showPrev=!0):showNext=!1},$scope.featuredPrev=function(){var $panel=$(".panel"),itemWidth=$(".box").width(),currentPosition=$panel.position(),currentLeft=currentPosition.left,cssvalue=currentLeft+itemWidth;if($scope.isDisplayRTL){var totalWidth=$el.width(),adjstment=12,panelWidth=sections.length*itemWidth,maxScroll=panelWidth-totalWidth-adjstment;cssvalue>0&&(showNext=!0),Math.abs(cssvalue)>maxScroll&&(cssvalue=maxScroll,showPrev=!1),$scope.scrollTo(cssvalue,"easeInQuint")}else cssvalue<0?($scope.scrollTo(cssvalue,"easeInQuint"),showNext=!0):($scope.scrollTo(0,"easeInQuint"),showPrev=!1,showNext=!0)},$scope.setIntialNextButton=function(){$(".box").length>$scope.sectionsVisible&&(showNext=!0)},$scope.showController=function(control){return"next"===control?showNext:showPrev},$scope.displayControls=function(){if($(".box").length>$scope.sectionsVisible)return!0},$scope.showArrows=function(){$el.find(".arrow").fadeIn(200)},$scope.hideArrows=function(){$el.find(".arrow").fadeOut(200)},$el.find(".arrow")&&($scope.isDisplayRTL?(showNext=!1,showPrev=!0):$scope.setIntialNextButton(),$el.find(".next").on("click",function(){return!$(".panel").is(":animated")&&(sectionWidth=getSectionWidth(),void $scope.featuredNext())}),$el.find(".prev").on("click",function(){sectionWidth=getSectionWidth(),$scope.featuredPrev()})),$scope.setInitialLeft=function(){$scope.scrollTo(-($scope.position*sectionWidth),"easeInQuint")},$scope.centerDoublePanel=function(){$timeout(function(){var newMarginLeft=$(".box").width()/2;$el.find(".box").first().css("margin-left",newMarginLeft)},100)},$scope.setDefaults=function(){visibleSlides(),$scope.setInitialLeft(),3===$el.find(".box").length&&$scope.centerDoublePanel()},$scope.setDefaults(),$scope.debounce=function(func,wait,immediate){var timeout;return function(){var context=this,args=arguments,later=function(){timeout=null,immediate||func.apply(context,args)},callNow=immediate&&!timeout;clearTimeout(timeout),timeout=setTimeout(later,wait),callNow&&func.apply(context,args)}},$scope.setPanelContentHeight=function(){if(!$("#wrap").hasClass("mobile")&&$(".featured-3").length>0){var maxHeight=0;$(".featured-3 .panel .box > div").each(function(){$(this).removeAttr("style"),$("a",this).removeAttr("style");var outerHeight=parseInt($(this).outerHeight(!0),10);maxHeight<outerHeight&&(maxHeight=outerHeight)}),$(".featured-3 .panel .box > div").each(function(){if($(this).css("height",maxHeight+"px"),$("a",this).length>0){var topMargin=parseInt($(this).height(),10)-($("a",this).position().top+parseInt($("a",this).outerHeight(!0)));topMargin=topMargin<0?0:topMargin,$("a",this).css("margin-top",topMargin+"px")}})}else $("#wrap").hasClass("mobile")&&$(".featured-3").length>0&&$(".featured-3 .panel .box > div").each(function(){$(this).css("height",""),$("a",this).length>0&&$("a",this).css("margin-top","")})},$scope.setPanelContentHeight(),$scope.debounceResize=$scope.debounce(function(){$scope.setPanelContentHeight()},250),$(window).on("resize",function(){sectionWidth=getSectionWidth(),$scope.setDefaults(),$scope.debounceResize()})},$scope.$watch("mapCtrl.localMarkersLoaded",function(){$(".box").length>0&&$scope.intialize()})}}}]),angular.module("radBlu").directive("crPanelFeatured",[function(){"use strict";return{restrict:"A",link:function($scope,$el){$scope.intialize=function(){var visibleSlides,getSectionWidth,sections=$el.find(".box"),sectionFirst=sections.first(),panel=$el.find(".panel"),wrap=$("#wrap"),sectionWidth=$("#wrap").hasClass("mobile")?$(window).width()+4:sectionFirst.width(),showNext=!1,showPrev=!1;sections.last().addClass("last"),$scope.sectionsVisible=3,$scope.position=0,getSectionWidth=function(){return sectionWidth=$("#wrap").hasClass("mobile")?$(window).width()+4:sectionFirst.width()},visibleSlides=function(){wrap.hasClass("tablet")&&sections.length>2?($scope.breakpoint="tablet",$scope.sectionsVisible=2):wrap.hasClass("desktop")&&sections.length>3?($scope.breakpoint="desktop",$scope.sectionsVisible=3):wrap.hasClass("mobile")&&($scope.breakpoint="mobile",$scope.sectionsVisible=1);for(var i=0;i<sections.length;i++)i===$scope.position?$(sections[i]).addClass("visible"):i<=$scope.position?$(sections[i]).removeClass("visible"):i>=$scope.position&&i<=$scope.position+($scope.sectionsVisible-1)?$(sections[i]).addClass("visible"):$(sections[i]).removeClass("visible")},$scope.scrollTo=function(pos,ease,cb){panel.velocity({left:pos+"px",easing:ease||"easeInQuint"},200,function(){cb&&cb(),visibleSlides()})},$scope.featuredNext=function(){var $panel=$(".panel"),numberOfItems=$scope.mapCtrl.radissonbluLocalMarkers.length,panelWidth=$panel.width(),itemWidth=$(".box").width()+1,peakWidth=panelWidth-itemWidth*$scope.sectionsVisible,currentPosition=$panel.position(),currentLeft=currentPosition.left,cssvalue=currentLeft-itemWidth,hasMoreThanVisable=numberOfItems>$scope.sectionsVisible,isLastItemShowing=currentLeft<=-((numberOfItems-($scope.sectionsVisible+1))*itemWidth),lastItemScroll=-((numberOfItems-$scope.sectionsVisible)*itemWidth-peakWidth);isLastItemShowing&&(cssvalue=lastItemScroll,$scope.scrollTo(cssvalue,"easeOutQuint"),showPrev=!0,showNext=!1),!isLastItemShowing&&hasMoreThanVisable?($scope.scrollTo(cssvalue,"easeOutQuint"),showPrev=!0):showNext=!1},$scope.featuredPrev=function(){var $panel=$(".panel"),itemWidth=$(".box").width()+1,currentPosition=$panel.position(),currentLeft=currentPosition.left,cssvalue=currentLeft+itemWidth;cssvalue<-itemWidth?($scope.scrollTo(cssvalue,"easeInQuint"),showNext=!0):($scope.scrollTo(0,"easeInQuint"),showPrev=!1,showNext=!0)},$scope.setIntialNextButton=function(){var itemWidth=$(".box").width();$scope.mapCtrl.radissonbluLocalMarkers.length*itemWidth>$(".panel").width()&&(showNext=!0)},$scope.showController=function(control){return"next"===control?showNext:showPrev},$scope.displayControls=function(){if($scope.mapCtrl.radissonbluLocalMarkers.length>$scope.sectionsVisible)return!0},$scope.showArrows=function(){$el.find(".arrow").fadeIn(200)},$scope.hideArrows=function(){$el.find(".arrow").fadeOut(200)},$el.find(".arrow")&&($scope.setIntialNextButton(),$el.find(".next").on("click",function(){return!$(".panel").is(":animated")&&(sectionWidth=getSectionWidth(),void $scope.featuredNext())}),$el.find(".prev").on("click",function(){sectionWidth=getSectionWidth(),$scope.featuredPrev()})),$scope.setInitialLeft=function(){$scope.scrollTo(-($scope.position*sectionWidth),"easeInQuint")},$scope.centerDoublePanel=function(){var maxWidthOfDoublePanel=980;if($("#content").width()<maxWidthOfDoublePanel&&!$scope.isMobileLayout()){var boxes=$el.find(".box");_.each(boxes,function(box){$(box).css("maxWidth","50%"),$scope.boxWrapperPaddingReset()})}if($("#content").width()>maxWidthOfDoublePanel){var newPaddingLeft=($("#content").width()-maxWidthOfDoublePanel)/2,boxWrapper=$el.find(".box-wrapper").first();boxWrapper.css("padding-left",newPaddingLeft+"px")}},$scope.boxWrapperPaddingReset=function(){$(".box-wrapper").css("padding-left","0px")},$scope.setDefaults=function(){visibleSlides(),2===$scope.mapCtrl.radissonbluLocalMarkers.length?$scope.centerDoublePanel():$scope.mapCtrl.radissonbluLocalMarkers.length>2&&$scope.setInitialLeft()},$scope.boxWrapperPaddingReset(),$scope.setDefaults()},$scope.$watch("mapCtrl.localMarkersLoaded",function(){$scope.mapCtrl.mapApiLoaded&&$scope.mapCtrl.radissonbluLocalMarkers.length>0&&$scope.mapCtrl.localMarkersLoaded===!0&&$scope.intialize(),$scope.mapCtrl.mapApiLoaded&&$scope.mapCtrl.radissonbluLocalMarkers.length>0&&$scope.mapCtrl.localMarkersLoaded===!1&&($scope.setInitialLeft(),$scope.showNext=!1,$scope.showPrev=!1)})}}}]),angular.module("radBlu").directive("crFeaturedAccordion",["$timeout","$compile",function($timeout,$compile){"use strict";var link=function($scope,$el){$scope.isDisplayRTL=$('html[dir="rtl"]').length>0,$timeout(function(){var $box=$el.find(".box"),$panel=$el.find(".panel"),$arrow=$el.find(".arrow"),$detail=$('<div class="accordion-content general-content"></div>'),isMobile=$("#wrap").hasClass("mobile");$scope.getPanelWidth=function(){var totalWidth=0;return $box.each(function(){totalWidth+=parseInt($(this).width(),10)}),totalWidth},$scope.isIE=function(){var msIE=!1,ua=window.navigator.userAgent,oldIE=ua.indexOf("MSIE "),newIE=ua.indexOf("Trident/");return(oldIE>-1||newIE>-1)&&(msIE=!0),msIE},$scope.handleArrowAction=function(e){var $this=$(e.currentTarget),action=$this.hasClass("next")?"handleNext":"handlePrev";$scope[action]($this)},$scope.arrowVisibility=function(){if(!$("#wrap").hasClass("mobile")){var selectorClass="";if($(".featured-3").length>0&&(selectorClass=".featured-3"),$(".featured-accordion").length>0&&(selectorClass=".featured-accordion"),""!==selectorClass){var nextArrowElement=$el.find(".arrow.next"),prevArrowElement=$el.find(".arrow.prev"),windowWidth=$(window).width();if($scope.isDisplayRTL){var firstPanelRightPosition=Math.ceil($el.find(".box").first().width()+$el.find(".box").first().offset().left),lastPanelLeftPosition=Math.ceil($el.find(".box").last().offset().left);firstPanelRightPosition>windowWidth+1&&$el.find(".box").length>4?nextArrowElement.show():nextArrowElement.hide(),lastPanelLeftPosition<-3&&$el.find(".box").length>4?prevArrowElement.show():prevArrowElement.hide()}else{var lastPanelRightPosition=Math.ceil($el.find(".box").last().width()+$el.find(".box").last().offset().left),firstPanelLeftPosition=Math.ceil($el.find(".box").first().offset().left);firstPanelLeftPosition<-3&&$el.find(".box").length>4?prevArrowElement.show():prevArrowElement.hide(),lastPanelRightPosition>windowWidth&&$el.find(".box").length>4?nextArrowElement.show():nextArrowElement.hide()}}}},$scope.handlePrev=function(){if(!$("#wrap").hasClass("mobile")){var panelWidth=$scope.getPanelWidth(),curPos=Number($panel.css("left").replace("px","")),newPos=curPos+panelWidth/4;if($scope.isDisplayRTL){var maxScroll,totalWidth=$el.width(),adjstment=1;$scope.isIE()&&(adjstment=3),maxScroll=panelWidth-totalWidth-adjstment,Math.abs(newPos)>maxScroll&&(newPos=maxScroll)}else newPos>-1&&(newPos=0);$panel.css({left:newPos+"px"}),setTimeout(function(){$scope.arrowVisibility()},500)}},$scope.handleNext=function(){if(!$("#wrap").hasClass("mobile")){var totalWidth=$el.width(),panelWidth=$scope.getPanelWidth(),maxScroll=panelWidth-totalWidth,curPos=Number($panel.css("left").replace("px","")),newPos=curPos-panelWidth/4;$scope.isDisplayRTL?newPos<1&&(newPos=0):Math.abs(newPos)>maxScroll&&(newPos=-1*maxScroll),$panel.css({left:newPos+"px"}),setTimeout(function(){$scope.arrowVisibility()},500)}},$scope.showDetails=function(e,context,fromInit){var $this=null===e?context:$(this);if(isMobile=$("#wrap").hasClass("mobile"),!fromInit){var urlFragment=$this.data("urlFragment");"undefined"!=typeof urlFragment&&urlFragment&&urlFragment.length>0&&(location.href=location.origin+location.pathname+location.search+"#"+urlFragment)}if($panel.addClass("active"),$this.addClass("active").siblings().removeClass("active"),$el.children(".panel").children(".detail").hide(),$el.find(".detail").each(function(){$(this).parent().hasClass("detail")&&$(this).show()}),isMobile?($this.next(".detail").show(),$(".detail",$this.next(".detail")).show(),handleDetailContent($this.next(".detail"))):($detail.html($this.next().html()),$this.next().hasClass("gallery")?($detail.find(".cycle-sentinel").remove(),$compile($detail)($scope)):($this.next().find(".carbonFootPrintContainer").length>0||$this.next().find(".show-options").length>0)&&$compile($detail)($scope),handleDetailContent($detail)),null!==e){var headerHeight=$("#header").height();$.scrollTo($this,{offset:{top:-headerHeight-50,duration:2e3}})}},$el.after($detail),$box.length<5?$arrow.hide():($arrow.on("click",$scope.handleArrowAction),$scope.arrowVisibility()),!isMobile&&$(".featured-accordion").length>0&&setTimeout(function(){$scope.arrowVisibility()},500),!isMobile&&$(".featured-accordion .panel .box").length>4&&$(".featured-accordion .panel .box").each(function(){$(this).addClass("gtFour")}),$box.on("click",$scope.showDetails);var locationFragment=location.hash.replace("#","").replace("/",""),foundFragment=!1,position=0,nextPressCount=0;$box.each(function(){var boxFragment=$(this).data("urlFragment");"undefined"!=typeof boxFragment&&boxFragment&&boxFragment===locationFragment&&(foundFragment=!0,$scope.showDetails(null,$(this)),nextPressCount=Math.floor(position/4)),position++});for(var i=0;i<nextPressCount;i++)$scope.handleNext();foundFragment&&$("html, body").animate({scrollTop:$box.offset().top-160},400),isMobile||foundFragment||$scope.showDetails(null,$box.first(),!0)},0)};return{restrict:"ECMA",scope:!0,link:link}}]),angular.module("radBlu").controller("restaurantTabs",["$scope",function($scope){"use strict";$(".restaurant__tabs_tab").on("click",function(){$(".restaurant__tabs_tab").removeClass("tabactive"),$(this).addClass("tabactive")})}]),angular.module("radBlu").directive("crChildanchor",[function(){"use strict";return{restrict:"ECMA",link:function($scope,$el){var anchorHref=$el.find("a").attr("href");$el.on("click",function(){$("#wrap").hasClass("mobile")&&(window.location.href=anchorHref)})}}}]),angular.module("radBlu").controller("ModalInstanceCtrl",["$scope","$modalInstance",function($scope,$modalInstance){"use strict";$scope.cancel=function(){$modalInstance.dismiss("cancel")}}]),angular.module("radBlu").directive("crMorecontent",["$compile",function($compile){"use strict";return{restrict:"ECMA",link:function($scope,$el,$attrs){if($el.find(".more-content-container").length<1){var currHtml=$el.html(),moreText="<span>"+$el.attr("text-more")+"</span>",lessText="<span>"+$el.attr("text-less")+"</span>",newHtml='<div class="more-content-container"><div class="more-content-holder">'+currHtml+'</div><a class="toggle-content toggle-content-more" href="javascript:;">'+moreText+'<span class="icon small-blue-down-arrow"></span></a><a class="toggle-content toggle-content-less" href="javascript:;">'+lessText+'<span class="icon small-blue-up-arrow"></span></a></div>';if(window.location.href.indexOf("/restaurant")>1&&$el.addClass("content-trim-partial"),window.location.href.indexOf("/restaurant")>1&&$el.addClass("content-trim-partial"),$el.html($compile(newHtml)($scope)),$scope.displayAll=!1,$scope.isExpanded=function(){return $scope.displayAll},$scope.toggleContent=function(){console.log("toggle content"),$scope.displayAll=!$scope.displayAll},$el.has(".ng-binding").length>0)var unbindPostProcess=$scope.$watch($attrs.ngBind,function(){handleMoreContent($el),unbindPostProcess()});else handleMoreContent($el)}}}}]),angular.module("radBlu").directive("crHidesection",["$cookieStore",function($cookieStore){"use strict";return{restrict:"ECMA",link:function($scope,$el){var close=$el.find(".close-section"),hotelCode=close.attr("data-code");$scope.$watch("$viewContentLoaded",function(){$cookieStore.get("we-alert")===hotelCode&&$el.hide()}),close.on("click",function(){$el.hide(),(angular.isUndefined($cookieStore.get("we-alert"))||null===$cookieStore.get("we-alert"))&&$cookieStore.put("we-alert",hotelCode)})}}}]),angular.module("radBlu").directive("crHideCookie",[function(){"use strict";return{restrict:"ECMA",link:function($scope,$el){var closeSimplifiedCookie=$el.find(".cookie-notification-close"),closeExtendedCookie=$el.find(".extended-cookie-notification-close"),extendedCookieControls=$(".cookieControls");closeSimplifiedCookie.on("click",function(e){e.preventDefault(),$el.hide()}),closeExtendedCookie.on("click",function(e){var checkboxOptIn=$("#checkboxOptIn"),checkboxOptOut=$("#checkboxOptOut");("undefined"!=typeof checkboxOptIn&&checkboxOptIn.is(":checked")||"undefined"!=typeof checkboxOptOut&&checkboxOptOut.is(":checked"))&&(e.preventDefault(),$el.hide())}),extendedCookieControls.on("change",function(e){extendedCookieControls.attr("checked",!1),$(this).prop("checked",!0)})}}}]),angular.module("radBlu").directive("crTabs",[function(){"use strict";return{restrict:"A",transclude:!0,replace:!0,scope:{},controller:["$scope","$rootScope","$location",function($scope,$rootScope,$location){function resetAngularListeners(newPath,fullUrl){fullUrl?$location.$$absUrl=window.location.href.replace(window.location.pathname+window.location.hash,newPath):$location.$$absUrl=window.location.href.replace(window.location.hash,"#"+newPath),$rootScope.$on("$locationChangeSuccess",function(event){$location.$$absUrl=window.location.href}),$rootScope.$on("$locationChangeStart",function(event){$location.$$absUrl=window.location.href})}var panes=$scope.panes=[];$scope.panesList=[],$scope.currentTab=-1,$scope.contentTabs=[],$scope.selectedIndex=0,$scope.select=function(pane,paneindex,$event){console.log("paneindex : "+paneindex),$scope.selectedIndex=paneindex;var currentUrl=window.location.href;angular.forEach($scope.panesList,function(paneitem,index){var count=index;paneitem.selected=!1,currentUrl.indexOf($scope.contentTabs[count])>-1&&($scope.selectedIndex=count,$scope.getClass(count),pane.selected=!0)}),$scope.currentTab!==paneindex&&($scope.selectedIndex=paneindex,$scope.currentTab=pane,pane.selected=!0,$scope.getClass($scope.selectedIndex),$scope.updateURL($scope.contentTabs[paneindex]),$scope.currentTab=paneindex,null!=$event&&$event.preventDefault(),$scope.$broadcast("$destroy"))},$scope.getClass=function(ind){return ind===$scope.selectedIndex?"nav-tab--active":""},$scope.updateURL=function(url){if(console.log("in updateURL? : "+url),window.history.pushState){console.log("in updateURL IF block? : "+url);var newPath=url+window.location.search;console.log("in updateURL IF block - newPath? : "+newPath),console.log("in updateURL IF block - window.location.hash? : "+window.location.hash),window.history.pushState("",document.title,newPath),resetAngularListeners(newPath,!0)}else console.log("in updateURL else block? : "+url),window.location.hash=url,resetAngularListeners(url,!1)},this.addPane=function(pane){pane.selected=!1;var tabUrl="";tabUrl=pane.href,window.location.href.indexOf(tabUrl)>-1&&(pane.selected=!0),$scope.panesList.push(pane),$scope.contentTabs.push(tabUrl),panes.push(pane),window.location.href.indexOf(tabUrl)>-1&&$scope.select(pane,$scope.panesList.length-1,null),$scope.panesList.length===jQuery(".panediv").length&&$scope.currentTab<0&&$scope.select($scope.panesList[0],0,null)}}],templateUrl:"/radblu_sc/views/partials/tabs.html"}}]).directive("crPane",function(){"use strict";return{require:"^crTabs",restrict:"A",replace:!0,transclude:!0,scope:{title:"@title",href:"@href"},link:function(scope,element,attrs,tabsCtrl){tabsCtrl.addPane(scope)},templateUrl:"/radblu_sc/views/partials/tab-pane.html"}}),angular.module("radBlu").directive("crHideMobileSearch",["$document",function($document){"use strict";return{restrict:"A",link:function(scope,el,attr){function isSearchClicked(e){return $(e.target).closest(".search").length}function hideMobileSearch(){isMobileLayout()&&($(".slide-panel input").is(":focus")||el.find(".check-in, .check-out, .rooms-container, .rates-select, .submit").hide())}function toggleMobileSearch(){el.toggleClass("search--visible"),scope.$root.$broadcast("syncToggleBookingBar")}function isMobileLayout(){return $("#wrap.mobile").length}function handleClickEvent(e){isSearchClicked(e)||hideMobileSearch()}function handleScrollEvent(e){hideMobileSearch()}function destroy(){$document.off("click",handleClickEvent),$document.off("scroll",handleScrollEvent)}function init(){$document.on("click",handleClickEvent),$document.on("scroll",handleScrollEvent),scope.$on("destroy",destroy),$(".search-togglerButton").on("click",function(e){toggleMobileSearch()})}scope.$on("syncHideBookingBar",function(){el.removeClass("search--visible"),$(window).trigger("resize")}),init()}}}]),angular.module("radBlu").directive("crCarbonCalculator",[function(){"use strict";return{restrict:"ECMA",link:function($scope,$el){var checkForContent=function(){var attendants=$el.find("#co2Attendants").val(),duration=$el.find("#co2MeetingDuration").val(),seating=$el.find("#co2SeatingArrangement option:selected").index();if(""!==attendants&&attendants.length>0&&""!==duration&&duration.length>0&&seating>0){var seatingValue=$el.find("#co2SeatingArrangement").val();calculateResult(attendants,duration,seatingValue)}else $el.find("#co2resultcontainer").hide()},calculateResult=function(attendantsNumber,meetingDuration,seatingTypeValue){var attendants=parseInt(attendantsNumber,10),duration=parseInt(meetingDuration,10),seating=parseFloat(seatingTypeValue,10),meetingSize=seating*attendants,result=meetingSize*duration*.187/1e3,roundedResult=Math.round(1e5*result)/1e5;injectResult(roundedResult)},injectResult=function(computationResult){$el.find("#keyco2result").text(computationResult+" "+$el.find("#keyco2result").attr("text-co2result")),$el.find("#co2resultcontainer").show()};$el.find("#co2Attendants").keydown(function(event){1==event.shiftKey&&event.preventDefault(),event.keyCode>=48&&event.keyCode<=57||event.keyCode>=96&&event.keyCode<=105||8==event.keyCode||9==event.keyCode||37==event.keyCode||39==event.keyCode||46==event.keyCode||40==event.keyCode||38==event.keyCode||event.preventDefault()}),$el.find("#co2MeetingDuration").keydown(function(event){1==event.shiftKey&&event.preventDefault(),event.keyCode>=48&&event.keyCode<=57||event.keyCode>=96&&event.keyCode<=105||8==event.keyCode||9==event.keyCode||37==event.keyCode||39==event.keyCode||46==event.keyCode||190==event.keyCode||110==event.keyCode||40==event.keyCode||38==event.keyCode?""!=$(this).val()||190!=event.keyCode&&110!=event.keyCode||event.preventDefault():event.preventDefault(),$(this).val().indexOf(".")===-1||190!=event.keyCode&&110!=event.keyCode||event.preventDefault()}),$el.find(".co2inputwrapper input").each(function(){$(this).keyup(function(event){($(this).val().indexOf(".")>-1&&$(this).val().length!=$(this).val().indexOf(".")+1||$(this).val().indexOf(".")==-1)&&(event.keyCode>=48&&event.keyCode<=57||event.keyCode>=96&&event.keyCode<=105||8==event.keyCode||9==event.keyCode||37==event.keyCode||39==event.keyCode||46==event.keyCode||40==event.keyCode||38==event.keyCode)&&checkForContent()})}),$el.find("#co2SeatingArrangement").change(function(){checkForContent()})}}}]),angular.module("radBlu").directive("crShowReservation",[function(){"use strict";return{restrict:"A",link:function($scope,$el){$el.on("click",function(){$(this).next(".reservation-options").toggleClass("active")})}}}]);var MapCtrl=function($scope,$attrs,$log,$filter,$state,$http,$q,carlsonService,userService,reservationModel,GeolocationService,$timeout,brandColorValues,$window,$location){"use strict";if(this.mapApiLoaded=!1,this.$http=$http,this.$q=$q,this.$window=$window,this.$scope=$scope,this.$log=$log,this.$state=$state,this.$filter=$filter,this.$timeout=$timeout,this.$location=$location,this.reservationModel=reservationModel,sessionStorage.reservationModel){var tempModel=JSON.parse(sessionStorage.reservationModel);this.reservationModel.destination=tempModel.destination,this.reservationModel.locations=tempModel.locations,this.reservationModel.rate=tempModel.rate,this.reservationModel.rooms=tempModel.rooms,this.reservationModel.dates=tempModel.dates,this.reservationModel.cityRequest=tempModel.cityRequest,this.reservationModel.cityId=tempModel.cityId,angular.element("[ng-controller=radBluSearchCtrl]").scope().cityRequest=tempModel.cityRequest,sessionStorage.clear()}this.carlsonService=carlsonService,this.geolocationService=GeolocationService,this.brandColorValues=brandColorValues,this.drawer={name:"",visible:!1,overlay:!1,secondarySection:!1},this.section={name:"map-view"},this.activeMarker=null,this.activeInterest=null,this.brand="RAD_B",this.filters=carlsonService.brands,this.areaBrands="",this.variants=[],this.updateMarkers=!1,this.enableAllBrands=!1,this.partnersClass="",this.map=null,this.markerType="world",this.markerIsActive=!1,this.iconSize="large",this.modalClass="",this.modalZoomClass="",this.bookUrl="http://www.radissonblu.com",this.geolocate=!1,this.localMarkers=[],this.radissonbluLocalMarkers=[],this.localMarkersLoaded=!0,this.localInterests=[],this.currentLocalMarkerSymbol="A",this.locationProtocol=$location.protocol(),this.locationHost=$location.host(),this.windowHeight=0,this.windowWidth=0,this.initialMapLoad="",this.listenerExecCtr=0,$scope.worldMarkers={},$scope.regionalMarkers={},this.closestHotel={},_.bindAll(this,"alterMarker","mapZoom","getIcon","getIconUrl"),this.directions={start:"",destination:"",searchStatus:"OK",isShown:!1},$scope.breakpoints=[{breakpoint:1100,settings:{slidesToShow:4,slidesToScroll:1}},{breakpoint:800,settings:{slidesToShow:3,slidesToScroll:1}},{breakpoint:480,settings:{slidesToShow:1,slidesToScroll:1}}];var _this=this;loadGoogleMapsApi(function(){_this.mapApiLoaded=!0,_this.infoWindow=new google.maps.InfoWindow,_this.position=userService.geolocation,_this.mapOptions={zoom:_this.zoom,maxZoom:14,minZoom:2,disableDefaultUI:!0,overviewMapControl:!0,overviewMapControlOptions:{opened:!1},zoomControl:!0,zoomControlOptions:{position:$attrs.zoomControlPosition?google.maps.ControlPosition[$attrs.zoomControlPosition]:google.maps.ControlPosition.RIGHT_CENTER,style:google.maps.ZoomControlStyle.SMALL},scaleControlOptions:{position:google.maps.ControlPosition.BOTTOM_RIGHT}},_this.init()},1)};MapCtrl.prototype={init:function(){this.$scope.$watch("mapCtrl.activeMarker",this.updateDirectionsDestination.bind(this)),this.$scope.$watch("mapCtrl.activeMarker",this.alterMarker),this.$scope.$watch("mapCtrl.reservationModel.destination.zoomLevel",this.mapZoom),this.setMapState(this.$state.activeMapSection),this.$scope.$watch("mapCtrl.localMarkers",this.setClosestHotel.bind(this)),this.$scope.$watch("mapCtrl.localMarkers",this.closeDrawersWhenNoLocalMarkers.bind(this)),this.$scope.delay=0,this.$scope.minDuration=0,this.$scope.message="Please Wait...",this.$scope.backdrop=!0,this.$scope.promise=null,this.$scope.promise=this.$timeout(angular.noop,7700)},isActive:function(names){if(!this.mapApiLoaded)return!1;angular.isString(names)&&(names=[names]);for(var i in names){if(this.drawer.name===names[i])return!0;if(this.section.name===names[i])return!0}return!1},setMapState:function(state){var _this=this;"panel"===state?($("#wrap").hasClass("mobile")?_this.initialSection="map-view":_this.initialSection="panel-view",this.$timeout(function(){google.maps.event.trigger(_this.$scope.map,"resize")},100)):(_this.initialSection="map-view",_this.section.name="map-view")},setActiveHotel:function(address){var _this=this;this.geolocationService.getByAddress(address).then(function(res){_this.reservationModel.destination.geoCoordinates.lat=res.geometry.location.lat(),_this.reservationModel.destination.geoCoordinates.lng=res.geometry.location.lng()});var setActiveMarker=this.$scope.$watch("mapCtrl.localMarkers",function(){var activeMarker,_list=this;activeMarker=_.find(_list.last,function(marker){marker.id===_this.$state.params.hotelCode&&(_this.activeMarker=marker,setActiveMarker())})})},applyFilter:function(){var markers=this.$scope[this.markerType+"Markers"],codes=this.$filter("enabledBrandCodes")(this.filters),that=this;this.$scope.enableAllBrands===!0&&(codes=["RAD_B","RAD_G","RAD_E","RAD_R","CHI","PII","PKP","PKP_A"]);var checkMarker=function(marker,filter){var filterEnabled=filter.enabled===!0,markerHasProperty=Number(marker[filter.code])>0;return filterEnabled&&markerHasProperty?(marker.setMap(that.map),!0):(marker.setMap(null),marker.active=!1,!1)},checkFilters=function(marker,filters){var markerVisible;for(var filter in filters)if(markerVisible=checkMarker(markers[m],filters[filter]))break;return markerVisible};for(var m in markers)"undefined"==typeof markers[m].variant&&checkFilters(markers[m],this.filters)},filterAreaBrands:function(filters,areaBrands){var brands=[];for(var key in areaBrands)brands.push(areaBrands[key]);_.each(filters,function(filter){var checkForBrand=_.indexOf(brands,filter.code);checkForBrand>-1&&(filter.enabled=!0)})},showAreaBrands:function(){this.variants=["RAD_B","RAD_G","RAD_E","RAD_R","CHI","PII","PKP","PKP_A"],this.geolocate=!0,this.updateMarkers=!0,this.filterAreaBrands(this.filters,this.areaBrands),this.loadDrawer("explore-partners"),this.hideMapModal()},alterMarker:function(newMarker,oldMarker){null!==oldMarker&&angular.isUndefined(oldMarker)===!1&&(oldMarker.active=!1,this.scaleMarkers([oldMarker],this.markerType)),null!==newMarker&&angular.isUndefined(newMarker)===!1&&(newMarker.active=!newMarker.active,newMarker.active?(this.scaleMarkers([newMarker],"active"),"RAD_B"===newMarker.variant&&("explore-partners"==this.drawer.name?this.loadDrawer("explore-partners-detail"):this.loadDrawer("explore-hotel-detail"))):(this.scaleMarkers([newMarker],this.markerType),this.closeDrawer()))},hideMarkers:function(markers){_.each(markers,function(marker){marker.active||marker.setMap(null)})},scaleMarkers:function(markers,scale){scale=scale||this.markerType,_.each(markers,function(marker){marker.setIcon(this.getIcon(marker,scale))}.bind(this))},manyMarkers:function(){return this.localMarkers.length>1},mapZoom:function(newZoom,oldZoom){var _this=this,farWorldZoom=4,closeWorldZoom=9;_this.$scope.mapCtrl.reservationModel.destination.zoomLevel<farWorldZoom?(this.markerType="world",this.iconSize="small",this.hideMarkers(this.$scope.regionalMarkers),this.hideMarkers(this.localMarkers)):_this.$scope.mapCtrl.reservationModel.destination.zoomLevel<closeWorldZoom?(this.markerType="regional",this.iconSize="small",this.hideMarkers(this.localMarkers),this.hideMarkers(this.$scope.worldMarkers)):(this.markerType="local",this.iconSize="large",this.hideMarkers(this.$scope.worldMarkers),this.hideMarkers(this.$scope.regionalMarkers)),this.scaleMarkers(this.$scope[this.markerType+"Markers"],this.markerType)},getPropertyType:function(marker){var result=marker.variant||"RAD_B";return null===marker?result:(Number(marker.RAD_B)>0?result="RAD_B":Number(marker.RAD_G)>0?result="RAD_G":Number(marker.RAD_E)>0?result="RAD_E":Number(marker.RAD_R)>0?result="RAD_R":Number(marker.CHI)>0?result="CHI":Number(marker.PII)>0?result="PII":Number(marker.PKP)>0?result="PKP":Number(marker.PKP_A)>0&&(result="PKP_A"),result)},numberOfPropertiesInMarker:function(marker,propertyType){return+marker[propertyType]||0},getIcon:function(marker,size){size=size||this.markerType;var wh=[21,34];return"local"===size||"regional"===size?wh=[21,34]:"active"===size&&(wh=[Math.floor(31.5),Math.floor(51)]),
{url:this.getIconUrl(marker),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(wh[0]/2,wh[1]),size:new google.maps.Size(wh[0],wh[1]),scaledSize:new google.maps.Size(wh[0],wh[1])}},getIconUrl:function(marker){var brand=this.getPropertyType(marker),markerColor=this.brandColorValues[brand],markerSymbol=this.markerSymbol(marker,brand);return"//chart.googleapis.com/chart?chst=d_map_pin_letter&chld="+markerSymbol+"|"+markerColor+"|FFFFFF"},markerSymbol:function(marker,brand){return marker.isLocalMarker?marker.markerSymbol?marker.markerSymbol:this.createAlphaMarkerSymbol(marker):this.numberOfPropertiesInMarker(marker,brand)},createAlphaMarkerSymbol:function(marker){var symbol=this.currentLocalMarkerSymbol;return this.incrementLocalMarkerSymbol(),marker.markerSymbol=symbol,symbol},incrementLocalMarkerSymbol:function(){function nextChar(c){return String.fromCharCode(c.charCodeAt(0)+1)}var nextSymbol;return nextSymbol=nextChar(this.currentLocalMarkerSymbol),this.currentLocalMarkerSymbol=nextSymbol,this.currentLocalMarkerSymbol},hasImage:function(img){return"undefined"!=typeof img&&""!==img},loadSection:function(section){this.section.name=section||"map-view","map-view"===this.section.name?this.isActive("explore-hotel")||(this.closeDrawer(),this.loadDrawer("explore-hotel")):("panel-view"===this.section.name&&(this.drawer.visible=!1),this.localMarkers.length>0&&(this.drawer.visible=!1,this.drawer.name="")),this.$state.go("map-results",{},{notify:!1})},radBluLocalMarkers:function(){var radBluLocalMarkers=_.filter(this.localMarkers,function(pMarker){return"RAD_B"===pMarker.variant});return radBluLocalMarkers},sectionClicked:function(section){"panel-view"===section&&0===this.radBluLocalMarkers().length&&"local"===this.markerType?this.showPanelModal():this.loadSection(section)},isSecondaryContentSection:function(){return _.contains(["explore-city-detail","explore-hotel-detail","explore-weather-detail","explore-partners-detail"],this.drawer.name)},loadDrawer:function(page){return"undefined"==typeof page?(this.drawer.overlay=!1,this.drawer.visible=!1,!1):(this.section.name="map-view","explore-hotel"===page&&this.radBluLocalMarkers().length<1&&("local"===this.markerType||"regional"===this.markerType||"world"===this.markerType)?(this.closeDrawer(),!1):!("explore-city"===page&&this.localMarkers.length<1)&&(this.drawer.name=page,(this.localMarkers.length&&this.hasVariantMarkers(this.localMarkers,"RAD_B")||"explore-partners"===page)&&(this.drawer.visible=!0),this.drawer.overlay=this.isSecondaryContentSection(),this.drawer.visible||this.drawer.overlay?void 0:(this.closeDrawer(),!1)))},explorePartnersItemClicked:function(pMarker){if(this.activeMarker=pMarker,"RAD_B"===pMarker.variant)this.loadDrawer("explore-partners-detail",250);else{var lUrl=pMarker.hotelURL;this.$window.location.href=lUrl}},disableBrandPartnerFilters:function(){var filters=_.map(this.filters,function(filter){return"RAD_B"===filter.code?filter.enabled=!0:filter.enabled=!1,filter}.bind(this));this.filters=filters},closeDrawer:function(){if(3===this.drawer.name.split("-").length){var name=this.drawer.name.split("-");"weather"===name[1]&&(name[1]="city"),this.loadDrawer(name[0]+"-"+name[1]),this.activeMarker=null}else this.drawer.visible=!1,this.drawer.overlay=!1,this.drawer.name="",this.activeMarker=null},closeDrawersWhenNoLocalMarkers:function(){"explore-hotel"===this.drawer.name&&(this.localMarkers.length||this.closeDrawer())},loadCarouselInMapView:function(){var isDrawerOpen=this.drawer.visible,isAppropriateView="explore-partners"!==this.drawer.name&&"map-view"===this.section.name;!isDrawerOpen&&isAppropriateView&&this.loadDrawer("explore-hotel")},hasVariantMarkers:function(pMarkers,pVariant){var result=!1,filterFunction=_.filter(pMarkers,function(pMarker){return pMarker.variant===pVariant});return filterFunction&&filterFunction.length>0&&(result=!0),result},loadPanelModal:function(){var result=!1,isNoHotelsOnLocalPanelView=!this.localMarkers.length&&this.$scope.mapCtrl.map.zoom>=8&&"explore-partners"!==this.drawer.name;return isNoHotelsOnLocalPanelView&&(this.$scope.mapCtrl.section.name="map-view",this.showPanelModal(),result=!0),result},showMapModal:function(){this.modalClass="active"},showPanelModal:function(){this.panelModalClass="active"},hideMapModal:function(){this.modalClass="",this.geolocate=!1},hidePanelModal:function(){this.panelModalClass="",this.geolocate=!1},setSearchLocation:function(location){var _this=this;_this.reservationModel.destination.displayVal=location,_this.carlsonService.suggestLocations(location).then(function(res){_this.reservationModel.locations.suggestedList=[];for(var i in res.data)_this.reservationModel.locations.suggestedList.push(res.data[i]);_this.reservationModel.locations.suggestedList[0]&&_this.reservationModel.setSearchLocation(_this.reservationModel.locations.suggestedList[0].cityId,_this.reservationModel.locations.suggestedList[0].cityName)})},setSearchHotel:function(hotelName,hotelId){this.reservationModel.destination.displayVal=hotelName.replace("&#039;","'"),this.reservationModel.destination.hotelName=hotelName.replace("&#039;","'"),this.reservationModel.destination.hotelCode=hotelId},showDirections:function(){this.closeDrawer(),this.closeDrawer(),this.directions.isShown=!0,this.directions.searchStatus="OK"},updateDirectionsDestination:function(newMarker){newMarker&&(this.directions.destination=this.addressString(newMarker))},addressString:function(marker){var address="";return marker.hotelFixture&&(address=marker.hotelFixture.address1,marker.hotelFixture.address2&&(address=address+","+marker.hotelFixture.address2),marker.hotelFixture.address3&&(address=address+","+marker.hotelFixture.address3),address=address+","+marker.hotelFixture.city,marker.hotelFixture.state&&(address=address+","+marker.hotelFixture.state),marker.hotelFixture.postalCode&&(address=address+","+marker.hotelFixture.postalCode),address=address+","+marker.hotelFixture.country),address},setClosestHotel:function(){return!!this.localMarkers.length&&void(this.closestHotel=this.localMarkers[0])},hasExploreCityMarkers:function(){return this.mapApiLoaded?this.localInterests.length:0}},MapCtrl.$inject=["$scope","$attrs","$log","$filter","$state","$http","$q","carlsonService","userService","reservationModel","GeolocationService","$timeout","brandColorValues","$window","$location"],angular.module("radBlu").controller("mapCtrl",MapCtrl),angular.module("radBlu").directive("crMap",["$http","$timeout","$filter","userService","carlsonService","messageBus","mapLocUpdateService","$location","$q","sharedSearchMap","GeolocationService",function($http,$timeout,$filter,userService,carlsonService,messageBus,mapLocUpdateService,$location,$q,sharedSearchMap,GeolocationService){"use strict";var link=function($scope,$el){loadGoogleMapsApi(function(){function resizeMapViewPort(){if(!$("#map").length)return!1;if($scope.mapCtrl.windowHeight==Math.floor($(window).height())||$scope.mapCtrl.windowWidth==Math.floor($(window).width()))return!1;$scope.mapCtrl.windowHeight=Math.floor($(window).height()),$scope.mapCtrl.windowWidth=Math.floor($(window).width()),navigator.userAgent.match(/iPad;.*CPU.*OS 7_\d/i)&&($("div.cr-map-nav").addClass("ipad-ios7"),$("section.bottom-drawer").addClass("ipad-ios7-explore"));var windowHeight=Math.floor($(window).height()),mapHeaderHeight=(Math.floor($(".top-bar").height()),Math.floor($("#header").height())),mapNavHeight=Math.floor($(".cr-map-nav").height()),newMapHeight=windowHeight-mapHeaderHeight,newInteriorHeight=windowHeight-mapHeaderHeight-mapNavHeight,bottomDrawerHeight=newInteriorHeight,mobileBookNowButtonheight=0;$("#wrap").hasClass("mobile")&&(mobileBookNowButtonheight=Math.floor($(".next-mobile").outerHeight()),newMapHeight=windowHeight-mapHeaderHeight-mobileBookNowButtonheight,newInteriorHeight=windowHeight-mapHeaderHeight-mapNavHeight-mobileBookNowButtonheight),google.maps.event.trigger($scope.mapCtrl.map,"resize"),$timeout(function(){var bottomDrawerHeightDecrement=175;$("#wrap").hasClass("mobile")&&(bottomDrawerHeightDecrement=196),bottomDrawerHeight-=bottomDrawerHeightDecrement,$scope.mapCtrl.mapHeight=newMapHeight+"px",$scope.mapCtrl.mapInteriorHeight=newInteriorHeight+"px",$scope.mapCtrl.bottomDrawerHeight=bottomDrawerHeight+"px",google.maps.event.trigger($scope.mapCtrl.map,"resize"),resizeDescriptionHeight()},100),google.maps.event.trigger($scope.mapCtrl.map,"resize")}function resizeDescriptionHeight(){$scope.mapCtrl.drawer.visible&&$scope.mapCtrl.isSecondaryContentSection()&&$timeout(function(){$scope.mapCtrl.descriptionHeight=$(".col40").height()-$(".hotel-info").height()-15},100)}function resizeSpinnerHeight(){"explore-partners"===$scope.mapCtrl.drawer.name&&$timeout(function(){var newSpinnerHeight=$("#map-canvas").height()-$(".explore-partners .general-content").outerHeight();$scope.mapCtrl.spinnerHeight=newSpinnerHeight+"px"},100)}$scope.mapCtrl.reservationModel.destination.searchedVal&&($scope.mapCtrl.reservationModel.destination.displayVal=$scope.mapCtrl.reservationModel.destination.searchedVal);var lat=$scope.mapCtrl.position.lat,lng=$scope.mapCtrl.position.lng;if($.trim(lat).length>0&&$.trim(lng).length>0&&($scope.mapCtrl.mapOptions.center=new google.maps.LatLng(lat,lng)),""==$scope.mapCtrl.initialMapLoad?$scope.mapCtrl.initialMapLoad="true":"true"==$scope.mapCtrl.initialMapLoad&&($scope.mapCtrl.initialMapLoad="false"),0==$scope.mapCtrl.windowHeight&&0==$scope.mapCtrl.windowWidth&&$("#map").length&&("true"==$scope.mapCtrl.initialMapLoad||""!=$scope.mapCtrl.reservationModel.destination.geoCoordinates.lat&&""!=$scope.mapCtrl.reservationModel.destination.geoCoordinates.lng)){var initialWindowHeight=Math.floor($(window).height()),initialMapHeaderHeight=Math.floor($("#header").height()),initialMapNavHeight=Math.floor($(".cr-map-nav").height()),initialNewMapHeight=initialWindowHeight-initialMapHeaderHeight,initialNewInteriorHeight=initialWindowHeight-initialMapHeaderHeight-initialMapNavHeight,initialMobileBookNowButtonheight=0;$("#wrap").hasClass("mobile")&&(initialMobileBookNowButtonheight=Math.floor($(".next-mobile").outerHeight()),initialNewMapHeight=initialWindowHeight-initialMapHeaderHeight-initialMobileBookNowButtonheight,initialNewInteriorHeight=initialWindowHeight-initialMapHeaderHeight-initialMapNavHeight-initialMobileBookNowButtonheight),$scope.mapCtrl.mapHeight=initialNewMapHeight+"px",$scope.mapCtrl.mapInteriorHeight=initialNewInteriorHeight+"px"}$scope.mapCtrl.map=$scope.$parent.map=new google.maps.Map($el[0],$scope.mapCtrl.mapOptions),$scope.usergeo=userService.geolocation,$scope.searchUpdateLocation=mapLocUpdateService.getLocation(),$scope.mapCtrl.position=userService.geolocation,$scope.$watch("mapCtrl.reservationModel.destination.geoCoordinates.lat",function(){$scope.mapCtrl.activeMarker=null,$scope.mapCenter(),$scope.mapCtrl.localMarkersLoaded=!1,$scope.mapCtrl.hidePanelModal(),$("#wrap").hasClass("mobile")?$scope.mapCtrl.loadSection("map-view"):$scope.mapCtrl.loadSection("panel-view")}),$scope.mapCenter=function(){var lat=$scope.mapCtrl.reservationModel.destination.geoCoordinates.lat,lng=$scope.mapCtrl.reservationModel.destination.geoCoordinates.lng;$.trim(lat).length>0&&$.trim(lng).length>0&&($scope.mapCtrl.position={lat:lat,lng:lng})},$scope.processMarkers=function(markers){var result=[];for(var m in markers)markers[m]=$scope.createMarker(markers[m]),result.push(markers[m]);return result},$scope.createMarker=function(m){var marker=angular.extend(new google.maps.Marker({map:null,position:new google.maps.LatLng(m.lat,m.lng),icon:$scope.mapCtrl.getIcon(m),active:!1,scaledSize:new google.maps.Size(100,100)}),m);return google.maps.event.addListener(marker,"click",$scope.markerClick),marker},$scope.updateLocation=function(hotelName){$scope.mapCtrl.reservationModel.destination.displayVal=hotelName},$scope.fetchLocalMarkers=function(variants){var codes=variants||$filter("enabledBrandCodes")($scope.mapCtrl.filters);return this.getMarkers(codes).success(function(codes){$scope.getMarkersSuccess(codes)}).error(function(){console.log("error getting markers")})},$scope.fetchHotelMapResults=function(pMarkers){var deferred=$q.defer(),lHotelCodes=[];_.each(pMarkers,function(pMarker){"RAD_B"===pMarker.variant&&lHotelCodes.push(pMarker.id)});var lHotelCodeList=lHotelCodes.join(",");return $.trim(lHotelCodeList).length>0?this.getHotelMapResults(lHotelCodeList).success(function(result){var lLocalMarkers=$scope.getHotelMapResultsSuccess(pMarkers,result);deferred.resolve(lLocalMarkers)}).error(function(){console.log("error in calling getHotelMapResults"),deferred.reject()}):(0!==pMarkers.length&&(_.each(pMarkers,function(pMarker){pMarker.setMap($scope.mapCtrl.map)}),"explore-partners"!==$scope.mapCtrl.drawer.name&&$scope.mapCtrl.showPanelModal()),deferred.resolve(pMarkers),$scope.mapCtrl.localMarkersLoaded=!0),deferred.promise},$scope.getHotelMapResultsSuccess=function(pMarkers,pHotelContent){var lMarkers=pMarkers;if(pHotelContent){var lHotelFixtures=pHotelContent.hotelFixtures;lHotelFixtures?_.each(lMarkers,function(pMarker){var lHotelCode=pMarker.id,lHotelFixture=lHotelFixtures[lHotelCode];lHotelFixture?(pMarker.hotelFixture={},angular.extend(pMarker.hotelFixture,lHotelFixture)):"RAD_B"===pMarker.variant&&(console.log("No WCS content found for hotelcode "+pMarker.id+". Removing marker..."),lMarkers=jQuery.grep(lMarkers,function(pLocalMarker){return pLocalMarker.id!=lHotelCode}))}):(lMarkers=jQuery.grep(lMarkers,function(pMarker){return"RAD_B"===pMarker.variant&&console.log("No WCS content found for hotelcode "+pMarker.id+". Removing marker..."),"RAD_B"!==pMarker.variant}),"explore-partners"!==$scope.mapCtrl.drawer.name&&$scope.mapCtrl.showPanelModal()),lMarkers.length!==pMarkers.length?($scope.mapCtrl.currentLocalMarkerSymbol="A",_.each(lMarkers,function(pMarker){pMarker.markerSymbol=null,pMarker.icon=$scope.mapCtrl.getIcon(pMarker),pMarker.setMap($scope.mapCtrl.map)})):_.each(lMarkers,function(pMarker){pMarker.setMap($scope.mapCtrl.map)});var lBookingFixtures=pHotelContent.hotelsBookingFixture;lBookingFixtures&&_.each(lMarkers,function(pMarker){var lHotelCode=pMarker.id,lBookingFixture=lBookingFixtures[lHotelCode];lBookingFixture&&(pMarker.bookingFixture={},angular.extend(pMarker.bookingFixture,lBookingFixture))})}if($scope.mapCtrl.localMarkersLoaded=!0,$(".mobile textarea#crhotelSearch.top-bookingbar").length>0&&$(window).trigger("resize"),$("#wrap").hasClass("mobile")&&$scope.mapCtrl.drawer.visible&&$scope.mapCtrl.reservationModel.selectionMade&&""!=$scope.mapCtrl.reservationModel.destination.geoCoordinates.lat&&""!=$scope.mapCtrl.reservationModel.destination.geoCoordinates.lng){var offsetYValue,activeMarkerYHeight=parseInt($scope.mapCtrl.mapInteriorHeight,10)/2,viewableHeight=parseInt($scope.mapCtrl.mapInteriorHeight,10)-200;activeMarkerYHeight>200&&(offsetYValue=viewableHeight/2-(activeMarkerYHeight-200)),200==activeMarkerYHeight&&(offsetYValue=viewableHeight/2),activeMarkerYHeight<200&&(offsetYValue=viewableHeight/2+(200-activeMarkerYHeight));var latlng=new google.maps.LatLng($scope.mapCtrl.reservationModel.destination.geoCoordinates.lat,$scope.mapCtrl.reservationModel.destination.geoCoordinates.lng);$scope.setCenterWithOffset(latlng,0,offsetYValue),$scope.mapCtrl.reservationModel.selectionMade=!1}return lMarkers},$scope.getHotelMapResults=function(pHotelCodeList){var result={};if($.trim(pHotelCodeList).length>0){var lMapContentURL=$("#mapContentURL").attr("data-URL");lMapContentURL.indexOf("d=Touch")>-1&&(lMapContentURL=lMapContentURL.replace("d=Touch","d=Default"));var lHost=$location.protocol()+"://"+$location.host(),lUrlWithParams=lHost+lMapContentURL+"&packedargs=hotelCodes="+pHotelCodeList;result=$http.get(lUrlWithParams)}return result},$scope.fetchLocalInterests=function(){var lCityId=$.trim(reservationModel.destination.cityId);if(lCityId.length>0&&Number(lCityId)>0)return this.getLocalInterests(lCityId).success(function(result){$scope.getLocalInterestsSuccess(result)}).error(function(){console.log("error in calling getLocalInterests")})},$scope.getLocalInterestsSuccess=function(pInterests){pInterests&&!jQuery.isEmptyObject(pInterests)?$scope.mapCtrl.localInterests=pInterests:$scope.mapCtrl.localInterests=[]},$scope.getLocalInterests=function(pCityId){var lPoiURL=$("#poiURL").attr("data-URL");return $http.get(lPoiURL+"&cityId="+pCityId)},$scope.getMarkers=function(codes){return carlsonService.fetch("markers",{params:{zoom:$scope.mapCtrl.reservationModel.destination.zoomLevel,bounds:$scope.mapCtrl.map.getBounds().toString().replace(/([()])/g,""),center:$scope.mapCtrl.map.getCenter().toString().replace(/([()])/g,""),variants:codes}})},$scope.getMarkersSuccess=function(res){var result=[],localMarkers=res.propertyMarkers;$scope.mapCtrl.currentLocalMarkerSymbol="A",$scope.mapCtrl.hideMarkers($scope.mapCtrl.localMarkers),localMarkers=$scope.sortByDistance(localMarkers),result=_.map(localMarkers,function(marker){return marker.isLocalMarker=!0,$scope.createMarker(marker)}),$scope.fetchHotelMapResults(result).then(function(pLocalMarkers){$scope.mapCtrl.localMarkers=$scope.$parent.localMarkers=pLocalMarkers,$scope.mapCtrl.radissonbluLocalMarkers=$scope.mapCtrl.radBluLocalMarkers(),$scope.mapCtrl.loadCarouselInMapView(),$scope.mapCtrl.applyFilter(),null!==$scope.mapCtrl.activeMarker&&($scope.mapCtrl.scaleMarkers([$scope.mapCtrl.activeMarker],"clicked"),$scope.mapCtrl.alterMarker(null,$scope.mapCtrl.activeMarker),$scope.mapCtrl.hideMarkers([$scope.mapCtrl.activeMarker])),$scope.mapCtrl.markerIsActive===!1||($scope.mapCtrl.markerIsActive=!1),$scope.mapCtrl.geolocate===!0&&($scope.mapCtrl.areaBrands=res.data.areaBrands,res.data.areaBrands.indexOf($scope.mapCtrl.brand)<0&&($scope.mapCtrl.showMapModal(),$scope.positionModal())),"panel-view"===$scope.mapCtrl.initialSection&&(delete $scope.mapCtrl.initialSection,$scope.mapCtrl.localMarkers.length&&($scope.mapCtrl.section.name="panel-view")),0===$scope.mapCtrl.localMarkers.length&&($scope.mapCtrl.section.name="map-view"),$scope.mapCtrl.loadPanelModal()})},$scope.sortByDistance=function(markersData){var markerLatLng,centerPosition=$scope.mapCtrl.map.getCenter(),centerLatLng={lat:centerPosition.lat(),lng:centerPosition.lng()};return _.sortBy(markersData,function(marker){return markerLatLng={lat:marker.lat,lng:marker.lng},$scope.distanceBetweenPositions(centerLatLng,markerLatLng)})},$scope.goToMarker=function(id){var worldResult=$filter("getById")($scope.worldMarkers,id),regionalResult=$filter("getById")($scope.regionalMarkers,id);null!==worldResult&&($scope.mapCtrl.activeMarker=worldResult),null!==regionalResult&&($scope.mapCtrl.activeMarker=regionalResult),null!==$scope.mapCtrl.activeMarker&&$timeout(function(){new google.maps.event.trigger($scope.mapCtrl.activeMarker,"click")},1e3)},$scope.handleMarkerTypeChange=function(){google.maps.event.trigger($scope.mapCtrl.map,"zoom_changed")},$scope.markerClick=function(e){var lCityId=this.id,lZoomLevel=11,lLat=this.getPosition().lat(),lLng=this.getPosition().lng();"undefined"==typeof lCityId||isNaN(lCityId)||"undefined"==typeof sharedSearchMap.markerClickOverride()[lCityId]||(""!==sharedSearchMap.markerClickOverride()[lCityId].zoom&&(lZoomLevel=parseInt(sharedSearchMap.markerClickOverride()[lCityId].zoom)),""!==sharedSearchMap.markerClickOverride()[lCityId].lat&&""!==sharedSearchMap.markerClickOverride()[lCityId].lng&&(lLat=sharedSearchMap.markerClickOverride()[lCityId].lat,lLng=sharedSearchMap.markerClickOverride()[lCityId].lng)),"local"===$scope.mapCtrl.markerType?($scope.mapCtrl.infoWindow&&$scope.mapCtrl.infoWindow.close(),"RAD_B"!==this.variant?(this.active?$scope.mapCtrl.activeMarker=null:$scope.mapCtrl.activeMarker=this,$scope.openInfoWindow($scope.mapCtrl.activeMarker)):($scope.mapCtrl.activeMarker=this.active?null:this,$scope.mapCtrl.hideMarkers($scope.mapCtrl.worldMarkers))):($scope.mapCtrl.reservationModel.destination.zoomLevel=lZoomLevel,$timeout(function(){new google.maps.event.trigger($scope.mapCtrl.map,"idle")},100)),$scope.mapCtrl.position={lat:lLat,lng:lLng},$scope.mapCtrl.markerIsActive=!0},$scope.openInfoWindow=function(marker){$scope.mapCtrl.infoWindow.setContent('<div class="map-info-window"><p>'+marker.name+'</p><p><a href="'+marker.hotelURL+'">View Hotel</a></p></div>'),$scope.mapCtrl.infoWindow.open($scope.mapCtrl.map,marker)},$scope.handleZoomChange=function(){$scope.mapCtrl.map.setZoom($scope.mapCtrl.reservationModel.destination.zoomLevel)},$scope.handlePositionChange=function(){var lat=$scope.mapCtrl.position.lat,lng=$scope.mapCtrl.position.lng;$.trim(lat).length>0&&$.trim(lng).length>0&&($scope.mapCtrl.mapOptions.center=new google.maps.LatLng(lat,lng),$scope.mapCtrl.activeMarker||$scope.mapCtrl.map.panTo($scope.mapCtrl.mapOptions.center))},$scope.positionModal=function(){var popupHeight=$el.height(),popupModal=$el.next("div.popup-modal"),popupModalHeight=popupModal.height();popupModal.css("top",popupHeight/2-popupModalHeight/2)},$scope.distanceBetweenPositions=function(position1,position2){function toRadians(number){return number*Math.PI/180}var R=6371,lat1radians=toRadians(position1.lat),lat2radians=toRadians(position2.lat),latdelta=toRadians(position2.lat-position1.lat),londelta=toRadians(position2.lng-position1.lng),a=Math.sin(latdelta/2)*Math.sin(latdelta/2)+Math.cos(lat1radians)*Math.cos(lat2radians)*Math.sin(londelta/2)*Math.sin(londelta/2),c=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));return R*c},$scope.setCenterWithOffset=function(latlng,offsetx,offsety){var scale=Math.pow(2,$scope.mapCtrl.map.getZoom()),worldCoordinateCenter=$scope.mapCtrl.map.getProjection().fromLatLngToPoint(latlng),pixelOffset=new google.maps.Point(offsetx/scale||0,offsety/scale||0),worldCoordinateNewCenter=new google.maps.Point(worldCoordinateCenter.x-pixelOffset.x,worldCoordinateCenter.y+pixelOffset.y),newCenter=$scope.mapCtrl.map.getProjection().fromPointToLatLng(worldCoordinateNewCenter);$scope.mapCtrl.map.setCenter(newCenter)},resizeMapViewPort.bind(this),$(window).on("resize",resizeMapViewPort),$scope.$on("cr-resizeMap",function(){$timeout(function(){resizeMapViewPort()})}),$scope.$watch("mapCtrl.panelModalClass",$scope.positionModal),$scope.$watch("mapCtrl.reservationModel.destination.zoomLevel",$scope.handleZoomChange),$scope.$watch("mapCtrl.position",$scope.handlePositionChange),$scope.$watch("mapCtrl.markerType",$scope.handleMarkerTypeChange),$scope.$watch("usergeo",function(){var defaultLocation={lat:28,lng:2.3470599};$scope.mapCtrl.position=$scope.usergeo,("undefined"==typeof $scope.mapCtrl.reservationModel||""==$scope.mapCtrl.reservationModel.destination.geoCoordinates.lat&&""==$scope.mapCtrl.reservationModel.destination.geoCoordinates.lng)&&($scope.mapCtrl.geolocate=!0,$scope.mapCtrl.position.lat===defaultLocation.lat&&$scope.mapCtrl.position.lng===defaultLocation.lng?$scope.mapCtrl.reservationModel.destination.zoomLevel=0:$scope.mapCtrl.reservationModel.destination.zoomLevel=11)}),carlsonService.fetch("bootstrap",{}).then(function(res){$scope.mapCtrl.hideMarkers($scope.regionalMarkers),$scope.mapCtrl.hideMarkers($scope.worldMarkers);var updatedRegionalMarkers=_.filter(res.data.bootstrap.regionalMarkers,function(obj){var excludedMarker=sharedSearchMap.excludedMarkers()[obj.id],excludedMarkerId="",excludedMarkerLat="",excludedMarkerLng="";return"undefined"!=typeof excludedMarker&&obj.lat===excludedMarker.lat&&obj.lng===excludedMarker.lng&&(excludedMarkerId=obj.id,excludedMarkerLat=obj.lat,excludedMarkerLng=obj.lng),obj.id!==excludedMarkerId&&obj.lat!==excludedMarkerLat&&obj.lng!==excludedMarkerLng}),updatedWorldMarkers=_.filter(res.data.bootstrap.worldMarkers,function(obj){var excludedMarker=sharedSearchMap.excludedMarkers()[obj.id],excludedMarkerId="",excludedMarkerLat="",excludedMarkerLng="";return"undefined"!=typeof excludedMarker&&obj.lat===excludedMarker.lat&&obj.lng===excludedMarker.lng&&(excludedMarkerId=obj.id,excludedMarkerLat=obj.lat,excludedMarkerLng=obj.lng),obj.id!==excludedMarkerId&&obj.lat!==excludedMarkerLat&&obj.lng!==excludedMarkerLng});$scope.regionalMarkers=$scope.processMarkers(updatedRegionalMarkers),$scope.worldMarkers=$scope.$parent.worldMarkers=$scope.processMarkers(updatedWorldMarkers),$scope.mapCtrl.applyFilter(),"undefined"==typeof $scope.mapCtrl.$state.params.id&&userService.getGeolocation()}),google.maps.event.addListener($scope.mapCtrl.map,"zoom_changed",function(){$scope.mapCtrl.reservationModel.destination.zoomLevel=$scope.mapCtrl.map.getZoom()}),google.maps.event.addListener($scope.mapCtrl.map,"bounds_changed",_.debounce(function(){var latSouth=Math.floor($scope.mapCtrl.map.getBounds().getSouthWest().lat()),latNorth=Math.floor($scope.mapCtrl.map.getBounds().getNorthEast().lat());latSouth<=-85?$scope.checkBounds():latNorth>=85&&$scope.checkBounds()},250)),google.maps.event.addListener($scope.mapCtrl.map,"idle",_.debounce(function(){$scope.mapCtrl.listenerExecCtr=parseInt($scope.mapCtrl.listenerExecCtr,10)+1,1==$scope.mapCtrl.listenerExecCtr&&($scope.mapCtrl.localMarkersLoaded=!1,$scope.mapCtrl.hidePanelModal(),8==$scope.mapCtrl.map.getZoom()&&($scope.mapCtrl.markerType="regional",$scope.mapCtrl.listenerExecCtr=0),"local"===$scope.mapCtrl.markerType?($scope.fetchLocalMarkers().then(function(){if($scope.mapCtrl.applyFilter(),$scope.mapCtrl.scaleMarkers($scope[$scope.mapCtrl.markerType+"Markers"],$scope.markerSize),$scope.mapCtrl.loadCarouselInMapView(),$scope.mapCtrl.hideMarkers($scope.regionalMarkers),$scope.mapCtrl.hideMarkers($scope.worldMarkers),$("#wrap").hasClass("mobile")){var oldDrawer=$scope.mapCtrl.drawer.name;$scope.mapCtrl.closeDrawer(),$scope.mapCtrl.loadDrawer(oldDrawer,300)}$scope.mapCtrl.listenerExecCtr=0}),$scope.fetchLocalInterests()):(console.log("google.maps.event.addListener- Setting localMarkersLoaded to true, there are no local markers - to stop spinner"),$scope.mapCtrl.localMarkersLoaded=!0,$scope.mapCtrl.radissonbluLocalMarkers=[],$scope.mapCtrl.hideMarkers($scope.mapCtrl.localMarkers),$scope.mapCtrl.geolocate===!1&&($scope.mapCtrl.localMarkers=[]),$scope.mapCtrl.activeMarker=null,$scope.mapCtrl.applyFilter(),$scope.mapCtrl.scaleMarkers($scope[$scope.mapCtrl.markerType+"Markers"],$scope.markerSize),$scope.mapCtrl.section.name="map-view",$scope.mapCtrl.closeDrawer(),$scope.mapCtrl.listenerExecCtr=0),$("#map-canvas").find("img").attr("nopin","nopin"),resizeMapViewPort())},250)),messageBus.subscribe("geolocation",function(message,newGeo){$scope.mapCtrl.position={lat:newGeo.lat,lng:newGeo.lng},GeolocationService.getByLatLng(new google.maps.LatLng(newGeo.lat,newGeo.lng)).then(function(result){$scope.mapCtrl.geolocate=!0,$("#destinationSearchType").val(""),$("#usedAutocomplete").val("false");var country=GeolocationService.getAddressValue(result,"country","long_name"),state=GeolocationService.getAddressValue(result,"administrative_area_level_1","short_name"),address=GeolocationService.getAddressValue(result,"locality");"United States"!==country&&"Canada"!==country||(address=address+", "+state),address=address+" ("+country+")",$scope.mapCtrl.reservationModel.destination.geoCoordinates.lat=newGeo.lat,$scope.mapCtrl.reservationModel.destination.geoCoordinates.lng=newGeo.lng,$scope.mapCtrl.reservationModel.cityRequest=address,$scope.mapCtrl.reservationModel.cityId="0",$scope.mapCtrl.reservationModel.destination.zoomLevel=11,$scope.mapCtrl.closeDrawer()})}),$scope.checkBounds=function(){var latNorth=$scope.mapCtrl.map.getBounds().getNorthEast().lat(),latSouth=$scope.mapCtrl.map.getBounds().getSouthWest().lat();if($scope.mapCtrl.map.getZoom()<11)for(var newLat;!(latNorth<85&&latSouth>-85||latNorth>85&&latSouth<-85);){if(latNorth<85&&latSouth>-85)return;if(latNorth>85&&latSouth<-85)return;if(latNorth>85&&(newLat=$scope.mapCtrl.map.getCenter().lat()-(latNorth-85)),latSouth<-85&&(newLat=$scope.mapCtrl.map.getCenter().lat()-(latSouth+85)),newLat){var newCenter=new google.maps.LatLng(newLat,$scope.mapCtrl.map.getCenter().lng());$scope.mapCtrl.map.setCenter(newCenter)}latNorth=$scope.mapCtrl.map.getBounds().getNorthEast().lat(),latSouth=$scope.mapCtrl.map.getBounds().getSouthWest().lat()}},$scope.$on("cr-fullMap",function(){$timeout(function(){$scope.mapCtrl.reservationModel.destination.zoomLevel=2},100)}),$scope.$on("cr-close-drawer",function(){$timeout(function(){$scope.mapCtrl.drawer.overlay=!1,$scope.mapCtrl.closeDrawer()},100)}),$scope.$watch("mapCtrl.updateMarkers",function(){$scope.mapCtrl.updateMarkers===!0&&$scope.fetchLocalMarkers($scope.variants).then(function(){$scope.mapCtrl.applyFilter(),$scope.mapCtrl.scaleMarkers($scope[$scope.mapCtrl.markerType+"Markers"],$scope.markerSize)})}),$scope.$watch("mapCtrl.reservationModel.destination.geoCoordinates",function(){$scope.mapCtrl.position={lat:$scope.mapCtrl.reservationModel.destination.geoCoordinates.lat,lng:$scope.mapCtrl.reservationModel.destination.geoCoordinates.lng},$scope.mapCtrl.closeDrawer()}),$scope.$watch("mapCtrl.activeMarker",function(activeMarker,oldActiveMarker){return!!activeMarker&&void $scope.mapCtrl.setSearchHotel(activeMarker.name,activeMarker.id)}),$scope.$watch(function(){return mapLocUpdateService.getLocation()},function(i){isNaN(i.B)||$scope.mapCtrl.map.panTo(i)}),$scope.$watch(function(){return mapLocUpdateService.getLocationAndZoom()},function(pLocationAndZoom){if(pLocationAndZoom.length>0){var locLatLng=pLocationAndZoom[0],zoomValue=pLocationAndZoom[1];isNaN(locLatLng.lat())||(isNaN(zoomValue)||$scope.mapCtrl.map.setZoom(zoomValue),$scope.mapCtrl.map.panTo(locLatLng),$scope.mapCtrl.loadSection("map-view"))}}),$scope.$on("destroy",function(){google.maps.event.clearInstanceListeners($scope.mapCtrl.map),$(window).off("resize",resizeMapViewPort)}),$scope.$watch("mapCtrl.drawer.name",function(){resizeDescriptionHeight(),resizeSpinnerHeight()})})};return{restrict:"ECMA",link:link}}]),angular.module("radBlu").directive("crDirections",[function(){"use strict";return{restrict:"A",controller:"DirectionsController as directionsCtrl",link:function(scope,element,attrs,directionsCtrl){directionsCtrl.init(element),scope.printDiv=function(printMe){var popupWin,printContents=document.getElementById("printMe").innerHTML;if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1)popupWin=window.open("","_blank","width=600,height=600,scrollbars=no,menubar=no,toolbar=no,location=no,status=no,titlebar=no"),popupWin.window.focus(),popupWin.document.write('<!DOCTYPE html><html><head><link rel="stylesheet" type="text/css" href="style.css" /></head><body onload="window.print()"><div class="reward-body">'+printContents+"</div></body></html>"),popupWin.onbeforeunload=function(event){return popupWin.close(),".\n"},popupWin.onabort=function(event){popupWin.document.close(),popupWin.close()};else{var popupWinB=window.open("","_blank","width=800,height=600,resizable=yes");popupWinB.document.open(),popupWinB.document.write('<html><head><link rel="stylesheet" type="text/css" href="style.css" /></head><body onload="window.print()">'+printContents+"</html>"),popupWinB.document.close()}return popupWin.document.close(),!0},scope.getDirections=function(){directionsCtrl.getDirections()},scope.closeDirectionsPanel=function(){directionsCtrl.close()},scope.reverseDirection=function(){directionsCtrl.reverseDirection()},scope.isState=function(state){return scope.state===state}}}}]).controller("DirectionsController",["$scope",function($scope){"use strict";var self=this,openClass="directions-panel--open";this.states={SEARCH_STATE:"search-state",RESULTS_STATE:"results-state"},this.init=function(element){self.element=element,self.$mapCanvas=$("#map-canvas"),$scope.state=this.states.SEARCH_STATE},this.reset=function(){$scope.state=this.states.SEARCH_STATE,$scope.mapCtrl.directions.start="",this.clearDirectionsResults()},this.open=function(){$scope.mapCtrl.directions.isShown=!0},this.close=function(){$scope.mapCtrl.directions.isShown=!1,$scope.mapCtrl.directions.searchStatus="OK"},this.toggleState=function(state){$scope.state=state},this.clearDirectionsResults=function(){var $resultsPanel=this.element.find(".directions-panel__results");
$resultsPanel.empty()},this.getDirections=function(){var directionsDisplay,directionsService=new google.maps.DirectionsService,$resultsPanel=this.element.find(".directions-panel__results"),_this=this;this.clearDirectionsResults(),directionsDisplay=new google.maps.DirectionsRenderer,directionsDisplay.setMap($scope.mapCtrl.map),directionsDisplay.setPanel($resultsPanel[0]);var request={origin:$scope.mapCtrl.directions.start,destination:$scope.mapCtrl.directions.destination,travelMode:google.maps.TravelMode.DRIVING};directionsService.route(request,function(result,status){$scope.mapCtrl.directions.searchStatus=status,$scope.$apply(),status===google.maps.DirectionsStatus.OK&&(_this.toggleState(_this.states.RESULTS_STATE),directionsDisplay.setDirections(result))})},this.reverseDirection=function(){var start=$scope.mapCtrl.directions.start;$scope.mapCtrl.directions.start=$scope.mapCtrl.directions.destination,$scope.mapCtrl.directions.destination=start},$scope.$watch("mapCtrl.directions.isShown",function(value){self.element[value?"addClass":"removeClass"](openClass)}),$scope.$watch("mapCtrl.activeMarker",function(newMarker){newMarker&&(self.close(),self.reset())})}]);var WebExtraMapCtrl=function($scope,$attrs,$filter,$http,$q,brandColorValues){"use strict";this.$q=$q,this.$scope=$scope,this.modalClass="",this.$http=$http,this.position=null,this.brandColorValues=brandColorValues,this.brand="RAD_B",this.map=null,this.mapElement=null,this.marker=null,this.zoom=14,this.hotelcode=$attrs.hotelcode,this.hotelLatLng=[10,2],this.directions={start:"",destination:"",searchStatus:"OK",isShown:!1},$scope.mapCtrl=this,this.showDirections=function(){this.directions.isShown=!0,this.directions.searchStatus="OK"},this.updateDirectionsDestination=function(newMarker){newMarker&&(this.directions.destination=this.addressString(newMarker))},this.addressString=function(marker){var address="";return marker.hotelFixture&&(address=marker.hotelFixture.address1,marker.hotelFixture.address2&&(address=address+","+marker.hotelFixture.address2),marker.hotelFixture.address3&&(address=address+","+marker.hotelFixture.address3),address=address+","+marker.hotelFixture.city,marker.hotelFixture.state&&(address=address+","+marker.hotelFixture.state),marker.hotelFixture.postalCode&&(address=address+","+marker.hotelFixture.postalCode),address=address+","+marker.hotelFixture.country),address},this.init();var _this=this;loadGoogleMapsApi(function(){_this.mapOptions={zoom:_this.zoom,minZoom:2,disableDefaultUI:!0,overviewMapControl:!0,overviewMapControlOptions:{opened:!1},zoomControl:!0,zoomControlOptions:{position:$attrs.zoomControlPosition?google.maps.ControlPosition[$attrs.zoomControlPosition]:google.maps.ControlPosition.RIGHT_CENTER,style:google.maps.ZoomControlStyle.SMALL},scaleControlOptions:{position:google.maps.ControlPosition.BOTTOM_RIGHT}}})};WebExtraMapCtrl.prototype={init:function(){if(null!=this.hotelcode&&this.getHotelLatLong(this.hotelcode),!$("#map").length)return!1;navigator.userAgent.match(/iPad;.*CPU.*OS 7_\d/i)&&($("div.cr-map-nav").addClass("ipad-ios7"),$("section.bottom-drawer").addClass("ipad-ios7-explore"));var windowHeight=Math.floor($(window).height()),topBarHeight=Math.floor($(".top-bar").height()),subNavHeight=Math.floor($(".secondary-nav").height()),bottomBarHeight=Math.floor($(".bottom-bar").height()),newMapHeight=windowHeight-topBarHeight-subNavHeight,newMapInteriorHeight=newMapHeight-bottomBarHeight;this.mapHeight=newMapHeight+"px",this.mapInteriorHeight=newMapInteriorHeight+"px"},getIcon:function(){var wh=[21,34];return{url:this.getIconUrl(),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(wh[0]/2,wh[1]),size:new google.maps.Size(wh[0],wh[1]),scaledSize:new google.maps.Size(wh[0],wh[1])}},getIconUrl:function(){var brand=this.brand,markerColor=this.brandColorValues[brand],markerSymbol="";return"//chart.googleapis.com/chart?chst=d_map_pin_letter&chld="+markerSymbol+"|"+markerColor+"|FFFFFF"},getHotelLatLong:function(pHotelCode){if($.trim(pHotelCode).length>0){var self=this,lMapContentURL=$("#mapContentURL").attr("data-URL");lMapContentURL.indexOf("d=Touch")>-1&&(lMapContentURL=lMapContentURL.replace("d=Touch","d=Default")),this.$http.get(lMapContentURL+"&packedargs=hotelCodes="+pHotelCode+"&locale=en&latLongOnly=false").success(function(data,status,headers,config){var lHotelBookingFixtures=data.hotelsBookingFixture,lHotelFixtures=data.hotelFixtures,lat=new Number(lHotelBookingFixtures[pHotelCode].lat).valueOf(),lng=new Number(lHotelBookingFixtures[pHotelCode].lng).valueOf();self.updateDirectionsDestination({hotelFixture:lHotelFixtures[pHotelCode]}),self.hotelLatLng=[lat,lng],self.$scope.$broadcast("hotelLatLngLoaded")}).error(function(data,status,headers,config){console.log("no hotel data")})}}},WebExtraMapCtrl.$inject=["$scope","$attrs","$filter","$http","$q","brandColorValues"],angular.module("radBlu").controller("webextraMapCtrl",WebExtraMapCtrl),angular.module("radBlu").directive("crWebextraMap",[function(){"use strict";return{restrict:"EA",link:function($scope,$el,$attrs){function resizeMapViewPort(){loadGoogleMapsApi(function(){if(!$("#map").length)return!1;navigator.userAgent.match(/iPad;.*CPU.*OS 7_\d/i)&&($("div.cr-map-nav").addClass("ipad-ios7"),$("section.bottom-drawer").addClass("ipad-ios7-explore"));var windowHeight=Math.floor($(window).height()),topBarHeight=Math.floor($(".top-bar").height()),subNavHeight=Math.floor($(".secondary-nav").height()),bottomBarHeight=Math.floor($(".bottom-bar").height()),newMapHeight=windowHeight-topBarHeight-subNavHeight,newMapInteriorHeight=newMapHeight-bottomBarHeight;$scope.webextraMapCtrl.mapHeight=newMapHeight+"px",$scope.webextraMapCtrl.mapInteriorHeight=newMapInteriorHeight+"px"})}$scope.$on("hotelLatLngLoaded",function(event,mass){loadGoogleMapsApi(function(){$scope.webextraMapCtrl.mapOptions.center=new google.maps.LatLng($scope.webextraMapCtrl.hotelLatLng[0],$scope.webextraMapCtrl.hotelLatLng[1]),$scope.webextraMapCtrl.map=new google.maps.Map($el[0],$scope.webextraMapCtrl.mapOptions),$scope.webextraMapCtrl.mapElement=$el[0],$scope.mapCenter=function(){$scope.webextraMapCtrl.position={lat:$scope.webextraMapCtrl.hotelLatLng[0],lng:$scope.webextraMapCtrl.hotelLatLng[1]}},$scope.createMarker()})}),$scope.createMarker=function(){var marker=new google.maps.Marker({map:$scope.webextraMapCtrl.map,position:new google.maps.LatLng($scope.webextraMapCtrl.hotelLatLng[0],$scope.webextraMapCtrl.hotelLatLng[1]),icon:$scope.webextraMapCtrl.getIcon(),active:!1,scaledSize:new google.maps.Size(100,100)});return marker},resizeMapViewPort.bind(this),$(window).on("resize",resizeMapViewPort)}}}]);var SearchCtrl=function($http,$scope,$window,$timeout,locationsService,carlsonService,mapLocUpdateService,reservationModel,citySearch,userService,messageBus,sharedModel,sharedSearchMap,GeolocationService,$location,$state,$route,$element,tagging,$q){this.$http=$http,this.$route=$route,this.$scope=$scope,this.$state=$state,this.$timeout=$timeout,this.$window=$window,this.$q=$q,this.locationsService=locationsService,this.location=$location,this.carlsonService=carlsonService,this.mapLocUpdateService=mapLocUpdateService,this.sharedModel=sharedModel,this.sharedSearchMap=sharedSearchMap,this.geolocationService=GeolocationService,this.reservationModel=reservationModel,$scope.reservationModel=reservationModel,this.citySearchModel=citySearch,$scope.citySearchModel=citySearch,this.userService=userService,this.messageBus=messageBus,this.geoCoordinates={lat:"",lng:""},this.searchFormAction="//www.radissonblu.com/reservation/cityRateSearch.do",this.selectedRate="",this.rmcCode="",this.showRmcInputBox=!1,this.rooms=reservationModel.rooms,$scope.showBookingBar=!0,$scope.session={amountChosen:1},$scope.validBookingUrl=!1,$scope.$watch("reservationModel",function(){reservationModel.destination.displayVal&&($scope.validBookingUrl=!0)}),$scope.$watch("reservationModel.dates.checkInDateNoMinFormated",function(newVal,oldVal){$scope.missingMilesForm&&(console.log("setting missing miles arr date validity in watch"),$scope.validateMissingMilesArrDate(newVal)),$scope.contactUsForm&&!$scope.contactusCatagoryCheckInOutConfirmation&&(console.log("setting contact us arr date validity in watch"),$scope.validateContactUsArrDate(newVal))}),$scope.$watch("reservationModel.dates.checkOutDateNoMinFormated",function(newVal,oldVal){$scope.contactUsForm&&!$scope.contactusCatagoryCheckInOutConfirmation&&(console.log("setting contact us dep date validity in watch"),$scope.validateContactUsDepDate(newVal))}),$scope.showBookingForm=!1,$scope.toggleBookingForm=function(){$scope.showBookingForm=!$scope.showBookingForm,$scope.$root.$broadcast("syncHideBookingBar")},$scope.closeBookingForm=function(){$scope.isClickedElementChildOfPopup||($scope.showBookingForm=!1)},$(window).on("orientationchange",function(){$(".hasDatepicker").datepicker("hide")}),$scope.$on("syncToggleBookingBar",function(){$scope.showBookingForm=!0}),$("#content").unbind(),$("#content").bind("click",function(event){event.target;$scope.isClickedElementChildOfPopup=$(".search").find(event.target).length>0,$scope.isPopupCalendar=$(".ui-datepicker-div").find(event.target).length>0,$scope.isClickedElementChildOfPopup||$scope.isPopupCalendar||$scope.closeBookingForm()}),this.rate=reservationModel.rate,this.dates=reservationModel.dates,this.locations=reservationModel.locations,this.destination=reservationModel.destination,this.citydestination=citySearch.destination,$scope.zoomValues={Afghanistan:5,Albania:7,Algeria:4,Andorra:10,Angola:5,"Antigua and Barbuda":11,Argentina:4,Armenia:7,Aruba:11,Australia:4,Austria:6,Azerbaijan:7,"Bahamas, The":11,Bahrain:9,Bangladesh:6,Barbados:10,Belarus:5,Belgium:7,Belize:7,Benin:6,Bhutan:7,Bolivia:5,"Bosnia and Herzegovina":7,Botswana:5,Brazil:4,"Brunei ":8,Bulgaria:6,"Burkina Faso":6,Burundi:7,Cambodia:6,Cameroon:5,Canada:3,"Cape Verde":8,"Central African Republic":5,Chad:5,Chile:4,China:4,Colombia:5,Comoros:9,"Congo, Democratic Republic of the":5,"Congo, Republic of the":5,"Costa Rica":7,"Cote d'Ivoire":6,Croatia:6,Cuba:5,Curacao:8,Cyprus:7,"Czech Republic":6,Denmark:5,Djibouti:7,Dominica:8,"Dominican Republic":6,"East Timor":7,Ecuador:6,Egypt:5,"El Salvador":7,"Equatorial Guinea":8,Eritrea:5,Estonia:6,Ethiopia:5,Fiji:8,Finland:4,France:5,Gabon:6,"Gambia, The":7,Georgia:7,Germany:5,Ghana:6,Greece:6,Grenada:10,Guatemala:6,Guinea:6,"Guinea-Bissau":8,Guyana:6,Haiti:7,Honduras:6,"Hong Kong":10,Hungary:6,Iceland:6,India:4,Indonesia:5,Iran:5,Iraq:5,Ireland:6,Israel:6,Italy:5,Jamaica:8,Japan:5,Jordan:6,Kazakhstan:4,Kenya:5,Kiribati:10,Kosovo:7,Kuwait:8,Kyrgyzstan:6,Laos:5,Latvia:6,Lebanon:7,Lesotho:7,Liberia:6,Libya:5,Liechtenstein:9,Lithuania:6,Luxembourg:8,Macau:12,Macedonia:7,Madagascar:5,Malawi:5,Malaysia:5,Maldives:5,Mali:5,Malta:9,"Marshall Islands":5,Mauritania:5,Mauritius:6,Mexico:4,Micronesia:10,Moldova:6,Monaco:13,Mongolia:4,Montenegro:7,Morocco:5,Mozambique:5,Myanmar:5,Namibia:5,Nauru:10,Nepal:6,Netherlands:6,"Netherlands Antilles":5,"New Zealand":4,Nicaragua:6,Niger:5,Nigeria:5,"North Korea":6,Norway:4,Oman:5,Pakistan:5,Palau:7,"Palestinian Territories":7,Panama:6,"Papua New Guinea":5,Paraguay:5,Peru:4,Philippines:5,Poland:5,Portugal:6,Qatar:7,Romania:6,Russia:2,Rwanda:8,"Saint Kitts and Nevis":8,"Saint Lucia":10,"Saint Vincent and the Grenadines":10,"Samoa ":7,"San Marino":11,"Sao Tome and Principe":9,"Saudi Arabia":4,Senegal:6,Serbia:6,Seychelles:9,"Sierra Leone":7,Singapore:9,"Sint Maarten":10,Slovakia:7,Slovenia:7,"Solomon Islands":5,Somalia:5,"South Africa":4,"South Korea":5,"South Sudan":5,"Spain ":5,"Sri Lanka":6,Sudan:4,Suriname:6,"Swaziland ":8,Sweden:5,Switzerland:7,Syria:7,Taiwan:6,Tajikistan:6,Tanzania:5,"Thailand ":5,Togo:6,Tonga:9,"Trinidad and Tobago":8,Tunisia:5,Turkey:5,Turkmenistan:5,Tuvalu:5,Uganda:6,Ukraine:5,"United Arab Emirates":6,"United Kingdom":5,"United States":4,Uruguay:6,Uzbekistan:5,Vanuatu:5,"Vatican City":12,Venezuela:5,Vietnam:5,Yemen:5,Zambia:5,Zimbabwe:5},$scope.formData={checkInDateRange:{startingDate:$scope.reservationModel.dates.checkInDate,endingDate:$scope.reservationModel.dates.checkOutDate}},$scope.unsubscribe={show:!1,hide:!0},$scope.$watch($scope.contactUsForm,function(){if($scope.contactUsForm&&$scope.contactUsForm.$pristine){var testIE=/(MSIE|Trident\/|Edge\/)/i.test(navigator.userAgent);if(testIE){var resizeTextArea=$(".contact-us-form-page .contact-us-form-wrapper .custom-form textarea");resizeTextArea.resizable({minHeight:resizeTextArea.parent().outerHeight(),minWidth:resizeTextArea.parent().outerWidth(),maxWidth:resizeTextArea.parent().outerWidth(),handles:"se"})}}}),$scope.contactusSecondLevel=!0,$scope.contactusCatagory=!0,$scope.contactusCatagoryCityHotel=!0,$scope.contactusCatagoryFirstLastName=!0,$scope.contactusCatagoryClubEmailComment=!0,$scope.contactusCatagoryCheckInOutConfirmation=!0,$scope.contactusCatagoryGuestRooms=!0,$scope.contactusCatagoryAddressPhone=!0,$scope.contactusCatagoryClubMissingMiles=!0,$scope.contactusCatagoryCityHotelRequired=!0,$scope.guestNumbers=[{value:"",name:"-"},{value:"1",name:"1"},{value:"2",name:"2"},{value:"3",name:"3"},{value:"4",name:"4"},{value:"5",name:"5"},{value:"6",name:"6"},{value:"7",name:"7"},{value:"8",name:"8"},{value:"9",name:"9"}],$scope.formData.guestRoom1=$scope.guestNumbers[0],$scope.formData.guestRoom2=$scope.guestNumbers[0],$scope.formData.guestRoom3=$scope.guestNumbers[0],$scope.$on("chosenCitySelected",function(event,data){$scope.cityFromRadBluSearch=data}),$scope.$on("hotelResults",function(event,data){$scope.hotelResultsFromRadBluSearch=data}),$scope.errorMessages=[],$scope.select_change=function(data){$scope.contactusSecondLevel=!0,$scope.contactusCatagory=!0,$scope.contactusCatagoryCityHotel=!0,$scope.contactusCatagoryFirstLastName=!0,$scope.contactusCatagoryClubEmailComment=!0,$scope.contactusCatagoryCheckInOutConfirmation=!0,$scope.contactusCatagoryAddressPhone=!0,$scope.contactusCatagoryGuestRooms=!0,$scope.contactusCatagoryCityHotelRequired=!0,$scope.categoryRadBluSearchFirst=$scope.selected_type_first.value,$scope.selected_type_second=$scope.subChoice[0],$scope.categoryNameRadBluSearchFirst=$scope.selected_type_first.name,$scope.websiteOptionurl=$scope.redirectWebsiteUrl[0],$scope.careersOptionurl=$scope.redirectCareersUrl[0],"website"===$scope.selected_type_first.value&&($scope.contactusSecondLevel=!1),"reservation_rates"===$scope.selected_type_first.value&&($scope.contactusCatagoryGuestRooms=!1,$scope.contactusCatagory=!1,$scope.contactusCatagoryCityHotel=!1,$scope.contactusCatagoryFirstLastName=!1,$scope.contactusCatagoryClubEmailComment=!1,$scope.contactusCatagoryCheckInOutConfirmation=!1,$scope.contactusCatagoryAddressPhone=!1),"feedback_stay"!==$scope.selected_type_first.value&&"hotel_questions"!==$scope.selected_type_first.value||($scope.contactusCatagory=!1,$scope.contactusCatagoryCityHotel=!1,$scope.contactusCatagoryFirstLastName=!1,$scope.contactusCatagoryClubEmailComment=!1,$scope.contactusCatagoryCheckInOutConfirmation=!1,$scope.contactusCatagoryAddressPhone=!1,$scope.formData.guestRoom1=null,$scope.formData.guestRoom2=null,$scope.formData.guestRoom3=null,$scope.formData.ConfirmationOrCancellationNumber=null),"press_media"!==$scope.selected_type_first.value&&"press_media_newsletter"!==$scope.selected_type_first.value&&"one_touch_app"!==$scope.selected_type_first.value||($scope.contactusCatagory=!1,$scope.contactusCatagoryCityHotel=!1,$scope.contactusCatagoryFirstLastName=!1,$scope.contactusCatagoryClubEmailComment=!1,$scope.contactusCatagoryCityHotelRequired=!1,$scope.formData.guestRoom1=null,$scope.formData.guestRoom2=null,$scope.formData.guestRoom3=null,$scope.formData.contactUsAddress=null,$scope.formData.contactUsPhoneNumber=null,$scope.formData.checkinValue=null,$scope.formData.checkoutValue=null),"club_carlson"===$scope.selected_type_first.value&&($scope.contactusCatagory=!1,$scope.contactusCatagoryFirstLastName=!1,$scope.contactusCatagoryClubEmailComment=!1,$scope.formData.guestRoom1=null,$scope.formData.guestRoom2=null,$scope.formData.guestRoom3=null,$scope.formData.ChooseHotel=null,$scope.formData.ConfirmationOrCancellationNumber=null,$scope.formData.contactUsAddress=null,$scope.formData.contactUsPhoneNumber=null,$scope.formData.checkinValue=null,$scope.formData.checkoutValue=null),"meetings_events"===$scope.selected_type_first.value&&($window.location.href=$scope.websiteOptionurl.value),$scope.contactusCatagoryCityHotel===!0&&($scope.contactusCatagoryCityHotelRequired=!1);var d=new Date,formattedCheckInOutDates=d.getMonth()+1+"/"+d.getDate()+"/"+d.getFullYear();this.reservationModel.dates.checkInDateNoMinFormated=formattedCheckInOutDates,this.reservationModel.dates.checkOutDateNoMinFormated=formattedCheckInOutDates,$("#noMin-calendar-checkout").val(formattedCheckInOutDates),$scope.resetContactUsForm($scope.contactUsForm)},$scope.select_change_second=function(){$scope.contactusCatagory=!0,$scope.contactusCatagoryCityHotel=!0,$scope.contactusCatagoryFirstLastName=!0,$scope.contactusCatagoryClubEmailComment=!0,$scope.contactusCatagoryCheckInOutConfirmation=!0,$scope.contactusCatagoryAddressPhone=!0,$scope.contactusCatagoryGuestRooms=!0,$scope.contactusCatagoryClubMissingMiles=!0,$scope.contactusCatagoryCityHotelRequired=!0,$scope.categoryRadBluSearchSecond=$scope.selected_type_second.value,$scope.categoryNameRadBluSearchSecond=$scope.selected_type_second.name,"reservation_rates"===$scope.selected_type_second.value&&($scope.contactusCatagoryGuestRooms=!1,$scope.contactusCatagory=!1,$scope.contactusCatagoryCityHotel=!1,$scope.contactusCatagoryFirstLastName=!1,$scope.contactusCatagoryClubEmailComment=!1,$scope.contactusCatagoryCheckInOutConfirmation=!1,$scope.contactusCatagoryAddressPhone=!1),"feedback_stay"!==$scope.selected_type_second.value&&"hotel_questions"!==$scope.selected_type_second.value||($scope.contactusCatagory=!1,$scope.contactusCatagoryCityHotel=!1,$scope.contactusCatagoryFirstLastName=!1,$scope.contactusCatagoryClubEmailComment=!1,$scope.contactusCatagoryCheckInOutConfirmation=!1,$scope.contactusCatagoryAddressPhone=!1),"press_media"!==$scope.selected_type_second.value&&"E-Newsletter"!==$scope.selected_type_second.value||($scope.contactusCatagory=!1,$scope.contactusCatagoryCityHotel=!1,$scope.contactusCatagoryFirstLastName=!1,$scope.contactusCatagoryClubEmailComment=!1,$scope.contactusCatagoryCityHotelRequired=!1,$scope.formData.checkinValue=null,$scope.formData.checkoutValue=null,$scope.formData.ConfirmationOrCancellationNumber=null,$scope.formData.contactUsAddress=null,$scope.formData.contactUsPhoneNumber=null),"club_carlson"!==$scope.selected_type_second.value&&"website"!==$scope.selected_type_second.value&&"sales_marketing"!==$scope.selected_type_second.value||($scope.contactusCatagory=!1,$scope.contactusCatagoryFirstLastName=!1,$scope.contactusCatagoryClubEmailComment=!1,$scope.formData.checkinValue=null,$scope.formData.checkoutValue=null,$scope.formData.ChooseHotel=null,$scope.formData.ConfirmationOrCancellationNumber=null,$scope.formData.contactUsAddress=null,$scope.formData.contactUsPhoneNumber=null,$scope.contactusCatagoryClubMissingMiles=!0),"careers"===$scope.selected_type_second.value&&($window.location.href=$scope.careersOptionurl.value),"meetings_events"===$scope.selected_type_second.value&&($window.location.href=$scope.websiteOptionurl.value),$scope.contactusCatagoryCityHotel===!0&&($scope.contactusCatagoryCityHotelRequired=!1);var d=new Date,formattedCheckInOutDates=d.getMonth()+1+"/"+d.getDate()+"/"+d.getFullYear();this.reservationModel.dates.checkInDateNoMinFormated=formattedCheckInOutDates,this.reservationModel.dates.checkOutDateNoMinFormated=formattedCheckInOutDates,$("#noMin-calendar-checkout").val(formattedCheckInOutDates),$scope.resetContactUsForm($scope.contactUsForm)},$scope.resetContactUsForm=function(pForm){console.log("resetContactUsForm form is "+pForm),$scope.contactUsForm.submitted=!1,angular.forEach(pForm,function(field,name){field.$setValidity&&$scope.contactUsForm[name].$setValidity(name,!0)})},$scope.$watch(function(){return sharedSearchMap.getLocation()},function(i){this.$scope=$scope,i&&$scope.searchCtrl.setLatLng(i.destName)}),$scope.$watch(function(){return sharedSearchMap.setSearchBarGo()},function(i){this.$scope=$scope,i&&($scope.searchCtrl.destination.displayVal=i)}),$scope.setInputDirty=function(){$scope.contactUsForm&&($scope.contactUsForm.cityChosen.$setViewValue($scope.cityFromRadBluSearch),$scope.contactUsForm.feedbackCategory.$setViewValue($scope.categoryRadBluSearchFirst),$scope.contactUsForm.feedbackCategoryName.$setViewValue($scope.categoryNameRadBluSearchFirst),$scope.contactUsForm.feedbackCategorySecond.$setViewValue($scope.categoryRadBluSearchSecond),$scope.contactUsForm.feedbackCategoryNameSecond.$setViewValue($scope.categoryNameRadBluSearchSecond)),$scope.meetingRequestForm&&$scope.meetingRequestForm.cityChosen.$setViewValue($scope.cityFromRadBluSearch)},$scope.validateCityChoosen=function(hotelResultsFromRadBluSearch){var validCityChoosen=!1;if(hotelResultsFromRadBluSearch&&hotelResultsFromRadBluSearch.length>0&&(validCityChoosen=!0,"NOHOTELFOUND"===hotelResultsFromRadBluSearch[0].hotelCode&&(validCityChoosen=!1)),$scope.crContactUsObj=$('input[rad-blu-city-autocomplete="citiesAutocompleteOptions"]'),$scope.contactUsForm?$scope.formObj=$scope.contactUsForm:$scope.meetingRequestForm&&($scope.formObj=$scope.meetingRequestForm),$scope.formObj){var valid,oldClss="",nwClss="";validCityChoosen?(valid=!0,oldClss="in"):(valid=!1,nwClss="in"),$scope.formObj.cityChosen.$setValidity("cityChosen",valid),$scope.crContactUsObj.switchClass("ng-"+oldClss+"valid","ng-"+nwClss+"valid"),$scope.crContactUsObj.switchClass("ng-"+oldClss+"valid-required","ng-"+nwClss+"valid-required")}},$scope.validateHotelChoice=function(){$scope.contactUsForm?0==this.formData.ChooseHotel.length||"NOHOTELFOUND"==this.formData.ChooseHotel[0].hotelCode?$scope.contactUsForm.hotelValueHidden.$setValidity("hotelValueHidden",!1):$scope.contactUsForm.hotelValueHidden.$setValidity("hotelValueHidden",!0):$scope.meetingRequestForm?($(".buttonLabel").length&&$(".buttonLabel").each(function(index,el){$(el).html($(el).html().replace(/&nbsp;/g,""))}),0==this.formData.ChooseHotel.length||this.formData.ChooseHotel.length>3||"NOHOTELFOUND"==this.formData.ChooseHotel[0].hotelCode?$scope.meetingRequestForm.hotelValueHidden.$setValidity("hotelValueHidden",!1):$scope.meetingRequestForm.hotelValueHidden.$setValidity("hotelValueHidden",!0)):$scope.missingMilesForm&&(0==this.formData.ChooseHotel.length?$scope.missingMilesForm.hotelValueHidden.$valid=!1:$scope.missingMilesForm.hotelValueHidden.$valid=!0)},$scope.validateRequiredContactUsForm=function(){$scope.contactusCatagory||($scope.contactusCatagoryFirstLastName||(null==this.formData.contactUsFirstName||0===$.trim(this.formData.contactUsFirstName).length?$scope.contactUsForm.contactUsFirstName.$setValidity("contactUsFirstName",!1):$scope.contactUsForm.contactUsFirstName.$setValidity("contactUsFirstName",!0),null==this.formData.contactUsLastName||0===$.trim(this.formData.contactUsLastName).length?$scope.contactUsForm.contactUsLastName.$setValidity("contactUsLastName",!1):$scope.contactUsForm.contactUsLastName.$setValidity("contactUsLastName",!0)),$scope.contactusCatagoryClubEmailComment||(null==this.formData.contactUsEmailAddress||0===$.trim(this.formData.contactUsEmailAddress).length?$scope.contactUsForm.contactUsEmailAddress.$setValidity("contactUsEmailAddress",!1):$scope.contactUsForm.contactUsEmailAddress.$setValidity("contactUsEmailAddress",!0),null==this.formData.contactUsVerifyEmailAddress||0===$.trim(this.formData.contactUsVerifyEmailAddress).length?$scope.contactUsForm.contactUsVerifyEmailAddress.$setValidity("contactUsVerifyEmailAddress",!1):$scope.contactUsForm.contactUsVerifyEmailAddress.$setValidity("contactUsVerifyEmailAddress",!0),null==this.formData.contactUsComment||0===$.trim(this.formData.contactUsComment).length?$scope.contactUsForm.contactUsComment.$setValidity("contactUsComment",!1):$scope.contactUsForm.contactUsComment.$setValidity("contactUsComment",!0)))},$scope.submitFbForm=function(){$scope.contactUsForm&&(console.log("this.formData",this.formData),this.formData.contactUsArrDate=this.reservationModel.dates.checkInDateNoMinFormated,this.formData.contactUsDepDate=this.reservationModel.dates.checkOutDateNoMinFormated,$scope.contactusCatagoryCheckInOutConfirmation||($scope.validateContactUsDepDate(this.formData.contactUsDepDate),$scope.validateContactUsArrDate(this.formData.contactUsArrDate)),$scope.setInputDirty(),$scope.contactUsForm.submitted=!0,$scope.contactUsForm.invalidOr=!0,$scope.missingField=!1,this.formData.feedbackCategoryName=encodeURIComponent(this.formData.feedbackCategoryName),$scope.validateRequiredContactUsForm(),$scope.contactusCatagoryCityHotelRequired&&($scope.validateCityChoosen($scope.hotelResultsFromRadBluSearch),$scope.validateHotelChoice()),0!=$("input#isSendToMeOnly").length&&(this.formData.isSendToMeOnly="true"),$scope.contactUsForm.$valid?$http({url:"/cs/Satellite?pagename=RADBLU/integration/forms/ContactUsSubmit&d=Default",method:"get",params:{formData:this.formData}}).success(function(data){var data=JSON.stringify(data);data.indexOf("missingFields")!==-1?$scope.openModal("missingFields-modal"):data.indexOf("exception")!==-1?$scope.openModal("error-modal"):$scope.openModal("feedback-modal")}).error(function(data,status){$scope.openModal("error-modal"),console.log("error in submiting contact us form")}):console.log("not valid $scope.contactUsForm.$valid",$scope.contactUsForm))},$scope.validateContactUsArrDate=function(pArrDate){0===$.trim(pArrDate).length?$scope.contactUsForm["rateSearchForm.checkinDate"].$setValidity("rateSearchForm.checkinDate",!1):($scope.contactUsForm["rateSearchForm.checkinDate"].$setValidity("rateSearchForm.checkinDate",!0),$scope.contactUsForm["rateSearchForm.checkoutDate"].$setValidity("rateSearchForm.checkoutDate",!0))},$scope.validateContactUsDepDate=function(pDepDate){0===$.trim(pDepDate).length?$scope.contactUsForm["rateSearchForm.checkoutDate"].$setValidity("rateSearchForm.checkoutDate",!1):$scope.contactUsForm["rateSearchForm.checkoutDate"].$setValidity("rateSearchForm.checkoutDate",!0)},$scope.validateRequiredMissingMilesForm=function(){null==this.formData.missingMilesFullName||0===$.trim(this.formData.missingMilesFullName).length?$scope.missingMilesForm.missingMilesFullName.$setValidity("missingMilesFullName",!1):$scope.missingMilesForm.missingMilesFullName.$setValidity("missingMilesFullName",!0),null==this.formData.missingMilesEmail||0===$.trim(this.formData.missingMilesEmail).length?$scope.missingMilesForm.missingMilesEmail.$setValidity("missingMilesEmail",!1):$scope.missingMilesForm.missingMilesEmail.$setValidity("missingMilesEmail",!0),null==this.formData.missingMilesMembershipNumber||0===$.trim(this.formData.missingMilesMembershipNumber).length?$scope.missingMilesForm.missingMilesMembershipNumber.$setValidity("missingMilesMembershipNumber",!1):$scope.missingMilesForm.missingMilesMembershipNumber.$setValidity("missingMilesMembershipNumber",!0),0===$.trim(this.formData.missingMilesLoyaltyProgram.value).length?$scope.missingMilesForm.missingMilesLoyaltyProgram.$setValidity("missingMilesLoyaltyProgram",!1):$scope.missingMilesForm.missingMilesLoyaltyProgram.$setValidity("missingMilesLoyaltyProgram",!0),null==this.formData.missingMilesCity||0===$.trim(this.formData.missingMilesCity).length?$scope.missingMilesForm.city.$setValidity("city",!1):$scope.missingMilesForm.city.$setValidity("city",!0),null==this.formData.missingMilesInvoiceNumber||0===$.trim(this.formData.missingMilesInvoiceNumber).length?$scope.missingMilesForm.missingMilesInvoiceNumber.$setValidity("missingMilesInvoiceNumber",!1):$scope.missingMilesForm.missingMilesInvoiceNumber.$setValidity("missingMilesInvoiceNumber",!0)},$scope.submitMissingMilesForm=function(){$scope.missingMilesForm&&(this.formData.missingMilesCity=$scope.cityFromRadBluSearch,this.formData.missingMilesArrDate=this.reservationModel.dates.checkInDateNoMinFormated,this.formData.missingMilesDepDate=this.reservationModel.dates.checkOutDateNoMinFormated,0!=$("input#isSendToMeOnly").length&&(this.formData.isSendToMeOnly="true"),console.log("this.formData",this.formData),$scope.setInputDirty(),$scope.missingMilesForm.submitted=!0,$scope.missingMilesForm.invalidOr=!0,$scope.validateMissingMilesArrDate(this.formData.missingMilesArrDate),$scope.validateRequiredMissingMilesForm(),$scope.validateHotelChoice(),$scope.missingMilesForm.$valid?$http({url:"/cs/Satellite?pagename=RADBLU/integration/forms/MissingMilesSubmit&d=Default",method:"get",params:{formData:this.formData}}).success(function(data){var data=JSON.stringify(data);data.indexOf("missingFields")!==-1?$scope.openModal("missingFields-modal"):data.indexOf("exception")!==-1?$scope.openModal("error-modal"):$scope.openModal("feedback-modal")}).error(function(data,status){$scope.openModal("error-modal"),console.log("error in submiting missing miles form")}):console.log("not valid $scope.missingMilesForm.$valid",$scope.missingMilesForm))},$scope.validateMissingMilesArrDate=function(pArrDate){var lArrivalDate=new Date,parts=pArrDate.split("/"),parts=pArrDate.split("/"),lArrivalDate=new Date(new Date(parts[2],parts[0]-1,parts[1])),lDateSixWeeksBeforNow=new Date;lDateSixWeeksBeforNow.setDate(lDateSixWeeksBeforNow.getDate()-42),console.log("lDateSixWeeksBeforNow="+lDateSixWeeksBeforNow),console.log("lArrivalDate="+lArrivalDate),lDateSixWeeksBeforNow<lArrivalDate?$scope.missingMilesForm["rateSearchForm.checkinDate"].$setValidity("rateSearchForm.checkinDate",!1):$scope.missingMilesForm["rateSearchForm.checkinDate"].$setValidity("rateSearchForm.checkinDate",!0)},$scope.submitAccessResForm=function(){if($scope.accessResForm){$scope.setInputDirty(),$scope.accessResForm.submitted=!0,$scope.accessResForm.invalidOr=!0;var accessResURL="";null!=document.getElementById("accessResURL")&&null!=document.getElementById("accessResURL").getAttribute("data-URL")&&(accessResURL=document.getElementById("accessResURL").getAttribute("data-URL")),console.log("submitAccessResForm valid is "+$scope.accessResForm.$valid),$scope.accessResForm.$valid&&($("#accessResFormId").attr("action",accessResURL),$("#accessResFormId").submit())}},$scope.validateRequiredMtgReqForm=function(){null==this.formData.meetingRequestFullName||0===$.trim(this.formData.meetingRequestFullName).length?$scope.meetingRequestForm.name.$setValidity("name",!1):$scope.meetingRequestForm.name.$setValidity("name",!0),null==this.formData.meetingRequestCountry||0===$.trim(this.formData.meetingRequestCountry).length?$scope.meetingRequestForm.country.$setValidity("country",!1):$scope.meetingRequestForm.country.$setValidity("country",!0),null==this.formData.meetingRequestPhoneNumber||0===$.trim(this.formData.meetingRequestPhoneNumber).length?$scope.meetingRequestForm.meetingRequestPhoneNumber.$setValidity("meetingRequestPhoneNumber",!1):$scope.meetingRequestForm.meetingRequestPhoneNumber.$setValidity("meetingRequestPhoneNumber",!0),null==this.formData.meetingRequestEmail||0===$.trim(this.formData.meetingRequestEmail).length?$scope.meetingRequestForm.meetingRequestEmail.$setValidity("meetingRequestEmail",!1):$scope.meetingRequestForm.meetingRequestEmail.$setValidity("meetingRequestEmail",!0),null==this.formData.meetingRequestNumberAttendees||0===$.trim(this.formData.meetingRequestNumberAttendees).length?$scope.meetingRequestForm.meetingRequestNumberAttendees.$setValidity("meetingRequestNumberAttendees",!1):$scope.meetingRequestForm.meetingRequestNumberAttendees.$setValidity("meetingRequestNumberAttendees",!0),null==this.formData.meetingRequestRoomSize||0===$.trim(this.formData.meetingRequestRoomSize).length?$scope.meetingRequestForm.meetingRequestRoomSize.$setValidity("meetingRequestRoomSize",!1):$scope.meetingRequestForm.meetingRequestRoomSize.$setValidity("meetingRequestRoomSize",!0),null==this.formData.meetingRequestRoomsNeeded||0===$.trim(this.formData.meetingRequestRoomsNeeded).length?$scope.meetingRequestForm.meetingRequestRoomsNeeded.$setValidity("meetingRequestRoomsNeeded",!1):$scope.meetingRequestForm.meetingRequestRoomsNeeded.$setValidity("meetingRequestRoomsNeeded",!0);
},$scope.submitMtgReqForm=function(){console.log("this.formData",this.formData),$scope.setInputDirty();var meetingReqCheckinDate=$("#mtg-calendar-check-in").datepicker("getDate"),meetingReqCheckoutDate=$("#mtg-calendar-check-out").datepicker("getDate");if(this.formData.meetingReqArrDate=$.datepicker.formatDate("mm/dd/yy",meetingReqCheckinDate),this.formData.meetingReqDepDate=$.datepicker.formatDate("mm/dd/yy",meetingReqCheckoutDate),$scope.meetingRequestForm.submitted=!0,$scope.meetingRequestForm.invalidOr=!0,$scope.validateCityChoosen($scope.hotelResultsFromRadBluSearch),$scope.validateHotelChoice(),$scope.validateRequiredMtgReqForm(),$scope.meetingRequestForm.$valid){if($scope.setInputDirty(),$("input#recaptcha_response_field").length>0){var captchaResponseName=$("input#recaptcha_response_field").attr("name"),captchaResponseValue=$("input#recaptcha_response_field").val();this.formData[captchaResponseName]=captchaResponseValue}if($("input#recaptcha_challenge_field").length>0){var captchaChallengeName=$("input#recaptcha_challenge_field").attr("name"),captchaChallengeValue=$("input#recaptcha_challenge_field").val();this.formData[captchaChallengeName]=captchaChallengeValue}if($("#g-recaptcha-response").length>0){var captchaResponseName=$("#g-recaptcha-response").attr("name"),captchaResponseValue=$("#g-recaptcha-response").val();this.formData[captchaResponseName]=captchaResponseValue}0!=$("input#isSendToMeOnly").length&&(this.formData.isSendToMeOnly="true"),$http({url:"/cs/Satellite?pagename=RADBLU/integration/forms/MeetingRequestSubmit&d=Default",method:"get",params:{formData:this.formData}}).success(function(data){$scope.captchaError=!1,data.indexOf("missingFields")!==-1?$scope.openModal("missingFields-modal"):data.indexOf("exception")!==-1?$scope.openModal("error-modal"):data.indexOf("20")===-1?($scope.openModal("feedback-modal"),$scope.tagSubmit()):$scope.captchaError=!0}).error(function(data,status){$scope.openModal("error-modal"),console.log("error in submiting meeting request form")})}else console.log("not valid $scope.meetingRequestForm.$valid",$scope.meetingRequestForm)},$scope.tagSubmit=function(){for(var lSuites="",lProducts="",lEvents="event21,event23",x=0;x<$scope.formData.ChooseHotel.length;x++)x>0&&(lProducts+=","),lSuites+=",rezidor"+$scope.formData.ChooseHotel[x].hotelCode.toLowerCase(),lProducts+=";"+$scope.formData.ChooseHotel[x].hotelCode.toLowerCase();tagging.page_name=tagging.page_name+">submit",tagging.products=lProducts,tagging.tagAdobe(!0,lEvents,lSuites)},$scope.displayLocation=function(){return $scope.searchCtrl.destination.displayVal},this.init(),$window.location.href.indexOf("webextra")>=0&&(this.reservationModel.destination.displayVal="Radisson Blu Le Metropolitan Hotel, Paris Eiffel");var adjustMaxHeightOfElement=function(){if("booking-form"===$element.attr("id")){var maxHeight=$(window).height()-110;$element.css({maxHeight:maxHeight+"px"})}};adjustMaxHeightOfElement(),$(window).on("resize",adjustMaxHeightOfElement)};SearchCtrl.$inject=["$http","$scope","$window","$timeout","locationsService","carlsonService","mapLocUpdateService","reservationModel","citySearch","userService","messageBus","sharedModel","sharedSearchMap","GeolocationService","$location","$state","$route","$element","tagging","$q"],SearchCtrl.prototype={init:function(){this.reservationModel.setDefaultDates(),this.formData={checkInDateRange:{startingDate:this.reservationModel.dates.checkInDate,endingDate:this.reservationModel.dates.checkOutDate},meetingReqArrDate:this.reservationModel.dates.checkInDateFormated,meetingReqDepDate:this.reservationModel.dates.checkOutDateFormated}},initMissingMiles:function(){var today=new Date,tomorrow=new Date(today.getTime()+864e5);this.reservationModel.dates.checkInDateNoMinFormated=today.getMonth()+1+"/"+today.getDate()+"/"+today.getFullYear(),this.reservationModel.dates.checkOutDateNoMinFormated=tomorrow.getMonth()+1+"/"+tomorrow.getDate()+"/"+tomorrow.getFullYear()},getLocations:_.debounce(function(){var _this=this;_this.destination.previousDisplayVal!==_this.destination.displayVal&&this.locationsService.fetch(_this.destination.displayVal).then(function(suggestedLocations){_this.locations.suggestedList=suggestedLocations,_this.destination.previousDisplayVal=_this.destination.displayVal,$(".destination-list").show()})},300),getLocationsCitySearch:function(){var _this=this;this.locationsService.fetch(this.citydestination.displayVal).then(function(suggestedLocationsCitySearch){_this.locations.suggestedListCitySearch=suggestedLocationsCitySearch,$(".destination-listCitySearch").show()})},getLocationsForSecondarySearch:function(){var _this=this;this.locationsService.fetch(this.destination.displayVal).then(function(suggestedLocations){_this.locations.suggestedList=suggestedLocations,$(".secondary-destination-list").show()})},setNavHeight:function(){var that=this;$(window).bind("load",function(){that.$timeout(function(){$("#content").height();$(".nav-container").css("height","0")})})},searchInfoForMap:function(){},getGeolocation:function(){var geoCoordinates=this.geoCoordinates,messageBus=this.messageBus;this.$window.scroll(0,0),"map"===this.$state.activeMapSection&&$(".book-a-hotel-wrapper").length>0&&this.sharedModel.setBookAHotelGeoLocation(!0),this.userService.getGeolocation().then(function(geo){geoCoordinates.lat=geo.coords.latitude,geoCoordinates.lng=geo.coords.longitude,messageBus.publish("geolocation",geoCoordinates)})},setLatLng:function(destinationName){var _this=this;_this.geolocationService.getByAddress(destinationName).then(function(res){_this.reservationModel.destination.geoCoordinates.lng=res.geometry.location.lng(),_this.reservationModel.destination.geoCoordinates.lat=res.geometry.location.lat(),_this.mapLocUpdateService.updateLocation(_this.reservationModel.destination.geoCoordinates),_this.goToUrl("panel")})},setZoomLevel:function(zoomLevel){var _this=this;_this.mapCtrl.map.setZoom(zoomLevel),console.log(_this.reservationModel.destination)},setLatLngCity:function(destinationName){var _this=this;_this.geolocationService.getByAddress(destinationName).then(function(res){res.geometry.location.lng(),res.geometry.location.lat();_this.fetchLocalMarkersCity()})},fetchLocalMarkersCity:function(variants){var _this=this;return this.carlsonService.fetch("markers",{params:{}}).then(function(res){var localMarkers=res.data.propertyMarkers;_this.locations.suggestedListCitySearchHotels=localMarkers})},redirect:function(location){this.$state.go(location,{})},onClickGeolocator:function(){var _this=this;_this.goToUrl("map").then(function(){_this.getGeolocation()})},goToUrl:function(activeSection){var deferred=this.$q.defer();return this.$state.activeMapSection=activeSection,"map-results"!==this.$state.$current.name?this.$state.go("map-results",{}).then(function(){deferred.resolve()}):deferred.resolve(),deferred.promise},setRateTypeCode:function(event){this.rate.rateVal=event.currentTarget.value},hasRateTypeCode:function(){return this.$scope.ratesCode&&this.$scope.ratesCode.length>0},clearRateTypeCode:function(){this.rate.rateVal="",this.$scope.ratesCode=""},clearDestination:function(){this.reservationModel.destination.displayVal=""},hasLocation:function(){return this.destination.displayVal.length>0},setMapView:function(){var messageBus=this.messageBus,url=this.$window.location.href,map={section:"map-view"};url.indexOf("map-results")<0&&(console.error("line 380 searchcontroller file"),map.section="panel-view",messageBus.publish("map",map))}},angular.module("radBlu").controller("searchCtrl",SearchCtrl),angular.module("radBlu").directive("crDatePicker",["$timeout","$filter",function($timeout,$filter){"use strict";var CALENDAR_TYPES={CHECK_IN:"check-in",CHECK_OUT:"check-out"};return{restrict:"A",scope:{calendarType:"@calendarType",compareToValue:"=compareToValue",useDefaultMinDate:"@useDefaultMinDate"},controller:["$rootScope","$scope","$attrs","reservationModel",function($rootScope,$scope,$attrs,reservationModel){$scope.isCheckinCalendar=$scope.calendarType===CALENDAR_TYPES.CHECK_IN,$scope.bookingCheckIn=[],$scope.bookingCheckOut=[],$scope.monthsDisplay=$rootScope.isMobileLayout()?1:[2,1],$scope.dayNamesMin=["S","M","T","W","T","F","S"],$scope.dateFormat="mm/dd/yy",$scope.minCheckInDate=0,$scope.minCheckOutDate=1,$scope.getDefaultOptions=function(){return{showOn:"both",changeYear:!1,changeMonth:!1,dateFormat:$scope.dateFormat,showAnim:"fade",numberOfMonths:$scope.monthsDisplay,dayNamesMin:$scope.dayNamesMin,altFormat:"M",buttonText:""}},$scope.getCheckInOptions=function(){$scope.coupledCheckInCalendar=$scope.thisCalendar.closest("form").find(".check-in-date"),$scope.coupledCheckOutCalendar=$scope.thisCalendar.closest("form").find(".check-out-date");var initialDate=$scope.coupledCheckInCalendar.val(),useMinDate=$scope.minCheckInDate,options={setDate:initialDate,minDate:useMinDate,onSelect:function(dateStr,inst){var $this=$scope.thisCalendar,date=$this.datepicker("getDate"),newCheckOutDate=$scope.getNewDate($scope.thisCalendar,1);$this.datepicker("hide"),$scope.$apply(function(){$scope.updateCalendarModel(date,$scope.coupledCheckInCalendar),date>=$scope.coupledCheckOutCalendar.datepicker("getDate")&&$scope.updateCalendarModel(newCheckOutDate,$scope.coupledCheckOutCalendar)}),$this.datepicker("setDate",date),$scope.coupledCheckOutCalendar.datepicker("option","minDate",newCheckOutDate)}};return _.merge($scope.getDefaultOptions(),options)},$scope.getCheckOutOptions=function(){$scope.coupledCheckInCalendar=$scope.thisCalendar.closest("form").find(".check-in-date"),$scope.coupledCheckOutCalendar=$scope.thisCalendar.closest("form").find(".check-out-date");var initialDate=$scope.coupledCheckOutCalendar.val(),options={setDate:initialDate,minDate:$scope.minCheckOutDate,onSelect:function(dateStr,inst){var $this=$scope.thisCalendar,date=$this.datepicker("getDate");$scope.getNewDate(".check-out-date",-1),$scope.getNewDate(".check-in-date");$this.datepicker("hide"),$scope.$apply(function(){$scope.updateCalendarModel(date,$scope.coupledCheckOutCalendar)})}};return _.merge($scope.getDefaultOptions(),options)},$scope.getNewDate=function(calendar,offset){var newDate=$(calendar).datepicker("getDate");return null!=newDate&&newDate.setDate(newDate.getDate()+offset),newDate},$scope.updateCalendarModel=function(date,calendar){var newMonth=$.datepicker.formatDate("M",date);calendar.closest(".pure-u-1-2").find(".month").val(newMonth);var newDay=$.datepicker.formatDate("dd",date);calendar.closest(".pure-u-1-2").find(".day").val(newDay);var formattedDate=$.datepicker.formatDate("yymmdd",date);calendar.hasClass("check-in-date")?calendar.closest("form").find(".checkIn").val(formattedDate):calendar.closest("form").find(".checkOut").val(formattedDate)},$scope.getCalendarOptions=function(){return $scope.isCheckinCalendar?$scope.getCheckInOptions():$scope.getCheckOutOptions()}}],link:function(scope,element,attrs,ngModelCtrl){scope.thisCalendar="",scope.setCalendar=function(){scope.thisCalendar=element},element.on("click",scope.setCalendar()),$timeout(function(){scope.calendar=element.datepicker(scope.getCalendarOptions())},800)}}}]).directive("crNoMinDatePicker",["$filter",function($filter){"use strict";var CALENDAR_TYPES={CHECK_IN:"check-in",CHECK_OUT:"check-out"};return{restrict:"A",require:"ngModel",scope:{calendarType:"@calendarType",compareToValue:"=compareToValue",useDefaultMinDate:"@useDefaultMinDate"},controller:["$rootScope","$scope","$attrs","reservationModel",function($rootScope,$scope,$attrs,reservationModel){$scope.isCheckinCalendar=$scope.calendarType===CALENDAR_TYPES.CHECK_IN,$scope.bookingCheckIn=[],$scope.bookingCheckOut=[],$scope.monthsDisplay=$rootScope.isMobileLayout()?1:[2,1],$scope.dayNamesMin=["S","M","T","W","T","F","S"],$scope.dateFormat="mm/dd/yy",$scope.getDefaultOptions=function(){return{showOn:"both",changeYear:!1,changeMonth:!1,dateFormat:$scope.dateFormat,showAnim:"fade",numberOfMonths:$scope.monthsDisplay,dayNamesMin:$scope.dayNamesMin,altFormat:"M",buttonText:""}},$scope.getCheckInOptions=function(){var useMinDate=$scope.minCheckInDate,options={setDate:reservationModel.dates.checkInDateNoMinFormated,minDate:useMinDate,onSelect:function(dateStr,inst){var $this=$(this),date=$this.datepicker("getDate"),newCheckOutDate=$scope.getNewDate("#noMin-calendar-checkin",1);$this.datepicker("hide"),$scope.$apply(function(){$scope.updateCheckInCalendarModel(date),reservationModel.dates.checkInDateNoMin>=reservationModel.dates.checkOutDateNoMin&&$scope.updateCheckOutCalendarModel(newCheckOutDate)}),$this.datepicker("setDate",date),$("#noMin-calendar-checkout").datepicker("setDate",newCheckOutDate),$("#noMin-calendar-checkout").datepicker("option","minDate",newCheckOutDate),reservationModel.dates.checkOutDateNoMinFormated=newCheckOutDate.getMonth()+1+"/"+newCheckOutDate.getDate()+"/"+newCheckOutDate.getFullYear()}};return _.merge($scope.getDefaultOptions(),options)},$scope.getCheckOutOptions=function(){var options={setDate:reservationModel.dates.checkOutDateNoMinFormated,minDate:$scope.minCheckOutDate,onSelect:function(dateStr,inst){var $this=$(this),date=$this.datepicker("getDate");$scope.getNewDate("#noMin-calendar-checkout",-1),$scope.getNewDate("#noMin-calendar-checkin");$this.datepicker("hide"),$scope.$apply(function(){$scope.updateCheckOutCalendarModel(date)})}};return _.merge($scope.getDefaultOptions(),options)},$scope.getNewDate=function(calendar,offset){var newDate=$(calendar).datepicker("getDate");return null!=newDate&&newDate.setDate(newDate.getDate()+offset),newDate},$scope.updateCheckInCalendarModel=function(date){reservationModel.dates.checkInDateNoMin=date,reservationModel.dates.checkInReservationNoMin=date,reservationModel.dates.checkInDayNoMin=$.datepicker.formatDate("dd",date),reservationModel.dates.checkInMonthShowNoMin=$.datepicker.formatDate("M",date),reservationModel.dates.checkInDateNoMinFormated=$.datepicker.formatDate("mm/dd/yy",date)},$scope.updateCheckOutCalendarModel=function(date){reservationModel.dates.checkOutDateNoMin=date,reservationModel.dates.checkOutReservationNoMin=date,reservationModel.dates.checkOutDayNoMin=$.datepicker.formatDate("dd",date),reservationModel.dates.checkOutMonthShowNoMin=$.datepicker.formatDate("M",date),reservationModel.dates.checkOutDateNoMinFormated=$.datepicker.formatDate("mm/dd/yy",date)},$scope.getCalendarOptions=function(){return $scope.isCheckinCalendar?$scope.getCheckInOptions():$scope.getCheckOutOptions()}}],link:function(scope,element,attrs,ngModelCtrl){$(function(){scope.calendar=element.datepicker(scope.getCalendarOptions())})}}}]).directive("crMtgRqstDatePicker",["$filter",function($filter){"use strict";var CALENDAR_TYPES={CHECK_IN:"check-in",CHECK_OUT:"check-out"};return{restrict:"A",scope:{calendarType:"@calendarType",compareToValue:"=compareToValue",useDefaultMinDate:"@useDefaultMinDate"},controller:["$rootScope","$scope","$attrs","reservationModel",function($rootScope,$scope,$attrs,reservationModel){$scope.isCheckinCalendar=$scope.calendarType===CALENDAR_TYPES.CHECK_IN,$scope.bookingCheckIn=[],$scope.bookingCheckOut=[],$scope.monthsDisplay=$rootScope.isMobileLayout()?1:[2,1],$scope.dayNamesMin=["S","M","T","W","T","F","S"],$scope.dateFormat="mm/dd/yy",$scope.minCheckInDate=0,$scope.minCheckOutDate=1,$scope.getDefaultOptions=function(){return{showOn:"both",changeYear:!1,changeMonth:!1,dateFormat:$scope.dateFormat,showAnim:"fade",numberOfMonths:$scope.monthsDisplay,dayNamesMin:$scope.dayNamesMin,altFormat:"M",buttonText:""}},$scope.getCheckInOptions=function(){$scope.meetingRqstCheckInCalendar=$("#mtg-calendar-check-in"),$scope.meetingRqstCheckOutCalendar=$("#mtg-calendar-check-out");var initialDate=$scope.meetingRqstCheckInCalendar.val(),useMinDate=$scope.minCheckInDate,options={setDate:initialDate,minDate:useMinDate,onSelect:function(dateStr,inst){var $this=$(this),date=$this.datepicker("getDate"),newCheckOutDate=$scope.getNewDate("#mtg-calendar-check-in",1);$this.datepicker("hide"),$scope.$apply(function(){$scope.updateCalendarModel(date,$scope.meetingRqstCheckInCalendar),date>=$scope.meetingRqstCheckOutCalendar.datepicker("getDate")&&$scope.updateCalendarModel(newCheckOutDate,$scope.meetingRqstCheckOutCalendar)}),$this.datepicker("setDate",date),$scope.meetingRqstCheckOutCalendar.datepicker("option","minDate",date)}};return _.merge($scope.getDefaultOptions(),options)},$scope.getCheckOutOptions=function(){$scope.meetingRqstCheckOutCalendar=$("#mtg-calendar-check-out");var initialDate=$scope.meetingRqstCheckOutCalendar.val(),options={setDate:initialDate,minDate:$scope.minCheckOutDate,onSelect:function(dateStr,inst){var $this=$(this),date=$this.datepicker("getDate");$this.datepicker("hide"),$scope.$apply(function(){$scope.updateCalendarModel(date,$scope.meetingRqstCheckOutCalendar)})}};return _.merge($scope.getDefaultOptions(),options)},$scope.getNewDate=function(calendar,offset){var newDate=$(calendar).datepicker("getDate");return null!=newDate&&newDate.setDate(newDate.getDate()+offset),newDate},$scope.updateCalendarModel=function(date,calendar){var formattedDate=$.datepicker.formatDate("mm/dd/yy",date);calendar.hasClass("check-in-date")?calendar.val(formattedDate):calendar.val(formattedDate)},$scope.getCalendarOptions=function(){return $scope.isCheckinCalendar?$scope.getCheckInOptions():$scope.getCheckOutOptions()}}],link:function(scope,element,attrs,ngModelCtrl){$(function(){scope.calendar=element.datepicker(scope.getCalendarOptions())})}}}]),angular.module("radBlu").directive("crRooms",["$timeout",function($timeout){"use strict";return{restrict:"A",scope:{rooms:"=crRooms"},link:function(scope,element,attrs){var addRoom,removeRoom;addRoom=function(){if(element.find(".rooms-panel").show(),parseInt(scope.rooms.numOfRooms,10)<9){var newRoomCount=parseInt(scope.rooms.numOfRooms,10)+1;scope.rooms.numOfRooms=newRoomCount,2===newRoomCount&&element.find(".remove-room").removeClass("disabled")}scope.$apply()},removeRoom=function(){if(element.find(".rooms-panel .room").last().remove(),parseInt(scope.rooms.numOfRooms,10)>1){var newRoomCount=parseInt(scope.rooms.numOfRooms,10)-1;scope.rooms.numOfRooms=newRoomCount,1===newRoomCount&&($(window).width()>800&&element.find(".rooms-panel").hide(),element.find(".remove-room").addClass("disabled"))}$timeout(function(){scope.$apply()})},element.find(".add-room").on("click",addRoom),element.find(".subtract-room").on("click",removeRoom)}}}]),angular.module("radBlu").directive("crRateselect",[function(){"use strict";return{restrict:"A",link:function(scope,$el,attrs){$(function(){scope.setRate=function(selectedRate){var isDataRate=selectedRate.hasAttribute("data-rate"),isDataCode=selectedRate.hasAttribute("data-code"),dr=selectedRate.value;isDataRate&&(scope.searchCtrl.showRmcInputBox=!1,scope.$apply(),scope.searchCtrl.rmcCode=dr,scope.searchCtrl.reservationModel.rate.rmcCode=dr,scope.searchCtrl.reservationModel.rate.rateVal=dr,"DEFAULT"===dr&&(dr=""),$('input[name="rateSearchForm.rmcCode"]').val(dr)),isDataCode&&(scope.searchCtrl.showRmcInputBox=!0,scope.$apply(),$(".rate-choose").find('input[type="hidden"]').val(""),$(".rate-input").find("input").attr("name","rateSearchForm."+dr),scope.searchCtrl.rmcCode="",scope.searchCtrl.reservationModel.rate.rateVal="",scope.searchCtrl.reservationModel.rate.rateType=dr)},$el.on("click",function(){var parent=$el.parent(),list=parent.find("ul").first();"none"!==$(".search").css("display")&&($("#wrap").hasClass("tablet")||$("#wrap").hasClass("desktop"))&&$(".rooms-container").hide(),list.is(":visible")?(list.hide(),$(".rates-select").find(".up-arrow").removeClass("up-arrow").addClass("dd-arrow")):(list.show(),$(".rates-select").find(".dd-arrow").removeClass("dd-arrow").addClass("up-arrow"))}),$(".cr-rateselect").on("change",function(event){var selectedIndex=event.currentTarget.options.selectedIndex,selectedRate=event.currentTarget.options[selectedIndex];"none"!==$(".search").css("display")&&$(".rooms-container").hide(),scope.setRate(selectedRate)})})}}}]).directive("crRateselectgeneral",[function(){"use strict";return{restrict:"A",link:function(scope,$el,attrs){$(function(){var rates=$el.parent().next();scope.$root.$on("cr-uiEvent-click",function(evt,jqe){$el.find(jqe.target).length<1&&($(".rates-select ul").hide(),$(".search .rates-select").find(".up-arrow").removeClass("up-arrow").addClass("dd-arrow"))}),scope.setRate=function(selectedRate){var dr=selectedRate.data("rate")||selectedRate.data("code");selectedRate.attr("data-rate")?(rates.find("input").removeAttr("name"),rates.addClass("disabled"),scope.searchCtrl.rmcCode=dr,scope.searchCtrl.reservationModel.rate.rmcCode=dr,scope.searchCtrl.reservationModel.rate.rateVal=dr):($el.find('input[type="hidden"]').val(""),rates.find("input").attr("name","rateSearchForm."+selectedRate.attr("data-code")),rates.removeClass("disabled"),scope.searchCtrl.rmcCode="",scope.searchCtrl.reservationModel.rate.rmcCode="",scope.searchCtrl.reservationModel.rate.rateVal="",scope.searchCtrl.reservationModel.rate.rateType=dr)},$el.on("click",function(){var parent=$el.parent(),list=parent.find("ul").first();"none"!==$(".search").css("display")&&$(".rooms-container").hide(),list.is(":visible")?(list.hide(),$(".rates-select").find(".up-arrow").removeClass("up-arrow").addClass("dd-arrow")):(list.show(),$(".rates-select").find(".dd-arrow").removeClass("dd-arrow").addClass("up-arrow"),$(".mobile .book-a-hotel-wrapper .rates-select.drop-down").length>0&&$("html, body").animate({scrollTop:$(".book-a-hotel-wrapper .rates-select.drop-down").offset().top-80},500),($(".tablet .book-a-hotel-wrapper .rates-select.drop-down").length>0||$(".desktop .book-a-hotel-wrapper .rates-select.drop-down").length>0)&&$("html, body").animate({scrollTop:$(".book-a-hotel-wrapper .rates-select.drop-down").offset().top-110},500))}),$el.parent().find("li").on("click",function(){var selectedRate=$(this);"none"!==$(".search").css("display")&&$(".rooms-container").hide(),$el.parent().find(".rate-label-general span").first().text($(this).text()),$el.parent().find("ul").hide(),$el.parent().find(".up-arrow").removeClass("up-arrow").addClass("dd-arrow"),$el.parent().find("li.selected").removeClass("selected"),$(this).addClass("selected"),scope.setRate(selectedRate)})})}}}]).directive("crMrateselect",[function(){"use strict";return{restrict:"A",link:function(scope,$el,attrs){$el.on("click",function(e){var parent,selectedRate,rate;$el.hasClass("forward")?(parent=$el.parent(),selectedRate=parent.find("li.selected"),rate=$(selectedRate).next().data("rate"),$(".rates-select .back").css("visibility","visible"),scope.searchCtrl.reservationModel.rate.rateVal=rate,$('input[name="rateSearchForm.rmcCode"]').val(rate),$(selectedRate).is(":last-child")?$(".rates-select .forward").css("visibility","hidden"):($(selectedRate).removeClass("selected").next().addClass("selected"),$(selectedRate).removeClass("selected").next().attr("data-rate")?($(".rates input").removeAttr("name"),$(".rates").addClass("disabled")):(scope.searchCtrl.reservationModel.destination.rateVal="",$('.rates-select input[type="hidden"]').val(""),$(".rates input").attr("name","rateSearchForm."+selectedRate.attr("data-code")),$(".rates").removeClass("disabled"))),scope.setRate(selectedRate)):(rate=$(selectedRate).prev().data("rate"),parent=$el.parent(),selectedRate=parent.find("li.selected"),$(".rates-select .forward").css("visibility","visible"),scope.searchCtrl.reservationModel.destination.rateVal=rate,$('input[name="rateSearchForm.rmcCode"]').val(rate),$(selectedRate).is(":first-child")?$(".rates-select .back").css("visibility","hidden"):($(selectedRate).removeClass("selected").prev().addClass("selected"),$(selectedRate).removeClass("selected").prev().attr("data-rate")?($(".rates input").removeAttr("name"),$(".rates").addClass("disabled")):(scope.searchCtrl.reservationModel.destination.rateVal="",$('.rates-select input[type="hidden"]').val(""),$(".rates input").attr("name","rateSearchForm."+selectedRate.attr("data-code")),$(".rates").removeClass("disabled"))),scope.setRate(selectedRate))})}}}]).directive("crSearchsubmit",[function(){"use strict";return{restrict:"A",link:function(scope,$el,attrs){$el.on("click",function(e){var webextraHotelCode=$("#WEHotelCode").val(),errorMsg=$("#crhotelSearch").attr("data-error");if($(".room-array-adults .numAdults").each(function(){""===$(this).val().trim()&&$(this).val("1")}),""===$("#crhotelSearch").val().trim()&&!webextraHotelCode&&""===$("#searchForm #city").val().trim())return $(".destination").addClass("bookingbar-error"),$("#crhotelSearch").addClass("top-bookingbar-error"),$("#crhotelSearch").attr("placeholder",errorMsg),!1;$("#bluFnbOverlay").length>0&&"none"==$("#bluFnbOverlay").css("display")&&$("#bluFnbOverlay").show();var rateCode=$(".rates-select").find("li.selected").data("code");rateCode=$(".rate-choose").find("option.selected").data("code"),scope.searchCtrl.reservationModel.rate.rateVal=rateCode,e.preventDefault(),e.stopImmediatePropagation(),scope.searchCtrl.reservationModel.rate.rateVal=rateCode,rateCode&&("promo"===rateCode?$('input[name="rateSearchForm.promotionalCode"]').val(scope.ratesCode):"ecert"===rateCode?$('input[name="rateSearchForm.ecertCode"]').val(scope.ratesCode):"corp"===rateCode?$('input[name="rateSearchForm.corporateAccountID"]').val(scope.ratesCode):$('input[name="rateSearchForm.travelAgencyId"]').val(scope.ratesCode),$('.rates-select input[type="hidden"]').val(""),scope.searchCtrl.reservationModel.destination.rateVal="");var lIsProduction=$("#isProduction").val(),lDomain="";if("true"===lIsProduction&&(lDomain="//www.radissonblu.com"),$("#wrap").hasClass("mobile")&&!$("#wrap").hasClass("tabletportrait")?$("form#searchForm").attr("action",lDomain+"/mweb/reservation/cityRateSearch.do"):$("form#searchForm").attr("action",lDomain+"/reservation/cityRateSearch.do"),$(".room-block input, .adults input, .children input").each(function(i){var placeholder=$(this).attr("placeholder");""===$(this).val()&&$(this).val(placeholder)}),scope.$apply(),$("#crhotelSearch").length>0){var usedautocomplete=$("#usedAutocomplete").val(),destinationSearchType=$("#destinationSearchType").val();webextraHotelCode&&"false"===usedautocomplete&&!$("#city").val()&&($("#city").val($("#crhotelSearch").attr("placeholder")),$("#hotelCode").val(webextraHotelCode),$("#hotelCodes").val(webextraHotelCode),$("#destinationSearchType").val("PROPERTY"),usedautocomplete="true"),"false"==usedautocomplete||usedautocomplete&&"ATTRACTION"==destinationSearchType?loadGoogleMapsApi(function(){scope.performGeocodeSearch()}):$el.parents("#searchForm").submit()}else $el.parents("#searchForm").submit()}),scope.performGeocodeSearch=function(){var geocoder=new google.maps.Geocoder,googleResults=[],searchTerm=$("#crhotelSearch").val().trim();""!==searchTerm?geocoder.geocode({address:searchTerm},function(georesults,geostatus){geostatus==google.maps.GeocoderStatus.OK&&$.each(georesults,function(georesultindex,geoelement){var geostreet1="",geostreet2="",geocity="",geostate="",geocountrycode="",geolongname="",geopostalcode="",addresscomponentslength=geoelement.address_components.length-1;for(i=addresscomponentslength;i>=0;i--)"country"==geoelement.address_components[i].types[0]&&(geocountrycode=geoelement.address_components[i].short_name),"administrative_area_level_1"==geoelement.address_components[i].types[0]&&(geostate="US"==geocountrycode||"MX"==geocountrycode||"CA"==geocountrycode?geoelement.address_components[i].short_name:geoelement.address_components[i].long_name),"locality"==geoelement.address_components[i].types[0]&&(geocity=geoelement.address_components[i].short_name,geolongname=geoelement.address_components[i].long_name),"street_number"==geoelement.address_components[i].types[0]&&(geostreet1=geoelement.address_components[i].short_name),"route"==geoelement.address_components[i].types[0]&&(geostreet2=geoelement.address_components[i].short_name),"postal_code"==geoelement.address_components[i].types[0]&&(geopostalcode=geoelement.address_components[i].short_name);geoelement.types.indexOf("country")>=0&&(geocountrycode=geoelement.address_components[0].short_name),googleResults.push(geostreet1+","+geostreet2+","+geocity+","+geostate+","+geocountrycode+","+geolongname+","+geopostalcode+","+geoelement.geometry.location.lat()+","+geoelement.geometry.location.lng()+","+geoelement.formatted_address)});var googleGeocoderSuggestionsSearchUrl="/reservation/googleGeocoderSuggestionsSearch.do";$("#wrap").hasClass("mobile")&&!$("#wrap").hasClass("tabletportrait")&&(googleGeocoderSuggestionsSearchUrl="/mweb/reservation/googleGeocoderSuggestionsSearch.do"),$.ajax({url:googleGeocoderSuggestionsSearchUrl,type:"POST",data:{searchTerm:searchTerm,googleResults:googleResults,requestVersion:"2"}}).always(function(){$("form#searchForm").submit()})}):$("form#searchForm").submit()}}}}]).directive("initializeOverlay",[function(){"use strict";return{restrict:"A",link:function(scope,$el,attrs){if($("#bluFnbOverlay").length<1){var ratesTitle=$("#blu2-locale-ratesinterstitial").attr("interstitial-title")?$("#blu2-locale-ratesinterstitial").attr("interstitial-title"):"Best rates guaranteed",ratesSearching=$("#blu2-locale-ratesinterstitial").attr("interstitial-searching")?$("#blu2-locale-ratesinterstitial").attr("interstitial-searching"):"Searching for your hotel",ratesSearchImageSrc=$("#blu2-locale-ratesinterstitial").attr("interstitial-imgsrc")?$("#blu2-locale-ratesinterstitial").attr("interstitial-imgsrc"):"//rdevcache2.amer.carlson.com/radblu_sc/images/",ratesSearchImageName="logo-desktop.png";$("#wrap").after('<div id="bluFnbOverlay"><div class="bluFnbOverlayWrapper"><img src="'+ratesSearchImageSrc+ratesSearchImageName+'" alt=""><p>'+ratesTitle+"</p><p>"+ratesSearching+'</p><div class="cg-busy-default-spinner"><div class="bar1"></div><div class="bar2"></div><div class="bar3"></div><div class="bar4"></div><div class="bar5"></div><div class="bar6"></div><div class="bar7"></div><div class="bar8"></div><div class="bar9"></div><div class="bar10"></div><div class="bar11"></div><div class="bar12"></div></div></div></div>')}}}}]),angular.module("radBlu.search",[]).controller("radBluSearchCtrl",["$scope","$state","$attrs","$location","radBluSearchSuggestor","GeolocationService","reservationModel","mapLocUpdateService","radBluHotelNameSearch","sharedSearchMap",function($scope,$state,$attrs,$location,radBluSearchSuggestor,GeolocationService,reservationModel,mapLocUpdateService,radBluHotelNameSearch,sharedSearchMap){"use strict";$scope.hotelResults=[],$scope.suggestions=[],$scope.cityRequest="",$scope.selected=-1,$scope.selectionMade=!1,$scope.continueButton=!0,$scope.maxNum=3,$scope.getCountries=_.isUndefined($attrs.getCountries)?"true":$attrs.getCountries,$scope.locationListLimit=10,$scope.minsSearchChar=3,$("#locationListLimit").length>0&&$("#minSearchChar").length>0&&($scope.locationListLimit=$("#locationListLimit").val(),$scope.minsSearchChar=$("#minSearchChar").val()),($scope.minsSearchChar<2||$scope.minsSearchChar>3)&&($scope.minsSearchChar=2);var cityRequestWatch=function(){var searchValue=$scope.cityRequest;reservationModel.destination.displayVal=$scope.cityRequest,reservationModel.cityRequest=$scope.cityRequest,(""===$scope.cityRequest||angular.isUndefined($scope.cityRequest)||searchValue.length<$scope.minsSearchChar)&&($scope.suggestions=[],$scope.selected=-1,$scope.resetAutocompleteValues(),$("textarea#crhotelSearch.top-bookingbar").length>0&&$scope.topRadBluBookingBarText($("textarea#crhotelSearch.top-bookingbar")),$("textarea#crhotelSearch.bookahotel").length>0&&$scope.radBluBookAHotelText($("textarea#crhotelSearch.bookahotel")))},cityRequestWatchContactUs=function(){$scope.crContactUsObj=$('input[rad-blu-city-autocomplete="citiesAutocompleteOptions"]'),$scope.crContactUsObj&&($scope.crContactUsObj.val()&&0!=$scope.suggestions.length||($scope.hotelResults=[],$("[button-label=hotelName] button").html('<span class="caret"></span>'))),$scope.hotelResults&&$scope.$emit("hotelResults",$scope.hotelResults)},suggestionCounter=0,suggestionCategoryCounter=0,categoryCountBeforeMaxListNumber=0,autocompleteSuggestions=function(request,response){
radBluSearchSuggestor.getRadBluSearchSuggestions($scope.cityRequest,$scope.getCountries).then(function(data){$scope.suggestions=data,reservationModel.locations.suggestedList=data,response(data)})},autocompleteOffersSuggestions=function(request,response){radBluSearchSuggestor.getRadBluSearchSuggestions($scope.cityRequest,$scope.getCountries,"offersAutocomplete").then(function(data){$scope.suggestions=data,reservationModel.locations.suggestedList=data,response(data)})},autocompleteCitiesSuggestions=function(request,response){radBluSearchSuggestor.getRadBluSearchSuggestions($scope.cityRequest,"false").then(function(data){$scope.suggestions=data,reservationModel.locations.suggestedList=data,response(data)})},renderAutocompleteItem=function(ul,item){var suggestedLocation="";if("true"==item.isCategoryLabel)return suggestedLocation=$("<span class='expandedSearchCategoryType' style='font-style:italic;'></span>").text(item.categoryLabel),suggestionCategoryCounter+=1,$("<li class='expandedSearchCategoryTypeWrapper'></li>").append(suggestedLocation).appendTo(ul);suggestedLocation=$("<a></a>").text(item.display);for(var matchIndex,newTextNode,newSpanNode,searchText=$.trim($scope.cityRequest).toLowerCase(),currentNode=suggestedLocation.get(0).firstChild;(matchIndex=currentNode.data.toLowerCase().indexOf(searchText))>=0;)newTextNode=currentNode.splitText(matchIndex),currentNode=newTextNode.splitText(searchText.length),newSpanNode=document.createElement("span"),newSpanNode.className="highlightedterm",currentNode.parentNode.insertBefore(newSpanNode,currentNode),newSpanNode.appendChild(newTextNode);return suggestionCounter<=$scope.locationListLimit&&(categoryCountBeforeMaxListNumber=suggestionCategoryCounter),suggestionCounter+=1,$("<li></li>").append(suggestedLocation).appendTo(ul)},renderOffersAutocompleteItem=function(ul,item){var suggestedLocation="";suggestedLocation=$("<a></a>").text(item.display);for(var matchIndex,newTextNode,newSpanNode,searchText=$.trim($scope.cityRequest).toLowerCase(),currentNode=suggestedLocation.get(0).firstChild;(matchIndex=currentNode.data.toLowerCase().indexOf(searchText))>=0;)newTextNode=currentNode.splitText(matchIndex),currentNode=newTextNode.splitText(searchText.length),newSpanNode=document.createElement("span"),newSpanNode.className="highlightedterm",currentNode.parentNode.insertBefore(newSpanNode,currentNode),newSpanNode.appendChild(newTextNode);return suggestionCounter<=$scope.locationListLimit&&(categoryCountBeforeMaxListNumber=suggestionCategoryCounter),suggestionCounter+=1,$("<li></li>").append(suggestedLocation).appendTo(ul)},renderCitiedAutocompleteItem=function(ul,item){var suggestedLocation="";suggestedLocation=$("<a></a>").html(item.cityName);for(var matchIndex,newTextNode,newSpanNode,searchText=$.trim($scope.cityRequest).toLowerCase(),currentNode=suggestedLocation.get(0).firstChild;(matchIndex=currentNode.data.toLowerCase().indexOf(searchText))>=0;)newTextNode=currentNode.splitText(matchIndex),currentNode=newTextNode.splitText(searchText.length),newSpanNode=document.createElement("span"),newSpanNode.className="highlightedterm",currentNode.parentNode.insertBefore(newSpanNode,currentNode),newSpanNode.appendChild(newTextNode);return suggestionCounter<=$scope.locationListLimit&&(categoryCountBeforeMaxListNumber=suggestionCategoryCounter),suggestionCounter+=1,$("<li></li>").append(suggestedLocation).appendTo(ul)},focusSuggestion=function(event,ui){event.preventDefault()},selectSuggestion=function(event,ui){$scope.cityRequest=ui.item.display,$scope.setZoomLevel(ui.item.cityId,$scope.cityRequest),$scope.selectionMade=!0,$scope.suggestions=[],$scope.closeAutoComplete(),reservationModel.destination.cityId=ui.item.cityId,reservationModel.destination.displayVal=ui.item.display,reservationModel.cityRequest=ui.item.display,reservationModel.cityId=ui.item.cityId,reservationModel.selectionMade=!0,$scope.$root.$broadcast("syncToggleBookingBar"),$("#destinationSearchType").val(ui.item.searchType),"CITY_STATE_COUNTRY"==ui.item.searchType||"AIRPORT"==ui.item.searchType||"ATTRACTION"==ui.item.searchType?($('input[name="rateSearchForm.crossBrandSearch"]').val("true"===ui.item.defaultToBrandSearch?"thisBrandOnly":"searchCrossBrand"),$scope.setDestinationId(ui.item.cityId,ui.item.attractionId)):$scope.setDestinationHotelCode(ui.item.hotelCode);var isCountrySearch=!1;$("#usedAutocomplete").length>0&&$("#country").length>0&&$("#state").length>0&&"true"==$("#usedAutocomplete").val()&&""!=$("#country").val()&&""==$("#state").val()&&(isCountrySearch=!0),$("#wrap").hasClass("mobile")&&$(".next-mobile").length>0&&$scope.$root.$broadcast("syncToggleBookingBar"),$("textarea#crhotelSearch.top-bookingbar").length>0&&($("textarea#crhotelSearch.top-bookingbar").val(ui.item.display),$scope.topRadBluBookingBarText($("textarea#crhotelSearch.top-bookingbar"))),9===event.keyCode&&event.preventDefault()},selectSuggestionBookHotel=function(event,ui){$scope.cityRequest=ui.item.display,$scope.selectionMade=!0,$scope.suggestions=[],$scope.closeAutoComplete(),reservationModel.destination.cityId=ui.item.cityId,reservationModel.destination.displayVal=ui.item.display,$("#destinationSearchType").val(ui.item.searchType),"CITY_STATE_COUNTRY"==ui.item.searchType||"AIRPORT"==ui.item.searchType||"ATTRACTION"==ui.item.searchType?($('input[name="rateSearchForm.crossBrandSearch"]').val("true"===ui.item.defaultToBrandSearch?"thisBrandOnly":"searchCrossBrand"),$scope.setDestinationId(ui.item.cityId,ui.item.attractionId)):$scope.setDestinationHotelCode(ui.item.hotelCode),$("textarea#crhotelSearch.bookahotel").length>0&&($("textarea#crhotelSearch.bookahotel").val(ui.item.display),$scope.radBluBookAHotelText($("textarea#crhotelSearch.bookahotel")))},selectSuggestionOffers=function(event,ui){window.location.hash="#/destination="+ui.item.display+"|"+ui.item.cityId,$scope.cityRequest=ui.item.display,$scope.cityId=ui.item.cityId,$scope.setZoomLevel(ui.item.cityId,$scope.cityRequest),reservationModel.destination.cityId=ui.item.cityId,reservationModel.destination.displayVal=ui.item.display;var isCountrySearch=!1;"CITY_STATE_COUNTRY"==ui.item.searchType&&isNaN(ui.item.cityId)&&2==ui.item.cityId.length&&(isCountrySearch=!0),GeolocationService.getByMapAddress($scope.cityRequest,isCountrySearch).then(function(res){$scope.map?($scope.map.setCenter({lat:res.geometry.location.lat(),lng:res.geometry.location.lng()}),$scope.map.setZoom(12)):(reservationModel.destination.geoCoordinates.lat=res.geometry.location.lat(),reservationModel.destination.geoCoordinates.lng=res.geometry.location.lng())}),$scope.selectionMade=!0,$scope.continueButton=!1,$scope.suggestions=[]},selectSuggestionCities=function(event,ui){if("ru"==$("html").attr("lang")){var selectedValue=$('<span class="selectSuggestionCitiesValue"></span>').html(ui.item.cityName).html();setTimeout(function(){$(event.target).val(selectedValue)},50),$scope.cityRequest=selectedValue}else $scope.cityRequest=ui.item.cityName;$scope.setZoomLevel(ui.item.cityId),$scope.selectionMade=!0,radBluHotelNameSearch.getRadBluHotelName(ui.item.cityId).then(function(data){data.errorMessage?$scope.hotelResults=[{hotelCode:"NOHOTELFOUND",hotelName:"No Radisson Blu hotels found in the selected city."}]:$scope.hotelResults=data,$scope.hotelResults&&$scope.$emit("hotelResults",$scope.hotelResults)}),$scope.$emit("chosenCitySelected",ui.item.cityName),$scope.suggestions=[]},selectSuggestionSimpleOffers=function(event,ui){$scope.setSimpleOfferCityId(ui.item.cityId),$scope.cityRequest=ui.item.display,$scope.cityId=ui.item.cityId,$scope.setZoomLevel(ui.item.cityId,$scope.cityRequest),reservationModel.destination.cityId=ui.item.cityId,reservationModel.destination.displayVal=ui.item.display,$scope.selectionMade=!0,$scope.suggestions=[]},selectSuggestionFilterByInterestOffers=function(event,ui){if(""==window.location.hash)window.location.hash="#/destination="+ui.item.display+"|"+ui.item.cityId;else if(window.location.hash.indexOf("interest")!==-1){var newHashUrl=decodeURIComponent(window.location.hash);newHashUrl=newHashUrl.split("#/interest=")[1],window.location.hash="#/destination="+ui.item.display+"|"+ui.item.cityId+"#/interest="+newHashUrl}else window.location.hash="#/destination="+ui.item.display+"|"+ui.item.cityId;$scope.cityRequest=ui.item.display,$scope.cityId=ui.item.cityId,$scope.setZoomLevel(ui.item.cityId,$scope.cityRequest),reservationModel.destination.cityId=ui.item.cityId,reservationModel.destination.displayVal=ui.item.display;var isCountrySearch=!1;"CITY_STATE_COUNTRY"==ui.item.searchType&&isNaN(ui.item.cityId)&&2==ui.item.cityId.length&&(isCountrySearch=!0),GeolocationService.getByMapAddress($scope.cityRequest,isCountrySearch).then(function(res){$scope.map?($scope.map.setCenter({lat:res.geometry.location.lat(),lng:res.geometry.location.lng()}),$scope.map.setZoom(12)):(reservationModel.destination.geoCoordinates.lat=res.geometry.location.lat(),reservationModel.destination.geoCoordinates.lng=res.geometry.location.lng())}),$scope.selectionMade=!0,$scope.continueButton=!1,$scope.suggestions=[]},openAutoCompletePanel=function(){var adjstmnt=0;1===categoryCountBeforeMaxListNumber&&(adjstmnt=16);var autoCompleteMaxHeight=$scope.locationListLimit*$(".ui-menu-item").height()+categoryCountBeforeMaxListNumber*$(".expandedSearchCategoryType").parent().height()+adjstmnt;$scope.openAutocomplete(autoCompleteMaxHeight),suggestionCounter=0,suggestionCategoryCounter=0,categoryCountBeforeMaxListNumber=0},closeAutoCompletePanel=function(event,ui){$scope.closeAutoComplete()},resetAutocompleteValues=function(){$scope.selectionMade=!1,$scope.selected=-1,$scope.closeAutoComplete(),$("#usedAutocomplete").val(!1),$("#destinationSearchType").val(""),$("#state").val(""),$("#country").val(""),$("#countryAndState").val(""),reservationModel.cityId=0,$('input[name="rateSearchForm.hotelCodes"]').each(function(){$(this).val("")}),$('input[name="rateSearchForm.attractionId"]').each(function(){$(this).val("0")}),$("ul.ui-autocomplete").length>0&&$("ul.ui-autocomplete").css("display","none")},resetSimpleOfferAutocompleteValues=function(){$("#simpleOfferCityId").val(""),$("#simpleOfferState").val(""),$("#simpleOfferCountry").val(""),$("#simpleOfferCountryAndState").val(""),$scope.selectionMade=!1,$scope.suggestions=[]};$scope.$watch("cityRequest",cityRequestWatch),$scope.$watch(function(){return $('input[rad-blu-city-autocomplete="citiesAutocompleteOptions"]').val()},cityRequestWatchContactUs),$scope.radBluAutocompleteOptions={minLength:$scope.minsSearchChar,autoFocus:!0,focus:focusSuggestion,source:autocompleteSuggestions,search:resetAutocompleteValues,open:openAutoCompletePanel,close:closeAutoCompletePanel,select:selectSuggestion,_renderItem:renderAutocompleteItem,appendTo:".searchResultList"},$scope.topRadBluBookingBarText=function(pTextAreaEl){if(!$(pTextAreaEl).prop("scrollTop"))do{var lTAScrollHeight=$(pTextAreaEl).prop("scrollHeight"),lTAHeight=$(pTextAreaEl).height();$(pTextAreaEl).height(lTAHeight-5)}while(lTAScrollHeight&&lTAScrollHeight!=$(pTextAreaEl).prop("scrollHeight"));if($(pTextAreaEl).height($(pTextAreaEl).prop("scrollHeight")),pTextAreaEl=$("textarea#crhotelSearch.top-bookingbar"),pTextAreaEl[0].scrollHeight!=pTextAreaEl[0].offsetHeight&&""!=pTextAreaEl.val()){var curFS=parseInt(pTextAreaEl.css("font-size"),10);pTextAreaEl.css("font-size",curFS-1+"px"),$scope.topRadBluBookingBarText(pTextAreaEl)}else""==pTextAreaEl.val()&&24!=parseInt(pTextAreaEl.css("font-size"),10)&&pTextAreaEl.css("font-size","");$("#wrap").hasClass("mobile")&&(74==pTextAreaEl.prop("scrollHeight")&&pTextAreaEl.addClass("placeholder18"),72==pTextAreaEl.prop("scrollHeight")&&pTextAreaEl.addClass("placeholder17"))},$scope.radBluBookAHotelText=function(pTextAreaBH){if(!$(pTextAreaBH).prop("scrollTop"))do{var lTAScrollHeight=$(pTextAreaBH).prop("scrollHeight"),lTAHeight=$(pTextAreaBH).height();$(pTextAreaBH).height(lTAHeight-5)}while(lTAScrollHeight&&lTAScrollHeight!=$(pTextAreaBH).prop("scrollHeight"));if($(pTextAreaBH).height($(pTextAreaBH).prop("scrollHeight")),pTextAreaBH=$("textarea#crhotelSearch.bookahotel"),null!=pTextAreaBH[0]&&pTextAreaBH[0].scrollHeight!=pTextAreaBH[0].offsetHeight){var curFS=parseInt(pTextAreaBH.css("font-size"),10);pTextAreaBH.css("font-size",curFS-1+"px"),$scope.radBluBookAHotelText()}""==$.trim($("textarea#crhotelSearch.bookahotel").val())&&$("textarea#crhotelSearch.bookahotel").css("font-size","")},$scope.bookHotelPageAutocompleteOptions={minLength:$scope.minsSearchChar,autoFocus:!0,focus:focusSuggestion,source:autocompleteSuggestions,search:resetAutocompleteValues,open:openAutoCompletePanel,close:closeAutoCompletePanel,select:selectSuggestionBookHotel,_renderItem:renderAutocompleteItem,appendTo:".searchResultList"},$scope.offersPageAutocompleteOptions={autoFocus:!0,focus:focusSuggestion,source:autocompleteOffersSuggestions,select:selectSuggestionOffers,_renderItem:renderOffersAutocompleteItem,appendTo:"#offerSearchResultsList .searchResultList"},$scope.citiesAutocompleteOptions={autoFocus:!0,focus:focusSuggestion,source:autocompleteCitiesSuggestions,select:selectSuggestionCities,_renderItem:renderCitiedAutocompleteItem,appendTo:"#citiesSearchResultsList .searchResultList"},$scope.simpleOffersAutocompleteOptions={autoFocus:!0,focus:focusSuggestion,source:autocompleteOffersSuggestions,search:resetSimpleOfferAutocompleteValues,select:selectSuggestionSimpleOffers,_renderItem:renderOffersAutocompleteItem,appendTo:"#offerSearchResultsList .searchResultList"},$scope.offersDrawerAutocompleteOptions={autoFocus:!0,focus:focusSuggestion,source:autocompleteOffersSuggestions,select:selectSuggestionFilterByInterestOffers,_renderItem:renderOffersAutocompleteItem,appendTo:"#offerDrawerSearchResultsList .searchResultList"},$scope.setSimpleOfferCityId=function(cityId){var selectedCityId=cityId;if(isNaN(selectedCityId))if(2==selectedCityId.length)reservationModel.cityId=0,$("#simpleOfferState").val(""),$("#simpleOfferCountry").val(selectedCityId),$("#simpleOfferCountryAndState").val("");else{var lSplit=selectedCityId.split(" ");reservationModel.cityId=0,$("#simpleOfferState").val(lSplit[1]),$("#simpleOfferCountry").val(lSplit[0]),$("#simpleOfferCountryAndState").val(selectedCityId)}else $("#simpleOfferCityId").val(selectedCityId),$("#simpleOfferState").val(""),$("#simpleOfferCountry").val(""),$("#simpleOfferCountryAndState").val("")},$scope.setDestinationId=function(cityId,attractionId){var selectedCityId=cityId;if(isNaN(selectedCityId))if(2==selectedCityId.length)reservationModel.cityId=0,$("#state").val(""),$("#country").val(selectedCityId),$("#countryAndState").val("");else{var lSplit=selectedCityId.split(" ");reservationModel.cityId=0,$("#state").val(lSplit[1]),$("#country").val(lSplit[0]),$("#countryAndState").val(selectedCityId)}else $("#cityId").val(selectedCityId),$("#state").val(""),$("#country").val(""),$("#countryAndState").val("");"null"==attractionId&&$('input[name="rateSearchForm.attractionId"]').each(function(){$(this).val("0")}),isNaN(attractionId)||$("#attractionId").val(attractionId),$('input[name="rateSearchForm.hotelCodes"]').each(function(){$(this).val("")}),$("#usedAutocomplete").val(!0)},$scope.setDestinationHotelCode=function(hotelCode){var selectedHotelCode=hotelCode;$("#cityId").val("0"),$("#state").val(""),$("#country").val(""),$("#countryAndState").val(""),$("#usedAutocomplete").val(!0),$('input[name="rateSearchForm.hotelCodes"]').each(function(){$(this).val("")}),$('input[name="rateSearchForm.attractionId"]').each(function(){$(this).val("0")}),$("#hotelCodes").length>0&&$("#hotelCodes").val(selectedHotelCode)},$scope.resetAutocompleteValues=function(){$scope.selectionMade=!1,$scope.selected=-1,$scope.closeAutoComplete(),$("#usedAutocomplete").val(!1),$("#destinationSearchType").val(""),$("#state").val(""),$("#country").val(""),$("#countryAndState").val(""),reservationModel.cityId=0,$('input[name="rateSearchForm.hotelCodes"]').each(function(){$(this).val("")}),$('input[name="rateSearchForm.attractionId"]').each(function(){$(this).val("0")}),$("ul.ui-autocomplete").length>0&&$("ul.ui-autocomplete").css("display","none")},$scope.openAutocomplete=function(maxHeight){$(".ui-autocomplete").css("max-height","");var uiAutocomplete=$(".ui-autocomplete");0==$("#refineSearchWrapper").length&&($("<div id='refineSearchWrapper'></div>").insertAfter(uiAutocomplete),$("#refineSearch").length>0&&$("#refineSearchWrapper").append($("#refineSearch").html())),$("#refineSearchWrapper").length>0&&$("#refineSearchWrapper").css("display","block"),uiAutocomplete.height()>maxHeight?$("#refineSearchWrapper").css("margin-top","10px"):$("#refineSearchWrapper").css("margin-top","0px"),uiAutocomplete.css("max-height",maxHeight+"px");uiAutocomplete.css("max-height")},$scope.closeAutoComplete=function(){$("#refineSearchWrapper").length>0&&$("#refineSearchWrapper").css("display","none")},$scope.$on("searchSuggestionSelected",function(event,suggestion){$scope.cityRequest=suggestion.cityName,$scope.setZoomLevel(suggestion.cityId),$scope.selectionMade=!0,radBluHotelNameSearch.getRadBluHotelName(suggestion.cityId).then(function(data){data.errorMessage?$scope.hotelResults=[{hotelCode:"NOHOTELFOUND",hotelName:"No Radisson Blu hotels found in the selected city."}]:$scope.hotelResults=data}),$scope.$emit("chosenCitySelected",suggestion.cityName),$scope.suggestions=[]}),$scope.setZoomLevel=function(Id,request){var searchingForCity=$.isNumeric(Id),requestedString=request,newZoom=sharedSearchMap.zoomLevel()[requestedString];newZoom?reservationModel.destination.zoomLevel=newZoom:searchingForCity?searchingForCity&&(reservationModel.destination.zoomLevel=10):reservationModel.destination.zoomLevel=9},$scope.setMultiSelect=function(item){item.selected?item.selected=!1:item.selected=!0},$scope.toggleDisable=function(item){3===$scope.formData.ChooseHotel.length?_.each($scope.hotelResults,function(item){item.selected||(item.disabled=!0)}):_.each($scope.hotelResults,function(item){item.disabled=!1})},$scope.selectedMulti=function(data){var item=_.findWhere($scope.hotelResults,{hotelCode:data.hotelCode});$scope.setMultiSelect(item),$scope.toggleDisable(item)},$scope.disableMultiSelectOption=!0,$scope.goToUrl=function(activeSection){$state.activeMapSection=activeSection;var lLocation=$location.absUrl().toString(),lLanguage=$('input[name="language"]').val(),lHost=$location.host(),lMapResultsUrl=$location.protocol()+"://"+lHost+"/"+lLanguage.substring(0,2)+"#/map-results";if(lLocation.indexOf("map-results")==-1){sessionStorage.reservationModel=JSON.stringify($scope.reservationModel);var homePageUrl=$location.protocol()+"://"+$location.host()+"/"+lLanguage.substring(0,2);lLocation==homePageUrl?$location.path("/map-results"):window.location.href=lMapResultsUrl}else console.log("The URL is map-results and current state is "+$state.$current.name)},$scope.setLatLng=function(destinationName){GeolocationService.getByAddress(destinationName).then(function(res){reservationModel.destination.geoCoordinates.lng=res.geometry.location.lng(),reservationModel.destination.geoCoordinates.lat=res.geometry.location.lat(),mapLocUpdateService.updateLocation(reservationModel.destination.geoCoordinates),$scope.goToUrl("panel")})},$scope.clearDestination=function(){$scope.selectionMade=!1,$scope.selected=-1,$scope.suggestions=[],$scope.cityRequest="",reservationModel.destination.displayVal="",$(".clear-icon").removeClass("clear-icon").addClass("search-icon"),$scope.resetAutocompleteValues(),$("textarea#crhotelSearch.top-bookingbar").length>0&&($("textarea#crhotelSearch.top-bookingbar").val("").css("font-size",""),$scope.topRadBluBookingBarText($("textarea#crhotelSearch.top-bookingbar"))),$("textarea#crhotelSearch.bookahotel").length>=0&&($("textarea#crhotelSearch.bookahotel").val("").css("font-size",""),$scope.radBluBookAHotelText($("textarea#crhotelSearch.bookahotel")))},$scope.addClearDestinationIcon=function(){$(".search-icon").removeClass("search-icon").addClass("clear-icon"),""===$(".search-textarea textarea").val()&&$(".clear-icon").removeClass("clear-icon").addClass("search-icon")},$scope.updateBookingBarDisplay=function(){this.$parent.showBookingForm=!0,$scope.resetBookingBarErrorPlaceholder()},$scope.removeBookingBarPlaceholder=function(){$("#crhotelSearch").data("placeholder",$("#crhotelSearch").attr("placeholder")).attr("placeholder","")},$scope.resetBookingBarPlaceholder=function(){$("#crhotelSearch").attr("placeholder",$("#crhotelSearch").data("placeholder"))},$scope.resetBookingBarErrorPlaceholder=function(){var $crhotelSearch=$("#crhotelSearch"),$destination=$(".destination"),defaultMsg=$crhotelSearch.attr("data-placeholder");$("#crhotelSearch").val().trim().length>0&&($crhotelSearch.attr("placeholder",defaultMsg),$destination.removeClass("bookingbar-error"),$crhotelSearch.removeClass("top-bookingbar-error"))},$scope.clearDestinationOffers=function(){$scope.selectionMade=!1,$scope.selected=-1,$scope.suggestions=[],$scope.cityRequest="",$scope.continueButton=!0,$(".clear-icon-offers").removeClass("clear-icon-offers").addClass("search-icon-offers")},$scope.addClearDestinationIconOffers=function(){$(".search-icon-offers").removeClass("search-icon-offers").addClass("clear-icon-offers"),""===$(".search-textarea textarea").val()&&$(".clear-icon-offers").removeClass("clear-icon-offers").addClass("search-icon-offers")}}]).directive("focusMe",[function(){"use strict";return{restrict:"A",link:function(scope,element,attrs){attrs.$observe("focusMe",function(){"true"===attrs.focusMe&&element[0].focus()})}}}]).directive("radBluSearchCityInputContact",[function(){"use strict";return{restrict:"A",template:'<input type="hidden" ng-required="!contactusCatagoryCityHotel && contactusCatagoryCityHotelRequired" class="formSpanHalfLast" id="hiddenCity" name="cityChosen" ng-model="formData.cityChosen" value="{{cityRequest}}"></input>'}}]).directive("radBluAutocomplete",[function(){"use strict";return{require:"ngModel",link:function(scope,element,attrs,controller){$("#expandedSearchResultList").append('<div class="searchResultList" ></div>');var getOptions=function(){return angular.extend({},scope.$eval(attrs.radBluAutocomplete))},initAutocompleteWidget=function(){var opts=getOptions();element.autocomplete(opts),opts._renderItem&&(element.data("ui-autocomplete")._renderItem=opts._renderItem)};$("textarea#crhotelSearch.top-bookingbar").length>0&&($("textarea#crhotelSearch.top-bookingbar").on("keydown, keyup",function(){scope.topRadBluBookingBarText(this)}),$("textarea#crhotelSearch.top-bookingbar").on("keypress",function(e){var searchValue=$.trim($(this).val());13===e.keyCode&&searchValue.length>0?($("#bluFnbOverlay").length>0&&"none"==$("#bluFnbOverlay").css("display")&&$("#bluFnbOverlay").show(),$("#searchForm").submit(),e.preventDefault()):13===e.keyCode&&0===searchValue.length&&e.preventDefault()}),$(window).resize(function(){scope.topRadBluBookingBarText($("textarea#crhotelSearch.top-bookingbar"))}),$(window).load(function(){scope.topRadBluBookingBarText($("textarea#crhotelSearch.top-bookingbar"))})),$("textarea#crhotelSearch.bookahotel").length>0&&($("textarea#crhotelSearch.bookahotel").on("keydown, keyup",function(){scope.radBluBookAHotelText(this)}),$(window).resize(function(){scope.radBluBookAHotelText($("textarea#crhotelSearch.bookahotel"))})),scope.$watch(getOptions,initAutocompleteWidget,!0)}}}]).directive("radBluOffersAutocomplete",[function(){"use strict";return{require:"ngModel",link:function(scope,element,attrs,controller){$("#offerSearchResultsList").append('<div class="searchResultList" ></div>');var getOptions=function(){return angular.extend({},scope.$eval(attrs.radBluOffersAutocomplete))},initAutocompleteWidget=function(){var opts=getOptions();element.autocomplete(opts),opts._renderItem&&(element.data("ui-autocomplete")._renderItem=opts._renderItem)};scope.$watch(getOptions,initAutocompleteWidget,!0)}}}]).directive("radBluCityAutocomplete",[function(){"use strict";return{require:"ngModel",link:function(scope,element,attrs,controller){$("#citiesSearchResultsList").append('<div class="searchResultList" ></div>');var getOptions=function(){return angular.extend({},scope.$eval(attrs.radBluCityAutocomplete))},initAutocompleteWidget=function(){var opts=getOptions();element.autocomplete(opts),opts._renderItem&&(element.data("ui-autocomplete")._renderItem=opts._renderItem)};scope.$watch(getOptions,initAutocompleteWidget,!0)}}}]).directive("radBluOffersDrawerAutocomplete",[function(){"use strict";return{require:"ngModel",link:function(scope,element,attrs,controller){$("#offerDrawerSearchResultsList").append('<div class="searchResultList" ></div>');var getOptions=function(){return angular.extend({},scope.$eval(attrs.radBluOffersDrawerAutocomplete))},initAutocompleteWidget=function(){var opts=getOptions();element.autocomplete(opts),opts._renderItem&&(element.data("ui-autocomplete")._renderItem=opts._renderItem)};scope.$watch(getOptions,initAutocompleteWidget,!0)}}}]),angular.module("radBlu").service("radBluSearchSuggestor",["$http","$q",function($http,$q){"use strict";function getRadBluSearchSuggestions(cityRequest,getCountries,offersAutocomplete){var deferred=$q.defer(),lUrl="/lcrExpSearch?callback=JSON_CALLBACK";return"false"===getCountries&&(lUrl="/lcrExpSearch?callback=JSON_CALLBACK&maxResults=6"),$http({url:lUrl,method:"jsonp",params:{city:cityRequest,suggest:"true",singleSearch:getCountries,jsonp:"true"}}).success(function(data,status){if("false"===getCountries)_.each(data,function(item,index){item.originalCityName=decodeURIComponent(item.cityName),item.state&&(item.cityName+=", "+item.state),item.country&&(item.cityName+=" ("+item.country+")")}),deferred.resolve(data);else if("undefined"!=typeof offersAutocomplete){var dataoffers=_.filter(data,function(item,index){return item.isCategoryLabel||(item.display=decodeURIComponent(item.display)),"CITY_STATE_COUNTRY"==item.searchType&&!isNaN(item.cityId)});deferred.resolve(dataoffers)}else _.each(data,function(item,index){item.isCategoryLabel||(item.display=decodeURIComponent(item.display))}),deferred.resolve(data)}).error(function(data,status){deferred.resolve([])}),deferred.promise}return{getRadBluSearchSuggestions:getRadBluSearchSuggestions}}]),function(){"use strict";angular.module("radBlu").service("radBluHotelNameSearchConfig",["$http","$q",function($http,$q){function getRadBluHotelName(idPicked){var deferred=$q.defer();return $http({url:radBluHotelNameService.url,method:"GET",params:{jsonp:"true",cityId:idPicked}}).success(function(data,status){data.errorMessage||(data=data.hotelList),deferred.resolve(data)}).error(function(data,status){deferred.resolve([])}),deferred.promise}var radBluHotelNameService={url:"/ajaxHotelSearch"};return{getRadBluHotelName:getRadBluHotelName}}]),angular.module("radBlu").service("radBluHotelNameSearch",["radBluHotelNameSearchConfig",function(radBluHotelNameSearchConfig){var getRadBluHotelName=radBluHotelNameSearchConfig.getRadBluHotelName;return{getRadBluHotelName:getRadBluHotelName}}])}(),angular.module("radBlu").directive("crTogglenav",[function(){"use strict";return{restrict:"A",link:function($scope,$el){var init,toggle,highlightCurrentPage,isMenuHidden,getSlideCSS,slide,$navContainer=$(".nav-container"),$nav=$("#nav"),slideCSSMap={rtl:{in:{left:0},out:{left:"-"+$nav.width()+"px"}},ltr:{in:{right:0},out:{right:"-"+$nav.width()+"px"}}};$scope.$root.$on("cr-uiEvent-click",function(evt,jqe){$el.find(jqe.target).length<1&&$nav.hasClass("active")&&slide("out")}),$(".lt-ie9 #nav ul li").on("click",function(e){slide("out")}),init=function(){slide("out"),highlightCurrentPage()},isMenuHidden=function(){return $nav.hasClass("hidden")},toggle=function(){slide(isMenuHidden()===!0?"in":"out"),highlightCurrentPage()},highlightCurrentPage=function(){var id_modified=window.location.pathname.replace("/","");if(id_modified.indexOf("/")!==-1){id_modified=id_modified.substr(id_modified.indexOf("/"));var currentpage_li=$('#nav li[id$="'+id_modified+'"]');0==currentpage_li.length&&$('#nav a[href$="'+id_modified+'"]').length>0&&(currentpage_li=$('#nav a[href$="'+id_modified+'"]').parent()),currentpage_li.length>0&&currentpage_li.first().addClass("active")}},getSlideCSS=function(direction){return $scope.isDisplayRTL()===!0?slideCSSMap.rtl[direction]:slideCSSMap.ltr[direction]},slide=function(direction){if("in"===direction){if($navContainer.outerWidth("300px"),$(".mobile-secondary-nav").length>0){var mapHeaderHeight=Math.floor($("#header").height()),windowHeight=window.innerHeight,navContainerHeight=windowHeight-mapHeaderHeight-32;$navContainer.innerHeight(navContainerHeight+"px")}$nav.show()}else $navContainer.outerWidth("auto");$nav.velocity(getSlideCSS(direction),350,function(){"in"===direction?$nav.removeClass("hidden").addClass("active"):$nav.addClass("hidden").removeClass("active").hide()}),"in"===direction?$el.addClass("menu-tab-selected"):$el.removeClass("menu-tab-selected"),"in"===direction?$("body").css({overflow:"hidden"}).addClass("menu-visible"):$("body").css({overflow:"auto"}).removeClass("menu-visible")},$el.on("click",function(){$nav.is(":animated")||(($scope.isTabletLayout()||$scope.isDesktopLayout())&&$(".rooms-container").hide(),toggle())}),init()}}}]),angular.module("radBlu").directive("crSecondarynav",["$timeout","$rootScope",function($timeout,$rootScope){"use strict";return{restrict:"A",link:function($scope,$el,$window){function highlightCurrentPage(){if($("#wrap").hasClass("mobile")){if($("#wrap").hasClass("mobile")){var id_modified=window.location.pathname,mobile_currentpage=$('.mobile-secondary-nav a[href = "'+id_modified+'"]'),mobile_currentpage_subpage=$('.mobile-secondary-nav a[href *= "'+id_modified.split("/").slice(0,4).join("/")+'"]');mobile_currentpage.length>0&&$(".mobile-secondary-nav a").length>0?mobile_currentpage.first().addClass("active"):1===mobile_currentpage_subpage.length&&mobile_currentpage_subpage.first().addClass("active")}}else{var id_modified=window.location.pathname.replace("/",""),currentpage_li=$('#secondaryNavItems li[id="'+id_modified+'"]');currentpage_li&&currentpage_li.first().addClass("active")}}function closeMobileTab(){$el.find(".nav-links").animate({"margin-top":"-35px"},800,"swing").removeClass("open"),$el.find(".nav-links a").animate({visibility:"hidden"},800,"swing"),$el.find(".mobile-tab").animate({"margin-top":"-35px"},800,"swing"),$el.find(".mobile-tab span").removeClass("icon-dd-sm").addClass("icon-dd-up-sm"),$el.find(".mobile-tab .hide-menu-icon").hide()}var navLinks=$el.find(".nav-links a").not(".more-tab"),navLinksCount=navLinks.length,nav=$el.find(".secondary-nav"),secondaryNavOffset=$(".alert:visible").length?150:113,stickyClass=$(".alert:visible").length?"stick-to-alert":"stick-to-header",isMarqueeHeaderAvailable="",setSecondaryNavPosition=function(){$timeout(function(){var marqueeHeight=0,marqueeHeader="";$("#marqueeHeader").length>0&&(marqueeHeader="#marqueeHeader "),$(marqueeHeader+".marquee-slide").not(".floorplan-slide").length>0&&(marqueeHeight=$(".marquee-slide").not(".floorplan-slide").height()),$(marqueeHeader+".hero-banner").length>0&&(marqueeHeight=$(".hero-banner").height()),$(marqueeHeader+".hero-banner--half").length>0&&(marqueeHeight=$(".hero-banner--half").height());var headerHeight=$("#header").height(),marqueeTop=marqueeHeight+headerHeight-3;$(".secondary-nav-wrap").css("top",marqueeTop+"px"),isMarqueeHeaderAvailable=0===marqueeHeight?"false":"true",0!==marqueeHeight||$("#wrap").hasClass("mobile")||$(".alert").length>0&&"none"!=$(".alert").css("display")&&$(".secondary-nav-wrap").css("top",$(".alert").outerHeight()+marqueeTop+"px")},400)};setSecondaryNavPosition(),$("#marqueeHeader").children().length>0||0===$("#marqueeHeader").length&&($(".marquee-slide").length>0||$(".hero-banner").length>0||$(".hero-banner--half").length>0)?$(window).on("load",setSecondaryNavPosition):setSecondaryNavPosition(),$timeout(function(){$(".marquee").addClass("marquee--withNav"),$(".hero-banner").addClass("marquee--withNav"),$(".hero-banner--half").addClass("marquee--withNav");
},200);var linksWidthTotal=function(){for(var totalWidth=2,linksContainerWidth=$el.find(".nav-links").width(),i=0;i<navLinksCount;i+=1){var linkWidth=$(navLinks[i]).width(),linkPadding=2*parseInt($(navLinks[i]).css("padding-right"),10);linkWidth+=linkPadding,totalWidth=totalWidth+=linkWidth,totalWidth>linksContainerWidth?($(navLinks[i]).addClass("break"),$(navLinks[i]).clone().appendTo(".nav-overflow")):($(navLinks[i]).removeClass("break"),$(".nav-overflow").html(""))}totalWidth>linksContainerWidth?$el.find(".more-tab").show():$el.find(".more-tab").hide()};$scope.setWayPoint=function(offset,stickyClass){nav.waypoint("sticky",{wrapper:'<div class="sticky-wrapper" />',offset:offset,stuckClass:stickyClass,handler:function(direction){}})},$scope.destroyWayPoint=function(){$.waypoints("destroy")},$(".alert").find(".close-section").on("click",function(){secondaryNavOffset="112",stickyClass="stick-to-header",$scope.destroyWayPoint(),nav.removeClass("stick-to-alert"),$scope.setWayPoint(secondaryNavOffset,stickyClass),"false"==isMarqueeHeaderAvailable&&!$("#wrap").hasClass("mobile")&&$(".alert").length>0&&"none"==$(".alert").css("display")&&$(".secondary-nav-wrap").css("top","112px")}),$("#wrap").hasClass("mobile")?($el.find(".mobile-tab .open-menu").on("click",function(){if(!$el.find(".nav-links").hasClass("open")){var maxHeight=.6*$(window).height();$el.find(".nav-links").height()<maxHeight&&(maxHeight=$el.find(".nav-links").height()+2),$el.find(".nav-links a").css({visibility:"visible"}),$el.find(".nav-links").css({"max-height":maxHeight+"px"}),$el.find(".nav-links").animate({"margin-top":"-"+(maxHeight-13)+"px"},800,"swing").addClass("open"),$el.find(".mobile-tab").animate({"margin-top":"-"+(maxHeight+37)+"px"},800,"swing"),$el.find(".mobile-tab span").removeClass("icon-dd-up-sm").addClass("icon-dd-sm"),$el.find(".mobile-tab .hide-menu-icon").show(),$el.find(".mobile-tab .fixed-icons a").removeClass("active"),$el.find(".mobile-tab .open-menu").addClass("active")}}),$el.find(".mobile-tab .close-menu").on("click",function(){$el.find(".nav-links").hasClass("open")&&closeMobileTab()})):(linksWidthTotal(),$el.find(".more-tab").on("click",function(){$(".nav-overflow").toggle()})),$timeout(function(){$scope.setWayPoint(secondaryNavOffset,stickyClass)},600),$(window).resize(function(){$("#wrap").hasClass("mobile")?$el.find(".more-tab").on("click",function(){$(".nav-overflow").toggle()}):(linksWidthTotal(),setSecondaryNavPosition()),$(".nav-overflow").hide()}),setTimeout(highlightCurrentPage,300),window.onload=function(){setTimeout(function(){$(window).trigger("resize"),!$("#wrap").hasClass("mobile")&&$(".alert.show").length>0&&"none"==$(".alert.show").css("display")&&(secondaryNavOffset="112",stickyClass="stick-to-header",$scope.destroyWayPoint(),nav.removeClass("stick-to-alert"),$scope.setWayPoint(secondaryNavOffset,stickyClass))},300)},$("#wrap").hasClass("mobile")&&$el.find(".nav-links a").on("click",function(){var link_selected=$(this).attr("href"),id_modified=window.location.pathname;link_selected===id_modified&&closeMobileTab()})}}}]),angular.module("radBlu").directive("crMarquee",["$window","$timeout","$rootScope",function($window,$timeout,$rootScope){"use strict";return{scope:!0,restrict:"A",link:function($scope,$el){var cycleOptions={fx:"scrollHorz",speed:"slow",timeout:8e3,slides:"> div.marquee-slide",loop:0,log:!1};$scope.reInitialize=function(){$el.cycle("destroy"),$el.removeClass("single-slide"),$rootScope.isMobileLayout()&&$el.hide(),$timeout($scope.checkForSingleSlideAndCycle,100),$scope.lazyloadImages()},$scope.marqueePrev=function(){$el.cycle("next")},$scope.marqueeNext=function(){$el.cycle("prev")},$scope.lazyloadImages=function(){var active=$el.find(".cycle-slide-active, .cycle-slide-active + .cycle-slide"),items=active.find("[data-gallery-srcset]");$.each(items,function(i,item){var $item=$(item);$item.attr("srcset",$item.attr("data-gallery-srcset")),$item.removeAttr("data-gallery-srcset")})},$scope.checkForSingleSlideAndCycle=function(){$el.find(".marquee-slide").length<2&&($el.addClass("single-slide"),cycleOptions.timeout=0),$rootScope.isMobileLayout()&&$el.show(),$el.cycle(cycleOptions)},$scope.checkForSingleSlideAndCycle(),$scope.$on("cr-uiEvent-secondaryNavUnstuck",function(){$scope.marqueePrev()}),$scope.$on("$destroy",function(){$el.cycle("destroy")}),$window.makeImagesResponsive(),$(".video-container").parent().addClass("cycle-slide-html5video"),$(".cycle-slide-html5video").attr("id","lsss-video"),$el.on("cycle-update-view",function(event,optionHash,slideOptionsHash,currentSlideEl){$(".cycle-slide-html5video").addClass("cycle-slide-html5video--fullHeight"),$(currentSlideEl).is("#lsss-video")?($("video",currentSlideEl)[0].play(),$el.cycle("pause")):$el.cycle("resume"),$scope.lazyloadImages()}),$el.on("cycle-before",function(event,optionHash,outgoingSlideEl,incomingSlideEl,forwardFlag){$(outgoingSlideEl).is("#lsss-video")&&$("video",outgoingSlideEl)[0].pause()}),$("video").on("ended",function(){$(this).closest(".marquee").hasClass("single-slide")?$(this)[0].play():($(this).closest(".marquee").cycle("next"),$el.cycle("resume"))})}}}]),angular.module("radBlu.weather",[]),angular.module("radBlu.weather").controller("weatherCtrl",["$scope","weatherService","GeolocationService",function($scope,weatherService,geolocationService){"use strict";console.log("args",arguments),$scope.date="",$scope.tempF="50",$scope.tempC="10",$scope.month="Feb",$scope.day="20",$scope.locationId="London::GB",$scope.tempUnit="Celsius",$scope.toggleTempUnit=function(){$scope.tempUnit="Celsius"===$scope.tempUnit?"Fahrenheit":"Celsius"},$scope.mapCtrl=$scope.mapCtrl||{},$scope.forecast={},$scope.address={city:"",state:"",country:""},$scope.addressString=function(){var city=$scope.address.city?$scope.address.city+", ":"",state=$scope.address.state?$scope.address.state+", ":"",country=$scope.address.country||"";return city+state+country},$scope.locationQuery="",$scope.queryWeather=function(){var location=$scope.locationQuery,metrocode="";geolocationService.getByAddress(location).then(function(result){metrocode=geolocationService.parseMetroCode(result),$scope.setAddress(result),weatherService.weatherByMetroCode(metrocode).then(function(forecast){$scope.forecast=forecast})})},$scope.setAddress=function(result){$scope.address.city=geolocationService.getAddressValue(result,"locality"),$scope.address.state=geolocationService.getAddressValue(result,"administrative_area_level_1","short_name"),$scope.address.country=geolocationService.getAddressValue(result,"country","short_name")},$scope.getForecast=function(hotel){$scope.getCurrentAddress(hotel).then(function(){weatherService.weatherByMetroCode($scope.parseMetroCode()).then(function(){$scope.forecast=weatherService.forecast})})},$scope.parseMetroCode=function(){var city=$scope.address.city,country=$scope.address.country,state=$scope.address.state;return"US"===country||"USA"===country||"CA"===country||"MX"===country?encodeURI(city+":"+state+":"+country):encodeURI(city+"::"+country)},$scope.getCurrentAddress=function(hotel){var lat=hotel.lat,lng=hotel.lng;return geolocationService.getByLatLng(new google.maps.LatLng(lat,lng)).then(function(result){$scope.setAddress(result)})},$scope.$watch("mapCtrl.closestHotel",function(newValue){return!!newValue&&void("world"!==$scope.mapCtrl.markerType&&$scope.getForecast($scope.mapCtrl.closestHotel))})}]),angular.module("radBlu.weather").directive("crWeather",["xmlFilter",function(xmlFilter){return{restrict:"ECMA",link:function($scope,$el){$scope.updateDom=function(){var stats=$scope.$root.weather[0];$scope.date=stats.date,$scope.tempC=stats.HighCelsius,$scope.tempF=stats.HighFahrenheit,$el.append('<img src="'+stats.IconPNG+'"/>')}}}}]),angular.module("radBlu.weather").factory("weatherService",["carlsonService","$q",function(carlsonService,$q){"use strict";return{forecast:{},weatherByLocation:function(hotelCode){var formattedWeather,gettingWeather=$q.defer(),_this=this;return carlsonService.weatherByHotelCode(hotelCode).success(function(weather){formattedWeather=weather.Weather?_this.formatWeather(weather.Weather):{},_this.forecast=formattedWeather,gettingWeather.resolve(formattedWeather)}),gettingWeather.promise},weatherByMetroCode:function(metroCode){var formattedWeather,gettingWeather=$q.defer(),_this=this;return carlsonService.weatherByCity(metroCode).success(function(weather){formattedWeather=weather.Weather?_this.formatWeather(weather.Weather):{},_this.forecast=formattedWeather,gettingWeather.resolve(formattedWeather)}),gettingWeather.promise},formatWeather:function(weather){var _this=this;return angular.forEach(weather,function(value,key){var date=_this.parseDateFromKeyString(key);value.dateString=date,value.date=new Date(date).valueOf()}),weather},parseDateFromKeyString:function(key){return key&&key.length?key.split("||")[1]:""}}}]);var InfoGridCtrl=function($scope){this.$scope=$scope,this.showText=!1,this.vp=$scope.viewport};InfoGridCtrl.prototype={iconSize:function(iconClass){return"mobile"===this.vp?iconClass[1]:iconClass[0]}},InfoGridCtrl.$inject=["$scope"],angular.module("radBlu").controller("infogridCtrl",InfoGridCtrl),angular.module("radBlu").directive("crToggletext",[function(){"use strict";return{restrict:"A",link:function($scope,$el,$attrs){var setTabPosition=function(){var tab=$el.find(".info-grid-arrow"),itemWidth=$el.find(".item:first-child").width(),tabPosition=itemWidth-23;tab.css({right:tabPosition+"px"})};$el.find(".item").on("click",function(item){if($("#wrap").hasClass("mobile")){var parentItem=$(this).closest(".item");$el.find(".item").not(parentItem).removeClass("active"),$el.find(".item-info .icon").not(parentItem).removeClass("list-blue-up-arrow").addClass("list-blue-down-arrow"),$(this).closest(".item").hasClass("active")?($(this).removeClass("active"),$el.find(".item-info .icon").removeClass("list-blue-up-arrow").addClass("list-blue-down-arrow")):($(this).addClass("active"),$(this).find(".item-info .icon").removeClass("list-blue-down-arrow").addClass("list-blue-up-arrow"))}}),setTabPosition(),$(window).resize(function(){setTabPosition()})}}}]);var GalleryCtrl=function($scope,$timeout){this.activeSection="",this.windowHeight=$("#wrap").height(),this.$timeout=$timeout,$("button.gallery-button").on("click",function(e){$(".gallery-modal").addClass("show").removeClass("hide")}),this.init()};GalleryCtrl.prototype={init:function(){this.getWindowHeight()},getWindowHeight:function(){var _this=this;this.$timeout(function(){_this.windowHeight=$("#wrap").height()},500)},openModal:function(){$(this).closest(".gallery-modal").addClass("show")},resizeOverlay:function(){$(".modal-overlay").css("height",this.windowHeight)},backToTop:function(){window.scroll(0,0)}},GalleryCtrl.$inject=["$scope","$timeout"],angular.module("radBlu").controller("galleryCtrl",GalleryCtrl),angular.module("radBlu").directive("crGallery",["$compile",function($compile){"use strict";return{restrict:"ECMA",link:function($scope,$el,$window){var navLinks=$el.find(".gallery-nav a"),boxes=$el.find(".section .box"),windowHeight=window.innerHeight,videoBoxes=$el.find("#videos .box");$scope.scrollToSection=function(element,offset,duration){$("body").scrollTo(element,{offset:{top:offset,duration:duration}})},$scope.builtModalSlides=function(section){var modal=section.find(".gallery-modal");$(".gallery-modal").hide(),modal.show()},$scope.setImageSectionCount=function(){$(".gallery .section").each(function(){var images=$(this).find(".row img"),imageCount=images.length;$(this).find(".section-count").html("("+imageCount+")")})},navLinks.on("click",function(e){var sectionId=$(this).attr("href");e.preventDefault(),$scope.scrollToSection(sectionId,-160,300)}),videoBoxes.on("click",function(e){var s=s_gi(s_account),trackCode="tvtrip-"+s.prop3;s.prop41=trackCode,s.eVar41=trackCode,s.linkTrackVars="prop41,eVar41",s.tl(!0,"o",trackCode)}),boxes.on("click",function(e){var $this=$(this),section=$this.closest(".section"),sectionId=section.attr("id"),modal=$this.closest(".row").siblings(".gallery-modal");modal.hasClass("tvtrip-gallery-modal")&&0==modal.find(".tvTripIframe").length&&$("#tvTripIframeOverlay").html('<iframe frameborder="0" src="'+$("#tvTripIframeOverlay").html()+'" style="width:100%; height:100%; border:0px; overflow:hidden;" class="tvTripIframe"></iframe>'),0==$this.closest(".row").siblings(".gallery-modal").length&&(modal=$this.find(".gallery-modal"));var boxImgSrc=$(this).children().attr("src");if($scope.scrollToSection("#rooms",-190,300),$scope.activeSection=sectionId,$("body").addClass("scroll-disabled"),$("#secondaryNav.secondary-nav-wrap").length>0&&$("#secondaryNav.secondary-nav-wrap").addClass("gallery-modal-open"),$(".alert.show").length>0&&$(".alert.show").addClass("gallery-modal-open"),$("#wrap").hasClass("mobile")){var mapHeaderHeight=Math.floor($("#header").height()),mobileSecondaryNavHeight=(Math.floor($(".next-mobile").outerHeight()),0),mobileGalleryModalHeight=0;$(".mobile-secondary-nav").length>0&&(mobileSecondaryNavHeight=Math.floor($(".mobile-secondary-nav").outerHeight())),mobileGalleryModalHeight=windowHeight-mapHeaderHeight-mapHeaderHeight-mobileSecondaryNavHeight,modal.addClass("show").removeClass("hide").css("height",mobileGalleryModalHeight+"px")}else modal.addClass("show").removeClass("hide").css("height",windowHeight-160+"px");var activeImageBoxNumber=1,selectedImageBoxNumber=1,activeImageBoxFoundFlag=!1,imageFoundflag=!1;if($(".gallery-modal.show .marquee-slide.cycle-slide").each(function(){if(!$(this).hasClass("cycle-sentinel")&&(activeImageBoxFoundFlag||($(this).hasClass("cycle-slide-active")?activeImageBoxFoundFlag=!0:activeImageBoxNumber+=1),!imageFoundflag)){var thisImgSrc=$(this).children().children().attr("src");boxImgSrc==thisImgSrc?imageFoundflag=!0:selectedImageBoxNumber+=1}}),selectedImageBoxNumber<activeImageBoxNumber){var clickCount=activeImageBoxNumber-selectedImageBoxNumber;for(i=0;i<clickCount;i++)$(".gallery-modal.show .cycle-prev").trigger("click")}if(selectedImageBoxNumber>activeImageBoxNumber){var clickCount=selectedImageBoxNumber-activeImageBoxNumber;for(i=0;i<clickCount;i++)$(".gallery-modal.show .cycle-next").trigger("click")}if(!$("#wrap").hasClass("mobile")){var imageWidthLargest=0;setTimeout(function(){$(".gallery-modal .cycle-slide").each(function(){var imageWidth=$(this).children().children().width();imageWidthLargest<imageWidth&&(imageWidthLargest=imageWidth)}),$(".gallery-modal .cycle-slide .slide-info .gallery-caption").each(function(){$(this).css("width",imageWidthLargest+"px")}),$(".gallery-modal .addthis_toolbox_wrapper").each(function(){$(this).css("width",.5*imageWidthLargest+"px")})},400)}$(".modal-overlay").css("height",$scope.windowHeight).show()}),$("body").on("click","button.gallery-button",function(e){if($(this).parent().hasClass("social-share")&&!$(this).parent().hasClass("buttons-only")&&$(this).parent().parent().hasClass("col-4")&&$(this).next(".gallery-modal").length>0){var $reCompileGalleryModalContent=$(this).next(".gallery-modal");$reCompileGalleryModalContent.find(".cycle-sentinel").remove(),$compile($reCompileGalleryModalContent)($scope)}var section=$(this).closest(".section"),galleryNum=$(this).attr("name"),sectionId=section.attr("id"),galleryModal=$(this).next(".gallery-modal");if(galleryModal.find(".lazyloadme").first().removeClass("lazyloadme").addClass("lazyload"),jQuery(".addthis_noload_instance").length>0){var addthis_instance=jQuery(".addthis_noload_instance").first().html();galleryModal.find(".addthis_noload_placeholder").append(addthis_instance)}if(galleryModal.find(".lazyloadme").each(function(){$(this).removeClass("lazyloadme").addClass("lazyload")}),makeImagesResponsive(),$scope.scrollToSection("#rooms",-190,300),$scope.activeSection=sectionId,!$("#wrap").hasClass("mobile")){var imageWidthLargest=0;setTimeout(function(){if(galleryModal.length>0)galleryModal.find(".cycle-slide").each(function(){var imageWidth=$(this).children().children().width();imageWidthLargest<imageWidth&&(imageWidthLargest=imageWidth)}),galleryModal.find(".gallery-caption").each(function(){$(this).css("width",imageWidthLargest>0?imageWidthLargest+"px":"100%"),$(this).children("p").css("color","white")}),galleryModal.find(".addthis_toolbox_wrapper").each(function(){$(this).css({width:imageWidthLargest>0?.5*imageWidthLargest+"px":"100%",left:imageWidthLargest>0?"50%":"0"})});else{var galleryId=$("#"+galleryNum);galleryId.find(".cycle-slide").each(function(){var imageWidth=$(this).children().children().width();imageWidthLargest<imageWidth&&(imageWidthLargest=imageWidth)}),console.log("cplm"),galleryId.find(".gallery-caption").each(function(){$(this).css("width",imageWidthLargest>0?imageWidthLargest+"px":"100%"),$(this).children("p").css("color","white")}),galleryId.find(".addthis_toolbox_wrapper").each(function(){$(this).css({width:imageWidthLargest>0?.5*imageWidthLargest+"px":"100%",left:imageWidthLargest>0?"50%":"0"})})}},400)}if($("body").addClass("scroll-disabled"),$("#secondaryNav.secondary-nav-wrap").length>0&&$("#secondaryNav.secondary-nav-wrap").addClass("gallery-modal-open"),$(".alert.show").length>0&&$(".alert.show").addClass("gallery-modal-open"),$("#wrap").hasClass("mobile")){var mapHeaderHeight=Math.floor($("#header").height()),mobileSecondaryNavHeight=(Math.floor($(".next-mobile").outerHeight()),0),mobileGalleryModalHeight=0;$(".mobile-secondary-nav").length>0&&(mobileSecondaryNavHeight=Math.floor($(".mobile-secondary-nav").outerHeight())),mobileGalleryModalHeight=windowHeight-mapHeaderHeight-mapHeaderHeight-mobileSecondaryNavHeight,$("#"+galleryNum).addClass("show").removeClass("hide").css("height",mobileGalleryModalHeight+"px")}else galleryModal.attr("id")==galleryNum?galleryModal.addClass("show").removeClass("hide").css("height",windowHeight-160+"px"):$("#"+galleryNum).addClass("show").removeClass("hide").css("height",windowHeight-160+"px");$(".modal-overlay").css("height",$scope.windowHeight).show()}),$scope.setImageSectionCount()}}}]).directive("crGalleryModal",[function(){"use strict";return{restrict:"ECMA",link:function($scope,$el){function init(){setOffsetModal()}function setOffsetModal(){var windowWidth=$scope.$parent.$root.windowWidth;if($scope.$parent.$root.windowWidth>1440){var offset=(windowWidth-1440)/2;$el.css("left",offset+"px")}else $el.css("left","0px")}function sectionGalleryId(){$(".gallery .gallery-nav .crumb").length>0&&$(".gallery .gallery-nav .crumb a").each(function(){var curHref=$(this).attr("href");"#city"==curHref&&$(this).attr("href","#cityviews")}),$(".gallery .section").length>0&&$(".gallery .section").each(function(){var curId=$(this).attr("id"),newId=curId;curId.indexOf(" ")>-1&&(newId=curId.substring(0,curId.indexOf(" "))),"city"==newId&&(newId="cityviews"),$(this).attr("id",newId)})}var closeModal=$el.find(".close");closeModal.on("click",function(e){if(e.stopPropagation(),$el.hasClass("show")&&($el.removeClass("show").addClass("hide"),$scope.scrollToSection("#"+$scope.activeSection,-190,300),$("#secondaryNav.secondary-nav-wrap").length>0&&$("#secondaryNav.secondary-nav-wrap").removeClass("gallery-modal-open"),$(".alert.show").length>0&&$(".alert.show").removeClass("gallery-modal-open"),$(".modal-overlay").hide(),$("body").removeClass("scroll-disabled")),$el.children(".tvTripIframeOverlayWrapper").length>0&&$("#tvTripIframeOverlay").length>0&&$("#tvTripIframeOverlay").children().length>0){var tvTripVideo=$("#tvTripIframeOverlay").html();$("#tvTripIframeOverlay").html(""),$("#tvTripIframeOverlay").html(tvTripVideo)}}),$el.hasClass("show")&&$scope.$root.$on("cr-uiEvent-click",function(evt,jqe){$el.find(jqe.target).length<1&&($el.removeClass("show").addClass("hide"),$(".modal-overlay").hide())}),$(document).on("ready",function(){sectionGalleryId()}),$(window).on("resize",function(){setOffsetModal()}),init()}}}]).directive("crMobileGallery",[function(){"use strict";return{restrict:"ECMA",scope:!0,link:function($scope,$el){$scope.position=0,$scope.sectionsVisible=1,$scope.mobileNext=function(){if($el.find(".box").length!=$scope.position+1){var sections=$el.find(".box"),newPos=$scope.position+1,imgWidth=sections.find("img").first().width();sections.last().hasClass("last")||sections.last().addClass("last"),newPos<1?$scope.position=0:$scope.position=newPos,$scope.scrollTo(-($scope.position*(imgWidth+2)),"easeOutQuint")}},$scope.mobilePrev=function(){if(0!=$scope.position){var sections=$el.find(".box"),newPos=$scope.position+1,imgWidth=sections.find("img").first().width();newPos=$scope.position-1,$scope.sectionsVisible>1?$scope.position=newPos<2?0:newPos:$scope.position=newPos<1?0:newPos,$scope.scrollTo(-($scope.position*(imgWidth+2)),"easeInQuint")}},$scope.scrollTo=function(pos,ease,cb){$(".row.active").velocity({left:pos+"px",easing:ease||"easeInQuint"},200,function(){})},$scope.scrollToSection=function(element,offset,duration){$("body").scrollTo(element,{offset:{top:offset,duration:duration}})},$el.on("touchstart",function(){$(".row.active").removeClass("active"),$el.hasClass("active")||$el.addClass("active")})}}}]).directive("crOpenGallery",[function(){"use strict";return{restrict:"ECMA",link:function($scope,$el){var modal=$el.closest(".gallery-modal");$el.unbind("click"),$el.on("click",function(){modal.addClass("show")})}}}]);var SlidingListCtrl=function($scope,reservationModel){"use strict";this.$scope=$scope,this.reservationModel=reservationModel,this.checkInDate=reservationModel.dates.checkInDate,this.checkOutDate=reservationModel.dates.checkOutDate,this.numOfRooms=reservationModel.rooms.numOfRooms,this.rooms=reservationModel.rooms,this.rmcCode=reservationModel.rate.rmcCode,this.init()};SlidingListCtrl.prototype={init:function(){}},SlidingListCtrl.$inject=["$scope","reservationModel"],angular.module("radBlu").controller("slidingListCtrl",SlidingListCtrl),angular.module("radBlu").controller("interestGalleryCtrl",["$scope",function($scope){"use strict";$scope.iitem="interest-item",$scope.items=INTERESTS_FIXTURE,$scope.continueButton=!0,$scope.breakpoints=[{breakpoint:1100,settings:{slidesToShow:3}},{breakpoint:800,settings:{slidesToShow:4}},{breakpoint:525,settings:{slidesToShow:3}},{breakpoint:390,settings:{slidesToShow:2}}],$scope.interestChosen=!1,$scope.interestBottomChosen=!1,$scope.dataLoaded=!0}]),angular.module("radBlu").directive("crInterestsCarousel",["interestsModel",function(interestsModel){"use strict";return{restrict:"E",templateUrl:"/radblu_sc/views/partials/carousels/interests-carousel.html",link:function($scope){$scope.interestClicked=function($event){interestsModel.toggle($event.currentTarget.getAttribute("ng-value")),interestsModel.chosen.length>0?($scope.continueButton=!1,window.location.hash="#/interest="+$scope.getInterestString()):($scope.continueButton=!0,window.location.hash="")}}}}]),angular.module("radBlu").controller("radBluGalleryCtrl",["$rootScope","$scope","$timeout","$location",function($rootScope,$scope,$timeout,$location){"use strict";$scope.items=radBluGalleryPhotos,$scope.categoryItems=[],$scope.tabs=$(".radBluTabbedNavigation"),$rootScope.location=$location,$rootScope.encodedLocation=encodeURIComponent($location.absUrl()),$rootScope.shareTranslation=shareTranslation.translation,$scope.deckChairInit=function(){$("#deckchair-jssdk").remove(),window.dcAsyncInit=function(){window.deckchair_com.config={version:"1",urlStrategy:"",urlKey:"dekchair"},window.deckchair_com.init()},function(d,s,id){var js,djs=d.getElementsByTagName(s)[0];d.getElementById(id)||(js=d.createElement(s),js.id=id,js.src="//camera.deckchair.com/embed.js",djs.parentNode.insertBefore(js,djs))}(document,"script","deckchair-jssdk")},$scope.updateQueryURL=function(tab){window.location.hash="#/"+tab},$scope.updateTab=function(tab){var $activeTab=$(tab);$activeTab.closest(".radBluTabbedNavigation").find(".radBluNavigationLink").removeClass("active"),$activeTab.addClass("active"),$scope.updateQueryURL($(tab).attr("data-link"))},$scope.onInit=function(event){$scope.galleryStatus.find(".currentSlide").html(event.currentSlide+1),$scope.galleryStatus.find(".totalSlides").html(event.slideCount),$scope.captionHeight=$scope.getMaxCaptionHeight()+$(".radBluGalleryStatus").outerHeight()+30,$(".radBluGalleryStatus").css("bottom",$scope.captionHeight),event.slideCount>1?$scope.galleryStatus.show():$scope.galleryStatus.hide()},$scope.onBeforeChange=function(event){var currentSlide,slideType,player,command;if(currentSlide=$(event.$slider).find(".slick-active"),player=currentSlide.find("iframe").get(0),slideType=$(player).attr("src"),slideType&&slideType.indexOf("vimeo")!==-1)command={method:"pause",value:"true"};else if(slideType&&slideType.indexOf("youtube")!==-1)command={event:"command",func:"stopVideo"};else if(slideType&&slideType.indexOf("videopolis")!==-1){var currentSrc=$(player).attr("src");currentSrc.indexOf("#pause")!==-1?(currentSrc=currentSrc.split("#")[0],$(player).attr("src",currentSrc+"#stop")):currentSrc.indexOf("#stop")!==-1?(currentSrc=currentSrc.split("#")[0],$(player).attr("src",currentSrc+"#pause")):$(player).attr("src",currentSrc+"#pause")}void 0!=player&&player.contentWindow.postMessage(JSON.stringify(command),"*")},$scope.onAfterChange=function(event){$scope.galleryStatus.find(".currentSlide").html(event.currentSlide+1),$scope.galleryStatus.find(".totalSlides").html(event.slideCount)},$scope.getIframeSrc=function(src){return src.indexOf("youtube")!==-1?src+"?enablejsapi=1":src.indexOf("vimeo")!==-1?src+"?api=1":src.indexOf("videopolis")!==-1||src.indexOf("google")!==-1?src:void 0},$scope.changeData=function($event,category){$event.preventDefault(),$($event.currentTarget).hasClass("active")||($scope.gallerySlick.unslick(),$scope.gallerySlick.find(".gallery-item, .slick-list").remove(),$scope.gallerySlick.removeClass("slick-initialized slick-slider"),$scope.categorySlick.unslick(),$scope.categorySlick.find(".gallery-item, .slick-list").remove(),$scope.categorySlick.removeClass("slick-initialized slick-slider"),"photos"==category?($scope.items=radBluGalleryPhotos,$scope.categoryItems=radBluGalleryCategories):"videos"==category?($scope.items=radBluGalleryVideos,$scope.categoryItems=[]):"webcam"==category?($scope.items=radBluGalleryWebcamFeeds,$scope.categoryItems=[],$timeout(function(){$scope.deckChairInit()})):"360video"==category?($scope.items=radBluGalleryVirualTours,$scope.categoryItems=[]):$scope.items=[],$scope.updateTab($event.currentTarget),$timeout(function(){$rootScope.location=$location,$rootScope.encodedLocation=encodeURIComponent($location.absUrl()),$scope.$broadcast("itemsUpdated",$scope.items),$scope.$broadcast("categoryItemsUpdated",$scope.categoryItems)}))},$scope.galleryItemClick=function(e){if(0==$(".radBluGalleryModal").length){$scope.marginDiff=20;var $clonedWrapper=$scope.element.clone(),$closeButton=$('<div class="radBluGalleryModal-closeButtonWrapper"><a href="#" class="radBluGalleryModal-closeButton"></a></div>');$scope.element.wrap('<div class="radBluGalleryModal"></div>').wrap('<div class="radBluGalleryModalWrapper"></div>'),$(".radBluGalleryModalWrapper").prepend($closeButton),$(".radBluGalleryModal").addClass("radBluGalleryModal--visible"),$("#header, #secondaryNav, .alert, .mobile-secondary-nav").addClass("radBluGalleryModal--open"),$("body").addClass("radBluGalleryModal--active"),$(".radBluGalleryModalWrapper").outerHeight()+$scope.marginDiff<$(".radBluGalleryModal").outerHeight()&&$(".radBluGalleryModalWrapper").addClass("radBluGalleryModalWrapper--center"),$clonedWrapper.insertBefore($(".radBluGalleryModal"))}},$("body").on("click",".radBluGalleryModal-closeButton",function(e){e.preventDefault(),$(".radBluGalleryModal").prev().remove(),$(".radBluGalleryModal-closeButtonWrapper").remove(),$("#header, #secondaryNav, .alert, .mobile-secondary-nav").removeClass("radBluGalleryModal--open"),$("body").removeClass("radBluGalleryModal--active"),$scope.element.unwrap().unwrap()}),$scope.getParameterByName=function(name,url){url||(url=window.location.href),name=name.replace(/[\[\]]/g,"\\$&");var regex=new RegExp("[?&]"+name+"(=([^&#]*)|&|#|$)"),results=regex.exec(url);return results?results[2]?decodeURIComponent(results[2].replace(/\+/g," ")):"":null},$scope.trackHashUrl=function(){$scope.hashUrl=decodeURIComponent(window.location.hash),$scope.hashUrl=decodeURIComponent(window.location.hash).split("#/")[1],"photos"==$scope.hashUrl&&radBluGalleryPhotos.length>0?($scope.items=radBluGalleryPhotos,$scope.tabs.find(".radBluNavigationLink").removeClass("active"),$scope.tabs.find("[data-link='photos']").addClass("active"),$scope.categoryItems=radBluGalleryCategories):"videos"==$scope.hashUrl&&radBluGalleryVideos.length>0?($scope.items=radBluGalleryVideos,$scope.tabs.find(".radBluNavigationLink").removeClass("active"),$scope.tabs.find("[data-link='videos']").addClass("active"),$scope.categoryItems=[]):"webcam"==$scope.hashUrl&&radBluGalleryWebcamFeeds.length>0?($scope.items=radBluGalleryWebcamFeeds,$scope.tabs.find(".radBluNavigationLink").removeClass("active"),$scope.tabs.find("[data-link='webcam']").addClass("active"),$scope.categoryItems=[],$timeout(function(){$scope.deckChairInit()})):"360video"==$scope.hashUrl&&radBluGalleryVirualTours.length>0?($scope.items=radBluGalleryVirualTours,$scope.tabs.find(".radBluNavigationLink").removeClass("active"),$scope.tabs.find("[data-link='360video']").addClass("active"),$scope.categoryItems=[]):$scope.highlightNextAvailableData(),$timeout(function(){$scope.$broadcast("itemsUpdated",$scope.items),$scope.$broadcast("categoryItemsUpdated",$scope.categoryItems)})},$scope.getMaxCaptionHeight=function(){var captionHeightArray=[];return $(".radBluGalleryCarousel .gallery-caption").css("position","static").css("height","initial").each(function(index,el){captionHeightArray.push($(el).outerHeight())}),Math.max.apply(null,captionHeightArray)},$scope.highlightNextAvailableData=function(){radBluGalleryPhotos.length>0?($scope.items=radBluGalleryPhotos,$scope.tabs.find("[data-link='photos']").addClass("active"),$scope.categoryItems=radBluGalleryCategories):radBluGalleryVideos.length>0?($scope.items=radBluGalleryVideos,$scope.tabs.find("[data-link='videos']").addClass("active")):radBluGalleryWebcamFeeds.length>0?($scope.items=radBluGalleryWebcamFeeds,$scope.tabs.find("[data-link='webcam']").addClass("active"),$timeout(function(){$scope.deckChairInit()})):radBluGalleryVirualTours.length>0?($scope.items=radBluGalleryVirualTours,$scope.tabs.find("[data-link='360video']").addClass("active")):$scope.items=[],$timeout(function(){$scope.$broadcast("itemsUpdated",$scope.items),$scope.$broadcast("categoryItemsUpdated",$scope.categoryItems)})},$scope.checkAvailableData=function(){0==radBluGalleryPhotos.length?($scope.tabs.find("[data-link='photos']").hide(),$scope.categoryItems=[]):($scope.tabs.find("[data-link='photos']").show(),$scope.categoryItems=radBluGalleryCategories),0==radBluGalleryVideos.length?$scope.tabs.find("[data-link='videos']").hide():$scope.tabs.find("[data-link='videos']").show(),0==radBluGalleryWebcamFeeds.length?$scope.tabs.find("[data-link='webcam']").hide():$scope.tabs.find("[data-link='webcam']").show(),0==radBluGalleryVirualTours.length?$scope.tabs.find("[data-link='360video']").hide():$scope.tabs.find("[data-link='360video']").show(),""!=window.location.hash?$scope.trackHashUrl():$scope.highlightNextAvailableData()},$scope.switchCategory=function($event,category){if($event.preventDefault(),!$($event.currentTarget).hasClass("active")&&(void 0!=category||null!=category||""!=category)){$scope.categorySlick.find(".gallery-itemLink").removeClass("active"),$($event.currentTarget).addClass("active");var textAreaCategory=document.createElement("textarea");textAreaCategory.innerHTML=category,$scope.selectedCategory=textAreaCategory.value.replace(/[`~!@#$%^&*()_|+\-=?;:'",.<>\{\}\[\]\\\/]/gi,"").replace(/ /g,""),$scope.selectedGalleryItem=$scope.gallerySlick.find(".gallery-item[data-category="+$scope.selectedCategory+"]").not(".slick-cloned").eq(0),$scope.selectedGalleryItemIndex=parseInt($scope.selectedGalleryItem.attr("index")),
$scope.gallerySlick.slickGoTo($scope.selectedGalleryItemIndex,!1)}},$(window).resize(function(){$scope.categorySlick&&$scope.categorySlick.slickGoTo(0,!1),$scope.captionHeight=$scope.getMaxCaptionHeight()+$(".radBluGalleryStatus").outerHeight()+25,$(".radBluGalleryStatus").css("bottom",$scope.captionHeight),$(".radBluGalleryModal").length&&($(".radBluGalleryModalWrapper").outerHeight()+$scope.marginDiff<$(".radBluGalleryModal").outerHeight()?$(".radBluGalleryModalWrapper").addClass("radBluGalleryModalWrapper--center"):$(".radBluGalleryModalWrapper").removeClass("radBluGalleryModalWrapper--center"))}),$scope.checkAvailableData(),$scope.slickConfig={onInit:$scope.onInit,onAfterChange:$scope.onAfterChange,onBeforeChange:$scope.onBeforeChange,rtl:"rtl"==$("html").attr("dir")},$scope.slickCategoryConfig={slidesToShow:5,slidesToScroll:1,dots:!1,infinite:!1,rtl:"rtl"==$("html").attr("dir"),responsive:[{breakpoint:1024,settings:{slidesToShow:4,slidesToScroll:1}},{breakpoint:800,settings:{slidesToShow:3,slidesToScroll:1}},{breakpoint:320,settings:{slidesToShow:2,slidesToScroll:1}}]}}]),angular.module("radBlu").directive("crGalleryCarousel",["$timeout",function($timeout){"use strict";return{restrict:"E",templateUrl:"/radblu_sc/views/partials/carousels/gallery-carousel.html",link:function($scope,element,attrs){$scope.gallerySlick=$(element).find(".radBluGalleryCarousel"),$scope.galleryStatus=$(".radBluGalleryStatus"),$scope.categorySlick=$(element).find(".radBluGalleryCategoryCarousel"),$timeout(function(){$scope.gallerySlick.slick($scope.slickConfig),$scope.categoryItems.length>0&&$scope.categorySlick.slick($scope.slickCategoryConfig),$scope.$on("itemsUpdated",function(event,data){$scope.gallerySlick.slick($scope.slickConfig)}),$scope.$on("categoryItemsUpdated",function(event,data){$scope.categorySlick.slick($scope.slickCategoryConfig)}),$scope.element=element})}}}]),angular.module("radBlu").directive("bookingLink",[function(){return{controller:["$scope",function($scope){}],link:function(scope,iElement,iAttrs,ctrl){iAttrs.$observe("href",function(){scope.href=iAttrs.href,scope.isMobileLayout()&&!$("#wrap").hasClass("tabletportrait")&&"undefined"!=typeof scope.href&&(scope.href.indexOf("/reservation/itineraryEntrance")>=0||scope.href.indexOf("/reservation/cityRateSearch")>=0||scope.href.indexOf("/reservation/rateSearch")>=0)&&scope.href.indexOf("mweb")<0&&iElement.attr("href",scope.href.replace("/reservation","/mweb/reservation"))})}}}]).directive("bookingForm",[function(){return{controller:["$scope",function($scope){}],link:function(scope,iElement,iAttrs,ctrl){iAttrs.$observe("action",function(){scope.action=iAttrs.action,scope.isMobileLayout()&&!$("#wrap").hasClass("tabletportrait")&&"undefined"!=typeof scope.action&&(scope.action.indexOf("/reservation/itineraryEntrance")>=0||scope.action.indexOf("/reservation/cityRateSearch")>=0||scope.action.indexOf("/reservation/rateSearch")>=0)&&scope.action.indexOf("mweb")<0&&iElement.attr("action",scope.action.replace("/reservation","/mweb/reservation"))})}}}]),angular.module("radBlu").directive("crSidebar",["$timeout","$filter",function($timeout,$filter){"use strict";return{restrict:"E",controllerAs:"SidebarCtrl",controller:["$scope",function($scope){window.jmr=$scope,$scope.isActive=!1,$scope.isActiveDetailItem=!1,$scope.activeDetailItem=null,$scope.activeDetailItemBefore=null,$scope.activeDetailItemAfter=null,$scope.isSingleGridView=!0,$scope.isFullGridView=!1,$scope.isFlexibleView=!0,$scope.sideBarItemSpacing=1,$scope.contentGridHeight=3,$scope.sidebarFilterOptions=[{label:"all",value:"-"},{label:"price (lowest)",value:"lowestRate.price"},{label:"price (highest)",value:"-lowestRate.price"}],$scope.sidebarFilterOption={label:"all",value:"-"},$scope.slideVertView=!0,$scope.handleVertView=function(){$scope.isMobileLayout()?$scope.slideVertView=!1:$scope.slideVertView=!0},$scope.showItemDetail=function(pFilter){$scope.activeDetailItem=this.sidebarItem,$scope.activeDetailItemIndex=this.$index;var lFilter="orderBy";pFilter&&(lFilter=pFilter);var sideBarItems=$filter(lFilter)($scope.sidebarData,$scope.sidebarFilterOption.value);$scope.activeDetailItemBefore=this.$first===!0?null:sideBarItems[$scope.activeDetailItemIndex-1],$scope.activeDetailItemAfter=this.$last===!0?null:sideBarItems[$scope.activeDetailItemIndex+1],$scope.hasActiveDetailItemBefore=null!=$scope.activeDetailItemBefore,$scope.hasActiveDetailItemAfter=null!=$scope.activeDetailItemAfter,$scope.isActiveDetailItem=!0,$scope.isFlexibleView=!1},$scope.closeItemDetail=function(){$scope.isFlexibleView=!0,$scope.isActiveDetailItem=!1,$("#sidebar .sidebar_detail-view .detail-view_content .description .more-content-container").length>0&&$("#sidebar .sidebar_detail-view .detail-view_content .description .more-content-container").each(function(){$(this).hasClass("only-show-partial")||$(this).addClass("only-show-partial")})},$scope.showFullGridView=function(){$scope.closeItemDetail(),$scope.isFullGridView=!0,$scope.isSingleGridView=!1,$scope.isFlexibleView=!0},$scope.showSingleGridView=function(){$scope.closeItemDetail(),$scope.isFullGridView=!1,$scope.isSingleGridView=!0,$scope.isFlexibleView=!0},$scope.toggleView=function(){$scope.isFullGridView=!$scope.isFullGridView,$scope.isSingleGridView=!$scope.isSingleGridView,$scope.changeSidebarWrapperPosistion()},$scope.changeSidebarWrapperPosistion=function(){$(".sidebar_wrapper").css("top","40px")},$scope.$watch("interestsModel.chosen",function(){$scope.changeSidebarWrapperPosistion()}),$scope.$on("sidebarDataLoaded",function(event,mass){$scope.slideSideBar()}),$scope.$on("sidebarDataUnloaded",function(event,mass){$scope.hideSideBar()}),$scope.$on("interestResultsLoaded",function(event,mass){$scope.isMobileLayout()||$scope.showFullGridView()}),$scope.$on("interestMapEnabled",function(event,mass){$scope.showSingleGridView()}),$scope.$on("mapZoomedOut",function(event,mass){$scope.hideSideBar()})}],link:function($scope,element,attr){var $element=$(element),sidebarWidth=$element.outerWidth()+30,slideCSSMap={rtl:{in:{left:0},out:{left:"-"+sidebarWidth+"px"}},ltr:{in:{right:0},out:{right:"-"+sidebarWidth+"px"}}},getSlideCSS=function(direction){return $scope.isDisplayRTL()===!0?slideCSSMap.rtl[direction]:slideCSSMap.ltr[direction]};$scope.slideSideBar=function(shouldOpen){if($element.show(),$element.velocity(getSlideCSS("in"),350,resizeContentItems),$scope.isDesktopLayout()||$scope.isTabletLayout()){var crSideBarHeight=$("#sidebar").outerHeight();$(".explore-hotels-view").length>0&&crSideBarHeight>$("#map").outerHeight()&&(crSideBarHeight=$("#map").outerHeight());var slideViewHeaderHeight=$element.find(".slide-view_header").outerHeight(),computedHeight=crSideBarHeight-slideViewHeaderHeight-10;$(".sidebar_wrapper").css("height",computedHeight+"px")}},$scope.hideSideBar=function(){$element.hide(),$element.velocity(getSlideCSS("out"),350)};var getSlideViewHeaderHeight=function(){return $element.find(".slide-view_header").outerHeight()},getContentHeight=function(){return $scope.windowWidth<=800?$element.find(".description").css("overflow-y","visible"):$element.find(".description").css("overflow-y","auto"),$(".sidebar_wrapper").outerHeight()-getSlideViewHeaderHeight()-66};$scope.getContentHeight=function(){return getContentHeight()-$scope.sideBarDetailViewHeaderHeight-30},$scope.hasImage=function(img){return"undefined"!=typeof img&&""!==img};var resizeContentItems=function(){$scope.isDesktopLayout()||$scope.showSingleGridView(),$scope.sideBarItemHeight=205,$scope.sideBarItemWidth=295,$scope.isOffersMapPage?$scope.sideBarDetailViewHeaderHeight=200:$scope.sideBarDetailViewHeaderHeight=getSlideViewHeaderHeight()+$scope.sideBarItemHeight+$scope.sideBarItemSpacing,$element.find(".item").outerHeight($scope.sideBarItemHeight).outerWidth($scope.sideBarItemWidth),$element.find(".item").css({"margin-top":6,"margin-bottom":6}),$element.find(".detail-view_header").outerHeight($scope.sideBarDetailViewHeaderHeight)};$(window).resize(_.debounce(resizeContentItems,200))}}}]),angular.module("radBlu").directive("crSidebarItem",[function(){"use strict";return{restrict:"EA",scope:{item:"=item",active:"=active",emptyText:"@emptyText",showOverlay:"=showOverlay"},link:function($scope,element,attr){}}}]),angular.module("radBlu").controller("OffersAndPromotionsCtrl",["$attrs","$scope","$window","$location","OffersAndPromotionsService","interestsModel","reservationModel","GeolocationService",function($attrs,$scope,$window,$location,OffersAndPromotionsService,interestsModel,reservationModel,GeolocationService){"use strict";$scope.isDrawerOpen=!1,$scope.isMapActive=!1,$scope.interestsModel=interestsModel,$scope.reservationModel=reservationModel,$scope.activeView=$attrs.activeView,$scope.isOffersMapPage=!0,$scope.dates={checkInDate:null,checkOutDate:null},$scope.refineOfferSearchForm={},$scope.status={isFirstOpen:!0},$scope.interestsModel.get("radBlu"),$scope.offerSidebarFilterOptions=[{label:"all",value:"n/a"},{label:"price (lowest)",value:"lowest"},{label:"price (highest)",value:"highest"}],$scope.offerSidebarFilterOption={label:"all",value:"n/a"},$scope.performCombinedSearch=function($event){var $this=$($event.currentTarget),$thisForm=$this.closest("form"),startDate=$thisForm.find("#check-in-datepicker")[0].value,endDate=$thisForm.find("#check-out-datepicker")[0].value,hasDateCriteria=null!=startDate&&null!=endDate,dateSpan={checkInDate:startDate,checkOutDate:endDate},location=this.reservationModel.destination.cityId,interests=this.interestsModel.chosen,searchCriteria={dateSpan:dateSpan,location:location,interests:interests};if(this.interestsModel.chosen.length>0)if(""==window.location.hash)window.location.hash="#/interest="+$scope.getInterestString();else if(window.location.hash.indexOf("destination")!==-1){var newHashUrl=decodeURIComponent(window.location.hash);newHashUrl=newHashUrl.split("#/interest=")[0],window.location.hash=newHashUrl+"#/interest="+$scope.getInterestString()}else window.location.hash="#/interest="+$scope.getInterestString();var combinedSearchDeferred=OffersAndPromotionsService.getCombinedSearchResultsData(searchCriteria,hasDateCriteria);combinedSearchDeferred.then(function(data){location&&location>0?($scope.originalResponse=data,$scope.$broadcast("offerDestinationDataLoaded",data),$scope.haveResults=!0):($scope.getInterestString(),$scope.originalResponse=data,$scope.$broadcast("offerInterestsDataLoaded",data),$scope.haveResults=!0)})},$scope.loadSidebarData=function(type){var _this=this;switch($scope.originalResponse={},type){case"destinations":var destinationDeferred=OffersAndPromotionsService.getSidebarDestinationData(this.cityId);_this.interestsModel.chosen=[],destinationDeferred.then(function(data){$scope.originalResponse=data,$scope.$broadcast("offerDestinationDataLoaded",data),$scope.haveResults=!0});break;case"interest":if(null!=_this.interestsModel.chosen&&_this.interestsModel.chosen.length>0){var interestsDeferred=OffersAndPromotionsService.getSidebarInterestData(_this.interestsModel.chosen);interestsDeferred.then(function(data){$scope.getInterestString(),$scope.originalResponse=data,$scope.$broadcast("offerInterestsDataLoaded",data),$scope.haveResults=!0})}}},$scope.$on("searchCriteriaUpdated",function(){var dateSpan=$scope.searchCriteria.dateSpan,hasDateCriteria=!1;null!=dateSpan&&null!=dateSpan.checkInDate&&null!=dateSpan.checkOutDate&&(hasDateCriteria=!0);var combinedSearchDeferred=OffersAndPromotionsService.getCombinedSearchResultsData($scope.searchCriteria,hasDateCriteria);combinedSearchDeferred.then(function(data){})}),$scope.showBookNowWithDisplayPriceButton=function(pItem){return!(null==pItem||"RadBluWEOffer"!=pItem.offersubType||"Yes"==pItem.isBrandOffer||!pItem.displayPrice)},$scope.showBookNowWithBookingFixturePriceButton=function(pItem){if(null!=pItem&&null!=pItem.hotelFixture){var hasBookingFixtureDisplayPrice=pItem.hotelsBookingFixture[pItem.hotelFixture.hotelCode]&&null!=pItem.hotelsBookingFixture[pItem.hotelFixture.hotelCode].displayPrice;if("RadBluOffer"==pItem.offersubType&&pItem.hotels&&pItem.hotels.length>0&&hasBookingFixtureDisplayPrice)return!0}return!1},$scope.showBookNowNoPriceButton=function(pItem){if(null!=pItem&&null!=pItem.hotelFixture){var hasBookingFixtureDisplayPrice=pItem.hotelsBookingFixture[pItem.hotelFixture.hotelCode]&&null!=pItem.hotelsBookingFixture[pItem.hotelFixture.hotelCode].displayPrice;if("RadBluOffer"==pItem.offersubType&&pItem.hotels&&pItem.hotels.length>0&&!hasBookingFixtureDisplayPrice||"RadBluWEOffer"==pItem.offersubType&&"Yes"==pItem.isBrandOffer)return!0}return!1},$scope.resize=function(){var windowH=Math.floor($(window).height()),headerH=Math.floor($(".header").height()),drawerMenuH=Math.floor($(".offers-and-promotions-drawer").height()),pageHeightCalculated=(Math.floor($(".top-bar").height()),windowH-headerH);this.contentHeight=$scope.isMobileLayout()?"513px":windowH-headerH-drawerMenuH+"px";var mapContentHeightCalculated=windowH-drawerMenuH;$scope.isMapActive&&(this.isMaxHeightNeeded=!0,this.pageHeight=$scope.isMobileLayout()?513+drawerMenuH+"px":pageHeightCalculated+"px"),this.mapContentHeight=mapContentHeightCalculated+"px"},$scope.hasImage=function(img){return"undefined"!=typeof img&&""!==img},$scope.triggerResize=function(){$(window).trigger("resize")},$(window).on("resize",$scope.resize.bind(this)),$scope.isActiveView=function(view){return view===$scope.activeView},$scope.activateView=function(view){$scope.activeView=view,"map"!==view&&$scope.closeDrawer()},$scope.offerHasHotels=function(pItem){return null!=pItem.hotelFixture},$scope.showOffersMap=function(){$scope.$broadcast("continueSelected"),$scope.isMapActive=!0,$scope.isFilterOpen=!1},$scope.newSearch=function(){window.location=window.location.href.replace(/#.*/,"")},$scope.toggleDrawer=function(){this.isDrawerOpen=!this.isDrawerOpen},$scope.openDrawer=function(){this.isDrawerOpen=!0},$scope.closeDrawer=function(){this.isDrawerOpen=!1},$scope.clearFilters=function(){$scope.interestsModel.chosen=[],$scope.originalDestinationResponse={},$scope.originalInterestResponse={},$scope.disableMap=!1,$scope.isInterestSearch=!1,$scope.markersLoaded=!0,$scope.openDrawer(),this.isFilterOpen=!0,$scope.$broadcast("interestResultsCleared")},$scope.removeFromSelectedInterests=function(interestValue){if($scope.interestsModel.unchoose(interestValue),""==window.location.hash)window.location.hash="#/interest="+$scope.getInterestString();else if(window.location.hash.indexOf("destination")!==-1){var newHashUrl=decodeURIComponent(window.location.hash);newHashUrl=newHashUrl.split("#/interest=")[0],$scope.getInterestString()?window.location.hash=newHashUrl+"#/interest="+$scope.getInterestString():window.location.hash=newHashUrl}else $scope.getInterestString()?window.location.hash="#/interest="+$scope.getInterestString():window.location.hash="";$scope.updateResults(!1)},$scope.enableMap=function(){$scope.disableMap=!1,$scope.$broadcast("interestMapEnabled")},$scope.getInterestString=function(){var chosen=interestsModel.chosen,interestString="",selectedInterestArray=[];if(null!=chosen&&chosen.length>0){$scope.isInterestSearch=!0,$scope.disableMap=!0,$scope.markersLoaded=!1;for(var i=0;i<chosen.length;i++){var interestObject=chosen[i];interestString+=interestObject+",",selectedInterestArray.push(interestObject)}return interestString&&(interestString=interestString.replace(/,$/,"")),$scope.interestsSelected=interestString,$scope.selectedInterestsArray=selectedInterestArray,interestString}},$scope.filterResults=function(){$scope.filteredOffers=[];var interestFound=!1,logText="";_.each($scope.selectedInterestsArray,function(selectedInterest){_.each($scope.originalResponse.promotionPackages,function(offer){logText=offer.packageName+": ",_.each(offer.interests,function(hotelInterest){var hotelInterestKey=hotelInterest.internalKey;logText+=hotelInterestKey+"-",interestFound=selectedInterest===hotelInterestKey}),1==interestFound&&$scope.filteredOffers.push(offer)})})},$scope.updateResults=function(pIsNewSearch){void 0!=$scope.getInterestString()&&""!=$scope.getInterestString()?(pIsNewSearch?$scope.loadSidebarData("interest"):($scope.filterResults(),$scope.$broadcast("cr-interestRemoved")),$scope.isDrawerOpen=!1):$scope.clearFilters()},$scope.showExploreHotelsOffers=function(){var lCityId=$location.search().cityId,lCity=$location.search().city;if(lCityId&&lCity){$location.search("cityId",null),$location.search("city",null),$scope.showOffersMap(),$scope.triggerResize();var geolocationDeferred=GeolocationService.getByMapAddress(lCity,!1);geolocationDeferred.then(function(data){reservationModel.destination.geoCoordinates.lng=data.geometry.location.lng(),reservationModel.destination.geoCoordinates.lat=data.geometry.location.lat(),$scope.cityId=lCityId,$scope.loadSidebarData("destinations")})}},$scope.showExploreHotelsOffers(),$("#crOffershotelSearch").length&&$("#crOffershotelSearch").keyup(function(event){13==event.keyCode&&$("button.continue:enabled").length&&$("button.continue:enabled").click()}),$scope.performHashUrlSearch=function(url){var _this=this;if(url){var hashUrl=decodeURIComponent(url),hashValue="",startDate=null,endDate=null,hasDateCriteria=null!=startDate&&null!=endDate,dateSpan={checkInDate:startDate,checkOutDate:endDate};if(hashUrl.indexOf("interest")!==-1&&hashUrl.indexOf("destination")!==-1){var interests,hashArray=hashUrl.split("#/"),location="",locationId=0;$(hashArray).each(function(index,el){el.indexOf("destination")!==-1?(location=el.split("=")[1].split("|")[0],locationId=el.split("|")[1]):el.indexOf("interest")!==-1&&(interests=el.replace("interest=","").split(","),_this.interestsModel.chosen=interests)});var searchCriteria={dateSpan:dateSpan,location:locationId,interests:interests},isCountrySearch=!1;$scope.cityRequest=location,GeolocationService.getByMapAddress($scope.cityRequest,isCountrySearch).then(function(res){reservationModel.destination.geoCoordinates.lat=res.geometry.location.lat(),reservationModel.destination.geoCoordinates.lng=res.geometry.location.lng();var combinedSearchDeferred=OffersAndPromotionsService.getCombinedSearchResultsData(searchCriteria,hasDateCriteria);combinedSearchDeferred.then(function(data){locationId&&locationId>0?($scope.originalResponse=data,$scope.$broadcast("offerDestinationDataLoaded",data),$scope.haveResults=!0,$scope.showOffersMap(),$scope.triggerResize()):($scope.getInterestString(),$scope.originalResponse=data,$scope.$broadcast("offerInterestsDataLoaded",data),$scope.haveResults=!0)})})}else hashUrl.indexOf("interest")!==-1?(hashValue=hashUrl.split("=")[1].split(","),_this.interestsModel.chosen=hashValue,$scope.loadSidebarData("interest"),$scope.showOffersMap(),$scope.triggerResize()):hashUrl.indexOf("destination")!==-1&&(hashValue=hashUrl.split("=")[1],$scope.destinationHashValue=decodeURI(hashValue).split("|"),_this.reservationModel.destination.cityId=$scope.destinationHashValue[1],$scope.setDestinationData())}},$scope.setDestinationData=function(city){var _this=this,isCountrySearch=!1;$scope.cityRequest=$scope.destinationHashValue[0],GeolocationService.getByMapAddress($scope.cityRequest,isCountrySearch).then(function(res){reservationModel.destination.geoCoordinates.lat=res.geometry.location.lat(),reservationModel.destination.geoCoordinates.lng=res.geometry.location.lng(),_this.cityId=$scope.destinationHashValue[1],$scope.loadSidebarData("destinations"),$scope.showOffersMap(),$scope.triggerResize()})},$scope.performHashUrlSearch(window.location.hash.toLowerCase())}]),angular.module("radBlu").controller("OffersAndPromotionsDrawerCtrl",["$scope","$timeout",function($scope,$timeout){"use strict";$scope.init=function(){},this.resize=function(){var windowH=Math.floor($(window).height()),headerH=Math.floor($(".header").height()),drawerMenuH=Math.floor($(".bottom-drawer__menu").height());this.pageHeight=windowH-headerH+"px",this.contentHeight=windowH-headerH-drawerMenuH+"px",this.mapContentHeight=windowH-drawerMenuH+"px"},$scope.triggerResize=function(){$(window).trigger("resize")},$scope.isDetailOpen=!1,$scope.openDetailView=function($event,isSidebar){isSidebar||($scope.isDetailOpen=!$scope.isDetailOpen),$scope.addActiveClass($event),$timeout(function(){$scope.scrollToActive()}),$("#wrap.mobile").length>0&&$("html, body").animate({scrollTop:0},"slow")},$scope.addActiveClass=function($event){$timeout(function(){if($event){var item=$event.currentTarget.parentElement.parentElement,newItemList=$(".item");_.each(newItemList,function(newItem){$(newItem).removeClass("active"),item.getAttribute("data-index")===newItem.getAttribute("data-index")&&item.getAttribute("offer")===newItem.getAttribute("offer")&&$(newItem).addClass("active")})}})},$scope.scrollToActive=function(){var $item=$(".item"),itemHeight=$item.height(),activeIndex=$item.index($(".item.active")),scrollTopAmount=(activeIndex-1)*itemHeight;$(".webextra-detail-grid").scrollTop(scrollTopAmount)},$scope.showItemDetail=function(expandedOffer){$scope.expandedOffer=expandedOffer},$scope.init()}]),angular.module("radBlu").directive("crOffersAndPromotionsDrawer",[function(){"use strict";return{restrict:"A",link:function($scope,element,attr){$scope.lView=getUrlParam("activeView"),$scope.lView&&("list"==$scope.lView?$scope.isFeaturedOpen=!0:$scope.isFeaturedOpen=!1),window.location.hash.toLowerCase().lastIndexOf("feature")!==-1&&($scope.isFeaturedOpen=!0,$scope.isFilterOpen=!1),$scope.toggleFeaturedDrawer=function(){$scope.isFeaturedOpen=!this.isFeaturedOpen,window.location.hash=window.location.hash.toLowerCase().indexOf("feature")===-1?"feature":"",$scope.isFilterOpen=!1},$scope.toggleFilterDrawer=function(){$scope.isFilterOpen=!this.isFilterOpen,$scope.isFeaturedOpen=!1}}}}]),angular.module("radBlu").directive("crOffersAndPromotionsPromos",["$timeout","OffersAndPromotionsService",function($timeout,OffersAndPromotionsService){"use strict";return{restrict:"A",link:function($scope,element,attr){$scope.init=function(){$scope.getPromoData()},$scope.getPromoData=function(){OffersAndPromotionsService.loadPromosData().then(function(data){$scope.data=data,$scope.promoData=data.featuredOffers,$scope.groups=_.range(0,$scope.promoData.length,2),$timeout($scope.setItemHeight,100)})},$scope.$parent.$last&&console.log("last"),$scope.setItemHeight=function(){var $drawer=element[0],drawerHeight=$drawer.offsetHeight,$panel=$($drawer).find(".featured-promos_panels"),$items=$panel.find(".item"),$slider=$panel.find(".slick-list");$($slider).css("height",drawerHeight),_.each($items,function(item){$(item).css("height",drawerHeight/2)})},$scope.init(),$(window).resize(function(){$scope.setItemHeight()})}}}]),angular.module("radBlu").directive("crOffersMap",["mapUtilityService",function(mapUtilityService){"use strict";return{restrict:"EA",link:function($scope,$el,$attrs){loadGoogleMapsApi(function(){mapUtilityService.initializeValues($el.get(0)),$scope.map=new google.maps.Map($el.get(0),mapUtilityService.mapOptions),mapUtilityService.map=$scope.map;var boundsFixListener=google.maps.event.addDomListener($scope.map,"idle",function(){mapUtilityService.checkBounds(),google.maps.event.trigger($scope.map,"resize");var newCenter=new google.maps.LatLng(10,2);$scope.map.setCenter(newCenter),mapUtilityService.$mapElement.find(".gm-style").get(0).style.top="-50px",google.maps.event.removeListener(boundsFixListener)});$scope.$broadcast("offersMapDirectiveLoaded")})}}}]),angular.module("radBlu").controller("crOffersMapCtrl",["$scope","$filter","mapUtilityService",function($scope,$filter,mapUtilityService){"use strict";$scope.markersWithData=null,$scope.defaultCityZoom=12,$scope.uniqueHotels={},$scope.hotelOffers={},$scope.offersMapLoaded=!1,$scope.hasImage=function(img){return"undefined"!=typeof img&&""!==img},$scope.$on("cr-interestsSelected",function(event,mass){}),$scope.$on("cr-interestRemoved",function(event,mass){mapUtilityService.hideAllMarkers(),mapUtilityService.filterExistingInterestMarkers($scope.interestsSelected),$scope.updateSidebar($scope.uniqueHotels,$scope.filteredOffers,!0),$scope.disableMap=!0}),$scope.$on("interestResultsCleared",function(event,mass){mapUtilityService.hideAllMarkers(),$scope.uniqueHotels={},$scope.hotelOffers={},mapUtilityService.resetInterestMarkers(),$scope.$broadcast("mapZoomedOut")}),$scope.$on("offerDestinationDataLoaded",function(event,data){var newGeoCoordinates=$scope.$parent.reservationModel.destination.geoCoordinates,newCenter=new google.maps.LatLng(newGeoCoordinates.lat,newGeoCoordinates.lng);$scope.map.setCenter(newCenter),$scope.map.setZoom($scope.defaultCityZoom);var panCenter=new google.maps.LatLng(newGeoCoordinates.lat,newGeoCoordinates.lng+.27);$(".desktop").length>0&&data.promotionPackages.length>0&&($scope.map.panTo(panCenter),$scope.map.setZoom(11)),$scope.uniqueHotels=data.uniqueHotels,$scope.allOffers=data.promotionPackages,mapUtilityService.createOfferMarkers($scope.uniqueHotels,null,null),$scope.updateSidebar($scope.uniqueHotels,$scope.allOffers,!1)}),$scope.$on("offerInterestsDataLoaded",function(event,data){if($scope.uniqueHotels=data.uniqueHotels,$scope.allOffers=data.promotionPackages,null===mapUtilityService.map)var setMapTimer=setInterval(function(){$scope.offersMapLoaded&&(mapUtilityService.createOfferMarkers($scope.uniqueHotels,null,null),clearInterval(setMapTimer))},300);else mapUtilityService.createOfferMarkers($scope.uniqueHotels,null,null);$scope.updateSidebar($scope.uniqueHotels,$scope.allOffers,!1)}),$scope.$on("offersMapDirectiveLoaded",function(event,data){$scope.offersMapLoaded=!0}),$scope.updateSidebar=function(uniqueHotels,allOffers,isInterestSearch){var lSortingPrice;_.each(allOffers,function(offerFixture){lSortingPrice=0,"RadBluWEOffer"===offerFixture.offersubType?lSortingPrice=parseFloat(offerFixture.basePrice):"RadBluOffer"===offerFixture.offersubType&&null!=offerFixture.hotelFixture&&(lSortingPrice=parseFloat(offerFixture.hotelsBookingFixture[offerFixture.hotelFixture.hotelCode].price)),lSortingPrice!==lSortingPrice&&(lSortingPrice=0),offerFixture.sortingPrice=lSortingPrice,null!=offerFixture.hotelFixture&&(offerFixture.hotelFixture.mapMarker=uniqueHotels[offerFixture.hotelFixture.hotelCode].mapMarker)}),$scope.originalSidebarData=allOffers,$scope.sidebarData=allOffers,$scope.numberOfResults=allOffers.length,$scope.$broadcast("sidebarDataLoaded"),$scope.$broadcast("interestResultsLoaded"),$scope.isWideDisplay=!0,$scope.isNarrowDisplay=!1,$scope.markersLoaded=!0},$scope.enableMap=function(){$scope.disableMap=!$scope.disableMap,$scope.$broadcast("interestMapEnabled")}}]),angular.module("radBlu").directive("dateRange",[function(){"use strict";return{restrict:"A",replace:!0,link:function($scope,$el,$attrs){$scope.startDateOptions={dateFormat:"dd M yy",minDate:"dateToday",defaultDate:1,nextText:"",prevText:"",showOtherMonths:!0,beforeShow:function(){var windowWidth=$(window).width(),marginLeft=windowWidth-320;$("#wrap").hasClass("mobile")&&setTimeout(function(){$("#ui-datepicker-div").css({left:marginLeft+"px"})},10)},numberOfMonths:$(window).width()<800?1:[2,1],dayNamesMin:["S","M","T","W","T","F","S"],gotoCurrent:!0},$scope.endDateOptions={dateFormat:"dd M yy",minDate:"dateToday",defaultDate:2,nextText:"",prevText:"",showOtherMonths:!0,beforeShow:function(){var windowWidth=$(window).width(),marginLeft=windowWidth-320;$("#wrap").hasClass("mobile")&&setTimeout(function(){$("#ui-datepicker-div").css({left:marginLeft+"px"})},10)},numberOfMonths:$(window).width()<800?1:[2,1],dayNamesMin:["S","M","T","W","T","F","S"],gotoCurrent:!0}}}}]),angular.module("radBlu.offers",[]),angular.module("radBlu.offers").factory("offersService",["$q",function($q){"use strict";return{getAmenities:function(brand){var getting=$q.defer();return getting.resolve(AMENITIES_FIXTURE),getting.promise},getInterests:function(brand){var getting=$q.defer();return getting.resolve(INTERESTS_FIXTURE),getting.promise},getOffers:function(data){var getting=$q.defer();return this.setOfferFixture(data),data?getting.resolve(this.offers):getting.resolve(this.offers),getting.promise},setOfferFixture:function(data){return data?this.offers=OFFERS_FIXTURE:this.offers=OFFERS_FEATURED_FIXTURE,this.offers},getOffer:function(offerId){var getting=$q.defer(),offer=_.find(this.offers||this.setOfferFixture(),function(element){return element.offerCode===offerId+""});return offer?getting.resolve(offer):getting.reject(offerId),getting.promise}}}]),angular.module("radBlu.offers").factory("interestsModel",["offersService",function(offersService){"use strict";return{get:function(brand){var that=this;return offersService.getInterests(brand).then(function(interests){that.interests=interests})},interests:[],chosen:[],toggle:function(value){this.isChosen(value)?this.unchoose(value):this.choose(value)},choose:function(interestValue){this.chosen.push(interestValue)},unchoose:function(interestValue){return interestValue?void(this.chosen=_.without(this.chosen,interestValue)):(this.chosen=[],!1)},isChosen:function(interestValue){return _.contains(this.chosen,interestValue)}}}]),angular.module("radBlu.offers").controller("OfferCtrl",["$scope","$q","reservationModel","$timeout","$http",function($scope,$q,reservationModel,$timeout,$http){"use strict";var _this=this;$scope.reservationModel=reservationModel,$scope.hotelsWithRates=[],this.chosenHotel={},this.sortOptions={DESTINATION:"destination",RATE:"rate",DESTINATION_RATE:"destination-rate"},this.hotelSortValue=this.sortOptions.DESTINATION,this.getImage=function(hotelCode){var hotel=_.findWhere($scope.offer.hotels,{hotelCode:hotelCode});return _.first(hotel.hotelImages)},this.isChosenHotel=function(hotel){return hotel===this.chosenHotel},this.showHeader=function(hotel){var country=hotel.country,basePrice=hotel.basePrice,showHeader=!1;return showHeader=this.hotelSortValue===this.sortOptions.DESTINATION?country!==this.country:this.hotelSortValue===this.sortOptions.RATE?this.isInNewPriceRange(this.basePrice,basePrice):this.hotelSortValue===this.sortOptions.DESTINATION_RATE&&country!==this.country,this.country=country,this.basePrice=basePrice,showHeader},this.groupHeaderString=function(hotel){return this.hotelSortValue===this.sortOptions.DESTINATION?hotel.country:this.hotelSortValue===this.sortOptions.RATE?hotel.rateHeader:this.hotelSortValue===this.sortOptions.DESTINATION_RATE?hotel.country:void 0},this.getRateRangeString=function(basePrice){basePrice=parseInt(basePrice,10);var rateRange="",numRanges=$scope.rateRanges?$scope.rateRanges.length:0,lastRange=numRanges-1;return _.each($scope.rateRanges,function(range){range.lowerRange<=basePrice&&basePrice<=range.upperRange?rateRange=range.displayRange:basePrice<$scope.rateRanges[0].lowerRange?rateRange=$scope.rateRanges[0].displayRange:basePrice>$scope.rateRanges[lastRange].upperRange&&(rateRange=$scope.rateRanges[lastRange].displayRange)}),rateRange},this.isInNewPriceRange=function(newPrice,oldPrice){return this.getRateRangeString(newPrice)!=this.getRateRangeString(oldPrice)},this.setRegion=function(regionCode){var deferred=$q.defer();deferred.longStackJumpLimit=0,$scope.hotelsWithRates=[],$scope.displayParticipatingHotels=!1;var getHotelsByGridItemURL=$("#getHotelsByGridItemURL"+regionCode).attr("data-URL");$http.get(getHotelsByGridItemURL).success(function(response){$scope.regionTitle=response.gridItemName,$scope.offer.hotels=response.hotels,$scope.rateRanges=response.rateRanges,deferred.resolve(response);var getLowestRateURL=$("#getLowestRateURL"+regionCode).attr("data-URL");$http.get(getLowestRateURL).success(function(rateResponse){$scope.rates=rateResponse,deferred.resolve(rateResponse);var lHotelsWithRates=[];angular.forEach($scope.offer.hotels,function(hotel,key){$scope.rates[hotel.hotelCode]&&$scope.rates[hotel.hotelCode].priceInSecCurrency&&(hotel.basePrice=$scope.rates[hotel.hotelCode].priceInSecCurrency,hotel.rateHeader=_this.getRateRangeString(hotel.basePrice),hotel.showHeader=!1,lHotelsWithRates.push(hotel))}),$scope.hotelsWithRates=lHotelsWithRates,0==$scope.hotelsWithRates.length&&($scope.displayParticipatingHotels=!0);
})}),this.selectedRegion=regionCode},this.bookHotel=function(hotel){if(this.chosenHotel!==hotel)return this.chosenHotel=hotel,!0},this.setWidget=function(widgetNumber,fromInit){var deferred=$q.defer(),isotopeUrlEl=$("#getFeaturedIsotopeURL"+widgetNumber);if(0!=isotopeUrlEl.length){var getFeaturedIsotopeURL=isotopeUrlEl.attr("data-URL");if(!fromInit){var isotopeItemEl=isotopeUrlEl.closest(".item"),urlFragment=isotopeItemEl.data("urlFragment");"undefined"!=typeof urlFragment&&urlFragment&&urlFragment.length>0&&(location.href=location.pathname+location.search+"#/"+urlFragment)}$http.get(getFeaturedIsotopeURL).success(function(response){var data=response;$scope.widgetInfo=data,deferred.resolve(response)})}else if($("#getHotelsByGridItemURL"+widgetNumber).length>0){isotopeUrlEl=$("#getHotelsByGridItemURL"+widgetNumber);var getFeaturedIsotopeURL=isotopeUrlEl.attr("data-URL");if(fromInit)$scope.OfferCtrl.setRegion(widgetNumber);else{var isotopeItemEl=isotopeUrlEl.closest(".item"),urlFragment=isotopeItemEl.data("urlFragment");"undefined"!=typeof urlFragment&&urlFragment&&urlFragment.length>0&&(location.href=location.pathname+location.search+"#/"+urlFragment)}}},this.preventAdultNumPaste=function(e){var adultnum="";if(e.originalEvent.clipboardData?adultnum=e.originalEvent.clipboardData.getData("TEXT"):window.clipboardData&&(adultnum=window.clipboardData.getData("TEXT")),"undefined"===adultnum||""===adultnum||isNaN(adultnum)||1!==adultnum.length||!adultnum.match("^[1-8]{1}"))return e.preventDefault(),!1},this.preventChildNumPaste=function(e){var childnum="";if(e.originalEvent.clipboardData?childnum=e.originalEvent.clipboardData.getData("TEXT"):window.clipboardData&&(childnum=window.clipboardData.getData("TEXT")),"undefined"===childnum||""===childnum||isNaN(childnum)||1!==childnum.length||!childnum.match("^[0-8]{1}"))return e.preventDefault(),!1},this.init=function(){$scope.displayParticipatingHotels=!1,$scope.offer=$scope.offer||{hotels:[]},$timeout(function(){$scope.OfferCtrl.selectedRegion="";var locationFragment=location.hash.replace("#","").replace("/",""),foundFragment=!1;locationFragment&&locationFragment.length>0&&$("div.js-isotope div.item").each(function(){var urlFragment=$(this).data("urlFragment");if(foundFragment=urlFragment&&urlFragment===locationFragment)return $(this).children("a").first().click(),$("html, body").animate({scrollTop:$(this).closest("div.js-isotope").offset().top},400),!1}),foundFragment||$scope.OfferCtrl.setWidget(1,!0)},100),1===$scope.offer.hotels.length&&(this.chosenHotel=$scope.offer.hotels[0])},$scope.$watch("hotelsWithRates",function(){$scope.hotelsWithRates.length>0&&($scope.displayParticipatingHotels=!0)}),this.init()}]),angular.module("radBlu.offers").directive("crMasonry",["$timeout","$compile",function($timeout,$compile){"use strict";return{restrict:"A",link:function($scope,$el,$attrs){$timeout(function(){var containerWidth="",smallWidth="",smallHeight="",largeWidth="",largeHeight="",gridWidth="",isMobile=$("#wrap").hasClass("mobile"),largeFontMobile="16px",smallFontMobile="9px",viewportWidth=$(window).width(),viewportHeight=$(window).height();viewportWidth>320&&viewportHeight>480&&(smallFontMobile="10.5px"),360==viewportWidth&&640==viewportHeight&&(smallFontMobile="10px");var $grid=$el,$container=$el.find(".tile-grid__container"),$allItems=$el.find(".item"),$topRow=$el.find(".tile-grid__row-top"),$bottomRow=$el.find(".tile-grid__row-bottom"),$activeArrows=$el.find(".arrow-up"),$large=$el.find(".large"),$defaultArrow=$large.find(".arrow-up"),rowCount=$el.find(".tile-grid__row-top .item").length,topRowCount=$el.find(".tile-grid__row-top .item").length,bottomRowCount=$el.find(".tile-grid__row-bottom .item").length,topRowItems=$topRow.find(".item"),bottomRowItems=$bottomRow.find(".item"),halfOfArrow=25,isIe9=$("html").hasClass("lt-ie10"),gridSetUp=function(){var resetItems=function(){$container=$el.find(".tile-grid__container"),$allItems=$el.find(".item"),$topRow=$el.find(".tile-grid__row-top"),$bottomRow=$el.find(".tile-grid__row-bottom"),$activeArrows=$el.find(".arrow-up"),$large=$el.find(".large"),$defaultArrow=$large.find(".arrow-up"),rowCount=$el.find(".tile-grid__row-top .item").length,topRowCount=$el.find(".tile-grid__row-top .item").length,bottomRowCount=$el.find(".tile-grid__row-bottom .item").length,topRowItems=$topRow.find(".item"),bottomRowItems=$bottomRow.find(".item")},configureItemSizes=function(){var visibleItemsInRow=5,largeSizeMultiplier=2;containerWidth=Math.ceil($grid.width()/visibleItemsInRow)*visibleItemsInRow,smallWidth=Math.ceil(containerWidth/visibleItemsInRow),smallHeight=smallWidth,largeWidth=Math.ceil(smallWidth*largeSizeMultiplier),largeHeight=largeWidth,gridWidth=parseInt(smallWidth*rowCount+largeWidth,10),$grid.find(".item.large img").each(function(){if($(this).outerHeight()>50){var largeImageWidth=$(this).outerWidth(),largeImageHeight=$(this).outerHeight();largeImageWidth!=largeImageHeight&&(largeHeight=largeImageHeight,smallHeight=Math.ceil(largeImageHeight/2),$grid.find(".control").each(function(){$(this).css("top","35%")}))}})},applyContainerSizes=function(){$grid.css("height",largeHeight+"px"),$container.css("width",gridWidth+"px"),$bottomRow.css("top",smallHeight+"px")},applyItemSizes=function(){$allItems.css({width:smallWidth+"px",height:smallHeight+"px"}),isIe9&&$allItems.css({lineHeight:smallHeight+"px"}),$allItems.removeClass("large"),$large.css({width:largeWidth+"px",height:largeHeight+"px"}),isIe9&&$large.css({lineHeight:largeHeight+"px"}),$large.addClass("large")},resetMargins=function(){$allItems.css("margin","0")},applyDefaultMargin=function(){var rowPos=$large.parent().find(".item").index($large);if("undefined"!=typeof rowPos&&rowPos>=0)if($large.parent().hasClass("tile-grid__row-top")){var $secondRowItem=$bottomRow.find(".item:nth-child("+(rowPos+1)+")");"undefined"!=typeof $secondRowItem&&$secondRowItem.css("marginLeft",largeWidth+"px")}else if($large.parent().hasClass("tile-grid__row-bottom")){$large.css("margin-top",-smallWidth+"px");var $secondRowItem=$topRow.find(".item:nth-child("+(rowPos+1)+")");"undefined"!=typeof $secondRowItem&&$secondRowItem.css("marginLeft",largeWidth+"px")}},reloadIsotopeLayout=function(){resetItems(),configureItemSizes(),applyContainerSizes(),applyItemSizes(),resetMargins(),applyDefaultMargin(),showControls(),showActiveArrow($defaultArrow)};reloadIsotopeLayout()},showActiveArrow=function(activeArrow){activeArrow.css("left",smallWidth-halfOfArrow+"px"),activeArrow.show()};$scope.setActiveState=function($event){var $this=$($event.currentTarget),$thisItem=$this.closest(".item"),$rows=$el.find(".row"),$items=$this.closest(".row").children(".item"),$activeArrow=$thisItem.find(".arrow-up"),indexOfObject=$items.index($thisItem),resetMargins=function($currentItem){$el.find(".large")[0]!=$currentItem[0]&&($allItems.css("margin","0"),$allItems.not($currentItem).css("margin-top","0"))},setLeftMargin=function(index,item){index===indexOfObject&&$(item).css("margin-left",largeWidth+"px")},toggleZindex=function(){$rows.toggleClass("top-layer")},applyLargeState=function(){var getItemToOffset=function(rowItem){$.each(rowItem,function(index,item){setLeftMargin(index,item)})},ifBottomItem=function(){resetMargins($thisItem),$bottomRow.find(".item").last().show(),isIe9?$thisItem.velocity({height:largeHeight+"px",width:largeWidth+"px","margin-top":"-"+smallHeight+"px","line-height":largeHeight+"px"},400,function(){showActiveArrow($activeArrow),$thisItem.addClass("large")}):isMobile?$thisItem.velocity({height:largeHeight+"px",width:largeWidth+"px","margin-top":"-"+smallHeight+"px","font-size":largeFontMobile},400,function(){showActiveArrow($activeArrow),$thisItem.addClass("large")}):$thisItem.velocity({height:largeHeight+"px",width:largeWidth+"px","margin-top":"-"+smallHeight+"px"},400,function(){showActiveArrow($activeArrow),$thisItem.addClass("large")}),getItemToOffset(topRowItems)},ifTopItem=function(){resetMargins($thisItem),getItemToOffset(bottomRowItems),isIe9?$thisItem.velocity({height:largeHeight+"px",width:largeWidth+"px","line-height":largeHeight+"px"},400,function(){showActiveArrow($activeArrow),$thisItem.addClass("large")}):isMobile?$thisItem.velocity({height:largeHeight+"px",width:largeWidth+"px","font-size":largeFontMobile},400,function(){showActiveArrow($activeArrow),$thisItem.addClass("large")}):$thisItem.velocity({height:largeHeight+"px",width:largeWidth+"px"},400,function(){showActiveArrow($activeArrow),$thisItem.addClass("large")})};$this.closest(".tile-grid__row-bottom").length?ifBottomItem():ifTopItem()},resetOtherItemsSize=function(){var ifBottomItem=function(){isMobile?$allItems.not($thisItem).removeClass("large").velocity({height:smallHeight+"px",width:smallWidth+"px","margin-top":0,"font-size":smallFontMobile}):$allItems.not($thisItem).removeClass("large").velocity({height:smallHeight+"px",width:smallWidth+"px","margin-top":0}),isIe9&&$allItems.not($thisItem).css({lineHeight:smallHeight+"px"})},ifTopItem=function(){isMobile?$allItems.not($thisItem).removeClass("large").velocity({height:smallHeight+"px",width:smallWidth+"px","font-size":smallFontMobile}):$allItems.not($thisItem).removeClass("large").velocity({height:smallHeight+"px",width:smallWidth+"px"}),isIe9&&$allItems.not($thisItem).css({lineHeight:smallHeight+"px"})};$activeArrows.not($thisItem.find(".arrow-up")).hide(),$this.closest(".tile-grid__row-bottom").length?ifBottomItem():ifTopItem()};$this.closest("top-layer").length||toggleZindex(),"none"==$el.find(".cycle-next").css("display")&&showControlsOnClick($this),applyLargeState(),resetOtherItemsSize()};var showControls=function(){var position=$container.position(),$prev=$el.find(".cycle-prev"),$next=$el.find(".cycle-next");position.left<0?$prev.show():$prev.hide();var isItemTopParent=!1,newTopRowCount=0,newBottomRowCount=0;$el.find(".large").length>0?isItemTopParent=!!$el.find(".large").parent().hasClass("tile-grid__row-top"):$el.find(".item").each(function(){$(this).outerWidth()>smallWidth+5&&(isItemTopParent=!!$(this).parent().hasClass("tile-grid__row-top"))}),isItemTopParent?(newTopRowCount=topRowCount+1,newBottomRowCount=bottomRowCount+2):(newTopRowCount=topRowCount+2,newBottomRowCount=bottomRowCount+1);var newRowCount=newTopRowCount>=newBottomRowCount?newTopRowCount:newBottomRowCount,newGridWidth=parseInt(smallWidth*newRowCount,10);0===position.left&&newGridWidth>containerWidth||position.left>-(newGridWidth-containerWidth)?$next.show():$next.hide()},showControlsOnClick=function($this){var position=$container.position(),$prev=$el.find(".cycle-prev"),$next=$el.find(".cycle-next");position.left<0?$prev.show():$prev.hide();var isItemTopParent=!($this.parents(".tile-grid__row-bottom").length>0),newTopRowCount=0,newBottomRowCount=0;isItemTopParent?(newTopRowCount=topRowCount+1,newBottomRowCount=bottomRowCount+2):(newTopRowCount=topRowCount+2,newBottomRowCount=bottomRowCount+1);var newRowCount=newTopRowCount>=newBottomRowCount?newTopRowCount:newBottomRowCount,newGridWidth=parseInt(smallWidth*newRowCount,10);0===position.left&&newGridWidth>containerWidth||position.left>-(newGridWidth-containerWidth)?$next.show():$next.hide()},animateSliderPosition=function(el){var position=$container.position();if($container.is(":animated"))return!1;var newLeft=position.left-smallWidth;$(el).closest(".cycle-prev").length&&(newLeft=position.left+smallWidth,newLeft>0&&(newLeft=0)),$container.velocity({left:newLeft+"px"},400,function(){showControls()})},resetSlider=function(){$container.css("left","0")},getNewSizes=function(){gridSetUp(),showControls(),resetSlider()};gridSetUp(),window.onresize=getNewSizes,$el.find(".control").on("click",function(){animateSliderPosition(this)})},0)}}}]),angular.module("radBlu.exploreHotels",[]),angular.module("radBlu.exploreHotels").controller("ExploreHotelsCtrl",["$attrs","$scope","interestsModel","reservationModel","GeolocationService","$state","sharedSearchMap","mapLocUpdateService",function($attrs,$scope,interestsModel,reservationModel,GeolocationService,$state,sharedSearchMap,mapLocUpdateService){"use strict";function expoloreHLoadEnd(){if(new Date-expoloreHDate<expoloreHdelta)setTimeout(expoloreHLoadEnd,expoloreHdelta);else if(expoloreHtimeout=!1,window.location.hash){var elementId=window.location.hash.replace("#/","");null!=document.getElementById(elementId)&&document.getElementById(elementId).click()}}this.views={EXPLORE:"explore",LIST:"list",MAP:"map"},this.interestsModel=interestsModel,this.reservationModel=reservationModel,this.geolocationService=GeolocationService,this.$state=$state,this.isDrawerOpen=!1,this.previousView="map",this.activeView=$attrs.activeView;var lView=getUrlParam("activeView");lView&&(this.activeView=lView);var defaultCityZoom=12;this.$scope=$scope,this.hotels=[],this.sortValues={POPULARITY:"Popularity",RATE:"Rate"},this.hotelSortValue="Popularity";var expoloreHDate,expoloreHtimeout=!1,expoloreHdelta=200;window.location.hash&&angular.element(document).ready(function(){expoloreHDate=new Date,expoloreHtimeout===!1&&(expoloreHtimeout=!0,setTimeout(expoloreHLoadEnd,expoloreHdelta))}),this.init=function(){"map"!=this.activeView&&"list"!=this.activeView||this.interestsModel.get("radBlu")},this.resize=function(){var windowH=Math.floor($(window).height()),headerH=Math.floor($(".header").height()),drawerMenuH=Math.floor($(".bottom-drawer__menu").height());"map"!=this.activeView&&"list"!=this.activeView||(this.isMaxHeightNeeded=!0);var pageHeightCalculated=windowH-headerH;this.pageHeight=$scope.isMobileLayout()?"auto":pageHeightCalculated+"px",this.contentHeight=$scope.isMobileLayout()?"auto":windowH-headerH-drawerMenuH+"px";var mapContentHeightCalculated=windowH-headerH-drawerMenuH;$("#map.explore-hotels-view.explore-hotels-map-view").length>0?this.mapContentHeight=$scope.isMobileLayout()?windowH-headerH-35+"px":mapContentHeightCalculated+"px":this.mapContentHeight=$scope.isMobileLayout()?"auto":mapContentHeightCalculated+"px",this.mapContentMinHeight=$scope.isMobileLayout()?"550px":"initial";var sidebarHeightCalculated=mapContentHeightCalculated-100;this.sidebarHeight=$scope.isMobileLayout()?"initial":sidebarHeightCalculated+"px"},this.triggerResize=function(){$(window).trigger("resize")},this.toggleDrawer=function(){this.isDrawerOpen=!this.isDrawerOpen},this.toggleViews=function(){this.isActiveView("list")?this.activateView(this.previousView):(this.previousView=this.activeView,this.activateView("list"),this.triggerResize())},this.openDrawer=function(){this.isDrawerOpen=!0},this.closeDrawer=function(){this.isDrawerOpen=!1},this.isActiveView=function(view){return view===this.activeView},this.keepViewHash=function(){if(window.location.href.indexOf("#/")>0&&window.location.href.indexOf("#/bounds")==-1&&window.location.href.indexOf("#/interest=")==-1&&"undefined"!=typeof window.history.pushState){var newHash=this.isActiveView("list")?"list":"interests";window.history.replaceState("replaceState","replaceState",window.location.pathname+"#/"+newHash)}},this.activateView=function(view){this.activeView=view,"explore"!==view&&this.closeDrawer(),this.keepViewHash()},this.clearResults=function(){this.interestsModel.unchoose(),this.hotels=[],$scope.disableMap=!1,$scope.isInterestSearch=!1,$scope.markersLoaded=!0,$scope.$broadcast("interestResultsCleared")},this.removeFromSelectedInterests=function(interestValue){this.interestsModel.unchoose(interestValue),this.updateResults()},this.enableMap=function(){$scope.disableMap=!1,$scope.$broadcast("interestMapEnabled")},$scope.$on("interestedLoaded",function(event,data){$scope.ExploreHotelsCtrl.setHashInterests(data)}),$scope.$on("bootstrapDataLoaded",function(event,data){event.targetScope.hashDataLoaded&&$scope.ExploreHotelsCtrl.setHashResult()}),this.setHashInterests=function(data){this.interestsModel.chosen=data},this.setHashResult=function(){this.updateResults()},this.updateResults=function(){var chosen=interestsModel.chosen;chosen.sort();var interestString="";$scope.isInterestSearch=!0,$scope.disableMap=!0,$scope.markersLoaded=!1;for(var i=0;i<chosen.length;i++){var interestObject=chosen[i];interestString+=interestObject+","}if(interestString=interestString.replace(/,$/,""),$scope.interestsSelected=interestString,""==window.location.hash&&interestsModel.chosen.length>0)window.location.hash="#/interest="+interestString;else if(window.location.hash.indexOf("bounds")!==-1){var newHashUrl=decodeURIComponent(window.location.hash);newHashUrl=newHashUrl.split("#/interest=")[0],interestsModel.chosen.length>0?window.location.hash=newHashUrl+"#/interest="+interestString:window.location.hash=newHashUrl}else interestsModel.chosen.length>0?window.location.hash="#/interest="+interestString:window.location.hash="";$scope.$broadcast("cr-interestSelected"),this.isDrawerOpen=!1},this.isDoubleRow=function(){return this.hotels.length>9},this.updateDoubleRowHotels=function(newValue){if(!newValue)return!1;var that=this,hotels=angular.copy(this.hotels),hotelPairs=[];for(hotels=_.sortBy(hotels,function(hotel){return that.hotelSortValue===that.sortValues.RATE?+hotel.basePrice:hotel});hotels.length;)hotels.length>1?hotelPairs.push(hotels.splice(0,2)):hotelPairs.push(hotels);this.hotelsPairs=hotelPairs},this.prepareView=function(newView,oldView){return!!newView&&void(newView===this.views.MAP&&$scope.$broadcast("cr-resizeMap"))},this.fullMap=function(){$scope.$broadcast("cr-close-drawer")},$(window).on("resize",this.resize.bind(this)),$scope.$watch("ExploreHotelsCtrl.hotels",this.updateDoubleRowHotels.bind(this)),$scope.$watch("ExploreHotelsCtrl.hotelSortValue",this.updateDoubleRowHotels.bind(this)),$scope.$watch("ExploreHotelsCtrl.activeView",this.prepareView.bind(this)),this.setLatLng=function(destinationCountry,destinationCity){var _this=this,destinationName=destinationCountry,zoomValue=sharedSearchMap.zoomLevel()[destinationCountry];null!=destinationCity&&""!=destinationCity&&(destinationName=destinationCity+", "+destinationCountry,zoomValue=defaultCityZoom),_this.geolocationService.getByAddress(destinationName).then(function(res){_this.reservationModel.destination.geoCoordinates.lng=res.geometry.location.lng(),_this.reservationModel.destination.geoCoordinates.lat=res.geometry.location.lat(),mapLocUpdateService.updateLocationAndZoom(_this.reservationModel.destination.geoCoordinates,zoomValue),_this.$state.activeMapSection="map",_this.$state.go("map-results",{activeMapSection:"map"})})},this.init()}]),angular.module("radBlu.exploreHotels").directive("crImagemap",[function(){"use strict";return{restrict:"A",link:function($scope,$el,$attrs){$(function(){this.resize=function(){};var $imgMap=$el.find("img[usemap]"),$area=$el.find("area"),$copy=$el.find(".country-list");$imgMap.rwdImageMaps();var mouseEnterHandler=function(event){var region=$(event.target).attr("class"),imageSrc=$imgMap.data("imgsrc"),imageName=imageSrc.split("/").pop().slice(0,-4),newImageName=imageName+"-"+region,src=imageSrc.replace(imageName,newImageName);$imgMap.attr("src",src)},mouseLeaveHandler=function(){$imgMap.attr("src",$imgMap.data("imgsrc"))},mouseUpHandler=function(event){var region=$(event.target).attr("class");if(mouseLeaveHandler(),region){var exploreHotelsRegionListURL="";null!=document.getElementById("exploreHotelsRegionListURL")&&null!=document.getElementById("exploreHotelsRegionListURL").getAttribute("data-URL")&&(exploreHotelsRegionListURL=document.getElementById("exploreHotelsRegionListURL").getAttribute("data-URL")),window.location.href=exploreHotelsRegionListURL+"?region="+$(event.target).attr("data-region")}};$copy.on("mouseenter",function(){var region=$(this).data("regionid"),mapId="#"+region+"-map-region";mouseEnterHandler({target:$el.find(mapId)})}),$copy.on("mouseleave",mouseLeaveHandler),$copy.on("mouseup",function(){var region=$(this).data("regionid"),mapId="#"+region+"-map-region";mouseUpHandler({target:$el.find(mapId)})}),$area.on("mouseenter",mouseEnterHandler),$area.on("mouseleave",mouseLeaveHandler),$area.on("mouseup",mouseUpHandler)})}}}]),angular.module("radBlu.exploreHotels").directive("crImageOnload",[function(){"use strict";return{restrict:"A",link:function($scope,$el,$attrs){$el.bind("load",function(){$scope.imageLoaded=!0})}}}]),angular.module("radBlu").controller("crExploreHotelsMapCtrl",["$http","$scope","$timeout","$filter","mapUtilityService","carlsonService",function($http,$scope,$timeout,$filter,mapUtilityService,carlsonService){"use strict";$scope.hotelInterestMap=mapUtilityService.hotelInterestMap,$scope.latNorth=0,$scope.latSouth=0,$scope.fetchLocalMarkers=function(hashObject){if(hashObject)var deferred=carlsonService.fetch("markers",{params:{bounds:hashObject.bounds,center:hashObject.center,variants:"RAD_B"}});else{mapUtilityService.clearLocalMarkers();var deferred=carlsonService.fetch("markers",{params:{bounds:this.map.getBounds().toString().replace(/([()])/g,""),center:this.map.getCenter().toString().replace(/([()])/g,""),variants:"RAD_B"}});if(""==window.location.hash)window.location.hash="#/bounds="+this.map.getBounds().toString().replace(/([()])/g,"")+"|center="+this.map.getCenter().toString().replace(/([()])/g,"")+"|zoom="+this.map.getZoom();else if(window.location.hash.indexOf("interest")!==-1){var newHashUrl=decodeURIComponent(window.location.hash);window.location.hash=window.location.hash="#/bounds="+this.map.getBounds().toString().replace(/([()])/g,"")+"|center="+this.map.getCenter().toString().replace(/([()])/g,"")+"|zoom="+this.map.getZoom()+newHashUrl}else window.location.hash="#/bounds="+this.map.getBounds().toString().replace(/([()])/g,"")+"|center="+this.map.getCenter().toString().replace(/([()])/g,"")+"|zoom="+this.map.getZoom()}deferred.then(function(response){if(mapUtilityService.createLocalMarkers(response.data.propertyMarkers,null),$scope.fetchHotelMapResults(),hashObject){var geocoder=new google.maps.Geocoder,input=hashObject.center,latlngStr=input.split(",",2),latlng={lat:parseFloat(latlngStr[0]),lng:parseFloat(latlngStr[1])};geocoder.geocode({location:latlng},function(results,status){status===google.maps.GeocoderStatus.OK?results[1]?($scope.map.setCenter(latlng),$scope.map.setZoom(parseInt(hashObject.zoom)),$scope.$broadcast("mapLoadedWithLocations")):window.alert("No results found"):window.alert("Geocoder failed due to: "+status)})}})},$scope.getBootstrapData=function(){var deferredBootstrap=carlsonService.fetch("bootstrap",{});deferredBootstrap.then(function(response){mapUtilityService.getService().then(function(mapUtilityService_response){mapUtilityService_response.createBootstrapMarkers(response.data.bootstrap,function(){}),$scope.markersLoaded=!0,google.maps.event.addListener($scope.map,"zoom_changed",$scope.onZoomChange.bind(this)),$scope.$emit("bootstrapDataLoaded")})})},$scope.fetchHotelMapResults=function(){var lHotelCodes=mapUtilityService.getHotelCodes();if($.trim(lHotelCodes).length>0){var lParamString="&packedargs=hotelCodes="+lHotelCodes;return $scope.getHotelMapResults(lParamString).success(function(result){$scope.markersWithData=mapUtilityService.getHotelMapResultsSuccess(result),$scope.updateSidebar($scope.markersWithData,!1),$scope.markersLoaded=!0}).error(function(){console.log("error in calling getHotelMapResults")})}console.log("lHotelCodeList was empty, so not calling getHotelMapResults"),$scope.updateSidebar([],!1)},$scope.getHotelMapResults=function(pParamString){var lMapContentURL=$("#mapContentURL").attr("data-URL");if(lMapContentURL.indexOf("d=Touch")>-1&&(lMapContentURL=lMapContentURL.replace("d=Touch","d=Default")),null!=pParamString)return $http.get(lMapContentURL+pParamString)},$scope.hasImage=function(img){return"undefined"!=typeof img&&""!==img},$scope.onZoomChange=function(){var closeWorldZoom=9;$scope.map.zoom<closeWorldZoom?$scope.$broadcast("mapZoomedOut"):($scope.markersLoaded=!1,$scope.fetchLocalMarkers()),mapUtilityService.handleZoomChanged()},$scope.$on("cr-interestSelected",function(event,mass){$scope.markersLoaded=!1,mapUtilityService.hideAllMarkers(),_.each(mapUtilityService.localMarkers,function(marker){marker.setVisible(!1)}),_.each(mapUtilityService.interestMarkers,function(marker){marker.setVisible(!1)}),$scope.handleInterestFilter($scope.interestsSelected)}),$scope.$on("interestResultsCleared",function(event,mass){mapUtilityService.hideAllMarkers(),mapUtilityService.handleZoomChanged(),mapUtilityService.resetInterestMarkers(),mapUtilityService.localMarkers.length>0?$scope.updateSidebar(mapUtilityService.localMarkers,!1):$scope.$broadcast("mapZoomedOut")}),$scope.handleInterestFilter=function(interestString){if(mapUtilityService.interestMarkers=[],$scope.map.zoom<12)if(""===interestString)mapUtilityService.showRegionalMarkers(),$scope.updateSidebar([],!0),$scope.$broadcast("sidebarDataUnloaded");else{var lParamString="&packedargs=interests="+interestString;$scope.getHotelMapResults(lParamString).then(function(result){if(result.data.hotelFixtures){_.each(result.data.hotelFixtures,function(pFixture,index){result.data.hotelsBookingFixture[pFixture.hotelCode]&&(pFixture.lat=result.data.hotelsBookingFixture[pFixture.hotelCode].lat,pFixture.lng=result.data.hotelsBookingFixture[pFixture.hotelCode].lng,pFixture.bookingFixture=result.data.hotelsBookingFixture[pFixture.hotelCode])});var interestMarkers=mapUtilityService.createInterestMarkers(result.data.hotelFixtures,null,!1,interestString,!1);$scope.updateAllMarkers(interestMarkers)}else $scope.updateSidebar([],!0)})}else{var interestMarkers=mapUtilityService.createInterestMarkers(mapUtilityService.localMarkers,null,!0,interestString,!1);$scope.updateAllMarkers(interestMarkers)}$scope.disableMap=!1},$scope.updateAllMarkers=function(interestMarkers){$scope.updateSidebar(interestMarkers,!0),mapUtilityService.showInterestMarkers()},$scope.updateSidebar=function(markersWithData,isInterestSearch){$scope.originalSidebarData=markersWithData,$scope.sidebarData=markersWithData,$scope.$broadcast("sidebarDataLoaded"),isInterestSearch&&mapUtilityService.interestMarkers.length>3?($scope.$broadcast("interestResultsLoaded"),$scope.isWideDisplay=!0,$scope.isNarrowDisplay=!1):isInterestSearch&&($scope.isWideDisplay=!1,$scope.isNarrowDisplay=!0),$scope.markersLoaded=!0,$scope.isInterestSearch=!1},$scope.enableMap=function(){$scope.disableMap=!$scope.$parent.disableMap,$scope.$broadcast("interestMapEnabled")};var init=function(){$timeout($scope.getBootstrapData,1e3)};init(),$scope.hashDataLoaded=!1,$scope.extractMapUrl=function(url){if(url){var interests,interestString,hashUrl=decodeURIComponent(url),hashObject={};if(hashUrl.indexOf("bounds")!==-1&&hashUrl.indexOf("interest")!==-1){var hashArray=hashUrl.split("#/");$(hashArray).each(function(index,el){if(el.indexOf("bounds")!==-1)hashValues=el.split("|"),hashObject={},$(hashValues).each(function(index,el){el.indexOf("bounds")!==-1?hashObject.bounds=el.split("=")[1]:el.indexOf("center")!==-1?hashObject.center=el.split("=")[1]:el.indexOf("zoom")!==-1&&(hashObject.zoom=el.split("=")[1])});else if(el.indexOf("interest")!==-1){interests=el.replace("interest=","").split(","),interestString="";for(var i=0;i<interests.length;i++){var interestObject=interests[i];interestString+=interestObject+","}interestString=interestString.replace(/,$/,"")}}),hashObject&&$scope.fetchLocalMarkers(hashObject),$scope.$on("mapLoadedWithLocations",function(){$scope.hashDataLoaded=!0,$scope.$emit("interestedLoaded",interests)})}else if(hashUrl.indexOf("interest")!==-1){interests=hashUrl.split("interest=")[1].split(","),interestString="";for(var i=0;i<interests.length;i++){var interestObject=interests[i];interestString+=interestObject+","}interestString=interestString.replace(/,$/,""),$scope.$on("mapDirectiveLoaded",function(){$scope.hashDataLoaded=!0,$scope.$emit("interestedLoaded",interests)})}else if(hashUrl.indexOf("bounds")!==-1){var hashValues=hashUrl.split("|"),hashObject={};$(hashValues).each(function(index,el){el.indexOf("bounds")!==-1?hashObject.bounds=el.split("=")[1]:el.indexOf("center")!==-1?hashObject.center=el.split("=")[1]:el.indexOf("zoom")!==-1&&(hashObject.zoom=el.split("=")[1])}),hashObject&&$scope.fetchLocalMarkers(hashObject)}}},$scope.extractMapUrl(window.location.hash)}]),angular.module("radBlu").directive("crExploreHotelsMap",["mapUtilityService",function(mapUtilityService){"use strict";return{restrict:"EA",link:function($scope,$el,$attrs){loadGoogleMapsApi(function(){mapUtilityService.initializeValues($el.get(0)),$scope.map=new google.maps.Map($el.get(0),mapUtilityService.mapOptions),mapUtilityService.map=$scope.map;var boundsFixListener=google.maps.event.addDomListener($scope.map,"idle",function(){mapUtilityService.checkBounds(),google.maps.event.trigger($scope.map,"resize");var newCenter=new google.maps.LatLng(10,2);$scope.map.setCenter(newCenter),mapUtilityService.$mapElement.find(".gm-style").get(0).style.top="-50px",google.maps.event.removeListener(boundsFixListener)})}),$scope.$broadcast("mapDirectiveLoaded")}}}]),angular.module("radBlu.floorplans").directive("crFloorplan",["$compile",function($compile){return{controller:["$scope","$http","$browser","$route","$location","$rootScope","$sce",function($scope,$http,$browser,$route,$location,$rootScope,$sce){function resetAngularListeners(newPath,fullUrl){fullUrl?$location.$$absUrl=window.location.href.replace(window.location.pathname+window.location.hash,newPath):$location.$$absUrl=window.location.href.replace(window.location.hash,"#"+newPath),$rootScope.$on("$locationChangeSuccess",function(event){$location.$$absUrl=window.location.href}),$rootScope.$on("$locationChangeStart",function(event){$location.$$absUrl=window.location.href})}$scope.fpTitle="",$scope.fpIntro="",$scope.fpDescription="",$scope.menuInstructions="",$scope.floorplans=[],$scope.floorplanTabs=[],$scope.floorplansFullyDone=!1,$scope.numberFloorplansLoaded=0,$scope.currentTab=-1,$scope.absLoc=window.location.href,$scope.markLoaded=function(){$scope.numberFloorplansLoaded++,$scope.floorplans&&$scope.numberFloorplansLoaded===$scope.floorplans.length&&($scope.floorplansFullyDone=!0,$scope.$broadcast("floorplansFullyLoaded"))},$scope.loadFloorplanFromDom=function(){$scope.floorplans=[],$scope.numberFloorplansLoaded=0,$scope.fpTitle=$sce.trustAsHtml(jQuery("#floorplan-top h2").first().html()),$scope.fpIntro=$sce.trustAsHtml(jQuery("#floorplan-top .intro").first().html()),$scope.fpDescription=$sce.trustAsHtml(jQuery("#floorplan-top .description").first().html()),jQuery("#data-floorplans").find(".floorplan").each(function(index){var _this=this,fp={};fp.id="fp"+index,fp.imgSrc=jQuery(_this).attr("data-zoomImg"),fp.imgAlt=jQuery(_this).find("img").first().attr("alt"),fp.imgWidth=jQuery(_this).find("img").first().attr("width"),fp.imgHeight=jQuery(_this).find("img").first().attr("height"),fp.imgSmall=jQuery(_this).find("img").first().attr("src"),fp.floorplanName=jQuery(_this).find("h2").first().html();var rooms=[];jQuery(_this).find(".rooms table.floorplanTable").size()>0?fp.fpTable=$sce.trustAsHtml(jQuery(_this).find(".rooms table.floorplanTable").clone().wrap("<p>").parent().html()):jQuery(_this).find(".rooms>div").each(function(index2){var room={};room.id="room"+index2,room.title=jQuery(this).find("h3").first().html(),room.number=index2+1,room.description=jQuery(this).find(".txt").html(),room.imgSrc=jQuery(this).find(".img img").attr("src"),room.imgAlt=jQuery(this).find(".img img").attr("alt"),room.landmarkX=jQuery(this).attr("data-x"),room.landmarkY=jQuery(this).attr("data-y"),room.room_m2=jQuery(this).attr("data-m2"),room.room_height=jQuery(this).attr("data-height"),room.room_width=jQuery(this).attr("data-width"),room.room_length=jQuery(this).attr("data-length"),room.tableContent=jQuery(this).find("table").html(),room.seating=jQuery(this).attr("data-seating").split(","),rooms.push(room)}),fp.rooms=rooms,0==fp.rooms.length?$scope.menuInstructions=jQuery("#data-floorplans").find("#instructions-simple").first().html():$scope.menuInstructions=jQuery("#data-floorplans").find("#instructions").first().html(),$scope.floorplans.push(fp)})},$scope.updateURL=function(url){
if(window.history.pushState){var newPath=url+window.location.search;window.location.hash&&url!==window.location.hash.replace("#","")&&(newPath+=window.location.hash),window.history.pushState("",document.title,newPath),resetAngularListeners(newPath,!0)}else window.location.hash=url,resetAngularListeners(newPath,!1)},$scope.prepareTabs=function(){$scope.currentTab=0;var tabFromPath=-1,tabFromHash=-1,pathName=window.location.pathname;jQuery(".floorplan-wrapper .nav-tabs").find("li").each(function(index){var item={};jQuery(this).find("a").each(function(){jQuery(this).click(function(e){e.preventDefault()}),item.tabUrl=jQuery(this).attr("href")}),"undefined"!=typeof item.tabUrl&&""!=item.tabUrl||(item.tabUrl=pathName),item.jsonUrl=jQuery(this).attr("data-json"),item.active=!1,pathName===item.tabUrl&&(tabFromPath=index),$scope.floorplanTabs.push(item)});var hashTag=window.location.hash.replace("#","");hashTag&&hashTag.length>0&&angular.forEach($scope.floorplanTabs,function(value,index){if(value.tabUrl===hashTag)return void(tabFromHash=index)}),tabFromHash>=0?($scope.currentTab=tabFromHash,$scope.floorplanTabs[tabFromHash].active=!0,tabFromHash!==tabFromPath?($scope.updateURL($scope.floorplanTabs[tabFromHash].tabUrl),$scope.loadFloorplanFromAjax($scope.floorplanTabs[tabFromHash].jsonUrl)):$scope.loadFloorplanFromDom()):tabFromPath>=0?($scope.currentTab=tabFromPath,$scope.floorplanTabs[tabFromPath].active=!0,$scope.loadFloorplanFromDom()):($scope.floorplanTabs[$scope.currentTab].active=!0,$scope.loadFloorplanFromDom(),$scope.updateURL($scope.floorplanTabs[$scope.currentTab].tabUrl))},$scope.changeTab=function(tab){if($scope.currentTab!==tab){var location=$scope.floorplanTabs[tab].jsonUrl;angular.forEach($scope.floorplanTabs,function(value,index){value.active=!1}),$scope.floorplanTabs[tab].active=!0,$scope.currentTab=tab,$scope.updateURL($scope.floorplanTabs[tab].tabUrl),$scope.$broadcast("$destroyFpMarquee"),$scope.loadFloorplanFromAjax(location)}},$scope.loadFloorplanFromAjax=function(location){$scope.floorplans=[],$scope.floorplansFullyDone=!1,$scope.numberFloorplansLoaded=0,$scope.fpTitle="",$scope.fpIntro="",$scope.fpDescription="",$http.get(location).then(function(res){$scope.fpTitle=$sce.trustAsHtml(res.data.title),$scope.fpIntro=$sce.trustAsHtml(res.data.intro),$scope.fpDescription=$sce.trustAsHtml(res.data.description),$scope.floorplans=res.data.floorplans,window.floorplans=$scope.floorplans,$scope.doneLoading=!0},function(msg){window.err=msg})}}],link:function(scope,iElement,iAttrs,ctrl){scope.prepareTabs()}}}]),angular.module("radBlu.floorplans").directive("floorplanTop",function(){return{restrict:"E"}}),angular.module("radBlu.floorplanfane").directive("floorplanFane",["$compile","$window",function($compile,$window){return{scope:!0,controller:["$scope","$http",function($scope,$http){$scope.pinCircleActive=[],$scope.oldContainer="",$scope.initialRatio="",$scope.active=!0,$scope.floorplanInfobox="",$scope.showFloorplanInfobox=!1,$scope.readyFloorplan=function(){$scope.fp!={}&&(angular.forEach($scope.fp.rooms,function(value,index){$scope.pinCircleActive[index]=!1}),$scope.$broadcast("paneLoaded"))},$scope.showPlan=function(){function onZoomComplete(zoomData){$scope.markLoaded(),setup?($scope.initialRatio=zoomData.ratio,setup=!1):zoomData.ratio==$scope.initialRatio&&jQuery($scope.oldContainer).smoothZoom("reset"),onInitialZoom&firstZoom&&(onInitialZoom=!1,$scope.active=!0,preloadImage($scope.fp.imgSrc,function(){$scope.active&&refreshImage($scope.fp.imgSrc)})),firstZoom=!0}function preloadImage(imgSrc,callback){var imgEl=document.createElement("img");imgEl.onreadystatechange=function(){"complete"!=this.readyState&&"loaded"!=this.readyState||callback()},imgEl.src=imgSrc,jQuery(imgEl).load(callback)}function refreshImage(imgSrc){var cache=jQuery("#"+$scope.fp.id+" #zoom_container img").attr("style");jQuery("#"+$scope.fp.id+" #zoom_container img").attr("src",imgSrc),jQuery("#"+$scope.fp.id+" #zoom_container img").attr("style",""),jQuery("#"+$scope.fp.id+" #zoom_container img").attr("style",cache)}jQuery("#"+$scope.fp.id+" #planImage").smoothZoom({image_original_width:$scope.fp.imgWidth,image_original_height:$scope.fp.imgHeight,width:"100%",min_WIDTH:$scope.floorPlanMinWidth,max_WIDTH:$scope.floorPlanMaxWidth,height:490,background_COLOR:"#ffffff",pan_BUTTONS_SHOW:"NO",pan_LIMIT_BOUNDARY:!0,zoom_BUTTONS_SHOW:!1,zoom_MAX:130,border_TRANSPARENCY:20,animation_SPEED_PAN:0,animation_SMOOTHNESS:1,on_ZOOM_PAN_COMPLETE:onZoomComplete,container:"zoom_container_"+$scope.fp.id,responsive:!0}),$scope.oldContainer="#"+$scope.fp.id+" #planImage";var onInitialZoom=!0,firstZoom=!1,setup=!0;jQuery("#"+$scope.fp.id+" #mapContainer #zoomIn").click(function(){jQuery($scope.oldContainer).smoothZoom("zoomIn")}),jQuery("#"+$scope.fp.id+" #mapContainer #zoomOut").click(function(){jQuery($scope.oldContainer).smoothZoom("zoomOut")}),jQuery&&(jQuery("#"+$scope.fp.id+" #mapContainer #download").off("click"),jQuery("#"+$scope.fp.id+" #mapContainer #download").on("click",function(){var attachmentInstructions="&blobheadername1=Content-Type&blobheadervalue1=image%2Fjpeg&blobheadername2=Content-disposition&blobheadervalue2=attachment%3Bfilename%3Dfloorplan.jpg";window.location=jQuery($scope.oldContainer)[0].src+attachmentInstructions})),refreshImage($scope.fp.imgSrc),jQuery(".floorplan-wrapper .marquee").css({"min-height":jQuery(".floorplan-fane").first().height(),height:jQuery(".floorplan-fane").first().height()})},$scope.showInfoBox=function(room){$scope.floorplanInfobox=room,$scope.scrollToInfobox(),$("#wrap").hasClass("mobile")&&(jQuery(".floorplan-wrapper .marquee .cycle-prev").css("display","none"),jQuery(".floorplan-wrapper .marquee .cycle-next").css("display","none"))},$scope.closeInfoBox=function(){$scope.floorplanInfobox="",$("#wrap").hasClass("mobile")&&"none"==jQuery(".floorplan-wrapper .marquee .cycle-prev").css("display")&&"none"==jQuery(".floorplan-wrapper .marquee .cycle-next").css("display")&&(jQuery(".floorplan-wrapper .marquee .cycle-prev").css("display","block"),jQuery(".floorplan-wrapper .marquee .cycle-next").css("display","block"))},$scope.getRooms=function(){return $scope.fp.rooms}}],link:function(scope,iElement,iAttrs,ctrl){scope.fp!==scope.floorplans[0]&&iElement.addClass("hidden"),scope.$watch("floorplans",function(){scope.floorplans&&scope.floorplans!=[]&&scope.readyFloorplan()});var readyMarquee=function(){var maxHeight=0,count=0;jQuery(".floorplan-wrapper").find(".floorplan-fane").each(function(index){count++,maxHeight<jQuery(this).height()&&(maxHeight=jQuery(this).height())}),jQuery(".floorplan-wrapper .marquee").css({"min-height":maxHeight,height:maxHeight,"max-height":maxHeight}),iElement.removeClass("hidden").css("display",""),jQuery(".floorplan-wrapper .marquee").addClass("single-slide"),count>1&&jQuery(".floorplan-wrapper .marquee").removeClass("single-slide"),jQuery(".floorplan-wrapper .marquee").css("background-image","none"),scope.marqueePrev()};scope.$on("marqueeReady",readyMarquee),scope.onResize=function(){var floorplan=jQuery(".floorplan-wrapper");console.log(scope.floorPlanMargin()),floorplan.css("width",$window.innerWidth-scope.floorPlanMargin()),scope.$digest()},(scope.isMobile||scope.isTablet)&&angular.element($window).bind("resize",scope.onResize)}}}]),angular.module("radBlu.floorplanfane").directive("landmarks",["$compile",function($compile){return{restrict:"C",require:"^floorplanFane",link:function(scope,element,attrs){scope.$on("paneLoaded",function(){var rooms=scope.getRooms();angular.forEach(rooms,function(value,index){var toAdd=angular.element('<div class="item mark" data-position="'+value.landmarkX+","+value.landmarkY+'" data-show-at-zoom="0" ><div>\t<div class="pinCircle" ng-class="{\'pinCircleActive\':pinCircleActive['+index+']}" id="fplm'+value.number+'" ng-click="showInfoBox(fp.rooms['+index+'])" ng-mouseover="pinCircleActive['+index+']=true" ng-mouseout="pinCircleActive['+index+']=false"><span>'+value.number+"</span></div></div></div>");element.append(toAdd),$compile(toAdd)(scope)}),scope.showPlan()})}}}]),angular.module("radBlu.floorplans").directive("fpMarquee",["$window",function($window){"use strict";return{scope:!0,restrict:"A",controller:["$scope","$element",function($scope,$element){$scope.isMobile=jQuery(document).find("div.container").hasClass("mobile"),$scope.isTablet=jQuery(document).find("div.container").hasClass("tablet")||jQuery(document).find("div.container").hasClass("tabletportrait"),$scope.floorPlanMaxWidth=$scope.isMobile?($window.innerWidth<$window.innerHeight?$window.innerHeight:$window.innerWidth)-32:978,$scope.floorPlanMinWidth=$scope.isMobile||$scope.isTablet?($window.innerWidth>$window.innerHeight?$window.innerHeight:$window.innerWidth)-32:978,$scope.floorPlanMargin=function(){var isLandscape=jQuery("div.container").hasClass("landscape");return isLandscape&&$scope.isTablet?60:32},console.log("max:"+$scope.floorPlanMaxWidth+",min:"+$scope.floorPlanMinWidth),$scope.scrollToInfobox=function(){($scope.isMobile||$scope.isTablet)&&jQuery(window).scrollTop(jQuery(".floorplan-wrapper .marquee").offset().top-150)},$scope.marqueePrev=function(){$element.cycle("next")},$scope.marqueeNext=function(){$element.cycle("prev")},$scope.initMarquee=function(){var cycleOptions={fx:"scrollHorz",speed:"slow",timeout:8e3,slides:"> div.marquee-slide",loop:0,log:!1,loader:"wait"};$element.find(".marquee-slide").length<2?($element.addClass("single-slide"),cycleOptions.timeout=0):$element.removeClass("single-slide"),$element.cycle(cycleOptions),$scope.$on("cr-uiEvent-secondaryNavUnstuck",function(){$scope.marqueePrev()}),$scope.$on("$destroyFpMarquee",function(){jQuery(".floorplan-wrapper .marquee .cycle-prev").addClass("hidden"),jQuery(".floorplan-wrapper .marquee .cycle-next").addClass("hidden"),$element.cycle("destroy")}),$window.makeImagesResponsive()}}],link:function(scope,el){scope.$on("floorplansFullyLoaded",function(){scope.initMarquee(),scope.$broadcast("marqueeReady")})}}}]),function($,window,document){function Zoomer($elem,params){var self=this;this.$elem=$elem;var op=$.extend({},defaults,params);if(this.sW=op.width,this.sH=op.height,this.init_zoom=op.initial_ZOOM/100,this.init_pos=op.initial_POSITION.replace(/,/g," ").replace(/\s{2,}/g," ").split(" "),this.zoom_max=op.zoom_MAX/100,this.zoom_min=op.zoom_MIN/100,this.zoom_single=checkBoolean(op.zoom_SINGLE_STEP),this.zoom_fit=checkBoolean(op.zoom_OUT_TO_FIT),this.zoom_speed=1+((0===op.animation_SPEED||op.animation_SPEED?op.animation_SPEED:op.animation_SPEED_ZOOM)+1)/20,this.zoom_show=checkBoolean(op.zoom_BUTTONS_SHOW),this.pan_speed_o=0===op.animation_SPEED||op.animation_SPEED?op.animation_SPEED:op.animation_SPEED_PAN,this.pan_show=checkBoolean(op.pan_BUTTONS_SHOW),this.pan_limit=checkBoolean(op.pan_LIMIT_BOUNDARY),this.pan_rev=checkBoolean(op.pan_REVERSE),this.reset_align=op.reset_ALIGN_TO.toLowerCase().split(" "),supportsTouch?this.bu_size=2*parseInt(op.button_SIZE_TOUCH_DEVICE/2):this.bu_size=2*parseInt(op.button_SIZE/2),this.bu_color=op.button_COLOR,this.bu_bg=op.button_BG_COLOR,this.bu_bg_alpha=op.button_BG_TRANSPARENCY/100,this.bu_icon=op.button_ICON_IMAGE,this.bu_auto=checkBoolean(op.button_AUTO_HIDE),this.bu_delay=1e3*op.button_AUTO_HIDE_DELAY,this.bu_align=op.button_ALIGN.toLowerCase().split(" "),this.bu_margin=op.button_MARGIN,this.bu_round=checkBoolean(op.button_ROUND_CORNERS),this.touch_drag=checkBoolean(op.touch_DRAG),this.mouse_drag=checkBoolean(op.mouse_DRAG),this.mouse_wheel=checkBoolean(op.mouse_WHEEL),this.mouse_wheel_cur=checkBoolean(op.mouse_WHEEL_CURSOR_POS),this.mouse_dbl_click=checkBoolean(op.mouse_DOUBLE_CLICK),this.ani_smooth=Math.max(1,(op.animation_SMOOTHNESS+1)/1.45),this.bg_color=op.background_COLOR,this.bord_size=op.border_SIZE,this.bord_color=op.border_COLOR,this.bord_alpha=op.border_TRANSPARENCY/100,this.container=op.container,this.image_url=op.image_url,this.image_width=op.image_original_width,this.image_height=op.image_original_height,this.responsive=checkBoolean(op.responsive),this.maintain_ratio=checkBoolean(op.responsive_maintain_ratio),this.w_max=op.max_WIDTH,this.h_max=op.max_HEIGHT,this.onLOAD=op.on_IMAGE_LOAD,this.onUPDATE=op.on_ZOOM_PAN_UPDATE,this.onZOOM_PAN=op.on_ZOOM_PAN_COMPLETE,this.onLANDMARK=op.on_LANDMARK_STATE_CHANGE,this._x,this._y,this._w,this._h,this._sc=0,this.rF=1,this.rA=1,this.iW=0,this.iH=0,this.tX=0,this.tY=0,this.oX=0,this.oY=0,this.fX=0,this.fY=0,this.dX=0,this.dY=0,this.cX=0,this.cY=0,this.transOffX=0,this.transOffY=0,this.focusOffX=0,this.focusOffY=0,this.offX=0,this.offY=0,this._playing=!1,this._dragging=!1,this._onfocus=!1,this._moveCursor=!1,this._wheel=!1,this._recent="zoomOut",this._pinching=!1,this._landmark=!1,this._rA,this._centx,this._centy,this._onButton=!1,this._onHitArea=!1,this.cFlag={_zi:!1,_zo:!1,_ml:!1,_mr:!1,_mu:!1,_md:!1,_rs:!1,_nd:!1},this.$holder,this.$hitArea,this.$controls,this.$loc_cont,this.map_coordinates=[],this.locations=[],this.buttons=[],this.border=[],this.buttons_total=7,this.cButtId=0,this.pan_speed,this.auto_timer,this.ani_timer,this.ani_end,this.focusSpeed=this.reduction=.5,this.orig_style,this.mapAreas,this.icons,this.show_at_zoom,this.assetsLoaded=!1,this.zStep=0,this.sRed=300,this.use3D=op.use_3D_Transform&&supportsTrans3D,supportsTouch?(this.event_down="touchstart.sz",this.event_up="touchend.sz",this.event_move="touchmove.sz"):(this.event_down="mousedown.sz",this.event_up="mouseup.sz",this.event_move="mousemove.sz"),""==this.image_url)this.$image=$elem,this.id=this.$image.attr("id");else{var img=new Image;this.image_width&&(img.width=this.image_width),this.image_height&&(img.height=this.image_height),img.src=this.image_url,this.$image=$(img).appendTo($elem)}this.setContainer();var testOb;if(!this.bu_icon){var regx=/url\(["']?([^'")]+)['"]?\)/;testOb=$('<div class="smooth_zoom_icons"></div>'),this.$holder.append(testOb),this.bu_icon=testOb.css("background-image").replace(regx,"$1"),"none"==this.bu_icon&&(this.bu_icon="zoom_assets/icons.png"),testOb.remove()}this.$image.css("-moz-transform")&&prop_transform?(testOb=$('<div style="-moz-transform: translate(1px, 1px)"></div>'),this.$holder.append(testOb),this.fixMoz=1!==testOb.position().left,testOb.remove()):this.fixMoz=!1,this.$image.hide(),this.imgList=[{loaded:!1,src:this.bu_icon||"zoom_assets/icons.png"},{loaded:!1,src:""==this.image_url?this.$image.attr("src"):this.image_url}],$.each(this.imgList,function(i){var _img=new Image;$(_img).bind("load",{id:i,self:self},self.loadComplete).bind("error",{id:i,self:self},self.loadComplete),_img.src=self.imgList[i].src})}function checkBoolean(_var){return _var===!0||!(!_var||(_var=_var.toLowerCase(),"yes"!=_var&&"true"!=_var))}var defaults={width:"",height:"",initial_ZOOM:"",initial_POSITION:"",animation_SMOOTHNESS:5.5,animation_SPEED_ZOOM:5.5,animation_SPEED_PAN:5.5,zoom_MAX:800,zoom_MIN:"",zoom_SINGLE_STEP:!1,zoom_OUT_TO_FIT:!0,zoom_BUTTONS_SHOW:!0,pan_BUTTONS_SHOW:!0,pan_LIMIT_BOUNDARY:!0,pan_REVERSE:!1,reset_ALIGN_TO:"center center",button_SIZE:18,button_SIZE_TOUCH_DEVICE:30,button_COLOR:"#FFFFFF",button_BG_COLOR:"#000000",button_BG_TRANSPARENCY:55,button_AUTO_HIDE:!1,button_AUTO_HIDE_DELAY:1,button_ALIGN:"bottom right",button_MARGIN:10,button_ROUND_CORNERS:!0,touch_DRAG:!0,mouse_DRAG:!0,mouse_WHEEL:!0,mouse_WHEEL_CURSOR_POS:!0,mouse_DOUBLE_CLICK:!0,background_COLOR:"#FFFFFF",border_SIZE:1,border_COLOR:"#000000",border_TRANSPARENCY:10,image_url:"",image_original_width:"",image_original_height:"",container:"",on_IMAGE_LOAD:"",on_ZOOM_PAN_UPDATE:"",on_ZOOM_PAN_COMPLETE:"",on_LANDMARK_STATE_CHANGE:"",use_3D_Transform:!0,responsive:!1,responsive_maintain_ratio:!0,max_WIDTH:"",max_HEIGHT:""};Zoomer.prototype={loadComplete:function(e){var self=e.data.self,complete=!0;self.imgList[e.data.id].loaded=!0;for(var j=0;j<self.imgList.length;j++)self.imgList[j].loaded||(complete=!1);complete&&(self.assetsLoaded=!0,""!==self.onLOAD&&self.onLOAD(),self.init())},init:function(){var cBW,cBH,self=this,$image=self.$image,sW=self.sW,sH=self.sH,pan_show=(self.container,self.pan_show),zoom_show=self.zoom_show,$controls=self.$controls,buttons=self.buttons,cFlag=self.cFlag,bu_align=self.bu_align,bu_margin=self.bu_margin,$holder=self.$holder;self.orig_style=self.getStyle(),$image.attr("galleryimg","no"),!navigator.userAgent.toLowerCase().match(/(iphone|ipod|ipad)/);for(var temp=$image,dispArray=[],i=0;i<5&&(temp&&"BODY"!==temp[0].tagName&&"HTML"!==temp[0].tagName);i++)"none"==temp.css("display")&&(temp.css("display","block"),dispArray.push(temp)),temp=temp.parent();self.iW=$image.width(),self.iH=$image.height();for(var i=0;i<dispArray.length;i++)dispArray[i].css("display","none");self.rF=self.checkRatio(sW,sH,self.iW,self.iH,self.zoom_fit),0==self.zoom_min||0!=self.init_zoom?(""!=self.init_zoom?self.rA=self._sc=self.init_zoom:self.rA=self._sc=self.rF,0==self.zoom_min?self.rF=self.rA:self.rF=self.zoom_min):self.rA=self._sc=self.rF=self.zoom_min,self._w=self._sc*self.iW,self._h=self._sc*self.iH,""==self.init_pos?(self._x=self.tX=(sW-self._w)/2,self._y=self.tY=(sH-self._h)/2):(self._x=self.tX=sW/2-parseInt(self.init_pos[0])*self._sc,self._y=self.tY=sH/2-parseInt(self.init_pos[1])*self._sc,self.oX=(self.tX-(sW-self._w)/2)/(self._w/sW),self.oY=(self.tY-(sH-self._h)/2)/(self._h/sH)),self.pan_limit&&!self._moveCursor&&self.init_zoom==self.rF||!self.mouse_drag||($image.css("cursor","move"),self.$hitArea.css("cursor","move")),$.browser.mozilla&&supportsTrans3D&&$image.css("opacity",0),prop_transform&&self.$image.css(prop_origin,"0 0"),self.use3D&&$image.css({"-webkit-backface-visibility":"hidden","-webkit-perspective":1e3}),$image.css({position:"absolute","z-index":supportsTouch?1:2,left:"0px",top:"0px","-webkit-box-shadow":"1px 1px rgba(0,0,0,0)"}).hide().fadeIn(500,function(){$holder.css("background-image","none"),$.browser.mozilla&&supportsTrans3D&&$image.css("opacity",1)}),supportsTouch&&$image.bind(self.event_down,function(e){e.preventDefault()});var self=self,bs=self.bu_size,iSize=50,sDiff=2,bSpace=3,mSize=Math.ceil(self.bu_size/4),iconOff=bs<16?50:0,bsDiff=bs-sDiff;pan_show?(cBW=zoom_show?parseInt(bs+.85*bs+3*bsDiff+2*bSpace+2*mSize):parseInt(3*bsDiff+2*bSpace+2*mSize),cBH=parseInt(3*bsDiff+2*bSpace+2*mSize)):zoom_show?(cBW=parseInt(bs+2*mSize),cBH=parseInt(2*bs+3*mSize),cBW=2*parseInt(cBW/2),cBH=2*parseInt(cBH/2)):(cBW=0,cBH=0);var hProp,vProp,hVal,vVal,pOff=(iSize-bs)/2,resetCenterX=cBW-2*(bs-(pan_show?sDiff:0))-mSize-bSpace,resetCenterY=cBH/2-(bs-(pan_show?sDiff:0))/2;"top"==bu_align[0]?(vProp="top",vVal=bu_margin):"center"==bu_align[0]?(vProp="top",vVal=parseInt((sH-cBH)/2)):(vProp="bottom",vVal=bu_margin),"right"==bu_align[1]?(hProp="right",hVal=bu_margin):"center"==bu_align[1]?(hProp="right",hVal=parseInt((sW-cBW)/2)):(hProp="left",hVal=bu_margin),$controls=$('<div style="position: absolute; '+hProp+":"+hVal+"px; "+vProp+": "+vVal+"px; width: "+cBW+"px; height: "+cBH+'px; z-index: 20;" class="noSel;">\t\t\t\t\t<div class="noSel controlsBg" style="position: relative; width: 100%; height: 100%; z-index: 1;">\t\t\t\t\t</div>\t\t\t\t</div>'),$holder.append($controls);var $controlsBg=$controls.find(".controlsBg");self.bu_round?prop_radius?$controlsBg.css(prop_radius,(iconOff>0?4:5)+"px").css("background-color",self.bu_bg):self.roundBG($controlsBg,"cBg",cBW,cBH,iconOff>0?4:5,375,self.bu_bg,self.bu_icon,1,iconOff?50:0):$controlsBg.css("background-color",self.bu_bg),$controlsBg.css("opacity",self.bu_bg_alpha),buttons[0]={_var:"_zi",l:mSize,t:pan_show?(cBH-2*bs-2*bSpace+2)/2:mSize,w:bs,h:bs,bx:-pOff,by:-pOff-iconOff},buttons[1]={_var:"_zo",l:mSize,t:pan_show?(cBH-2*bs-2*bSpace+2)/2+bs+2*bSpace-2:cBH-bs-mSize,w:bs,h:bs,bx:-iSize-pOff,by:-pOff-iconOff},buttons[2]={_var:self.pan_rev?"_ml":"_mr",l:resetCenterX-bsDiff-bSpace,t:resetCenterY,w:bsDiff,h:bsDiff,bx:-(sDiff/2)-2*iSize-pOff,by:-(sDiff/2)-pOff-iconOff},buttons[3]={_var:self.pan_rev?"_mr":"_ml",l:resetCenterX+bsDiff+bSpace,t:resetCenterY,w:bsDiff,h:bsDiff,bx:-(sDiff/2)-3*iSize-pOff,by:-(sDiff/2)-pOff-iconOff},buttons[4]={_var:self.pan_rev?"_md":"_mu",l:resetCenterX,t:resetCenterY+bsDiff+bSpace,w:bsDiff,h:bsDiff,bx:-(sDiff/2)-4*iSize-pOff,by:-(sDiff/2)-pOff-iconOff},buttons[5]={_var:self.pan_rev?"_mu":"_md",l:resetCenterX,t:resetCenterY-bsDiff-bSpace,w:bsDiff,h:bsDiff,bx:-(sDiff/2)-5*iSize-pOff,by:-(sDiff/2)-pOff-iconOff},buttons[6]={_var:"_rs",l:resetCenterX,t:resetCenterY,w:bsDiff,h:bsDiff,bx:-(sDiff/2)-6*iSize-pOff,by:-(sDiff/2)-pOff-iconOff};for(var i=0;i<7;i++){buttons[i].$ob=$('<div style="position: absolute; display: '+(i<2?zoom_show?"block":"none":pan_show?"block":"none")+"; left: "+(buttons[i].l-1)+"px; top: "+(buttons[i].t-1)+"px; width: "+(buttons[i].w+2)+"px; height: "+(buttons[i].h+2)+"px; z-index:"+(i+1)+';" class="noSel">\t\t\t\t\t\t</div>').css("opacity",.7).bind((supportsTouch?"":"mouseover.sz mouseout.sz ")+self.event_down,{id:i},function(e){self._onfocus=!1,$this=$(this),"mouseover"==e.type?$this.css("opacity")>.5&&$this.css("opacity",1):"mouseout"==e.type?$this.css("opacity")>.5&&$this.css("opacity",.7):"mousedown"!=e.type&&"touchstart"!=e.type||(self.cButtId=e.data.id,self._onButton=!0,self._wheel=!1,$this.css("opacity")>.5&&($this.css("opacity",1),$holder.find("#"+buttons[self.cButtId]._var+"norm").hide(),$holder.find("#"+buttons[self.cButtId]._var+"over").show(),self.cButtId<=1&&self.zoom_single?cFlag[buttons[self.cButtId]._var]||(self.sRed=300,cFlag[buttons[self.cButtId]._var]=!0):self.cButtId<6?cFlag[buttons[self.cButtId]._var]=!0:(cFlag._rs=!0,self.rA=self.rF,"top"==self.reset_align[0]?self.fY=self.sH/2*(self.rA/2):"bottom"==self.reset_align[0]?self.fY=-(self.sH/2)*(self.rA/2):self.fY=0,"left"==self.reset_align[1]?self.fX=self.sW/2*(self.rA/2):"right"==self.reset_align[1]?self.fX=-(self.sW/2)*(self.rA/2):self.fX=0),self.focusOffX=self.focusOffY=0,self.changeOffset(!0,!0),self._playing||self.Animate()),e.preventDefault(),e.stopPropagation())});var tpm=$('<div id="'+buttons[i]._var+'norm" style="position: absolute; left: 1px; top: 1px; width: '+buttons[i].w+"px; height: "+buttons[i].h+"px; "+(prop_radius||!self.bu_round?"background:"+self.bu_color:"")+'">\t\t\t\t\t</div>'),tpmo=$('<div id="'+buttons[i]._var+'over" style="position: absolute; left: 0px; top: 0px; width: '+(buttons[i].w+2)+"px; height: "+(buttons[i].h+2)+"px; display: none; "+(prop_radius||!self.bu_round?"background:"+self.bu_color:"")+'">\t\t\t\t\t</div>'),cont=$('<div id="'+buttons[i]._var+'_icon" style="position: absolute; left: 1px; top: 1px; width: '+buttons[i].w+"px; height: "+buttons[i].h+"px; background: transparent url("+self.bu_icon+") "+buttons[i].bx+"px "+buttons[i].by+'px no-repeat;" >\t\t\t\t\t</div>');buttons[i].$ob.append(tpm,tpmo,cont),$controls.append(buttons[i].$ob),self.bu_round&&(prop_radius?(tpm.css(prop_radius,"2px"),tpmo.css(prop_radius,"2px")):(self.roundBG(tpm,buttons[i]._var+"norm",buttons[i].w,buttons[i].h,2,425,self.bu_color,self.bu_icon,i+1,iconOff?50:0),self.roundBG(tpmo,buttons[i]._var+"over",buttons[i].w+2,buttons[i].h+2,2,425,self.bu_color,self.bu_icon,i+1,iconOff?50:0)))}if($(document).bind(self.event_up+self.id,{self:self},self.mouseUp),(self.mouse_drag&&!supportsTouch||self.touch_drag&&supportsTouch)&&(supportsTouch?(self.$hitArea.bind(self.event_down,{self:self},self.mouseDown),$(document).bind(self.event_move+self.id,{self:self},self.mouseDrag)):self.$holder.bind(self.event_down,{self:self},self.mouseDown)),self.mouse_dbl_click){var dClickedX,dClickedY,dbl_click_dir=1;(supportsTouch?self.$hitArea:self.$holder).bind("dblclick.sz",function(e){self.focusOffX=e.pageX-$holder.offset().left-self.sW/2,self.focusOffY=e.pageY-$holder.offset().top-self.sH/2,self.changeOffset(!0,!0),self._wheel=!1,self.rA<self.zoom_max&&dbl_click_dir==-1&&dClickedX!=self.focusOffX&&dClickedY!=self.focusOffY&&(dbl_click_dir=1),dClickedX=self.focusOffX,dClickedY=self.focusOffY,self.rA>=self.zoom_max&&1==dbl_click_dir&&(dbl_click_dir=-1),self.rA<=self.rF&&dbl_click_dir==-1&&(dbl_click_dir=1),dbl_click_dir>0?(self.rA*=2,self.rA=self.rA>self.zoom_max?self.zoom_max:self.rA,cFlag._zi=!0,clearTimeout(self.ani_timer),self._playing=!0,self.Animate(),cFlag._zi=!1):(self.rA/=2,self.rA=self.rA<self.rF?self.rF:self.rA,cFlag._zo=!0,clearTimeout(self.ani_timer),self._playing=!0,self.Animate(),cFlag._zo=!1),e.preventDefault(),e.stopPropagation()})}self.mouse_wheel&&$holder.bind("mousewheel.sz",{self:this},self.mouseWheel),self.bu_auto&&$holder.bind("mouseleave.sz",{self:this},self.autoHide),$controls.bind(self.event_down,function(e){e.preventDefault(),e.stopPropagation()}),self.mouse_dbl_click&&$controls.bind("dblclick.sz",function(e){e.preventDefault(),e.stopPropagation()}),$(".noSel").each(function(){this.onselectstart=function(){return!1}}),self.$holder=$holder,self.$controls=$controls,self.sW=sW,self.sH=sH,self.cBW=cBW,self.cBH=cBH,self.Animate()},setContainer:function(){var self=this,$image=self.$image,bord_size=self.bord_size,border=self.border,$holder=self.$holder;if(""==self.container&&""==self.image_url)$holder=self.$image.wrap('<div class="noSel smooth_zoom_preloader">\t\t\t\t\t</div>').parent();else if($holder=""==self.image_url?$("#"+self.container):self.$elem,$holder.addClass("noSel smooth_zoom_preloader"),self.locations=[],self.$loc_cont=$holder.find(".landmarks"),self.$loc_cont[0]){var locs=self.$loc_cont.children(".item");self.loc_clone=self.$loc_cont.clone(),self.show_at_zoom=parseInt(self.$loc_cont.data("show-at-zoom"),10)/100,self.allow_scale=checkBoolean(self.$loc_cont.data("allow-scale")),self.allow_drag=checkBoolean(self.$loc_cont.data("allow-drag")),locs.each(function(){self.setLocation($(this))})}$holder.css({position:"relative",overflow:"hidden","text-align":"left","-moz-user-select":"none","-khtml-user-select":"none","-webkit-user-select":"none","user-select":"none","-webkit-touch-callout":"none","-webkit-tap-highlight-color":"rgba(255, 255, 255, 0)","background-color":self.bg_color,"background-position":"center center","background-repeat":"no-repeat"}),self.$hitArea=$('<div style="position: absolute; z-index: '+(supportsTouch?2:1)+'; top: 0px; left: 0px; width: 100%; height: 100%;" ></div>').appendTo($holder),self.getContainerSize(self.sW,self.sH,$holder,self.w_max,self.h_max),self.responsive&&$(window).bind("orientationchange.sz"+self.id+" resize.sz"+self.id,{self:self},self.resize);var sW=self.sW,sH=self.sH;$holder.css({width:sW,height:sH}),bord_size>0&&(border[0]=$('<div style="position: absolute;\twidth: '+bord_size+"px; height: "+sH+"px;\ttop: 0px; left: 0px; z-index: 3; background-color: "+self.bord_color+';"></div>').css("opacity",self.bord_alpha),border[1]=$('<div style="position: absolute;\twidth: '+bord_size+"px; height: "+sH+"px;\ttop: 0px; left: "+(sW-bord_size)+"px; z-index: 4; background-color: "+self.bord_color+';"></div>').css("opacity",self.bord_alpha),border[2]=$('<div style="position: absolute;\twidth: '+(sW-2*bord_size)+"px; height: "+bord_size+"px; top: 0px; left: "+bord_size+"px; z-index: 5; background-color: "+self.bord_color+'; line-height: 1px;"></div>').css("opacity",self.bord_alpha),border[3]=$('<div style="position: absolute;\twidth: '+(sW-2*bord_size)+"px; height: "+bord_size+"px; top: "+(sH-bord_size)+"px; left: "+bord_size+"px; z-index: 6; background-color: "+self.bord_color+'; line-height: 1px;"></div>').css("opacity",self.bord_alpha),$holder.append(border[0],border[1],border[2],border[3])),void 0!=$image.attr("usemap")&&(self.mapAreas=$("map[name='"+$image.attr("usemap").split("#").join("")+"']").children("area"),self.mapAreas.each(function(i){var area=$(this);area.css("cursor","pointer"),self.mouse_drag&&area.bind(self.event_down,{self:self},self.mouseDown),self.mouse_wheel&&area.bind("mousewheel.sz",{self:self},self.mouseWheel),self.map_coordinates.push(area.attr("coords").split(","))})),self.$holder=$holder,self.sW=sW,self.sH=sH},getContainerSize:function(sW,sH,$holder,w_max,h_max){""===sW||0===sW?sW=""==this.image_url?Math.max($holder.parent().width(),100):Math.max($holder.width(),100):!isNaN(sW)||String(sW).indexOf("px")>-1?(sW=this.oW=parseInt(sW),this.responsive&&(sW=Math.min($holder.parent().width(),sW))):sW=String(sW).indexOf("%")>-1?$holder.parent().width()*(sW.split("%")[0]/100):100,0!==w_max&&""!==w_max&&(sW=Math.min(sW,w_max)),sH=""===sH||0===sH?""==this.image_url?Math.max($holder.parent().height(),100):Math.max($holder.height(),100):!isNaN(sH)||String(sH).indexOf("px")>-1?this.oH=parseInt(sH):String(sH).indexOf("%")>-1?$holder.parent().height()*(sH.split("%")[0]/100):100,0!==h_max&&""!==h_max&&(sH=Math.min(sH,h_max)),this.oW&&sW!==this.oW&&this.oH&&this.maintain_ratio&&(sH=sW/(this.oW/this.oH)),this.sW=sW,this.sH=sH},setLocation:function(lc){var w2,h2,pos,sc,self=this,ob=lc;if(prop_origin&&ob.css(prop_origin,"0 0"),ob.css({display:"block","z-index":2}),self.use3D&&ob.css({"-webkit-backface-visibility":"hidden","-webkit-perspective":1e3}),w2=ob.outerWidth()/2,h2=ob.outerHeight()/2,pos=ob.data("position").split(","),sc=ob.data("allow-scale"),sc=void 0==sc?self.allow_scale:checkBoolean(sc),ob.hasClass("mark")){ob.find("img").css("vertical-align","bottom").width();$(ob.children()[0]).css({position:"absolute",left:-ob.width()/2,bottom:2*parseInt(ob.css("padding-bottom"))});var txt=ob.find(".text");self.locations.push({ob:ob,x:parseInt(pos[0]),y:parseInt(pos[1]),w2:w2,h2:h2,w2pad:w2+(txt[0]?parseInt(txt.css("padding-left")):0),vis:!1,lab:!1,lpx:"0",lpy:"0",showAt:isNaN(ob.data("show-at-zoom"))?self.show_at_zoom:parseInt(ob.data("show-at-zoom"),10)/100,scale:sc})}else if(ob.hasClass("lable")){var bg=ob.data("bg-color"),opacity=ob.data("bg-opacity"),cont=$(ob.eq(0).children()[0]).css({position:"absolute","z-index":2,left:-w2,top:-h2});if(self.locations.push({ob:ob,x:parseInt(pos[0]),y:parseInt(pos[1]),w2:w2,h2:h2,w2pad:w2,vis:!1,lab:!0,lpx:"0",lpy:"0",showAt:isNaN(ob.data("show-at-zoom"))?self.show_at_zoom:parseInt(ob.data("show-at-zoom"),10)/100,scale:sc}),""!==bg){bg||(bg="#000000",opacity=.7);var bgob=$('<div style="position: absolute; left: '+-w2+"px; top: "+-h2+"px; width: "+2*(w2-parseInt(cont.css("padding-left")))+"px; height:"+2*(h2-parseInt(cont.css("padding-top")))+"px; background-color: "+bg+';"></div>').appendTo(ob);opacity&&bgob.css("opacity",opacity)}}ob.hide(),prop_transform&&ob.css("opacity",0),self.allow_drag?ob.css("pointer-events","none"):ob.bind(self.event_down,function(e){e.preventDefault(),e.stopPropagation()})},getStyle:function(){var el=this.$image;return{prop_origin:[prop_origin,prop_origin!==!1&&void 0!==prop_origin?el.css(prop_origin):null],prop_transform:[prop_transform,prop_transform!==!1&&void 0!==prop_transform?el.css(prop_transform):null],position:["position",el.css("position")],"z-index":["z-index",el.css("z-index")],cursor:["cursor",el.css("cursor")],left:["left",el.css("left")],top:["top",el.css("top")],width:["width",el.css("width")],height:["height",el.css("height")]}},checkRatio:function(sW,sH,iW,iH,zoom_fit){var rF;return iW==sW&&iH==sH?rF=1:iW<sW&&iH<sH?(rF=sW/iW,zoom_fit?rF*iH>sH&&(rF=sH/iH):(rF*iH<sH&&(rF=sH/iH),sW/iW!==sH/iH&&this.mouse_drag&&(this._moveCursor=!0,this.$image.css("cursor","move"),this.$hitArea.css("cursor","move")))):(rF=sW/iW,zoom_fit?(rF*iH>sH&&(rF=sH/iH),rF<this.init_zoom&&this.mouse_drag&&(this._moveCursor=!0,this.$image.css("cursor","move"),this.$hitArea.css("cursor","move"))):(rF*iH<sH&&(rF=sH/iH),sW/iW!==sH/iH&&this.mouse_drag&&(this._moveCursor=!0,this.$image.css("cursor","move"),this.$hitArea.css("cursor","move")))),rF},getDistance:function(x1,y1,x2,y2){return Math.sqrt(Math.abs((x2-x1)*(x2-x1)+(y2-y1)*(y2-y1)))},mouseDown:function(e){var self=e.data.self;if(self._onfocus=self._dragging=!1,self.cFlag._nd){if(self.fixMoz&&self.correctTransValue(),"mousedown"==e.type)self.offX=e.pageX-self.$holder.offset().left-self.$image.position().left,self.offY=e.pageY-self.$holder.offset().top-self.$image.position().top,$(document).bind(self.event_move+self.id,{self:self},self.mouseDrag);else{var te=e.originalEvent;te.targetTouches.length>1?(self._pinching=!0,self._rA=self.rA,self.dStart=self.getDistance(te.touches[0].pageX,te.touches[0].pageY,te.touches[1].pageX,te.touches[1].pageY)):(self.offX=te.touches[0].pageX-self.$holder.offset().left-self.$image.position().left,
self.offY=te.touches[0].pageY-self.$holder.offset().top-self.$image.position().top,self.setDraggedPos(te.touches[0].pageX-self.$holder.offset().left-self.offX,te.touches[0].pageY-self.$holder.offset().top-self.offY,self._sc),self._recent="drag",self._dragging=!0)}self._onHitArea=!0}e.preventDefault(),"mousedown"!==e.type&&e.stopPropagation()},mouseDrag:function(e){var self=e.data.self;if("mousemove"==e.type)return self.setDraggedPos(e.pageX-self.$holder.offset().left-self.offX,e.pageY-self.$holder.offset().top-self.offY,self._sc),self._recent="drag",self._dragging=!0,self._playing||self.Animate(),!1;if((self._dragging||self._pinching)&&e.preventDefault(),self._onHitArea){var touches=e.originalEvent.touches;self._pinching||touches.length>1?(self._pinching||(self._pinching=!0,self._rA=self.rA,touches.length>1&&(self.dStart=self.getDistance(touches[0].pageX,touches[0].pageY,touches[1].pageX,touches[1].pageY))),touches.length>1&&(self._centx=(touches[0].pageX+touches[1].pageX)/2,self._centy=(touches[0].pageY+touches[1].pageY)/2,self.focusOffX=self._centx-self.$holder.offset().left-self.sW/2,self.focusOffY=self._centy-self.$holder.offset().top-self.sH/2,self.changeOffset(!0,!0),self._wheel=!0,self._dragging=!1,self.zoom_single?self.sRed=300:(self.dEnd=self.getDistance(touches[0].pageX,touches[0].pageY,touches[1].pageX,touches[1].pageY),self.rA=self._rA*(self.dEnd/self.dStart),self.rA=self.rA>self.zoom_max?self.zoom_max:self.rA,self.rA=self.rA<self.rF?self.rF:self.rA),self._sc<self.rA?(self.cFlag._zo=!1,self.cFlag._zi=!0):(self.cFlag._zi=!1,self.cFlag._zo=!0),self._playing||self.Animate())):self._dragging&&touches.length<2&&(self.setDraggedPos(touches[0].pageX-self.$holder.offset().left-self.offX,touches[0].pageY-self.$holder.offset().top-self.offY,self._sc),self._recent="drag",self._playing||self.Animate())}},mouseUp:function(e){var self=e.data.self;return self._onButton?(self.$holder.find("#"+self.buttons[self.cButtId]._var+"norm").show(),self.$holder.find("#"+self.buttons[self.cButtId]._var+"over").hide(),6!==self.cButtId&&(self.cFlag[self.buttons[self.cButtId]._var]=!1),"touchend"==e.type&&self.buttons[self.cButtId].$ob.css("opacity")>.5&&self.buttons[self.cButtId].$ob.css("opacity",.7),self._onButton=!1,e.stopPropagation(),!1):void(self._onHitArea&&(self.mouse_drag||self.touch_drag)&&("mouseup"==e.type?($(document).unbind(self.event_move+self.id),self._recent="drag",self._dragging=!1,self._playing||self.Animate(),self._onHitArea=!1):(e.preventDefault(),self._dragging=!1,self._pinching?(self._pinching=!1,self._wheel=!1,self.cFlag._nd=!0,self.cFlag._zi=!1,self.cFlag._zo=!1):(self._recent="drag",self._playing||self.Animate()),self._onHitArea=!1)))},mouseWheel:function(e,delta){var self=e.data.self;return self._onfocus=self._dragging=!1,self.mouse_wheel_cur&&(self.focusOffX=e.pageX-self.$holder.offset().left-self.sW/2,self.focusOffY=e.pageY-self.$holder.offset().top-self.sH/2,self.changeOffset(!0,!0)),self._dragging=!1,delta>0?self.rA!=self.zoom_max&&(self.zoom_single?self._wheel||(self.sRed=300):(self.rA*=delta<1?1+.3*delta:1.3,self.rA=self.rA>self.zoom_max?self.zoom_max:self.rA),self._wheel=!0,self.cFlag._zi=!0,clearTimeout(self.ani_timer),self._playing=!0,self.Animate(),self.cFlag._zi=!1):self.rA!=self.rF&&(self.zoom_single?self._wheel||(self.sRed=300):(self.rA/=delta>-1?1+.3*-delta:1.3,self.rA=self.rA<self.rF?self.rF:self.rA),self._wheel=!0,self.cFlag._zo=!0,clearTimeout(self.ani_timer),self._playing=!0,self.Animate(),self.cFlag._zo=!1),!1},autoHide:function(e){var self=e.data.self;clearTimeout(self.auto_timer),self.auto_timer=setTimeout(function(){self.$controls.fadeOut(600)},self.bu_delay),self.$holder.bind("mouseenter.sz",function(e){clearTimeout(self.auto_timer),self.$controls.fadeIn(300)})},correctTransValue:function(){var v=this.$image.css("-moz-transform").toString().replace(")","").split(",");this.transOffX=parseInt(v[4]),this.transOffY=parseInt(v[5])},setDraggedPos:function(xp,yp,s){var self=this;""!==xp&&(self.dX=xp+self.transOffX,self.pan_limit?(self.dX=self.dX+s*self.iW<self.sW?self.sW-s*self.iW:self.dX,self.dX=self.dX>0?0:self.dX,s*self.iW<self.sW&&(self.dX=(self.sW-s*self.iW)/2)):(self.dX=self.dX+s*self.iW<self.sW/2?self.sW/2-s*self.iW:self.dX,self.dX=self.dX>self.sW/2?self.sW/2:self.dX)),""!==yp&&(self.dY=yp+self.transOffY,self.pan_limit?(self.dY=self.dY+s*self.iH<self.sH?self.sH-s*self.iH:self.dY,self.dY=self.dY>0?0:self.dY,s*self.iH<self.sH&&(self.dY=(self.sH-s*self.iH)/2)):(self.dY=self.dY+s*self.iH<self.sH/2?self.sH/2-s*self.iH:self.dY,self.dY=self.dY>self.sH/2?self.sH/2:self.dY))},Animate:function(){var self=this,pixTol=.5;if(self.cFlag._nd=!0,self.ani_end=!1,self.cFlag._zi&&(self._wheel||self.zoom_single||(self.rA*=self.zoom_speed),self.rA>self.zoom_max&&(self.rA=self.zoom_max),self.cFlag._nd=!1,self.cFlag._rs=!1,self._recent="zoomIn",self._onfocus=self._dragging=!1),self.cFlag._zo&&(self._wheel||self.zoom_single||(self.rA/=self.zoom_speed),self.rA<self.rF&&(self.rA=self.rF),self.cFlag._nd=!1,self.cFlag._rs=!1,self._recent="zoomOut",self._onfocus=self._dragging=!1),self.zoom_single&&!self.cFlag._rs&&("zoomIn"==self._recent?(self.sRed+=(10-self.sRed)/6,self.rA+=(self.zoom_max-self.rA)/(1/(self.pan_speed_o+1)*self.sRed+1)):"zoomOut"==self._recent&&(self.sRed+=(3-self.sRed)/3,self.rA+=(self.rF-self.rA)/((1/self.pan_speed_o+1)*self.sRed+1))),self.pan_speed=(Math.max(1,1+(self.sW+self.sH)/500)+self.pan_speed_o*self.pan_speed_o/4)/Math.max(1,self.rA/2),self.cFlag._ml&&(self.oX-=self.pan_speed,self.cFlag._nd=!1,self.cFlag._rs=!1,self._recent="left",self._onfocus=self._dragging=!1),self.cFlag._mr&&(self.oX+=self.pan_speed,self.cFlag._nd=!1,self.cFlag._rs=!1,self._recent="right",self._onfocus=self._dragging=!1),self.cFlag._mu&&(self.oY-=self.pan_speed,self.cFlag._nd=!1,self.cFlag._rs=!1,self._recent="up",self._onfocus=self._dragging=!1),self.cFlag._md&&(self.oY+=self.pan_speed,self.cFlag._nd=!1,self.cFlag._rs=!1,self._recent="down",self._onfocus=self._dragging=!1),self.cFlag._rs&&(self.oX+=(self.fX-self.oX)/8,self.oY+=(self.fY-self.oY)/8,self.cFlag._nd=!1,self._recent="reset",self._onfocus=self._dragging=!1),self.zoom_single&&"reset"!==self._recent?self._onfocus?self._sc+=(self.rA-self._sc)/self.reduction:self._sc=self.rA:self._sc+=(self.rA-self._sc)/(self.ani_smooth/(self._onfocus?self.reduction:1)),self._w=self._sc*self.iW,self._h=self._sc*self.iH,self._dragging&&(self.tX=self.dX,self.tY=self.dY,self.changeOffset(!0,!0)),"zoomIn"==self._recent?(self._w>self.rA*self.iW-pixTol&&!self.zoom_single?(self.cFlag._nd&&(self.ani_end=!0),self._sc=self.rA):self._w>self.zoom_max*self.iW-pixTol&&self.zoom_single&&(self.cFlag._nd&&(self.ani_end=!0),self._sc=self.rA=self.zoom_max),self.ani_end&&(self._w=self._sc*self.iW,self._h=self._sc*self.iH)):"zoomOut"==self._recent&&(self._w<self.rA*self.iW+pixTol&&!self.zoom_single?(self.cFlag._nd&&(self.ani_end=!0),self._sc=self.rA):self._w<self.rF*self.iW+pixTol&&self.zoom_single&&(self.cFlag._nd&&(self.ani_end=!0),self._sc=self.rA=self.rF),self.ani_end&&(self._w=self._sc*self.iW,self._h=self._sc*self.iH)),self.limitX=(self._w-self.sW)/(self._w/self.sW)/2,self.limitY=(self._h-self.sH)/(self._h/self.sH)/2,self._dragging||(self.pan_limit?(self.oX<-self.limitX-self.focusOffX&&(self.oX=-self.limitX-self.focusOffX),self.oX>self.limitX-self.focusOffX&&(self.oX=self.limitX-self.focusOffX),self._w<self.sW&&(self.tX=(self.sW-self._w)/2,self.changeOffset(!0,!1)),self.oY<-self.limitY-self.focusOffY&&(self.oY=-self.limitY-self.focusOffY),self.oY>self.limitY-self.focusOffY&&(self.oY=self.limitY-self.focusOffY),self._h<self.sH&&(self.tY=(self.sH-self._h)/2,self.changeOffset(!1,!0))):(self.oX<-self.limitX-self.focusOffX/self._w*self.sW-self.sW/2/(self._w/self.sW)&&(self.oX=-self.limitX-self.focusOffX/self._w*self.sW-self.sW/2/(self._w/self.sW)),self.oX>self.limitX-self.focusOffX/self._w*self.sW+self.sW/2/(self._w/self.sW)&&(self.oX=self.limitX-self.focusOffX/self._w*self.sW+self.sW/2/(self._w/self.sW)),self.oY<-self.limitY-self.focusOffY/self._h*self.sH-self.sH/(self._h/self.sH*2)&&(self.oY=-self.limitY-self.focusOffY/self._h*self.sH-self.sH/(self._h/self.sH*2)),self.oY>self.limitY-self.focusOffY/self._h*self.sH+self.sH/(self._h/self.sH*2)&&(self.oY=self.limitY-self.focusOffY/self._h*self.sH+self.sH/(self._h/self.sH*2)))),self._dragging||"drag"==self._recent||(self.tX=(self.sW-self._w)/2+self.focusOffX+self.oX*(self._w/self.sW),self.tY=(self.sH-self._h)/2+self.focusOffY+self.oY*(self._h/self.sH),1===self.ani_smooth&&(self.cFlag._nd=!0,self.ani_end=!0)),"zoomIn"==self._recent||"zoomOut"==self._recent||self.cFlag._rs?(self._x=self.tX,self._y=self.tY):(self._x+=(self.tX-self._x)/(self.ani_smooth/(self._onfocus?self.reduction:1)),self._y+=(self.tY-self._y)/(self.ani_smooth/(self._onfocus?self.reduction:1))),"left"==self._recent?(self._x<self.tX+pixTol||1===self.ani_smooth)&&(self.cFlag._nd?self.ani_end=!0:"",self._recent="",self._x=self.tX):"right"==self._recent?(self._x>self.tX-pixTol||1===self.ani_smooth)&&(self.cFlag._nd?self.ani_end=!0:"",self._recent="",self._x=self.tX):"up"==self._recent?(self._y<self.tY+pixTol||1===self.ani_smooth)&&(self.cFlag._nd?self.ani_end=!0:"",self._recent="",self._y=self.tY):"down"==self._recent?(self._y>self.tY-pixTol||1===self.ani_smooth)&&(self.cFlag._nd?self.ani_end=!0:"",self._recent="",self._y=self.tY):"drag"==self._recent&&(self._x+pixTol>=self.tX&&self._x-pixTol<=self.tX&&self._y+pixTol>=self.tY&&self._y-pixTol<=self.tY||1===self.ani_smooth)&&(self._onfocus&&(self._dragging=!1),self.cFlag._nd?self.ani_end=!0:"",self._recent="",self._x=self.tX,self._y=self.tY),self.cFlag._rs&&self._w+pixTol>=self.rA*self.iW&&self._w-pixTol<=self.rA*self.iW&&self.oX<=self.fX+pixTol&&self.oX>=self.fX-pixTol&&self.oY<=self.fY+pixTol&&self.oY>=self.fY-pixTol&&(self.ani_end=!0,self._recent="",self.cFlag._rs=!1,self.cFlag._nd=!0,self._x=self.tX,self._y=self.tY,self._sc=self.rA,self._w=self._sc*self.iW,self._h=self._sc*self.iH),self.rA==self.rF&&self.iW*self.rA<=self.sW&&self.iH*self.rA<=self.sH){if(self.buttons[1].$ob.css("opacity")>.5&&self.rA>=self.rF&&(""==self.init_zoom||self.rA<self.init_zoom)&&(""==self.zoom_min||self.rA<self.zoom_min)){self.pan_limit&&self._moveCursor&&!self._moveCursor&&(self.$image.css("cursor","default"),self.$hitArea.css("cursor","default"));for(var bEn=1;bEn<(self.pan_limit&&!self._moveCursor?self.buttons_total:2);bEn++)self.buttons[bEn].$ob.css({opacity:.4}),self._wheel=!1,self.$holder.find("#"+self.buttons[bEn]._var+"norm").show(),self.$holder.find("#"+self.buttons[bEn]._var+"over").hide()}}else if(self.buttons[1].$ob.css("opacity")<.5){self._moveCursor&&self.mouse_drag&&(self.$image.css("cursor","move"),self.$hitArea.css("cursor","move"));for(var bEn=1;bEn<self.buttons_total;bEn++)self.buttons[bEn].$ob.css("opacity",.7)}self.rA==self.zoom_max?self.buttons[0].$ob.css("opacity")>.5&&(self.buttons[0].$ob.css("opacity",.4),self._wheel=!1,self.$holder.find("#"+self.buttons[0]._var+"norm").show(),self.$holder.find("#"+self.buttons[0]._var+"over").hide()):self.buttons[0].$ob.css("opacity")<.5&&self.buttons[0].$ob.css("opacity",.7),prop_transform?self.$image.css(prop_transform,"translate("+self._x.toFixed(14)+"px,"+self._y.toFixed(14)+"px) scale("+self._sc+")"):self.$image.css({left:self._x,top:self._y,width:self._w,height:self._h}),self.$loc_cont&&self.updateLocations(self._x,self._y,self._sc,self.locations),!prop_transform&&self.map_coordinates.length>0&&self.updateMap(),self.ani_end&&!self._dragging&&"drag"!=self._recent?(self._playing=!1,self._recent="",self.cX=(-self._x+self.sW/2)/self.rA,self.cY=(-self._y+self.sH/2)/self.rA,self.onUPDATE&&self.onUPDATE(self.getZoomData(),!1),self.onZOOM_PAN&&self.onZOOM_PAN(self.getZoomData()),clearTimeout(self.ani_timer)):(self._playing=!0,self.onUPDATE&&self.onUPDATE(self.getZoomData(),!0),self.ani_timer=setTimeout(function(){self.Animate()},28))},updateLocations:function(_x,_y,_sc,loc){""!==this.onLANDMARK&&(_sc>=this.show_at_zoom?this._landmark||(this._landmark=!0,this.onLANDMARK(!0)):this._landmark&&(this._landmark=!1,this.onLANDMARK(!1)));for(var p=0;p<loc.length;p++){var wScaled,hScaled,lpx=loc[p].x*_sc+_x,lpy=loc[p].y*_sc+_y;_sc>=loc[p].showAt?(loc[p].scale&&prop_transform?(wScaled=loc[p].w2pad*this._sc,hScaled=loc[p].h2*this._sc):(wScaled=loc[p].w2pad,hScaled=loc[p].h2),lpx>-wScaled&&lpx<this.sW+wScaled&&(lpy>-hScaled&&lpy<this.sH+hScaled&&loc[p].lab||lpy>0&&lpy<this.sH+2*hScaled&&!loc[p].lab)?loc[p].vis||(loc[p].vis=!0,prop_transform?loc[p].ob.stop().css("display","block").animate({opacity:1},300):loc[p].ob.show()):loc[p].vis&&(loc[p].vis=!1,prop_transform?loc[p].ob.stop().animate({opacity:0},200,function(){$(this).hide()}):loc[p].ob.hide())):loc[p].vis&&(loc[p].vis=!1,prop_transform?loc[p].ob.stop().animate({opacity:0},200,function(){$(this).hide()}):loc[p].ob.hide()),(lpx!==loc[p].lpx||lpy!==loc[p].lpy&&loc[p].vis)&&(prop_transform?loc[p].ob.css(prop_transform,"translate("+lpx.toFixed(14)+"px,"+lpy.toFixed(14)+"px)"+(loc[p].scale?" scale("+this._sc+")":"")):loc[p].ob.css({left:lpx,top:lpy})),loc[p].lpx=lpx,loc[p].lpy=lpy}},roundBG:function(el,_name,_w,_h,_r,_p,_c,_i,_z,_yoff){var w=25;el.append($('<div class="bgi'+_name+'" style="background-position:'+-(_p-_r)+"px "+(-(w-_r)-_yoff)+'px"></div>\t\t\t\t<div class="bgh'+_name+'"></div>\t\t\t\t<div class="bgi'+_name+'" style="background-position:'+-_p+"px "+(-(w-_r)-_yoff)+"px; left:"+(_w-_r)+'px"></div>\t\t\t\t<div class="bgi'+_name+'" style="background-position:'+-(_p-_r)+"px "+(-w-_yoff)+"px; top:"+(_h-_r)+'px"></div>\t\t\t\t<div class="bgh'+_name+'" style = "top:'+(_h-_r)+"px; left:"+_r+'px"></div>\t\t\t\t<div class="bgi'+_name+'" style="background-position:'+-_p+"px "+(-w-_yoff)+"px; top:"+(_h-_r)+"px; left:"+(_w-_r)+'px"></div>\t\t\t\t<div class="bgc'+_name+'"></div>')),$(".bgi"+_name).css({position:"absolute",width:_r,height:_r,"background-image":"url("+_i+")","background-repeat":"no-repeat","-ms-filter":"progid:DXImageTransform.Microsoft.gradient(startColorstr=#00FFFFFF,endColorstr=#00FFFFFF)",filter:"progid:DXImageTransform.Microsoft.gradient(startColorstr=#00FFFFFF,endColorstr=#00FFFFFF)",zoom:1}),$(".bgh"+_name).css({position:"absolute",width:_w-2*_r,height:_r,"background-color":_c,left:_r}),$(".bgc"+_name).css({position:"absolute",width:_w,height:_h-2*_r,"background-color":_c,top:_r,left:0})},changeOffset:function(x,y){x&&(this.oX=(this.tX-(this.sW-this._w)/2-this.focusOffX)/(this._w/this.sW)),y&&(this.oY=(this.tY-(this.sH-this._h)/2-this.focusOffY)/(this._h/this.sH))},updateMap:function(){var self=this,mapId=0;self.mapAreas.each(function(){for(var new_vals=[],i=0;i<self.map_coordinates[mapId].length;i++)new_vals[i]=self.map_coordinates[mapId][i]*self._sc;new_vals=new_vals.join(","),$(this).attr("coords",new_vals),mapId++})},haltAnimation:function(){clearTimeout(this.ani_timer),this._playing=!1,this._recent=""},destroy:function(){var self=this;if(self.assetsLoaded){self.haltAnimation();for(prop in self.orig_style)self.orig_style[prop][0]!==!1&&void 0!==self.orig_style[prop][0]&&("width"===self.orig_style[prop][0]||"height"===self.orig_style[prop][0]?0!==parseInt(self.orig_style[prop][1])&&self.$image.css(self.orig_style[prop][0],self.orig_style[prop][1]):self.$image.css(self.orig_style[prop][0],self.orig_style[prop][1]));clearTimeout(self.auto_timer),$(document).unbind(".sz"+self.id),$(window).unbind(".sz"+self.id),self.$holder.unbind(".sz"),self.$controls=void 0}else self.$image.show();""==self.container?""==self.image_url?(self.$image.insertBefore(self.$holder),void 0!==self.$holder&&self.$holder.remove()):(self.$elem.empty(),self.$loc_cont[0]&&self.$elem.append(self.loc_clone)):(self.$image.insertBefore(self.$holder),self.$holder.empty(),self.$image.wrap(self.$holder),self.$loc_cont[0]&&self.$holder.append(self.loc_clone)),self.$elem.removeData("smoothZoom"),self.$holder=void 0,self.Buttons=void 0,self.op=void 0,self.$image=void 0},focusTo:function(params){var self=this;self.assetsLoaded&&(void 0===params.zoom||""===params.zoom||0==params.zoom?params.zoom=self.rA:params.zoom/=100,self._onfocus=!0,params.zoom>self.rA&&self.rA!=self.zoom_max?(self.rA=params.zoom,self.rA=self.rA>self.zoom_max?self.zoom_max:self.rA):params.zoom<self.rA&&self.rA!=self.rF&&(self.rA=params.zoom,self.rA=self.rA<self.rF?self.rF:self.rA),self.transOffX=self.transOffY=0,self.setDraggedPos(void 0===params.x||""===params.x?"":-params.x*self.rA+self.sW/2,void 0===params.y||""===params.y?"":-params.y*self.rA+self.sH/2,self.rA),self.reduction=params.speed?params.speed/10:self.focusSpeed,self._recent="drag",self._dragging=!0,self._playing||self.Animate())},zoomIn:function(params){this.buttons[0].$ob.trigger(this.event_down,{id:0})},zoomOut:function(params){this.buttons[1].$ob.trigger(this.event_down,{id:1})},moveRight:function(params){this.buttons[2].$ob.trigger(this.event_down,{id:2})},moveLeft:function(params){this.buttons[3].$ob.trigger(this.event_down,{id:3})},moveUp:function(params){this.buttons[4].$ob.trigger(this.event_down,{id:4})},moveDown:function(params){this.buttons[5].$ob.trigger(this.event_down,{id:5})},Reset:function(params){this.buttons[6].$ob.trigger(this.event_down,{id:6})},getZoomData:function(params){return{normX:(-this._x/this.rA).toFixed(14),normY:(-this._y/this.rA).toFixed(14),normWidth:this.iW,normHeight:this.iH,scaledX:-this._x.toFixed(14),scaledY:-this._y.toFixed(14),scaledWidth:this._w,scaledHeight:this._h,centerX:(-this._x.toFixed(14)+this.sW/2)/this.rA,centerY:(-this._y.toFixed(14)+this.sH/2)/this.rA,ratio:this.rA}},addLandmark:function(loc){if(this.$loc_cont){for(var total=loc.length,i=0;i<total;i++){var $loc=$(loc[i]);this.$loc_cont.append($loc),this.setLocation($loc)}total>0&&this.updateLocations(this._x,this._y,this._sc,this.locations)}},attachLandmark:function(loc){if(this.$loc_cont){for(var total=loc.length,i=0;i<total;i++)this.setLocation(loc[i]instanceof jQuery?loc[i]:$("#"+loc[i]));total>0&&this.updateLocations(this._x,this._y,this._sc,this.locations)}},removeLandmark:function(loc){if(this.$loc_cont){if(loc)for(var total=loc.length,i=0;i<total;i++)for(var j=0;j<this.locations.length;j++)(loc[i]instanceof jQuery&&this.locations[j].ob[0]==loc[i][0]||!(loc[i]instanceof jQuery)&&this.locations[j].ob.attr("id")==loc[i])&&(this.locations[j].ob.remove(),this.locations.splice(j,1),j--);else this.locations.length>0&&(this.locations[this.locations.length-1].ob.remove(),this.locations.pop());total>0&&this.updateLocations(this._x,this._y,this._sc,this.locations)}},refreshAllLandmarks:function(){var self=this,locs=self.$loc_cont.children(".item");self.show_at_zoom=parseInt(self.$loc_cont.data("show-at-zoom"),10)/100,self.allow_scale=checkBoolean(self.$loc_cont.data("allow-scale")),self.allow_drag=checkBoolean(self.$loc_cont.data("allow-drag"));for(var i=0;i<self.locations.length;i++){var exists=!1;locs.each(function(){self.locations[i].ob[0]==$(this)[0]&&(exists=!0)}),exists||(self.locations.splice(i,1),i--)}locs.each(function(){for(var exists=!1,i=0;i<self.locations.length;i++)if(self.locations[i].ob[0]==$(this)[0]){exists=!0;break}exists||self.setLocation($(this))}),this.updateLocations(this._x,this._y,this._sc,this.locations)},resize:function(e){var self;if(e.data){e.preventDefault(),self=e.data.self;var pw=self.$holder.parent().width(),ph=self.$holder.parent().height();self.oW&&(pw=Math.min(pw,self.oW)),self.sW=pw,self.oH?self.oW&&self.maintain_ratio&&(self.sH=pw/(self.oW/self.oH)):self.sH=ph}else self=this,e.width&&(self.sW=e.width),e.height&&(self.sH=e.height),e.max_WIDTH&&(self.w_max=e.max_WIDTH),e.max_HEIGHT&&(self.h_max=e.max_HEIGHT);0!==self.w_max&&""!==self.w_max&&(self.sW=Math.min(self.sW,self.w_max)),0!==self.h_max&&""!==self.h_max&&(self.sH=Math.min(self.sH,self.h_max)),self.$holder.css({width:self.sW,height:self.sH}),self.bord_size>0&&(self.border[0].height(self.sH),self.border[1].css({height:self.sH,left:self.sW-self.bord_size}),self.border[2].width(self.sW-2*self.bord_size),self.border[3].css({width:self.sW-2*self.bord_size,top:self.sH-self.bord_size})),"center"==self.bu_align[1]&&self.$controls.css("left",parseInt((self.sW-self.cBW)/2)),"center"==self.bu_align[0]&&self.$controls.css("top",parseInt((self.sH-self.cBH)/2)),0==self.zoom_min&&(self.rF=self.checkRatio(self.sW,self.sH,self.iW,self.iH,self.zoom_fit),self.rA<self.rF&&(self.rA=self.rF)),self.focusTo({x:self.cX,y:self.cY,zoom:"",speed:10})}},$.fn.smoothZoom=function(params){for(var self=this,l=self.length,i=0;i<l;i++){var $elem=$(self[i]),instance=$elem.data("smoothZoom");if(instance){if("getZoomData"==params)return instance[params].apply(instance,Array.prototype.slice.call(arguments,1));instance[params]&&instance[params].apply(instance,Array.prototype.slice.call(arguments,1))}else"object"!=typeof params&&params||$elem.data("smoothZoom",new Zoomer($elem,params))}if("getZoomData"!==params)return this};var Modernizr=function(a,b,c){function y(a){i.cssText=a}function A(a,b){return typeof a===b}function C(a,b){for(var d in a)if(i[a[d]]!==c)return"pfx"!=b||a[d];return!1}function D(a,b,d){for(var e in a){var f=b[a[e]];if(f!==c)return d===!1?a[e]:A(f,"function")?f.bind(d||b):f}return!1}function E(a,b,c){var d=a.charAt(0).toUpperCase()+a.substr(1),e=(a+" "+n.join(d+" ")+d).split(" ");return A(b,"string")||A(b,"undefined")?C(e,b):(e=(a+" "+o.join(d+" ")+d).split(" "),D(e,b,c))}var j,u,x,d="2.5.3",e={},f=b.documentElement,g="modernizr",h=b.createElement(g),i=h.style,l=({}.toString," -webkit- -moz- -o- -ms- ".split(" ")),m="Webkit Moz O ms",n=m.split(" "),o=m.toLowerCase().split(" "),p={},s=[],t=s.slice,v=function(a,c,d,e){var h,i,j,k=b.createElement("div"),l=b.body,m=l?l:b.createElement("body");if(parseInt(d,10))for(;d--;)j=b.createElement("div"),j.id=e?e[d]:g+(d+1),k.appendChild(j);return h=["&#173;","<style>",a,"</style>"].join(""),k.id=g,(l?k:m).innerHTML+=h,m.appendChild(k),l||(m.style.background="",f.appendChild(m)),i=c(k,a),l?k.parentNode.removeChild(k):m.parentNode.removeChild(m),!!i},w={}.hasOwnProperty;x=A(w,"undefined")||A(w.call,"undefined")?function(a,b){return b in a&&A(a.constructor.prototype[b],"undefined")}:function(a,b){return w.call(a,b)},Function.prototype.bind||(Function.prototype.bind=function(b){var c=this;if("function"!=typeof c)throw new TypeError;var d=t.call(arguments,1),e=function(){if(this instanceof e){var a=function(){};a.prototype=c.prototype;var f=new a,g=c.apply(f,d.concat(t.call(arguments)));return Object(g)===g?g:f}return c.apply(b,d.concat(t.call(arguments)))};return e});(function(c,d){var f=c.join(""),g=d.length;v(f,function(c,d){for(var f=b.styleSheets[b.styleSheets.length-1],i=(f?f.cssRules&&f.cssRules[0]?f.cssRules[0].cssText:f.cssText||"":"",c.childNodes),j={};g--;)j[i[g].id]=i[g];e.touch="ontouchstart"in a||a.DocumentTouch&&b instanceof DocumentTouch||9===(j.touch&&j.touch.offsetTop),e.csstransforms3d=9===(j.csstransforms3d&&j.csstransforms3d.offsetLeft)&&3===j.csstransforms3d.offsetHeight},g,d)})([,["@media (",l.join("touch-enabled),("),g,")","{#touch{top:9px;position:absolute}}"].join(""),["@media (",l.join("transform-3d),("),g,")","{#csstransforms3d{left:9px;position:absolute;height:3px;}}"].join("")],[,"touch","csstransforms3d"]);p.touch=function(){return e.touch},p.borderradius=function(){return E("borderRadius")},p.csstransforms=function(){return!!E("transform")},p.csstransforms3d=function(){var a=!!E("perspective");return a&&"webkitPerspective"in f.style&&(a=e.csstransforms3d),a};for(var G in p)x(p,G)&&(u=G.toLowerCase(),e[u]=p[G](),s.push((e[u]?"":"no-")+u));return y(""),h=j=null,e._version=d,e._prefixes=l,e._domPrefixes=o,e._cssomPrefixes=n,e.testProp=function(a){return C([a])},e.testAllProps=E,e.testStyles=v,e.prefixed=function(a,b,c){return b?E(a,b,c):E(a,"pfx")},e}(this,this.document),prop_transform=Modernizr.prefixed("transform"),prop_origin=Modernizr.prefixed("transformOrigin"),prop_radius=Modernizr.prefixed("borderRadius"),supportsTrans3D=Modernizr.csstransforms3d,supportsTouch=Modernizr.touch}(jQuery,window,document),function(a){function d(b){var c=b||window.event,d=[].slice.call(arguments,1),e=0,g=0,h=0;return b=a.event.fix(c),b.type="mousewheel",c.wheelDelta&&(e=c.wheelDelta/120),c.detail&&(e=-c.detail/3),h=e,void 0!==c.axis&&c.axis===c.HORIZONTAL_AXIS&&(h=0,g=-1*e),void 0!==c.wheelDeltaY&&(h=c.wheelDeltaY/120),void 0!==c.wheelDeltaX&&(g=-1*c.wheelDeltaX/120),d.unshift(b,e,g,h),(a.event.dispatch||a.event.handle).apply(this,d)}var b=["DOMMouseScroll","mousewheel"];if(a.event.fixHooks)for(var c=b.length;c;)a.event.fixHooks[b[--c]]=a.event.mouseHooks;a.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var a=b.length;a;)this.addEventListener(b[--a],d,!1);else this.onmousewheel=d},teardown:function(){if(this.remove_eventListener)for(var a=b.length;a;)this.remove_eventListener(b[--a],d,!1);else this.onmousewheel=null}},a.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})}(jQuery),function(){"use strict";$("#rtlButton").on("click",function(){$("html").attr("dir","rtl")})}(),angular.module("radBlu").directive("tripadvisor",["$sce",function($sce){return{restrict:"A",scope:{url:"@tripadvisor"},template:'<iframe ng-src="{{trustedUrl()}}"></iframe>',replace:!0,link:function(scope,el,attrs){console.log(scope.url),scope.trustedUrl=function(){return $sce.trustAsResourceUrl(scope.url)}}}}]),angular.module("radBlu").directive("match",function(){return{require:"ngModel",restrict:"A",scope:{match:"="},link:function(scope,elem,attrs,ctrl){scope.$watch(function(){var modelValue=ctrl.$modelValue||ctrl.$$invalidModelValue;return ctrl.$pristine&&angular.isUndefined(modelValue)||scope.match===modelValue},function(currentValue){ctrl.$setValidity("match",currentValue)})}}}),angular.module("radBlu.exploreHotels").controller("CityHotelsCtrl",["$scope","CityHotels",function($scope,CityHotels){$scope.CityHotels=CityHotels,$scope.cityCount="",$scope.cityitem=CityHotels.cities[0],$scope.initIsotopeView=function(){$scope.cityitem=CityHotels.cities[0]},$scope.initClassicView=function(){$scope.cityitem=CityHotels.cities[0]},$scope.setCity=function(selectedCity){$scope.cityitem=selectedCity},$scope.setCityIndex=function(indexNr){$scope.cityitem=CityHotels.cities[indexNr]},$scope.duplicateItem=$scope.CityHotels.cities.length-2}]),angular.module("radBlu.exploreHotels").service("CityHotels",["$http",function($http){var _this=this;this.cities=window.HOTEL_FIXTURE,this.bookRate=window.LOWEST_RATE_FIXTURE||{},angular.forEach(window.LOWEST_RATE_ARR,function(val){angular.extend(_this.bookRate,val)}),this.cityIndex=0,this.currentCity=function(){return this.cities[this.cityIndex]}}]).filter("urlByHotel",["$sce",function($sce){return function(hotel,hotelsWithUrls,bookdomain,label){var promoHotel=_.find(hotelsWithUrls,function(promoHotel){return promoHotel.hotelCode===hotel.hotelCode});if(promoHotel){var bookingurl=bookdomain+"?hotelCode="+promoHotel.hotelCode+"&startDate="+promoHotel.checkInDate+"&endDate="+promoHotel.checkOutDate,displayPrice=promoHotel.displayPrice,displayPriceInSecCurrency=promoHotel.displayPriceInSecCurrency,buttonText="";return null!=displayPrice&&(buttonText=displayPrice!==displayPriceInSecCurrency&&null!=displayPriceInSecCurrency?label+displayPrice+" ("+displayPriceInSecCurrency+")":label+displayPrice),$sce.trustAsHtml(""!=buttonText?'<a href="'+bookingurl+'" class="btn btn-primary">'+buttonText+"</a>":"")}}}]).filter("taByHotel",["$sce",function($sce){return function(hotel,hotelsWithUrls,partnerId,lang){for(var promoHotel="",i=0;i<hotelsWithUrls.length;i++)for(var hotelsList=hotelsWithUrls[i].hotels,j=0;j<hotelsList.length;j++)if(hotelsList[j].hotelCode===hotel.hotelCode){promoHotel=hotelsList[j];break}if(promoHotel){var iframeSrc="https://www.tripadvisor.com/WidgetEmbed-cdspropertysummary?display=true&amp;partnerId="+partnerId+"&lang="+lang+"&locationId="+promoHotel.hotelCode;return $sce.trustAsHtml('<iframe src="'+iframeSrc+'" width="180" scrolling="no" frameborder="0" allowtransparency="true" marginheight="0" marginwidth="0"></iframe>')}}}]);var upcomingHotels;upcomingHotels&&($.each(upcomingHotels.region,function(index,value){$("#upcoming-hotels-continent").append('<option value="'+value.code+'">'+value.name+"</option>")}),$("#upcoming-hotels-continent").on("change",function(){for(var i=0;i<upcomingHotels.region.length;i++)""==$(this).val()&&$("#upcoming-hotels-country").html('<option value="">Choose Country</option>'),upcomingHotels.region[i].code==$(this).val()&&($("#upcoming-hotels-country").html('<option value="">Choose Country</option>'),$.each(upcomingHotels.region[i].country,function(index,value){$("#upcoming-hotels-country").append('<option value="'+value.code+'">'+value.name+"</option>")}))})),function(angular){"use strict";angular.module("radBlu").controller("FormController",["$scope","$timeout",function($scope,$timeout){$timeout(function(){function getQueryVariable(variable){for(var query=window.location.search.substring(1),vars=query.split("&"),i=0;i<vars.length;i++){var pair=vars[i].split("=");if(pair[0]==variable)return pair[1]}return!1}$scope.FormController={},0==getQueryVariable("upcomingHotel")&&0==getQueryVariable("newHotelHotel")&&("on"==getQueryVariable("newHotel")?$scope.FormController.newHotel=!0:"on"==getQueryVariable("upcomingHotel")?$scope.FormController.upcomingHotel=!0:($scope.FormController.upcomingHotel=!0,$scope.FormController.newHotel=!0)),"on"==getQueryVariable("upcomingHotel")&&($scope.FormController.upcomingHotel=!0),"on"==getQueryVariable("newHotel")&&($scope.FormController.newHotel=!0),0!=getQueryVariable("upcomingHotelsContinent")&&($("#upcoming-hotels-continent").val(getQueryVariable("upcomingHotelsContinent")),$("#upcoming-hotels-continent").trigger("change")),0!=getQueryVariable("upcomingHotelsCountry")&&$("#upcoming-hotels-country").val(getQueryVariable("upcomingHotelsCountry")),null==window.LOWEST_RATE_FIXTURE&&$scope.openModal("modalContentRefresh.html"),$scope.validateForm=function(){$scope.FormController.upcomingHotel||$scope.FormController.newHotel?document.forms.FormController.submit():$scope.openModal("modalContent.html")}},0)}])}(window.angular),angular.module("radBlu").directive("numberOnly",[function(){"use strict";return{restrict:"A",scope:{numberOnly:"@"},link:function(scope,$el){var getSelectedText=function(){var selText="";if(window.getSelection)if(document.activeElement&&"input"==document.activeElement.tagName.toLowerCase()){var text=document.activeElement.value;try{selText=text.substring(document.activeElement.selectionStart,document.activeElement.selectionEnd)}catch(err){selText=window.getSelection().toString()}}else{var selRange=window.getSelection();selText=selRange.toString()}else if(document.selection.createRange){var range=document.selection.createRange();selText=range.text}return selText};$el.on("click",function(){$(this).select()}),"1-9"==scope.numberOnly?$el.keydown(function(event){var selText=getSelectedText();$(this).val().length<1||$(this).val()==selText?(1==event.shiftKey&&event.preventDefault(),event.keyCode>=49&&event.keyCode<=57||event.keyCode>=97&&event.keyCode<=105||8==event.keyCode||9==event.keyCode||37==event.keyCode||39==event.keyCode||46==event.keyCode||40==event.keyCode||38==event.keyCode||event.preventDefault()):1==$(this).val().length?8==event.keyCode||9==event.keyCode||37==event.keyCode||39==event.keyCode||46==event.keyCode||40==event.keyCode||38==event.keyCode||event.preventDefault():event.preventDefault()}):"1-8"==scope.numberOnly?$el.keydown(function(event){var selText=getSelectedText();$(this).val().length<1||$(this).val()==selText?(1==event.shiftKey&&event.preventDefault(),event.keyCode>=49&&event.keyCode<=56||event.keyCode>=97&&event.keyCode<=104||8==event.keyCode||9==event.keyCode||37==event.keyCode||39==event.keyCode||46==event.keyCode||40==event.keyCode||38==event.keyCode||event.preventDefault()):1==$(this).val().length?8==event.keyCode||9==event.keyCode||37==event.keyCode||39==event.keyCode||46==event.keyCode||40==event.keyCode||38==event.keyCode||event.preventDefault():event.preventDefault();
}):"0-8"==scope.numberOnly&&$el.keydown(function(event){var selText=getSelectedText();$(this).val().length<1||$(this).val()==selText?(1==event.shiftKey&&event.preventDefault(),event.keyCode>=47&&event.keyCode<=56||event.keyCode>=96&&event.keyCode<=104||8==event.keyCode||9==event.keyCode||37==event.keyCode||39==event.keyCode||46==event.keyCode||40==event.keyCode||38==event.keyCode||event.preventDefault()):1==$(this).val().length?8==event.keyCode||9==event.keyCode||37==event.keyCode||39==event.keyCode||46==event.keyCode||40==event.keyCode||38==event.keyCode||event.preventDefault():event.preventDefault()})}}}]),angular.module("radBlu").directive("crDetectMweb",[function(){"use strict";return{restrict:"A",link:function($scope,element,attr){setTimeout(function(){if($("#wrap").hasClass("mobile")&&!$("#wrap").hasClass("tabletportrait")){var action=element.attr("action");"undefined"!=typeof action&&null!==action&&0!==action.indexOf("/mweb")&&0!==action.indexOf("//")&&0!==action.indexOf("http")&&(0!==action.indexOf("/")&&(action="/"+action),element.attr("action","/mweb"+action));var href=element.attr("href");"undefined"!=typeof href&&null!==href&&0!==href.indexOf("/mweb")&&0!==href.indexOf("//")&&0!==href.indexOf("http")&&(0!==href.indexOf("/")&&(href="/"+href),element.attr("href","/mweb"+href))}},200)}}}]),angular.module("radBlu").directive("crPhoneLink",[function(){"use strict";return{restrict:"A",link:function($scope,element,attr){setTimeout(function(){var phoneRegex=/((\+)?(?:[\d]{1,3}){1}\s[\d]{5}\s[\d]{5})|((\+)?(?:[\d]{1,3}){1}\s[\d]{4}\s[\d]{4})|((\+)?(?:[\d]{1,3}){1}\s[\d]{2}\s[\d]{2}\s[\d]{3}\s[\d]{3})|((\+)?(?:[\d]{1,3}){1}\s[\d]{2}\s[\d]{3}\s[\d]{4})|(\+)?(?:\d{1}\s)?\(?(\d{3})\)?-?\s?(\d{3})-?\s?(\d{4})|(\+)?(\d{1})?-?(?:\d{1}\s)?\(?(\d{3})\)?-?\s?(\d{3})-?\s?(\d{4})|((\+)?(?:[\d]{1,3})\s[\d]{1,3}\s[\d]{1,3}\s[\d]{1,4}\s[\d]{1,4})|([\d]{5}\s[\d]{4}\s[\d]{4})|([\d]{5})/g,htmlContent=element.html(),phoneMatches=htmlContent.match(phoneRegex);if(null!=phoneMatches)for(var i=0;i<phoneMatches.length;i++){var phone=phoneMatches[i],modifiedPhone=phone.replace(/\s/g,"").replace(/-/g,"").replace(/\(/g,"").replace(/\)/g,"");htmlContent=$("#wrap").hasClass("mobile")?htmlContent.replace(" "+phone,' <a href="tel:'+modifiedPhone+'">'+phone+"</a>"):htmlContent.replace(" "+phone," <span>"+phone+"</span>")}element.html(htmlContent)},200)}}}]),angular.module("radBlu").directive("crIframeContent",[function(){return{controller:["$scope",function($scope){$scope.resize=function(frame){if("undefined"!=typeof frame.contentWindow&&"undefined"!=typeof frame.contentWindow.document)if(jQuery(frame.contentWindow.document.body).html().length<1){frame.getAttribute("srcdoc");frame.contentWindow.document.write(frame.getAttribute("srcdoc")),frame.style.height="100vh"}else{frame.contentWindow.document.body.scrollHeight;frame.style.height=frame.contentWindow.document.body.scrollHeight+"px"}}}],link:function(scope,iElement,iAttrs,ctrl){jQuery(document).ready(function(){scope.resize(jQuery(iElement))}),jQuery(iElement).load(function(){scope.resize(this)})}}}]),angular.module("radBlu").service("cookieUtilities",[function(){"use strict";window.createStrictCookie=function(name,days){try{var checkboxOptIn=document.getElementById("checkboxOptIn"),checkboxOptOut=document.getElementById("checkboxOptOut"),dateValue="&ts="+(new Date).getTime();"undefined"!=typeof checkboxOptIn&&checkboxOptIn.checked?createCookie(name,"val=40"+dateValue,days):"undefined"!=typeof checkboxOptOut&&checkboxOptOut.checked&&createCookie(name,"val=10"+dateValue,days)}catch(err){console.log(err)}},window.createGeneralCookie=function(name,days){try{var dateValue="&ts="+(new Date).getTime();createCookie(name,"val=40"+dateValue,days)}catch(err){console.log(err)}},window.createCookie=function(name,value,days){try{var expires="";if(days){var date=new Date;date.setTime(date.getTime()+24*days*60*60*1e3),expires="; expires="+date.toGMTString()}document.cookie=name+"="+value+expires+"; path=/"}catch(err){console.log(err)}},window.readCookie=function(name){try{for(var nameEQ=name+"=",ca=document.cookie.split(";"),i=0;i<ca.length;i++){for(var c=ca[i];" "==c.charAt(0);)c=c.substring(1,c.length);if(0==c.indexOf(nameEQ))return c.substring(nameEQ.length,c.length)}return null}catch(err){console.log(err)}},window.eraseCookie=function(name){try{createCookie(name,"",-1)}catch(err){console.log(err)}},window.setLocale=function(sitename,locale){try{console.log("setLocale:: sitename: "+sitename+", locale: "+locale),createCookie("locale",locale,0),createCookie("site",sitename,0)}catch(err){console.log(err)}}}]),angular.module("radBlu").service("micecrowd",[function(){"use strict";return{init:function(){if($(".rb_miceCrowd").length){var locationUrl=($(".rb_miceCrowd-idContainer").val(),$(".rb_miceCrowd-locationUrl").val());$(".rb_miceCrowd-groupId").val();$.when($.getScript("//maps.googleapis.com/maps/api/js?libraries=places"),$.getScript("//cdnjs.cloudflare.com/ajax/libs/geocomplete/1.6.5/jquery.geocomplete.min.js"),$.getScript(locationUrl+"/widget/js/singlevenuepartnerwidgetforconflictingRB.js"),$.Deferred(function(deferred){$(deferred.resolve)})).done(function(){window.singlevenuepartnerwidget&&window.singlevenuepartnerwidget()})}}}}]),angular.module("radBlu").service("debounce",[function(){"use strict";return function(func,wait,immediate){var timeout;return function(){var context=this,args=arguments,later=function(){timeout=null,immediate||func.apply(context,args)},callNow=immediate&&!timeout;clearTimeout(timeout),timeout=setTimeout(later,wait),callNow&&func.apply(context,args)}}}]),angular.module("radBlu").service("lazyLoading",["debounce",function(debounce){"use strict";return{init:function(){function processItem($image,type,useBuffer){var rect=$image[0].getBoundingClientRect(),buffer=useBuffer?bufferSize:0,isInView=rect.top>=0&&rect.bottom<=(window.innerHeight+buffer||document.documentElement.clientHeight+buffer);"srcset"===type?isInView&&$image.attr("data-lazy-srcset")&&($image.attr("srcset",$image.attr("data-lazy-srcset")),$image.removeAttr("data-lazy-srcset")):isInView&&$image.attr("data-lazy-src")&&($image.attr("src",$image.attr("data-lazy-src")),$image.removeAttr("data-lazy-src"))}function onWindowScroll(useBuffer){$.each($("[data-lazy-srcset]"),function(index,item){processItem($(item),"srcset",useBuffer)}),$.each($("[data-lazy-src]"),function(index,item){processItem($(item),null,useBuffer)})}var bufferSize=0,scrollDebounce=debounce(function(){onWindowScroll(!0)},50);$(window).on("scroll",scrollDebounce),$("document").ready(function(){onWindowScroll(!1)})}}}]),angular.module("radBlu").service("navPositions",[function(){"use strict";return{init:function(){this.desktopNavPosition(),this.bindEvents()},desktopNavPosition:function(){var self=this;setTimeout(function(){var navHeight=$("#header").outerHeight(),searchHeight=$(".search").outerHeight(),searchVisible=$(".search").hasClass("search--visible"),bodyWidth=$("body").width(),wrapWidth=$("#wrap").width(),bodyScroll=$("body").hasClass("menu-visible"),vScroll=$("body").height()>$(window).height(),adjstmnt=vScroll&&!bodyScroll?16:0,menuPosition=0,wrapPosition=Math.floor($("#wrap").offset().left);searchVisible&&(navHeight-=searchHeight),self.isDisplayRTL()?(menuPosition=bodyWidth!==wrapWidth?wrapPosition+adjstmnt/2:wrapPosition,$(".nav-container").css({top:navHeight+"px",left:menuPosition+"px",right:"auto"})):(menuPosition=bodyWidth!==wrapWidth?bodyWidth-(wrapPosition+wrapWidth)+adjstmnt/2-1:bodyWidth-(wrapPosition+wrapWidth),$(".nav-container").css({top:navHeight+"px",right:menuPosition+"px",left:"auto"}))},40)},isDisplayRTL:function(){return $('html[dir="rtl"]').length>0},bindEvents:function(){var self=this;$(window).resize(_.debounce(function(){self.desktopNavPosition()},10)).trigger("resize"),$(window).scroll(_.debounce(function(){self.desktopNavPosition()},10))}}}]),angular.module("radBlu").service("socialMediaFeeds",[function(){"use strict";return{init:function(){this.simpleCarousel=$(".rb_socialMediaFeed-socialSimpleCarousel"),this.interactiveCarousel=$(".rb_socialMediaFeed-socialInteractiveCarousel"),this.imageWrappers=$(".rb_socialMediaFeed-carouselItem, .rb_socialMediaFeed-shareImage"),this.setupFeedCarousels(),this.bindEvents()},setupFeedCarousels:function(){var self=this;self.simpleCarousel.length>0&&self.simpleCarousel.slick({fade:!0,arrows:!1,autoplay:!0,autoplaySpeed:4e3}),self.interactiveCarousel.length>0&&self.interactiveCarousel.slick({arrows:!1,autoplay:!0,autoplaySpeed:1e4,slidesToShow:5,slidesToScroll:5,responsive:[{breakpoint:1280,settings:{slidesToShow:4,slidesToScroll:4}},{breakpoint:1024,settings:{slidesToShow:3,slidesToScroll:3}},{breakpoint:768,settings:{slidesToShow:2,slidesToScroll:2}}],onInit:function(slick){self.imagesLoaded()}})},imagesLoaded:function(){var self=this,images=$(".rb_socialMediaFeed-carouselItem .rb_mediaImage");images.one("load",function(e){self.fitImageToContainer(e.target)}).each(function(){this.complete&&$(this).load()})},fitImageToContainer:function(image){var img=$(image),container=img.parents(".rb_socialMediaFeed-shareImage"),containerRatio=$(container).height()/$(container).width(),imageRatio=img[0].naturalHeight/img[0].naturalWidth;this.interactiveCarousel.find(".rb_socialMediaFeed-carouselItem").height($(container).width()),this.interactiveCarousel.find(".rb_socialMediaFeed-shareImage, .rb_mediaImage-wrapper").height($(container).width()),imageRatio<containerRatio?(img.css("height","100%"),img.css("width","auto"),img.removeClass("rb_mediaImage--fitHorizontal"),img.addClass("rb_mediaImage--fitVertical")):(img.css("width","100%"),img.css("height","auto"),img.removeClass("rb_mediaImage--fitVertical"),img.addClass("rb_mediaImage--fitHorizontal"))},bindEvents:function(){var self=this;$(window).resize(_.debounce(function(){self.interactiveCarousel.slickGoTo(0),self.imagesLoaded()},100)).trigger("resize")}}}]),angular.module("radBlu").service("picturePolyfill",[function(){"use strict";return{init:function(){var userAgent=navigator.userAgent;if(userAgent.indexOf("MSIE ")!==-1||userAgent.indexOf("Trident/")!==-1){var attributes=["[data-gallery-srcset]","[data-lazy-srcset]","[srcset]"],selector=attributes.join(" ,"),elements=$(selector);$.each(elements,function(i,item){var $item=$(item);if("IMG"===item.tagName)for(var i=0;i<attributes.length;i++){var attribute=attributes[i].replace("[","").replace("]",""),attributeValue=$item.attr(attribute);if(attributeValue){$item.attr("src",attributeValue),$item.removeAttr(attribute);var parent=$item.parent();if(parent.length&&"PICTURE"===parent[0].tagName){var sources=parent.find("source");if(sources.length){var source=$(sources[0]),src=source.attr(attribute);src&&src.indexOf(",")!==-1&&(src=src.split(",")[0]),$item.attr("src",src)}}break}}})}}}}]),angular.module("radBlu").service("accordion",[function(){"use strict";return{init:function(){this.accordionTrigger=$(".rb_accordion"),this.bindEvents()},bindEvents:function(){this.accordionTrigger.on("click",function(e){var $this=$(this),parentAccordion=$this.parents().find(".rb_accordion"),headerHeight=$(".header").outerHeight();if($this.hasClass("rb_accordion--expand"))$this.removeClass("rb_accordion--expand");else{parentAccordion.removeClass("rb_accordion--expand"),$this.addClass("rb_accordion--expand");var scrollUp=$this.offset().top-headerHeight;$("body").animate({scrollTop:scrollUp},600)}})}}}]);
//# sourceMappingURL=scripts.min.js.map